import { processError } from '../utils/processError.mjs';
import { validateDependencies } from '../utils/validateDependencies.mjs';
import { config } from 'dotenv';
import path from 'path';
export function loadEnv() {
	try {
		const envPath = path.join(process.cwd(), './backend.dev.env');
		console.log(`Loading environment variables from ${envPath}`);
		config({ path: envPath });
	} catch (error) {
		processError(error, console);
	}
}
loadEnv();
export const environmentVariables = {
	backendLogExportPath: process.env.BACKEND_LOG_EXPORT_PATH || '',
	emailUser: process.env.EMAIL_USER || '',
	featureApiRoutesCsrf: process.env.FEATURE_API_ROUTES_CSRF === 'true',
	featureDbSync: process.env.FEATURE_DB_SYNC === 'true',
	featureDecryptKeys: process.env.FEATURE_DECRYPT_KEYS === 'true',
	featureEnableErrorHandler:
		process.env.FEATURE_ENABLE_ERROR_HANDLER === 'true',
	featureEnableIpBlacklist:
		process.env.FEATURE_ENABLE_IP_BLACKLIST === 'true',
	featureEnableJwtAuth: process.env.FEATURE_ENABLE_JWT_AUTH === 'true',
	featureEnableRateLimit: process.env.FEATURE_ENABLE_RATE_LIMIT === 'true',
	featureEnableRedis: process.env.FEATURE_ENABLE_REDIS === 'true',
	featureEnableSession: process.env.FEATURE_ENABLE_SESSION === 'true',
	featureEnableSsl: process.env.FEATURE_ENABLE_SSL === 'true',
	featureHttpsRedirect: process.env.FEATURE_HTTPS_REDIRECT === 'true',
	featureLoadTestRoutes: process.env.FEATURE_LOAD_TEST_ROUTES === 'true',
	featureSequelizeLogging: process.env.FEATURE_SEQUELIZE_LOGGING === 'true',
	frontendAppJsPath: process.env.FRONTEND_APP_JS_PATH || '',
	frontendBrowserConfigXmlPath:
		process.env.FRONTEND_BROWSER_CONFIG_XML_PATH || '',
	frontendCssPath: process.env.FRONTEND_CSS_PATH || '',
	frontendFontsPath: process.env.FRONTEND_FONTS_PATH || '',
	frontendHumansMdPath: process.env.FRONTEND_HUMANS_MD_PATH || '',
	frontendIconsPath: process.env.FRONTEND_ICONS_PATH || '',
	frontendImagesPath: process.env.FRONTEND_IMAGES_PATH || '',
	frontendJsPath: process.env.FRONTEND_JS_PATH || '',
	frontendKeysPath: process.env.FRONTEND_KEYS_PATH || '',
	frontendLogosPath: process.env.FRONTEND_LOGOS_PATH || '',
	frontendRobotsTxtPath: process.env.FRONTEND_ROBOTS_TXT_PATH || '',
	frontendSecurityMdPath: process.env.FRONTEND_SECURITY_MD_PATH || '',
	frontendSecretsPath: process.env.FRONTEND_SECRETS_PATH || '',
	frontendSitemapXmlPath: process.env.FRONTEND_SITEMAP_XML_PATH || '',
	ipBlacklistPath: process.env.IP_BLACKLIST_PATH || '',
	loggerLevel: process.env.LOGGER || '1',
	logLevel: process.env.LOG_LEVEL,
	nodeEnv: process.env.NODE_ENV,
	serverDataFilePath1: process.env.SERVER_DATA_FILE_PATH_1 || '',
	serverDataFilePath2: process.env.SERVER_DATA_FILE_PATH_2 || '',
	serverDataFilePath3: process.env.SERVER_DATA_FILE_PATH_3 || '',
	serverDataFilePath4: process.env.SERVER_DATA_FILE_PATH_4 || '',
	serverLogPath: process.env.SERVER_LOG_PATH || '',
	serverNpmLogPath: process.env.SERVER_NPM_LOG_PATH || '',
	serverPort: parseInt(process.env.SERVER_PORT || '3000', 10),
	serverSslCertPath: process.env.SERVER_SSL_CERT_PATH || '',
	serverSslKeyPath: process.env.SERVER_SSL_KEY_PATH || '',
	serviceName: process.env.SERVICE_NAME || '',
	staticRootPath: process.env.STATIC_ROOT_PATH || '',
	yubicoApiUrl: process.env.YUBICO_API_URL || ''
};
export const FeatureFlagNames = {
	API_ROUTES_CSR: 'FEATURE_API_ROUTES_CSRF',
	DB_SYNC: 'FEATURE_DB_SYNC',
	DECRYPT_KEYS: 'FEATURE_DECRYPT_KEYS',
	ENABLE_CSRF: 'FEATURE_ENABLE_CSRF',
	ENABLE_ERROR_HANDLER: 'FEATURE_ENABLE_ERROR_HANDLER',
	ENABLE_IP_BLACKLIST: 'FEATURE_ENABLE_IP_BLACKLIST',
	ENABLE_JWT_AUTH: 'FEATURE_ENABLE_JWT_AUTH',
	ENABLE_RATE_LIMIT: 'FEATURE_ENABLE_RATE_LIMIT',
	ENABLE_REDIS: 'FEATURE_ENABLE_REDIS',
	ENABLE_SSL: 'FEATURE_ENABLE_SSL',
	HTTPS_REDIRECT: 'FEATURE_HTTPS_REDIRECT',
	LOAD_TEST_ROUTES: 'FEATURE_LOAD_TEST_ROUTES',
	SECURE_HEADERS: 'FEATURE_SECURE_HEADERS',
	SEQUELIZE_LOGGING: 'FEATURE_SEQUELIZE_LOGGING'
};
export function parseBoolean(value, logger) {
	try {
		validateDependencies(
			[
				{ name: 'logger', instance: logger },
				{ name: 'value', instance: value }
			],
			logger
		);
		if (value === undefined) {
			logger.warn('Feature flag value is undefined. Defaulting to false');
			return false;
		}
		if (typeof value === 'string') {
			return value.toLowerCase() === 'true';
		}
		return value === true;
	} catch (error) {
		processError(error, logger || console);
		return false;
	}
}
export function getFeatureFlags(logger, env = process.env) {
	try {
		validateDependencies(
			[
				{ name: 'logger', instance: logger },
				{ name: 'env', instance: env }
			],
			logger || console
		);
		return {
			apiRoutesCsrfFlag: parseBoolean(
				env.FEATURE_API_ROUTES_CSRF,
				logger
			),
			dbSyncFlag: parseBoolean(env.FEATURE_DB_SYNC, logger),
			decryptKeysFlag: parseBoolean(env.FEATURE_DECRYPT_KEYS, logger),
			enableErrorHandlerFlag: parseBoolean(
				env.FEATURE_ENABLE_ERROR_HANDLER,
				logger
			),
			enableIpBlacklistFlag: parseBoolean(
				env.FEATURE_ENABLE_IP_BLACKLIST,
				logger
			),
			enableJwtAuthFlag: parseBoolean(
				env.FEATURE_ENABLE_JWT_AUTH,
				logger
			),
			enableRateLimitFlag: parseBoolean(
				env.FEATURE_ENABLE_RATE_LIMIT,
				logger
			),
			enableRedisFlag: parseBoolean(env.FEATURE_ENABLE_REDIS, logger),
			enableSslFlag: parseBoolean(env.FEATURE_ENABLE_SSL, logger),
			httpsRedirectFlag: parseBoolean(env.FEATURE_HTTPS_REDIRECT, logger),
			loadTestRoutesFlag: parseBoolean(
				env.FEATURE_LOAD_TEST_ROUTES,
				logger
			),
			sequelizeLoggingFlag: parseBoolean(
				env.FEATURE_SEQUELIZE_LOGGING,
				logger
			)
		};
	} catch (error) {
		processError(error, logger || console);
		logger.error(`Returning 'false' for all feature flags`);
		return {
			apiRoutesCsrfFlag: false,
			dbSyncFlag: false,
			decryptKeysFlag: false,
			enableErrorHandlerFlag: false,
			enableIpBlacklistFlag: false,
			enableJwtAuthFlag: false,
			enableRateLimitFlag: false,
			enableRedisFlag: false,
			enableSslFlag: false,
			httpsRedirectFlag: false,
			loadTestRoutesFlag: false,
			sequelizeLoggingFlag: false
		};
	}
}
export function createFeatureEnabler(logger) {
	try {
		validateDependencies(
			[{ name: 'logger', instance: logger }],
			logger || console
		);
		return {
			enableFeatureBasedOnFlag(flag, description, callback) {
				if (flag) {
					logger.info(`Enabling ${description} (flag is ${flag})`);
					callback();
				} else {
					logger.info(`Skipping ${description} (flag is ${flag})`);
				}
			},
			enableFeatureWithProdOverride(flag, description, callback) {
				if (process.env.NODE_ENV === 'production') {
					logger.info(
						`Enabling ${description} in production regardless of flag value.`
					);
					callback();
				} else if (flag) {
					logger.info(`Enabling ${description} (flag is ${flag})`);
					callback();
				} else {
					logger.info(`Skipping ${description} (flag is ${flag})`);
				}
			}
		};
	} catch (error) {
		processError(error, logger || console);
		return {
			enableFeatureBasedOnFlag: () => {},
			enableFeatureWithProdOverride: () => {}
		};
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW52aXJvbm1lbnRDb25maWcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY29uZmlnL2Vudmlyb25tZW50Q29uZmlnLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNyRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ2hDLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUd4QixNQUFNLFVBQVUsT0FBTztJQUN0QixJQUFJLENBQUM7UUFDSixNQUFNLE9BQU8sR0FDWixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0NBQXNDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFFN0QsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDaEIsWUFBWSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM5QixDQUFDO0FBQ0YsQ0FBQztBQUVELE9BQU8sRUFBRSxDQUFDO0FBa0RWLE1BQU0sQ0FBQyxNQUFNLG9CQUFvQixHQUE2QjtJQUM3RCxvQkFBb0IsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLHVCQUF1QixJQUFJLEVBQUU7SUFDL0QsU0FBUyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxJQUFJLEVBQUU7SUFDdkMsb0JBQW9CLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsS0FBSyxNQUFNO0lBQ3BFLGFBQWEsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsS0FBSyxNQUFNO0lBQ3JELGtCQUFrQixFQUFFLE9B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LENBQUM7SUFDTixDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixZQUFZLENBQUMsS0FBSyxFQUFFLE1BQU0sSUFBSSxPQUFPLENBQUMsQ0FBQztRQUN2QyxPQUFPO1lBQ04sd0JBQXdCLEVBQUUsR0FBRyxFQUFFLEdBQUUsQ0FBQztZQUNsQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUUsR0FBRSxDQUFDO1NBQ3ZDLENBQUM7SUFDSCxDQUFDO0FBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHByb2Nlc3NFcnJvciB9IGZyb20gJy4uL3V0aWxzL3Byb2Nlc3NFcnJvcic7XG5pbXBvcnQgeyB2YWxpZGF0ZURlcGVuZGVuY2llcyB9IGZyb20gJy4uL3V0aWxzL3ZhbGlkYXRlRGVwZW5kZW5jaWVzJztcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJ2RvdGVudic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4vbG9nZ2VyJztcblxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRFbnYoKTogdm9pZCB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgZW52UGF0aCA9XG5cdFx0XHRwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJy4vYmFja2VuZC5kZXYuZW52Jyk7XG5cdFx0Y29uc29sZS5sb2coYExvYWRpbmcgZW52aXJvbm1lbnQgdmFyaWFibGVzIGZyb20gJHtlbnZQYXRofWApO1xuXG5cdFx0Y29uZmlnKHsgcGF0aDogZW52UGF0aCB9KTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRwcm9jZXNzRXJyb3IoZXJyb3IsIGNvbnNvbGUpO1xuXHR9XG59XG5cbmxvYWRFbnYoKTtcblxuaW50ZXJmYWNlIEVudmlyb25tZW50VmFyaWFibGVUeXBlcyB7XG5cdGJhY2tlbmRMb2dFeHBvcnRQYXRoOiBzdHJpbmc7XG5cdGVtYWlsVXNlcjogc3RyaW5nO1xuXHRmZWF0dXJlQXBpUm91dGVzQ3NyZjogYm9vbGVhbjtcblx0ZmVhdHVyZURiU3luYzogYm9vbGVhbjtcblx0ZmVhdHVyZURlY3J5cHRLZXlzOiBib29sZWFuO1xuXHRmZWF0dXJlRW5hYmxlRXJyb3JIYW5kbGVyOiBib29sZWFuO1xuXHRmZWF0dXJlRW5hYmxlSXBCbGFja2xpc3Q6IGJvb2xlYW47XG5cdGZlYXR1cmVFbmFibGVKd3RBdXRoOiBib29sZWFuO1xuXHRmZWF0dXJlRW5hYmxlUmF0ZUxpbWl0OiBib29sZWFuO1xuXHRmZWF0dXJlRW5hYmxlUmVkaXM6IGJvb2xlYW47XG5cdGZlYXR1cmVFbmFibGVTZXNzaW9uOiBib29sZWFuO1xuXHRmZWF0dXJlRW5hYmxlU3NsOiBib29sZWFuO1xuXHRmZWF0dXJlSHR0cHNSZWRpcmVjdDogYm9vbGVhbjtcblx0ZmVhdHVyZUxvYWRUZXN0Um91dGVzOiBib29sZWFuO1xuXHRmZWF0dXJlU2VxdWVsaXplTG9nZ2luZzogYm9vbGVhbjtcblx0ZnJvbnRlbmRBcHBKc1BhdGg6IHN0cmluZztcblx0ZnJvbnRlbmRCcm93c2VyQ29uZmlnWG1sUGF0aDogc3RyaW5nO1xuXHRmcm9udGVuZENzc1BhdGg6IHN0cmluZztcblx0ZnJvbnRlbmRGb250c1BhdGg6IHN0cmluZztcblx0ZnJvbnRlbmRIdW1hbnNNZFBhdGg6IHN0cmluZztcblx0ZnJvbnRlbmRJY29uc1BhdGg6IHN0cmluZztcblx0ZnJvbnRlbmRJbWFnZXNQYXRoOiBzdHJpbmc7XG5cdGZyb250ZW5kSnNQYXRoOiBzdHJpbmc7XG5cdGZyb250ZW5kS2V5c1BhdGg6IHN0cmluZztcblx0ZnJvbnRlbmRMb2dvc1BhdGg6IHN0cmluZztcblx0ZnJvbnRlbmRSb2JvdHNUeHRQYXRoOiBzdHJpbmc7XG5cdGZyb250ZW5kU2VjdXJpdHlNZFBhdGg6IHN0cmluZztcblx0ZnJvbnRlbmRTZWNyZXRzUGF0aDogc3RyaW5nO1xuXHRmcm9udGVuZFNpdGVtYXBYbWxQYXRoOiBzdHJpbmc7XG5cdGlwQmxhY2tsaXN0UGF0aDogc3RyaW5nO1xuXHRsb2dnZXJMZXZlbDogc3RyaW5nO1xuXHRsb2dMZXZlbDogJ2RlYnVnJyB8ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcic7XG5cdG5vZGVFbnY6ICdkZXZlbG9wbWVudCcgfCAndGVzdGluZycgfCAncHJvZHVjdGlvbic7XG5cdHNlcnZlckRhdGFGaWxlUGF0aDE6IHN0cmluZztcblx0c2VydmVyRGF0YUZpbGVQYXRoMjogc3RyaW5nO1xuXHRzZXJ2ZXJEYXRhRmlsZVBhdGgzOiBzdHJpbmc7XG5cdHNlcnZlckRhdGFGaWxlUGF0aDQ6IHN0cmluZztcblx0c2VydmVyTG9nUGF0aDogc3RyaW5nO1xuXHRzZXJ2ZXJOcG1Mb2dQYXRoOiBzdHJpbmc7XG5cdHNlcnZlclBvcnQ6IG51bWJlcjtcblx0c2VydmVyU3NsQ2VydFBhdGg6IHN0cmluZztcblx0c2VydmVyU3NsS2V5UGF0aDogc3RyaW5nO1xuXHRzZXJ2aWNlTmFtZTogc3RyaW5nO1xuXHRzdGF0aWNSb290UGF0aDogc3RyaW5nO1xuXHR5dWJpY29BcGlVcmw6IHN0cmluZztcbn1cblxuZXhwb3J0IGNvbnN0IGVudmlyb25tZW50VmFyaWFibGVzOiBFbnZpcm9ubWVudFZhcmlhYmxlVHlwZXMgPSB7XG5cdGJhY2tlbmRMb2dFeHBvcnRQYXRoOiBwcm9jZXNzLmVudi5CQUNLRU5EX0xPR19FWFBPUlRfUEFUSCB8fCAnJyxcblx0ZW1haWxVc2VyOiBwcm9jZXNzLmVudi5FTUFJTF9VU0VSIHx8ICcnLFxuXHRmZWF0dXJlQXBpUm91dGVzQ3NyZjogcHJvY2Vzcy5lbnYuRkVBVFVSRV9BUElfUk9VVEVTX0NTUkYgPT09ICd0cnVlJyxcblx0ZmVhdHVyZURiU3luYzogcHJvY2Vzcy5lbnYuRkVBVFVSRV9EQl9TWU5DID09PSAndHJ1ZScsXG5cdGZlYXR1cmVEZWNyeXB0S2V5czogcHJvY2Vzcy5lbnYuRkVBVFVSRV9ERUNSWVBUX0tFWVMgPT09ICd0cnVlJyxcblx0ZmVhdHVyZUVuYWJsZUVycm9ySGFuZGxlcjogcHJvY2Vzcy5lbnYuRkVBVFVSRV9FTkFCTEVfRVJST1JfSEFORExFUiA9PT0gJ3RydWUnLFxuXHRmZWF0dXJlRW5hYmxlSXBCbGFja2xpc3Q6IHByb2Nlc3MuZW52LkZFQVRVUkVfRU5BQkxFX0lQX0JMQUNLTElTVCA9PT0gJ3RydWUnLFxuXHRmZWF0dXJlRW5hYmxlSnd0QXV0aDogcHJvY2Vzcy5lbnYuRkVBVFVSRV9FTkFCTEVfSldUX0FVVEggPT09ICd0cnVlJyxcblx0ZmVhdHVyZUVuYWJsZVJhdGVMaW1pdDogcHJvY2Vzcy5lbnYuRkVBVFVSRV9FTkFCTEVfUkFURV9MSU1JVCA9PT0gJ3RydWUnLFxuXHRmZWF0dXJlRW5hYmxlUmVkaXM6IHByb2Nlc3MuZW52LkZFQVRVUkVfRU5BQkxFX1JFRElTID09PSAndHJ1ZScsXG5cdGZlYXR1cmVFbmFibGVTZXNzaW9uOiBwcm9jZXNzLmVudi5GRUFUVVJFX0VOQUJMRV9TRVNTSU9OID09PSAndHJ1ZScsXG5cdGZlYXR1cmVFbmFibGVTc2w6IHByb2Nlc3MuZW52LkZFQVRVUkVfRU5BQkxFX1NTTCA9PT0gJ3RydWUnLFxuXHRmZWF0dXJlSHR0cHNSZWRpcmVjdDogcHJvY2Vzcy5lbnYuRkVBVFVSRV9IVFRQU19SRURJUkVDVCA9PT0gJ3RydWUnLFxuXHRmZWF0dXJlTG9hZFRlc3RSb3V0ZXM6IHByb2Nlc3MuZW52LkZFQVRVUkVfTE9BRF9URVNUX1JPVVRFUyA9PT0gJ3RydWUnLFxuXHRmZWF0dXJlU2VxdWVsaXplTG9nZ2luZzogcHJvY2Vzcy5lbnYuRkVBVFVSRV9TRVFVRUxJWkVfTE9HR0lORyA9PT0gJ3RydWUnLFxuXHRmcm9udGVuZEFwcEpzUGF0aDogcHJvY2Vzcy5lbnYuRlJPTlRFTkRfQVBQX0pTX1BBVEggfHwgJycsXG5cdGZyb250ZW5kQnJvd3NlckNvbmZpZ1htbFBhdGg6IHByb2Nlc3MuZW52LkZST05URU5EX0JST1dTRVJfQ09ORklHX1hNTF9QQVRIIHx8ICcnLFxuXHRmcm9udGVuZENzc1BhdGg6IHByb2Nlc3MuZW52LkZST05URU5EX0NTU19QQVRIIHx8ICcnLFxuXHRmcm9udGVuZEZvbnRzUGF0aDogcHJvY2Vzcy5lbnYuRlJPTlRFTkRfRk9OVFNfUEFUSCB8fCAnJyxcblx0ZnJvbnRlbmRIdW1hbnNNZFBhdGg6IHByb2Nlc3MuZW52LkZST05URU5EX0hVTUFOU19NRF9QQVRIIHx8ICcnLFxuXHRmcm9udGVuZEljb25zUGF0aDogcHJvY2Vzcy5lbnYuRlJPTlRFTkRfSUNPTlNfUEFUSCB8fCAnJyxcblx0ZnJvbnRlbmRJbWFnZXNQYXRoOiBwcm9jZXNzLmVudi5GUk9OVEVORF9JTUFHRVNfUEFUSCB8fCAnJyxcblx0ZnJvbnRlbmRKc1BhdGg6IHByb2Nlc3MuZW52LkZST05URU5EX0pTX1BBVEggfHwgJycsXG5cdGZyb250ZW5kS2V5c1BhdGg6IHByb2Nlc3MuZW52LkZST05URU5EX0tFWVNfUEFUSCB8fCAnJyxcblx0ZnJvbnRlbmRMb2dvc1BhdGg6IHByb2Nlc3MuZW52LkZST05URU5EX0xPR09TX1BBVEggfHwgJycsXG5cdGZyb250ZW5kUm9ib3RzVHh0UGF0aDogcHJvY2Vzcy5lbnYuRlJPTlRFTkRfUk9CT1RTX1RYVF9QQVRIIHx8ICcnLFxuXHRmcm9udGVuZFNlY3VyaXR5TWRQYXRoOiBwcm9jZXNzLmVudi5GUk9OVEVORF9TRUNVUklUWV9NRF9QQVRIIHx8ICcnLFxuXHRmcm9udGVuZFNlY3JldHNQYXRoOiBwcm9jZXNzLmVudi5GUk9OVEVORF9TRUNSRVRTX1BBVEggfHwgJycsXG5cdGZyb250ZW5kU2l0ZW1hcFhtbFBhdGg6IHByb2Nlc3MuZW52LkZST05URU5EX1NJVEVNQVBfWE1MX1BBVEggfHwgJycsXG5cdGlwQmxhY2tsaXN0UGF0aDogcHJvY2Vzcy5lbnYuSVBfQkxBQ0tMSVNUX1BBVEggfHwgJycsXG5cdGxvZ2dlckxldmVsOiBwcm9jZXNzLmVudi5MT0dHRVIgfHwgJzEnLFxuXHRsb2dMZXZlbDogcHJvY2Vzcy5lbnYuTE9HX0xFVkVMIGFzICdkZWJ1ZycgfCAnaW5mbycgfCAnd2FybicgfCAnZXJyb3InLFxuXHRub2RlRW52OiBwcm9jZXNzLmVudi5OT0RFX0VOViBhcyAnZGV2ZWxvcG1lbnQnIHwgJ3Rlc3RpbmcnIHwgJ3Byb2R1Y3Rpb24nLFxuXHRzZXJ2ZXJEYXRhRmlsZVBhdGgxOiBwcm9jZXNzLmVudi5TRVJWRVJfREFUQV9GSUxFX1BBVEhfMSB8fCAnJyxcblx0c2VydmVyRGF0YUZpbGVQYXRoMjogcHJvY2Vzcy5lbnYuU0VSVkVSX0RBVEFfRklMRV9QQVRIXzIgfHwgJycsXG5cdHNlcnZlckRhdGFGaWxlUGF0aDM6IHByb2Nlc3MuZW52LlNFUlZFUl9EQVRBX0ZJTEVfUEFUSF8zIHx8ICcnLFxuXHRzZXJ2ZXJEYXRhRmlsZVBhdGg0OiBwcm9jZXNzLmVudi5TRVJWRVJfREFUQV9GSUxFX1BBVEhfNCB8fCAnJyxcblx0c2VydmVyTG9nUGF0aDogcHJvY2Vzcy5lbnYuU0VSVkVSX0xPR19QQVRIIHx8ICcnLFxuXHRzZXJ2ZXJOcG1Mb2dQYXRoOiBwcm9jZXNzLmVudi5TRVJWRVJfTlBNX0xPR19QQVRIIHx8ICcnLFxuXHRzZXJ2ZXJQb3J0OiBwYXJzZUludChwcm9jZXNzLmVudi5TRVJWRVJfUE9SVCB8fCAnMzAwMCcsIDEwKSxcblx0c2VydmVyU3NsQ2VydFBhdGg6IHByb2Nlc3MuZW52LlNFUlZFUl9TU0xfQ0VSVF9QQVRIIHx8ICcnLFxuXHRzZXJ2ZXJTc2xLZXlQYXRoOiBwcm9jZXNzLmVudi5TRVJWRVJfU1NMX0tFWV9QQVRIIHx8ICcnLFxuXHRzZXJ2aWNlTmFtZTogcHJvY2Vzcy5lbnYuU0VSVklDRV9OQU1FIHx8ICcnLFxuXHRzdGF0aWNSb290UGF0aDogcHJvY2Vzcy5lbnYuU1RBVElDX1JPT1RfUEFUSCB8fCAnJyxcblx0eXViaWNvQXBpVXJsOiBwcm9jZXNzLmVudi5ZVUJJQ09fQVBJX1VSTCB8fCAnJ1xufTtcblxuZXhwb3J0IGNvbnN0IEZlYXR1cmVGbGFnTmFtZXMgPSB7XG5cdEFQSV9ST1VURVNfQ1NSOiAnRkVBVFVSRV9BUElfUk9VVEVTX0NTUkYnLFxuXHREQl9TWU5DOiAnRkVBVFVSRV9EQl9TWU5DJyxcblx0REVDUllQVF9LRVlTOiAnRkVBVFVSRV9ERUNSWVBUX0tFWVMnLFxuXHRFTkFCTEVfQ1NSRjogJ0ZFQVRVUkVfRU5BQkxFX0NTUkYnLFxuXHRFTkFCTEVfRVJST1JfSEFORExFUjogJ0ZFQVRVUkVfRU5BQkxFX0VSUk9SX0hBTkRMRVInLFxuXHRFTkFCTEVfSVBfQkxBQ0tMSVNUOiAnRkVBVFVSRV9FTkFCTEVfSVBfQkxBQ0tMSVNUJyxcblx0RU5BQkxFX0pXVF9BVVRIOiAnRkVBVFVSRV9FTkFCTEVfSldUX0FVVEgnLFxuXHRFTkFCTEVfUkFURV9MSU1JVDogJ0ZFQVRVUkVfRU5BQkxFX1JBVEVfTElNSVQnLFxuXHRFTkFCTEVfUkVESVM6ICdGRUFUVVJFX0VOQUJMRV9SRURJUycsXG5cdEVOQUJMRV9TU0w6ICdGRUFUVVJFX0VOQUJMRV9TU0wnLFxuXHRIVFRQU19SRURJUkVDVDogJ0ZFQVRVUkVfSFRUUFNfUkVESVJFQ1QnLFxuXHRMT0FEX1RFU1RfUk9VVEVTOiAnRkVBVFVSRV9MT0FEX1RFU1RfUk9VVEVTJyxcblx0U0VDVVJFX0hFQURFUlM6ICdGRUFUVVJFX1NFQ1VSRV9IRUFERVJTJyxcblx0U0VRVUVMSVpFX0xPR0dJTkc6ICdGRUFUVVJFX1NFUVVFTElaRV9MT0dHSU5HJ1xufSBhcyBjb25zdDtcblxuZXhwb3J0IHR5cGUgRmVhdHVyZUZsYWdOYW1lc1R5cGUgPSBrZXlvZiB0eXBlb2YgRmVhdHVyZUZsYWdOYW1lcztcblxuZXhwb3J0IHR5cGUgRmVhdHVyZUZsYWdWYWx1ZVR5cGUgPSB0eXBlb2YgRmVhdHVyZUZsYWdOYW1lc1tGZWF0dXJlRmxhZ05hbWVzVHlwZV07XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVhdHVyZUZsYWdzIHtcblx0YXBpUm91dGVzQ3NyZkZsYWc6IGJvb2xlYW47XG5cdGRiU3luY0ZsYWc6IGJvb2xlYW47XG5cdGRlY3J5cHRLZXlzRmxhZzogYm9vbGVhbjtcblx0ZW5hYmxlRXJyb3JIYW5kbGVyRmxhZzogYm9vbGVhbjtcblx0ZW5hYmxlSXBCbGFja2xpc3RGbGFnOiBib29sZWFuO1xuXHRlbmFibGVKd3RBdXRoRmxhZzogYm9vbGVhbjtcblx0ZW5hYmxlUmF0ZUxpbWl0RmxhZzogYm9vbGVhbjtcblx0ZW5hYmxlUmVkaXNGbGFnOiBib29sZWFuO1xuXHRlbmFibGVTc2xGbGFnOiBib29sZWFuO1xuXHRodHRwc1JlZGlyZWN0RmxhZzogYm9vbGVhbjtcblx0bG9hZFRlc3RSb3V0ZXNGbGFnOiBib29sZWFuO1xuXHRzZXF1ZWxpemVMb2dnaW5nRmxhZzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQm9vbGVhbihcblx0dmFsdWU6IHN0cmluZyB8IGJvb2xlYW4gfCB1bmRlZmluZWQsXG5cdGxvZ2dlcjogTG9nZ2VyIHwgQ29uc29sZVxuKTogYm9vbGVhbiB7XG5cdHRyeSB7XG5cdFx0dmFsaWRhdGVEZXBlbmRlbmNpZXMoXG5cdFx0XHRbXG5cdFx0XHRcdHsgbmFtZTogJ2xvZ2dlcicsIGluc3RhbmNlOiBsb2dnZXIgfSxcblx0XHRcdFx0eyBuYW1lOiAndmFsdWUnLCBpbnN0YW5jZTogdmFsdWUgfVxuXHRcdFx0XSxcblx0XHRcdGxvZ2dlclxuXHRcdClcblxuXHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRsb2dnZXIud2FybignRmVhdHVyZSBmbGFnIHZhbHVlIGlzIHVuZGVmaW5lZC4gRGVmYXVsdGluZyB0byBmYWxzZScpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0XHRpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuXHRcdFx0cmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJztcblx0XHR9XG5cdFx0cmV0dXJuIHZhbHVlID09PSB0cnVlO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdHByb2Nlc3NFcnJvcihlcnJvciwgbG9nZ2VyIHx8IGNvbnNvbGUpO1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmVhdHVyZUZsYWdzKFxuXHRsb2dnZXI6IExvZ2dlciB8IENvbnNvbGUsXG5cdGVudjogUGFydGlhbDxOb2RlSlMuUHJvY2Vzc0Vudj4gPSBwcm9jZXNzLmVudlxuKTogRmVhdHVyZUZsYWdzIHtcblx0dHJ5IHtcblx0XHR2YWxpZGF0ZURlcGVuZGVuY2llcyhcblx0XHRcdFtcblx0XHRcdFx0eyBuYW1lOiAnbG9nZ2VyJywgaW5zdGFuY2U6IGxvZ2dlciB9LFxuXHRcdFx0XHR7IG5hbWU6ICdlbnYnLCBpbnN0YW5jZTogZW52IH1cblx0XHRcdF0sXG5cdFx0XHRsb2dnZXIgfHwgY29uc29sZVxuXHRcdCk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0YXBpUm91dGVzQ3NyZkZsYWc6IHBhcnNlQm9vbGVhbihlbnYuRkVBVFVSRV9BUElfUk9VVEVTX0NTUkYsIGxvZ2dlciksXG5cdFx0XHRkYlN5bmNGbGFnOiBwYXJzZUJvb2xlYW4oZW52LkZFQVRVUkVfREJfU1lOQywgbG9nZ2VyKSxcblx0XHRcdGRlY3J5cHRLZXlzRmxhZzogcGFyc2VCb29sZWFuKGVudi5GRUFUVVJFX0RFQ1JZUFRfS0VZUywgbG9nZ2VyKSxcblx0XHRcdGVuYWJsZUVycm9ySGFuZGxlckZsYWc6IHBhcnNlQm9vbGVhbihcblx0XHRcdFx0ZW52LkZFQVRVUkVfRU5BQkxFX0VSUk9SX0hBTkRMRVIsXG5cdFx0XHRcdGxvZ2dlclxuXHRcdFx0KSxcblx0XHRcdGVuYWJsZUlwQmxhY2tsaXN0RmxhZzogcGFyc2VCb29sZWFuKFxuXHRcdFx0XHRlbnYuRkVBVFVSRV9FTkFCTEVfSVBfQkxBQ0tMSVNULFxuXHRcdFx0XHRsb2dnZXJcblx0XHRcdCksXG5cdFx0XHRlbmFibGVKd3RBdXRoRmxhZzogcGFyc2VCb29sZWFuKGVudi5GRUFUVVJFX0VOQUJMRV9KV1RfQVVUSCwgbG9nZ2VyKSxcblx0XHRcdGVuYWJsZVJhdGVMaW1pdEZsYWc6IHBhcnNlQm9vbGVhbihcblx0XHRcdFx0ZW52LkZFQVRVUkVfRU5BQkxFX1JBVEVfTElNSVQsXG5cdFx0XHRcdGxvZ2dlclxuXHRcdFx0KSxcblx0XHRcdGVuYWJsZVJlZGlzRmxhZzogcGFyc2VCb29sZWFuKGVudi5GRUFUVVJFX0VOQUJMRV9SRURJUywgbG9nZ2VyKSxcblx0XHRcdGVuYWJsZVNzbEZsYWc6IHBhcnNlQm9vbGVhbihlbnYuRkVBVFVSRV9FTkFCTEVfU1NMLCBsb2dnZXIpLFxuXHRcdFx0aHR0cHNSZWRpcmVjdEZsYWc6IHBhcnNlQm9vbGVhbihlbnYuRkVBVFVSRV9IVFRQU19SRURJUkVDVCwgbG9nZ2VyKSxcblx0XHRcdGxvYWRUZXN0Um91dGVzRmxhZzogcGFyc2VCb29sZWFuKGVudi5GRUFUVVJFX0xPQURfVEVTVF9ST1VURVMsIGxvZ2dlciksXG5cdFx0XHRzZXF1ZWxpemVMb2dnaW5nRmxhZzogcGFyc2VCb29sZWFuKFxuXHRcdFx0XHRlbnYuRkVBVFVSRV9TRVFVRUxJWkVfTE9HR0lORyxcblx0XHRcdFx0bG9nZ2VyXG5cdFx0XHQpXG5cdFx0fVxuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdHByb2Nlc3NFcnJvcihlcnJvciwgbG9nZ2VyIHx8IGNvbnNvbGUpO1xuXHRcdGxvZ2dlci5lcnJvcihgUmV0dXJuaW5nICdmYWxzZScgZm9yIGFsbCBmZWF0dXJlIGZsYWdzYCk7XG5cdFx0cmV0dXJuIHtcblx0XHRcdGFwaVJvdXRlc0NzcmZGbGFnOiBmYWxzZSxcblx0XHRcdGRiU3luY0ZsYWc6IGZhbHNlLFxuXHRcdFx0ZGVjcnlwdEtleXNGbGFnOiBmYWxzZSxcblx0XHRcdGVuYWJsZUVycm9ySGFuZGxlckZsYWc6IGZhbHNlLFxuXHRcdFx0ZW5hYmxlSXBCbGFja2xpc3RGbGFnOiBmYWxzZSxcblx0XHRcdGVuYWJsZUp3dEF1dGhGbGFnOiBmYWxzZSxcblx0XHRcdGVuYWJsZVJhdGVMaW1pdEZsYWc6IGZhbHNlLFxuXHRcdFx0ZW5hYmxlUmVkaXNGbGFnOiBmYWxzZSxcblx0XHRcdGVuYWJsZVNzbEZsYWc6IGZhbHNlLFxuXHRcdFx0aHR0cHNSZWRpcmVjdEZsYWc6IGZhbHNlLFxuXHRcdFx0bG9hZFRlc3RSb3V0ZXNGbGFnOiBmYWxzZSxcblx0XHRcdHNlcXVlbGl6ZUxvZ2dpbmdGbGFnOiBmYWxzZVxuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRmVhdHVyZUVuYWJsZXIobG9nZ2VyOiBMb2dnZXIpIHtcblx0dHJ5IHtcblx0XHR2YWxpZGF0ZURlcGVuZGVuY2llcyhcblx0XHRcdFt7IG5hbWU6ICdsb2dnZXInLCBpbnN0YW5jZTogbG9nZ2VyIH1dLFxuXHRcdFx0bG9nZ2VyIHx8IGNvbnNvbGVcblx0XHQpO1xuXG4gICAgXHRyZXR1cm4ge1xuICAgIFx0ICAgIGVuYWJsZUZlYXR1cmVCYXNlZE9uRmxhZyhcblx0XHRcdFx0ZmxhZzogYm9vbGVhbixcblx0XHRcdFx0ZGVzY3JpcHRpb246IHN0cmluZyxcblx0XHRcdFx0Y2FsbGJhY2s6ICgpID0+IHZvaWRcblx0XHRcdCkge1xuICAgIFx0ICAgICAgICBpZiAoZmxhZykge1xuICAgIFx0ICAgICAgICAgICAgbG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0XHRgRW5hYmxpbmcgJHtkZXNjcmlwdGlvbn0gKGZsYWcgaXMgJHtmbGFnfSlgXG5cdFx0XHRcdFx0KTtcbiAgICBcdCAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgXHQgICAgICAgIH0gZWxzZSB7XG4gICAgXHQgICAgICAgICAgICBsb2dnZXIuaW5mbyhcblx0XHRcdFx0XHRcdGBTa2lwcGluZyAke2Rlc2NyaXB0aW9ufSAoZmxhZyBpcyAke2ZsYWd9KWBcblx0XHRcdFx0XHQpO1xuICAgIFx0ICAgICAgICB9XG4gICAgXHQgICAgfSxcbiAgICBcdCAgICBlbmFibGVGZWF0dXJlV2l0aFByb2RPdmVycmlkZShcblx0XHRcdFx0ZmxhZzogYm9vbGVhbixcblx0XHRcdFx0ZGVzY3JpcHRpb246IHN0cmluZyxcblx0XHRcdFx0Y2FsbGJhY2s6ICgpID0+IHZvaWRcblx0XHRcdCkge1xuICAgIFx0ICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xuICAgIFx0ICAgICAgICAgICAgbG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0XHRgRW5hYmxpbmcgJHtkZXNjcmlwdGlvbn0gaW4gcHJvZHVjdGlvbiByZWdhcmRsZXNzIG9mIGZsYWcgdmFsdWUuYFxuXHRcdFx0XHRcdCk7XG4gICAgXHQgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgIFx0ICAgICAgICB9IGVsc2UgaWYgKGZsYWcpIHtcbiAgICBcdCAgICAgICAgICAgIGxvZ2dlci5pbmZvKFxuXHRcdFx0XHRcdFx0YEVuYWJsaW5nICR7ZGVzY3JpcHRpb259IChmbGFnIGlzICR7ZmxhZ30pYFxuXHRcdFx0XHRcdCk7XG4gICAgXHQgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgIFx0ICAgICAgICB9IGVsc2Uge1xuICAgIFx0ICAgICAgICAgICAgbG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0XHRgU2tpcHBpbmcgJHtkZXNjcmlwdGlvbn0gKGZsYWcgaXMgJHtmbGFnfSlgXG5cdFx0XHRcdFx0KTtcbiAgICBcdCAgICAgICAgfVxuICAgIFx0ICAgIH0sXG4gICAgXHR9O1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdHByb2Nlc3NFcnJvcihlcnJvciwgbG9nZ2VyIHx8IGNvbnNvbGUpO1xuXHRcdHJldHVybiB7XG5cdFx0XHRlbmFibGVGZWF0dXJlQmFzZWRPbkZsYWc6ICgpID0+IHt9LFxuXHRcdFx0ZW5hYmxlRmVhdHVyZVdpdGhQcm9kT3ZlcnJpZGU6ICgpID0+IHt9XG5cdFx0fTtcblx0fVxufVxuIl19
