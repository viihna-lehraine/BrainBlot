import { execSync } from 'child_process';
import path from 'path';
const ciphers = [
	'ECDHE-ECDSA-AES256-GCM-SHA384',
	'ECDHE-RSA-AES256-GCM-SHA384',
	'ECDHE-ECDSA-CHACHA20-POLY1305',
	'ECDHE-RSA-CHACHA20-POLY1305',
	'ECDHE-ECDSA-AES128-GCM-SHA256',
	'ECDHE-RSA-AES128-GCM-SHA256',
	'ECDHE-ECDSA-AES256-SHA384',
	'ECDHE-RSA-AES256-SHA384',
	'ECDHE-ECDSA-AES128-SHA256',
	'ECDHE-RSA-AES128-SHA256'
];
export async function declareOptions({
	sops,
	fs,
	logger,
	constants,
	DECRYPT_KEYS,
	SSL_KEY,
	SSL_CERT,
	ciphers
}) {
	let sslKeys;
	if (DECRYPT_KEYS) {
		sslKeys = await sops.getSSLKeys({
			logger,
			execSync,
			getDirectoryPath: () => path.resolve(process.cwd())
		});
		logger.info('SSL Keys retrieved from via sops.getSSLKeys()');
	} else {
		if (!SSL_KEY || !SSL_CERT) {
			throw new Error(
				'SSL_Key or SSL_CERT environment variable is not set'
			);
		}
		const key = await fs.readFile(SSL_KEY, 'utf8');
		const cert = await fs.readFile(SSL_CERT, 'utf8');
		sslKeys = { key, cert };
		logger.info('Using unencrypted SSL Keys from environment files');
	}
	const options = {
		key: sslKeys.key,
		cert: sslKeys.cert,
		allowHTTP1: true,
		secureOptions: constants.SSL_OP_NO_TLSv1 | constants.SSL_OP_NO_TLSv1_1,
		ciphers: ciphers.join(':'),
		honorCipherOrder: true
	};
	return options;
}
export async function setupHttp({
	app,
	sops,
	fs: fsPromises,
	logger,
	constants,
	getFeatureFlags,
	getRedisClient,
	getSequelizeInstance,
	SERVER_PORT,
	SSL_FLAG,
	REDIS_FLAG
}) {
	logger.info('setupHttp() executing');
	const featureFlags = getFeatureFlags();
	const options = await declareOptions({
		sops,
		fs: fsPromises,
		logger,
		constants,
		DECRYPT_KEYS: featureFlags.decryptKeysFlag,
		SSL_KEY: process.env.SERVER_SSL_KEY_PATH || null,
		SSL_CERT: process.env.SERVER_SSL_CERT_PATH || null,
		ciphers
	});
	async function onShutdown() {
		logger.info('Cleaning up resources before shutdown');
		const sequelize = getSequelizeInstance();
		try {
			await sequelize.close();
			logger.info('Database connection closed');
		} catch (error) {
			logger.error(`Error closing database connection: ${error}`);
		}
		if (REDIS_FLAG) {
			logger.info('REDIS_FLAG is set to true, Closing redis connection');
			try {
				const redisClient = getRedisClient();
				if (redisClient) {
					await redisClient.quit();
					logger.info('Redis connection closed');
				}
			} catch (error) {
				logger.error(`Error closing redis connection: ${error}`);
			}
		}
		try {
			await new Promise(resolve => {
				logger.close();
				resolve();
			});
			console.log('Logger closed');
		} catch (error) {
			logger.error(`Error closing logger: ${error}`);
		}
	}
	return { options };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb25maWcvaHR0cC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFLQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pDLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQTZCeEIsTUFBTSxPQUFPLEdBQUc7SUFDZiwrQkFBK0I7SUFDL0IsNkJBQTZCO0lBQzdCLCtCQUErQjtJQUMvQiw2QkFBNkI7SUFDN0IsK0JBQStCO0lBQy9CLDZCQUE2QjtJQUM3QiwyQkFBMkI7SUFDM0IseUJBQXlCO0lBQ3pCLDJCQUEyQjtJQUMzQix5QkFBeUI7Q0FDekIsQ0FBQztBQUVGLE1BQU0sQ0FBQyxLQUFLLFVBQVUsY0FBYyxDQUFDLEVBQ3BDLElBQUksRUFDSixFQUFFLEVBQ0YsTUFBTSxFQUNOLFNBQVMsRUFDVCxZQUFZLEVBQ1osT0FBTyxFQUNQLFFBQVEsRUFDUixPQUFPLEVBVVA7SUFDQSxJQUFJLE9BQWdCLENBQUM7SUFFckIsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNsQixPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDO1lBQy9CLE1BQU07WUFDTixRQUFRO1lBQ1IsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7U0FDbkQsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLElBQUksQ0FBQywrQ0FBK0MsQ0FBQyxDQUFDO0lBQzlELENBQUM7U0FBTSxDQUFDO1FBQ1AsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzNCLE1BQU0sSUFBSSxLQUFLLENBQUMscURBQXFELENBQUMsQ0FBQztRQUN4RSxDQUFDO1FBQ0QsTUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMv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S0FBSyxDQUFDLHlCQUF5QixLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ25ELENBQUM7SUFDTCxDQUFDO0lBRUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDO0FBQ3ZCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBsaWNhdGlvbiB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgU2VxdWVsaXplIH0gZnJvbSAnc2VxdWVsaXplJztcbmltcG9ydCB7IFNlY3VyZUNvbnRleHRPcHRpb25zIH0gZnJvbSAndGxzJztcbmltcG9ydCB7IGNvbnN0YW50cyBhcyBjcnlwdG9Db25zdGFudHMgfSBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IFNvcHNEZXBlbmRlbmNpZXMgZnJvbSAnLi4vdXRpbHMvc29wcyc7XG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmludGVyZmFjZSBTZXR1cEh0dHBQYXJhbXMge1xuXHRhcHA6IEFwcGxpY2F0aW9uO1xuXHRzb3BzOiBhbnk7XG5cdGZzOiB0eXBlb2YgaW1wb3J0KCdmcycpLnByb21pc2VzO1xuXHRsb2dnZXI6IGFueTtcblx0Y29uc3RhbnRzOiB0eXBlb2YgY3J5cHRvQ29uc3RhbnRzO1xuXHRnZXRGZWF0dXJlRmxhZ3M6ICgpID0+IGFueTtcblx0Z2V0UmVkaXNDbGllbnQ6ICgpID0+IGFueTtcblx0Z2V0U2VxdWVsaXplSW5zdGFuY2U6ICgpID0+IFNlcXVlbGl6ZTtcblx0aW5pdGlhbGl6ZURhdGFiYXNlOiAoKSA9PiBQcm9taXNlPFNlcXVlbGl6ZT47XG5cdFNFUlZFUl9QT1JUOiBudW1iZXI7XG5cdFNTTF9GTEFHOiBib29sZWFuO1xuXHRSRURJU19GTEFHOiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgU2V0dXBIdHRwUmV0dXJuIHtcblx0b3B0aW9ucz86IFNlY3VyZUNvbnRleHRPcHRpb25zO1xuXHRzdGFydFNlcnZlcj86ICgpID0+IHZvaWQ7XG59XG5cbmludGVyZmFjZSBTU0xLZXlzIHtcblx0a2V5OiBzdHJpbmc7XG5cdGNlcnQ6IHN0cmluZztcbn1cblxudHlwZSBPcHRpb25zID0gU2VjdXJlQ29udGV4dE9wdGlvbnM7XG5cbmNvbnN0IGNpcGhlcnMgPSBbXG5cdCdFQ0RIRS1FQ0RTQS1BRVMyNTYtR0NNLVNIQTM4NCcsXG5cdCdFQ0RIRS1SU0EtQUVTMjU2LUdDTS1TSEEzODQnLFxuXHQnRUNESEUtRUNEU0EtQ0hBQ0hBMjAtUE9MWTEzMDUnLFxuXHQnRUNESEUtUlNBLUNIQUNIQTIwLVBPTFkxMzA1Jyxcblx0J0VDREhFLUVDRFNBLUFFUzEyOC1HQ00tU0hBMjU2Jyxcblx0J0VDREhFLVJTQS1BRVMxMjgtR0NNLVNIQTI1NicsXG5cdCdFQ0RIRS1FQ0RTQS1BRVMyNTYtU0hBMzg0Jyxcblx0J0VDREhFLVJTQS1BRVMyNTYtU0hBMzg0Jyxcblx0J0VDREhFLUVDRFNBLUFFUzEyOC1TSEEyNTYnLFxuXHQnRUNESEUtUlNBLUFFUzEyOC1TSEEyNTYnXG5dO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVjbGFyZU9wdGlvbnMoe1xuXHRzb3BzLFxuXHRmcyxcblx0bG9nZ2VyLFxuXHRjb25zdGFudHMsXG5cdERFQ1JZUFRfS0VZUyxcblx0U1NMX0tFWSxcblx0U1NMX0NFUlQsXG5cdGNpcGhlcnNcbn06IHtcblx0c29wczogYW55O1xuXHRmczogdHlwZW9mIGltcG9ydCgnZnMnKS5wcm9taXNlcztcblx0bG9nZ2VyOiBhbnk7XG5cdGNvbnN0YW50czogdHlwZW9mIGltcG9ydCgnY3J5cHRvJykuY29uc3RhbnRzO1xuXHRERUNSWVBUX0tFWVM6IGJvb2xlYW47XG5cdFNTTF9LRVk6IHN0cmluZyB8IG51bGw7XG5cdFNTTF9DRVJUOiBzdHJpbmcgfCBudWxsO1xuXHRjaXBoZXJzOiBzdHJpbmdbXTtcbn0pOiBQcm9taXNlPE9wdGlvbnM+IHtcblx0bGV0IHNzbEtleXM6IFNTTEtleXM7XG5cblx0aWYgKERFQ1JZUFRfS0VZUykge1xuXHRcdHNzbEtleXMgPSBhd2FpdCBzb3BzLmdldFNTTEtleXMoe1xuXHRcdFx0bG9nZ2VyLFxuXHRcdFx0ZXhlY1N5bmMsXG5cdFx0XHRnZXREaXJlY3RvcnlQYXRoOiAoKSA9PiBwYXRoLnJlc29sdmUocHJvY2Vzcy5jd2QoKSlcblx0XHR9KTtcblx0XHRsb2dnZXIuaW5mbygnU1NMIEtleXMgcmV0cmlldmVkIGZyb20gdmlhIHNvcHMuZ2V0U1NMS2V5cygpJyk7XG5cdH0gZWxzZSB7XG5cdFx0aWYgKCFTU0xfS0VZIHx8ICFTU0xfQ0VSVCkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdTU0xfS2V5IG9yIFNTTF9DRVJUIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIG5vdCBzZXQnKTtcblx0XHR9XG5cdFx0Y29uc3Qga2V5ID0gYXdhaXQgZnMucmVhZEZpbGUoU1NMX0tFWSwgJ3V0ZjgnKTtcblx0XHRjb25zdCBjZXJ0ID0gYXdhaXQgZnMucmVhZEZpbGUoU1NMX0NFUlQsICd1dGY4Jyk7XG5cblx0XHRzc2xLZXlzID0geyBrZXksIGNlcnQgfTtcblx0XHRsb2dnZXIuaW5mbygnVXNpbmcgdW5lbmNyeXB0ZWQgU1NMIEtleXMgZnJvbSBlbnZpcm9ubWVudCBmaWxlcycpO1xuXHR9XG5cblx0Y29uc3Qgb3B0aW9ucyA9IHtcblx0XHRrZXk6IHNzbEtleXMua2V5LFxuXHRcdGNlcnQ6IHNzbEtleXMuY2VydCxcblx0XHRhbGxvd0hUVFAxOiB0cnVlLFxuXHRcdHNlY3VyZU9wdGlvbnM6IGNvbnN0YW50cy5TU0xfT1BfTk9fVExTdjEgfCBjb25zdGFudHMuU1NMX09QX05PX1RMU3YxXzEsXG5cdFx0Y2lwaGVyczogY2lwaGVycy5qb2luKCc6JyksXG5cdFx0aG9ub3JDaXBoZXJPcmRlcjogdHJ1ZVxuXHR9O1xuXG5cdHJldHVybiBvcHRpb25zO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2V0dXBIdHRwKHtcbiAgICBhcHAsXG4gICAgc29wcyxcbiAgICBmczogZnNQcm9taXNlcyxcbiAgICBsb2dnZXIsXG4gICAgY29uc3RhbnRzLFxuICAgIGdldEZlYXR1cmVGbGFncyxcbiAgICBnZXRSZWRpc0NsaWVudCxcbiAgICBnZXRTZXF1ZWxpemVJbnN0YW5jZSxcbiAgICBTRVJWRVJfUE9SVCxcbiAgICBTU0xfRkxBRyxcbiAgICBSRURJU19GTEFHXG59OiBTZXR1cEh0dHBQYXJhbXMpOiBQcm9taXNlPFNldHVwSHR0cFJldHVybj4ge1xuICAgIGxvZ2dlci5pbmZvKCdzZXR1cEh0dHAoKSBleGVjdXRpbmcnKTtcblxuICAgIGNvbnN0IGZlYXR1cmVGbGFncyA9IGdldEZlYXR1cmVGbGFncygpO1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IGF3YWl0IGRlY2xhcmVPcHRpb25zKHtcbiAgICAgICAgc29wcyxcbiAgICAgICAgZnM6IGZzUHJvbWlzZXMsXG4gICAgICAgIGxvZ2dlcixcbiAgICAgICAgY29uc3RhbnRzLFxuICAgICAgICBERUNSWVBUX0tFWVM6IGZlYXR1cmVGbGFncy5kZWNyeXB0S2V5c0ZsYWcsXG4gICAgICAgIFNTTF9LRVk6IHByb2Nlc3MuZW52LlNFUlZFUl9TU0xfS0VZX1BBVEggfHwgbnVsbCxcbiAgICAgICAgU1NMX0NFUlQ6IHByb2Nlc3MuZW52LlNFUlZFUl9TU0xfQ0VSVF9QQVRIIHx8IG51bGwsXG4gICAgICAgIGNpcGhlcnM6IGNpcGhlcnNcbiAgICB9KTtcblxuICAgIGFzeW5jIGZ1bmN0aW9uIG9uU2h1dGRvd24oKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKCdDbGVhbmluZyB1cCByZXNvdXJjZXMgYmVmb3JlIHNodXRkb3duJyk7XG5cbiAgICAgICAgY29uc3Qgc2VxdWVsaXplOiBTZXF1ZWxpemUgPSBnZXRTZXF1ZWxpemVJbnN0YW5jZSgpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBzZXF1ZWxpemUuY2xvc2UoKTtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdEYXRhYmFzZSBjb25uZWN0aW9uIGNsb3NlZCcpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBFcnJvciBjbG9zaW5nIGRhdGFiYXNlIGNvbm5lY3Rpb246ICR7ZXJyb3J9YCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoUkVESVNfRkxBRykge1xuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ1JFRElTX0ZMQUcgaXMgc2V0IHRvIHRydWUsIENsb3NpbmcgcmVkaXMgY29ubmVjdGlvbicpO1xuXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlZGlzQ2xpZW50ID0gZ2V0UmVkaXNDbGllbnQoKTtcbiAgICAgICAgICAgICAgICBpZiAocmVkaXNDbGllbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVkaXNDbGllbnQucXVpdCgpO1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnUmVkaXMgY29ubmVjdGlvbiBjbG9zZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgY2xvc2luZyByZWRpcyBjb25uZWN0aW9uOiAke2Vycm9yfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlKSA9PiB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTG9nZ2VyIGNsb3NlZCcpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBFcnJvciBjbG9zaW5nIGxvZ2dlcjogJHtlcnJvcn1gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7IG9wdGlvbnMgfTtcbn1cbiJdfQ==
