export function createMulterUpload({
	multer,
	path,
	storageDir,
	allowedMimeTypes,
	allowedExtensions,
	fileSizeLimit
}) {
	const storage = multer.diskStorage({
		destination: (req, file, cb) => {
			cb(null, storageDir);
		},
		filename: (req, file, cb) => {
			const uniqueSuffix = `${Date.now()}-${Math.round(Math.random() * 1e9)}`;
			cb(null, `${uniqueSuffix}-${file.originalname}`);
		}
	});
	const fileFilter = (req, file, cb) => {
		const ext = path.extname(file.originalname).toLowerCase();
		if (
			allowedMimeTypes.includes(file.mimetype) &&
			allowedExtensions.includes(ext)
		) {
			cb(null, true);
		} else {
			cb(null, false);
		}
	};
	const multerLimits = {
		fileSize: fileSizeLimit
	};
	return multer({
		storage,
		fileFilter,
		limits: multerLimits
	});
}
export default createMulterUpload;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXVsdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbmZpZy9tdWx0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBYUEsTUFBTSxVQUFVLGtCQUFrQixDQUFDLEVBQ2xDLE1BQU0sRUFDTixJQUFJLEVBQ0osVUFBVSxFQUNWLGdCQUFnQixFQUNoQixpQkFBaUIsRUFDakIsYUFBYSxFQUNPO0lBQ3BCLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7UUFDbEMsV0FBVyxFQUFFLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRTtZQUM5QixFQUFFLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ3RCLENBQUM7UUFDRCxRQUFRLEVBQUUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFO1lBQzNCLE1BQU0sWUFBWSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDeEUsRUFBRSxDQUFDLElBQUksRUFBRSxHQUFHLFlBQVksSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQztRQUNsRCxDQUFDO0tBQ0QsQ0FBQyxDQUFDO0lBRUgsTUFBTSxVQUFVLEdBQUcsQ0FDbEIsR0FBWSxFQUNaLElBQXlCLEVBQ3pCLEVBQXNCLEVBQ3JCLEVBQUU7UUFDSCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMxRCxJQUNDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO1lBQ3hDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFDOUIsQ0FBQztZQUNGLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDaEIsQ0FBQzthQUFNLENBQUM7WUFDUCxFQUFFLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2pCLENBQUM7SUFDRixDQUFDLENBQUM7SUFFRixNQUFNLFlBQVksR0FBRztRQUNwQixRQUFRLEVBQUUsYUFBYTtLQUN2QixDQUFDO0lBRUYsT0FBTyxNQUFNLENBQUM7UUFDYixPQUFPLEVBQUUsT0FBTztRQUNoQixVQUFVLEVBQUUsVUFBVTtRQUN0QixNQUFNLEVBQUUsWUFBWTtLQUNwQixDQUFDLENBQUM7QUFDSixDQUFDO0FBRUQsZUFBZSxrQkFBa0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcXVlc3QgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBtdWx0ZXIsIHsgRmlsZUZpbHRlckNhbGxiYWNrIH0gZnJvbSAnbXVsdGVyJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5leHBvcnQgaW50ZXJmYWNlIE11bHRlckRlcGVuZGVuY2llcyB7XG5cdG11bHRlcjogdHlwZW9mIG11bHRlcjtcblx0cGF0aDogdHlwZW9mIHBhdGg7XG5cdHN0b3JhZ2VEaXI6IHN0cmluZztcblx0YWxsb3dlZE1pbWVUeXBlczogc3RyaW5nW107XG5cdGFsbG93ZWRFeHRlbnNpb25zOiBzdHJpbmdbXTtcblx0ZmlsZVNpemVMaW1pdDogbnVtYmVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTXVsdGVyVXBsb2FkKHtcblx0bXVsdGVyLFxuXHRwYXRoLFxuXHRzdG9yYWdlRGlyLFxuXHRhbGxvd2VkTWltZVR5cGVzLFxuXHRhbGxvd2VkRXh0ZW5zaW9ucyxcblx0ZmlsZVNpemVMaW1pdFxufTogTXVsdGVyRGVwZW5kZW5jaWVzKSB7XG5cdGNvbnN0IHN0b3JhZ2UgPSBtdWx0ZXIuZGlza1N0b3JhZ2Uoe1xuXHRcdGRlc3RpbmF0aW9uOiAocmVxLCBmaWxlLCBjYikgPT4ge1xuXHRcdFx0Y2IobnVsbCwgc3RvcmFnZURpcik7XG5cdFx0fSxcblx0XHRmaWxlbmFtZTogKHJlcSwgZmlsZSwgY2IpID0+IHtcblx0XHRcdGNvbnN0IHVuaXF1ZVN1ZmZpeCA9IGAke0RhdGUubm93KCl9LSR7TWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMWU5KX1gO1xuXHRcdFx0Y2IobnVsbCwgYCR7dW5pcXVlU3VmZml4fS0ke2ZpbGUub3JpZ2luYWxuYW1lfWApO1xuXHRcdH1cblx0fSk7XG5cblx0Y29uc3QgZmlsZUZpbHRlciA9IChcblx0XHRyZXE6IFJlcXVlc3QsXG5cdFx0ZmlsZTogRXhwcmVzcy5NdWx0ZXIuRmlsZSxcblx0XHRjYjogRmlsZUZpbHRlckNhbGxiYWNrXG5cdCkgPT4ge1xuXHRcdGNvbnN0IGV4dCA9IHBhdGguZXh0bmFtZShmaWxlLm9yaWdpbmFsbmFtZSkudG9Mb3dlckNhc2UoKTtcblx0XHRpZiAoXG5cdFx0XHRhbGxvd2VkTWltZVR5cGVzLmluY2x1ZGVzKGZpbGUubWltZXR5cGUpICYmXG5cdFx0XHRhbGxvd2VkRXh0ZW5zaW9ucy5pbmNsdWRlcyhleHQpXG5cdFx0KSB7XG5cdFx0XHRjYihudWxsLCB0cnVlKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2IobnVsbCwgZmFsc2UpO1xuXHRcdH1cblx0fTtcblxuXHRjb25zdCBtdWx0ZXJMaW1pdHMgPSB7XG5cdFx0ZmlsZVNpemU6IGZpbGVTaXplTGltaXRcblx0fTtcblxuXHRyZXR1cm4gbXVsdGVyKHtcblx0XHRzdG9yYWdlOiBzdG9yYWdlLFxuXHRcdGZpbGVGaWx0ZXI6IGZpbGVGaWx0ZXIsXG5cdFx0bGltaXRzOiBtdWx0ZXJMaW1pdHNcblx0fSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZU11bHRlclVwbG9hZDtcbiJdfQ==
