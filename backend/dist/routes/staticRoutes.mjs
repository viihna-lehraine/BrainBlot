import express from 'express';
import path from 'path';
import setupLogger from '../config/logger.mjs';
const router = express.Router();
export function setupStaticRoutes(deps) {
	const logger = setupLogger({
		logLevel: deps.logLevel,
		logDirectory: deps.logDirectory,
		serviceName: deps.serviceName,
		isProduction: deps.isProduction
	});
	const {
		staticRootPath,
		appMjsPath,
		appJsPath,
		secretsPath,
		browserConfigXmlPath,
		humansMdPath,
		robotsTxtPath
	} = deps;
	// Middleware to log static asset access
	router.use((req, res, next) => {
		const assetTypes = ['css', '/mjs', 'js', '/fonts', '/icons', '/images'];
		if (assetTypes.some(type => req.url.startsWith(type))) {
			logger.info(`GET request received at ${req.url}`);
		}
		next();
	});
	// Serve root HTML files
	router.get('/:page', (req, res) => {
		const page = req.params.page;
		const filePath = path.join(staticRootPath, `${page}.html`);
		res.sendFile(filePath, err => {
			if (err) {
				logger.error(`Failed to send ${page}.html: ${err}`);
				res.status(404).send('Page not found');
			} else {
				logger.info(`${page}.html was accessed`);
			}
		});
	});
	// Serve static directories
	router.use('/css', express.static(path.join(staticRootPath, 'assets/css')));
	router.use('/mjs', express.static(path.join(staticRootPath, 'assets/mjs')));
	router.use('/js', express.static(path.join(staticRootPath, 'assets/js')));
	router.use(
		'/fonts',
		express.static(path.join(staticRootPath, 'assets/fonts'))
	);
	router.use(
		'/icons',
		express.static(path.join(staticRootPath, 'assets/icons'))
	);
	router.use(
		'/images',
		express.static(path.join(staticRootPath, 'assets/images'))
	);
	// Serve nested HTML files
	router.get('/*', (req, res) => {
		const filePath = path.join(staticRootPath, `${req.path}.html`);
		res.sendFile(filePath, err => {
			if (err) {
				logger.error(`Failed to send ${req.path}.html: ${err}`);
				res.status(404).send('Page not found');
			} else {
				logger.info(`${req.path}.html was accessed`);
			}
		});
	});
	// Serve specific static files
	const staticFiles = [
		{ route: '/app.mjs', filePath: appMjsPath },
		{ route: '/app.js', filePath: appJsPath },
		{ route: '/secrets.json.gpg', filePath: secretsPath },
		{ route: '/browserconfig.xml', filePath: browserConfigXmlPath },
		{ route: '/humans.md', filePath: humansMdPath },
		{ route: '/robots.txt', filePath: robotsTxtPath }
	];
	staticFiles.forEach(file => {
		router.get(file.route, (req, res) => {
			logger.info(`GET request received at ${file.route}`);
			res.sendFile(file.filePath, err => {
				if (err) {
					logger.error(`Failed to send ${file.route}: ${err}`);
					res.status(404).send('File not found');
				} else {
					logger.info(`${file.route} was accessed`);
				}
			});
		});
	});
	// 404 handler for unmatched routes
	router.use((req, res) => {
		logger.info(`404 - ${req.url} was not found`);
		res.status(404).sendFile(
			path.join(staticRootPath, 'not-found.html'),
			err => {
				if (err) {
					logger.error(`Failed to send not-found.html: ${err}`);
					res.status(500).send('Internal server error');
				}
			}
		);
	});
	return router;
}
export function initializeStaticRoutes(app) {
	const deps = {
		staticRootPath: process.env.STATIC_ROOT_PATH,
		appMjsPath: process.env.FRONTEND_APP_MJS_PATH,
		appJsPath: process.env.FRONTEND_APP_JS_PATH,
		secretsPath: process.env.FRONTEND_SECRETS_PATH,
		browserConfigXmlPath: process.env.FRONTEND_BROWSER_CONFIG_XML_PATH,
		humansMdPath: process.env.FRONTEND_HUMANS_MD_PATH,
		robotsTxtPath: process.env.FRONTEND_ROBOTS_TXT_PATH,
		logLevel: process.env.LOG_LEVEL,
		logDirectory: process.env.LOG_DIRECTORY,
		serviceName: process.env.SERVICE_NAME,
		isProduction: process.env.NODE_ENV === 'development' ? false : true
	};
	const router = setupStaticRoutes(deps);
	app.use('/', router);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGljUm91dGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JvdXRlcy9zdGF0aWNSb3V0ZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxPQUE0QyxNQUFNLFNBQVMsQ0FBQztBQUNuRSxPQUFPLElBQUksTUFBTSxNQUFNLENBQUM7QUFDeEIsT0FBTyxXQUFXLE1BQU0sa0JBQWtCLENBQUM7QUFFM0MsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBZ0JoQyxNQUFNLFVBQVUsaUJBQWlCLENBQ2hDLElBQThCO0lBRTlCLE1BQU0sTUFBTSxHQUFHLFdBQVcsQ0FBQztRQUMxQixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7UUFDdkIsWUFBWSxFQUFFLElBQUksQ0FBQyxZQUFZO1FBQy9CLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVztRQUM3QixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVk7S0FDL0IsQ0FBQyxDQUFDO0lBRUgsTUFBTSxFQUNMLGNBQWMsRUFDZCxVQUFVLEVBQ1YsU0FBUyxFQUNULFdBQVcsRUFDWCxvQkFBb0IsRUFDcEIsWUFBWSxFQUNaLGFBQWEsRUFDYixHQUFHLElBQUksQ0FBQztJQUVULHdDQUF3QztJQUN4QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBWSxFQUFFLEdBQWEsRUFBRSxJQUFrQixFQUFFLEVBQUU7UUFDOUQsTUFBTSxVQUFVLEdBQUcsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ3hFLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUN2RCxNQUFNLENBQUMsSUFBSSxDQUFDLDJCQUEyQixHQUFHLENBQUMsR0FBRyxF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aEMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYztRQUN4QyxXQUFXLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFhO1FBQ3RDLFlBQVksRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVMsS0FBSyxhQUFhLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSTtLQUNwRSxDQUFDO0lBQ0YsTUFBTSxNQUFNLEdBQUcsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzLCB7IFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHNldHVwTG9nZ2VyIGZyb20gJy4uL2NvbmZpZy9sb2dnZXInO1xuXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG5pbnRlcmZhY2UgU3RhdGljUm91dGVzRGVwZW5kZW5jaWVzIHtcblx0bG9nTGV2ZWw/OiBzdHJpbmc7XG5cdGxvZ0RpcmVjdG9yeT86IHN0cmluZztcblx0c2VydmljZU5hbWU/OiBzdHJpbmc7XG5cdGlzUHJvZHVjdGlvbj86IGJvb2xlYW47XG5cdHN0YXRpY1Jvb3RQYXRoOiBzdHJpbmc7XG5cdGFwcE1qc1BhdGg6IHN0cmluZztcblx0YXBwSnNQYXRoOiBzdHJpbmc7XG5cdHNlY3JldHNQYXRoOiBzdHJpbmc7XG5cdGJyb3dzZXJDb25maWdYbWxQYXRoOiBzdHJpbmc7XG5cdGh1bWFuc01kUGF0aDogc3RyaW5nO1xuXHRyb2JvdHNUeHRQYXRoOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXR1cFN0YXRpY1JvdXRlcyhcblx0ZGVwczogU3RhdGljUm91dGVzRGVwZW5kZW5jaWVzXG4pOiBleHByZXNzLlJvdXRlciB7XG5cdGNvbnN0IGxvZ2dlciA9IHNldHVwTG9nZ2VyKHtcblx0XHRsb2dMZXZlbDogZGVwcy5sb2dMZXZlbCxcblx0XHRsb2dEaXJlY3Rvcnk6IGRlcHMubG9nRGlyZWN0b3J5LFxuXHRcdHNlcnZpY2VOYW1lOiBkZXBzLnNlcnZpY2VOYW1lLFxuXHRcdGlzUHJvZHVjdGlvbjogZGVwcy5pc1Byb2R1Y3Rpb25cblx0fSk7XG5cblx0Y29uc3Qge1xuXHRcdHN0YXRpY1Jvb3RQYXRoLFxuXHRcdGFwcE1qc1BhdGgsXG5cdFx0YXBwSnNQYXRoLFxuXHRcdHNlY3JldHNQYXRoLFxuXHRcdGJyb3dzZXJDb25maWdYbWxQYXRoLFxuXHRcdGh1bWFuc01kUGF0aCxcblx0XHRyb2JvdHNUeHRQYXRoXG5cdH0gPSBkZXBzO1xuXG5cdC8vIE1pZGRsZXdhcmUgdG8gbG9nIHN0YXRpYyBhc3NldCBhY2Nlc3Ncblx0cm91dGVyLnVzZSgocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pID0+IHtcblx0XHRjb25zdCBhc3NldFR5cGVzID0gWydjc3MnLCAnL21qcycsICdqcycsICcvZm9udHMnLCAnL2ljb25zJywgJy9pbWFnZXMnXTtcblx0XHRpZiAoYXNzZXRUeXBlcy5zb21lKHR5cGUgPT4gcmVxLnVybC5zdGFydHNXaXRoKHR5cGUpKSkge1xuXHRcdFx0bG9nZ2VyLmluZm8oYEdFVCByZXF1ZXN0IHJlY2VpdmVkIGF0ICR7cmVxLnVybH1gKTtcblx0XHR9XG5cdFx0bmV4dCgpO1xuXHR9KTtcblxuXHQvLyBTZXJ2ZSByb290IEhUTUwgZmlsZXNcblx0cm91dGVyLmdldCgnLzpwYWdlJywgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuXHRcdGNvbnN0IHBhZ2UgPSByZXEucGFyYW1zLnBhZ2U7XG5cdFx0Y29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4oc3RhdGljUm9vdFBhdGgsIGAke3BhZ2V9Lmh0bWxgKTtcblx0XHRyZXMuc2VuZEZpbGUoZmlsZVBhdGgsIGVyciA9PiB7XG5cdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdGxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIHNlbmQgJHtwYWdlfS5odG1sOiAke2Vycn1gKTtcblx0XHRcdFx0cmVzLnN0YXR1cyg0MDQpLnNlbmQoJ1BhZ2Ugbm90IGZvdW5kJyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRsb2dnZXIuaW5mbyhgJHtwYWdlfS5odG1sIHdhcyBhY2Nlc3NlZGApO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTtcblxuXHQvLyBTZXJ2ZSBzdGF0aWMgZGlyZWN0b3JpZXNcblx0cm91dGVyLnVzZSgnL2NzcycsIGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihzdGF0aWNSb290UGF0aCwgJ2Fzc2V0cy9jc3MnKSkpO1xuXHRyb3V0ZXIudXNlKCcvbWpzJywgZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHN0YXRpY1Jvb3RQYXRoLCAnYXNzZXRzL21qcycpKSk7XG5cdHJvdXRlci51c2UoJy9qcycsIGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihzdGF0aWNSb290UGF0aCwgJ2Fzc2V0cy9qcycpKSk7XG5cdHJvdXRlci51c2UoXG5cdFx0Jy9mb250cycsXG5cdFx0ZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHN0YXRpY1Jvb3RQYXRoLCAnYXNzZXRzL2ZvbnRzJykpXG5cdCk7XG5cdHJvdXRlci51c2UoXG5cdFx0Jy9pY29ucycsXG5cdFx0ZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHN0YXRpY1Jvb3RQYXRoLCAnYXNzZXRzL2ljb25zJykpXG5cdCk7XG5cdHJvdXRlci51c2UoXG5cdFx0Jy9pbWFnZXMnLFxuXHRcdGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihzdGF0aWNSb290UGF0aCwgJ2Fzc2V0cy9pbWFnZXMnKSlcblx0KTtcblxuXHQvLyBTZXJ2ZSBuZXN0ZWQgSFRNTCBmaWxlc1xuXHRyb3V0ZXIuZ2V0KCcvKicsIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcblx0XHRjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbihzdGF0aWNSb290UGF0aCwgYCR7cmVxLnBhdGh9Lmh0bWxgKTtcblx0XHRyZXMuc2VuZEZpbGUoZmlsZVBhdGgsIGVyciA9PiB7XG5cdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdGxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIHNlbmQgJHtyZXEucGF0aH0uaHRtbDogJHtlcnJ9YCk7XG5cdFx0XHRcdHJlcy5zdGF0dXMoNDA0KS5zZW5kKCdQYWdlIG5vdCBmb3VuZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bG9nZ2VyLmluZm8oYCR7cmVxLnBhdGh9Lmh0bWwgd2FzIGFjY2Vzc2VkYCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0pO1xuXG5cdC8vIFNlcnZlIHNwZWNpZmljIHN0YXRpYyBmaWxlc1xuXHRjb25zdCBzdGF0aWNGaWxlcyA9IFtcblx0XHR7IHJvdXRlOiAnL2FwcC5tanMnLCBmaWxlUGF0aDogYXBwTWpzUGF0aCB9LFxuXHRcdHsgcm91dGU6ICcvYXBwLmpzJywgZmlsZVBhdGg6IGFwcEpzUGF0aCB9LFxuXHRcdHsgcm91dGU6ICcvc2VjcmV0cy5qc29uLmdwZycsIGZpbGVQYXRoOiBzZWNyZXRzUGF0aCB9LFxuXHRcdHsgcm91dGU6ICcvYnJvd3NlcmNvbmZpZy54bWwnLCBmaWxlUGF0aDogYnJvd3NlckNvbmZpZ1htbFBhdGggfSxcblx0XHR7IHJvdXRlOiAnL2h1bWFucy5tZCcsIGZpbGVQYXRoOiBodW1hbnNNZFBhdGggfSxcblx0XHR7IHJvdXRlOiAnL3JvYm90cy50eHQnLCBmaWxlUGF0aDogcm9ib3RzVHh0UGF0aCB9XG5cdF07XG5cblx0c3RhdGljRmlsZXMuZm9yRWFjaChmaWxlID0+IHtcblx0XHRyb3V0ZXIuZ2V0KGZpbGUucm91dGUsIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcblx0XHRcdGxvZ2dlci5pbmZvKGBHRVQgcmVxdWVzdCByZWNlaXZlZCBhdCAke2ZpbGUucm91dGV9YCk7XG5cdFx0XHRyZXMuc2VuZEZpbGUoZmlsZS5maWxlUGF0aCwgZXJyID0+IHtcblx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdGxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIHNlbmQgJHtmaWxlLnJvdXRlfTogJHtlcnJ9YCk7XG5cdFx0XHRcdFx0cmVzLnN0YXR1cyg0MDQpLnNlbmQoJ0ZpbGUgbm90IGZvdW5kJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0bG9nZ2VyLmluZm8oYCR7ZmlsZS5yb3V0ZX0gd2FzIGFjY2Vzc2VkYCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9KTtcblxuXHQvLyA0MDQgaGFuZGxlciBmb3IgdW5tYXRjaGVkIHJvdXRlc1xuXHRyb3V0ZXIudXNlKChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcblx0XHRsb2dnZXIuaW5mbyhgNDA0IC0gJHtyZXEudXJsfSB3YXMgbm90IGZvdW5kYCk7XG5cdFx0cmVzLnN0YXR1cyg0MDQpLnNlbmRGaWxlKFxuXHRcdFx0cGF0aC5qb2luKHN0YXRpY1Jvb3RQYXRoLCAnbm90LWZvdW5kLmh0bWwnKSxcblx0XHRcdGVyciA9PiB7XG5cdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoYEZhaWxlZCB0byBzZW5kIG5vdC1mb3VuZC5odG1sOiAke2Vycn1gKTtcblx0XHRcdFx0XHRyZXMuc3RhdHVzKDUwMCkuc2VuZCgnSW50ZXJuYWwgc2VydmVyIGVycm9yJyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHQpO1xuXHR9KTtcblxuXHRyZXR1cm4gcm91dGVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZVN0YXRpY1JvdXRlcyhhcHA6IGV4cHJlc3MuQXBwbGljYXRpb24pOiB2b2lkIHtcblx0Y29uc3QgZGVwczogU3RhdGljUm91dGVzRGVwZW5kZW5jaWVzID0ge1xuXHRcdHN0YXRpY1Jvb3RQYXRoOiBwcm9jZXNzLmVudi5TVEFUSUNfUk9PVF9QQVRIISxcblx0XHRhcHBNanNQYXRoOiBwcm9jZXNzLmVudi5GUk9OVEVORF9BUFBfTUpTX1BBVEghLFxuXHRcdGFwcEpzUGF0aDogcHJvY2Vzcy5lbnYuRlJPTlRFTkRfQVBQX0pTX1BBVEghLFxuXHRcdHNlY3JldHNQYXRoOiBwcm9jZXNzLmVudi5GUk9OVEVORF9TRUNSRVRTX1BBVEghLFxuXHRcdGJyb3dzZXJDb25maWdYbWxQYXRoOiBwcm9jZXNzLmVudi5GUk9OVEVORF9CUk9XU0VSX0NPTkZJR19YTUxfUEFUSCEsXG5cdFx0aHVtYW5zTWRQYXRoOiBwcm9jZXNzLmVudi5GUk9OVEVORF9IVU1BTlNfTURfUEFUSCEsXG5cdFx0cm9ib3RzVHh0UGF0aDogcHJvY2Vzcy5lbnYuRlJPTlRFTkRfUk9CT1RTX1RYVF9QQVRIISxcblx0XHRsb2dMZXZlbDogcHJvY2Vzcy5lbnYuTE9HX0xFVkVMISxcblx0XHRsb2dEaXJlY3Rvcnk6IHByb2Nlc3MuZW52LkxPR19ESVJFQ1RPUlkhLFxuXHRcdHNlcnZpY2VOYW1lOiBwcm9jZXNzLmVudi5TRVJWSUNFX05BTUUhLFxuXHRcdGlzUHJvZHVjdGlvbjogcHJvY2Vzcy5lbnYuTk9ERV9FTlYhID09PSAnZGV2ZWxvcG1lbnQnID8gZmFsc2UgOiB0cnVlXG5cdH07XG5cdGNvbnN0IHJvdXRlciA9IHNldHVwU3RhdGljUm91dGVzKGRlcHMpO1xuXHRhcHAudXNlKCcvJywgcm91dGVyKTtcbn1cbiJdfQ==
