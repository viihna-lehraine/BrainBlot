import express from 'express';
import path from 'path';
import setupLogger from '../config/logger.mjs';
const router = express.Router();
const logger = setupLogger();
async function setupStaticRoutes() {
	const staticRootPath = process.env.STATIC_ROOT_PATH;
	// Middleware to log static asset access
	router.use((req, res, next) => {
		const assetTypes = ['css', 'js', 'images', 'fonts', 'icons'];
		if (assetTypes.some(type => req.url.startsWith(type))) {
			logger.info(`GET request received at ${req.url}`);
		}
		next();
	});
	// Define root file path for public/
	router.get('/', (req, res) => {
		logger.info('GET request received at /');
		res.sendFile(path.join(staticRootPath, 'index.html'));
		logger.info('index.html was accessed');
	});
	// Serve root HTML files
	router.get('/:page', (req, res) => {
		const page = req.params.page;
		res.sendFile(path.join(staticRootPath, `${page}.html`), err => {
			if (err) {
				res.status(404).send('Page not found');
			}
		});
	});
	// Serve static directories
	router.use('/css', express.static(path.join(staticRootPath, 'assets/css')));
	router.use('/js', express.static(path.join(staticRootPath, 'assets/js')));
	router.use(
		'/images',
		express.static(path.join(staticRootPath, 'assets/images'))
	);
	router.use(
		'/fonts',
		express.static(path.join(staticRootPath, 'assets/fonts'))
	);
	router.use(
		'/icons',
		express.static(path.join(staticRootPath, 'assets/icons'))
	);
	// Serve nested HTML files
	router.get('/*', (req, res) => {
		res.sendFile(path.join(staticRootPath, `${req.path}.html`), err => {
			if (err) {
				res.status(404).send('Page not found');
			}
		});
	});
	// Serve specific static files
	router.get('/app.js', (req, res) => {
		logger.info('GET request received at /app.js');
		res.sendFile(process.env.FRONTEND_APP_JS_PATH);
		logger.info('app.js was accessed');
	});
	router.get('/secrets.json.gpg', (req, res) => {
		logger.info('GET request received at /secrets.json.gpg');
		res.sendFile(process.env.FRONTEND_SECRETS_PATH, err => {
			if (err) {
				logger.error('Failed to send secrets.json.gpg:', err);
				res.status(404).send('File not found');
			} else {
				logger.info('secrets.json.gpg was accessed');
			}
		});
	});
	router.get('/browser-config.xml', (req, res) => {
		logger.info('GET request received at /browser-config.xml');
		res.sendFile(process.env.FRONTEND_BROWSER_CONFIG_XML_PATH);
		logger.info('browser-config.xml was accessed');
	});
	router.get('/humans.md', (req, res) => {
		logger.info('GET request received at /humans.md');
		res.sendFile(process.env.FRONTEND_HUMANS_MD_PATH);
		logger.info('humans.md was accessed');
	});
	router.get('/robots.txt', (req, res) => {
		logger.info('GET request received at /robots.txt');
		res.sendFile(process.env.FRONTEND_ROBOTS_TXT_PATH);
		logger.info('robots.txt was accessed');
	});
	// 404 handler for unmatched routes
	router.use((req, res) => {
		logger.info(`404 - ${req.url} was not found`);
		res.status(404).sendFile(path.join(staticRootPath, 'not-found.html'));
	});
}
// For setting up routes when initializing the application
export default async function initializeStaticRoutes(app) {
	try {
		await setupStaticRoutes();
		app.use('/', router);
	} catch (err) {
		logger.error(`Error setting up routes: ${err}`);
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGljUm91dGVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JvdXRlcy9zdGF0aWNSb3V0ZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxPQUFPLE1BQU0sU0FBUyxDQUFDO0FBQzlCLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUN4QixPQUFPLFdBQVcsTUFBTSxrQkFBa0IsQ0FBQztBQUUzQyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDaEMsTUFBTSxNQUFNLEdBQUcsV0FBVyxFQUFFLENBQUM7QUFFN0IsS0FBSyxVQUFVLGlCQUFpQjtJQUMvQixNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUEwQixDQUFDO0lBRTlELHdDQUF3QztJQUN4QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRTtRQUM3QixNQUFNLFVBQVUsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM3RCxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDdkQsTUFBTSxDQUFDLElBQUksQ0FBQywyQkFBMkIsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDbkQsQ0FBQztRQUNELElBQUksRUFBRSxDQUFDO0lBQ1IsQ0FBQyxDQUFDLENBQUM7SUFFSCxvQ0FBb0M7SUFDcEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDNUIsTUFBTSxDQUFDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQ3pDLEdBQUcsQ0FBQyxRQUFRLENB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Q0FBQyx3QkFBa0MsQ0FBQyxDQUFDO1FBQzdELE1BQU0sQ0FBQyxJQUFJLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUN4QyxDQUFDLENBQUMsQ0FBQztJQUVILG1DQUFtQztJQUNuQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQ3ZCLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzlDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLGdCQUFnQixDQUFDLENBQUMsQ0FBQztJQUN2RSxDQUFDLENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRCwwREFBMEQ7QUFDMUQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLFVBQVUsc0JBQXNCLENBQ25ELEdBQXdCO0lBRXhCLElBQUksQ0FBQztRQUNKLE1BQU0saUJBQWlCLEVBQUUsQ0FBQztRQUMxQixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN0QixDQUFDO0lBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNkLE1BQU0sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDakQsQ0FBQztBQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHNldHVwTG9nZ2VyIGZyb20gJy4uL2NvbmZpZy9sb2dnZXInO1xuXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuY29uc3QgbG9nZ2VyID0gc2V0dXBMb2dnZXIoKTtcblxuYXN5bmMgZnVuY3Rpb24gc2V0dXBTdGF0aWNSb3V0ZXMoKTogUHJvbWlzZTx2b2lkPiB7XG5cdGNvbnN0IHN0YXRpY1Jvb3RQYXRoID0gcHJvY2Vzcy5lbnYuU1RBVElDX1JPT1RfUEFUSCBhcyBzdHJpbmc7XG5cblx0Ly8gTWlkZGxld2FyZSB0byBsb2cgc3RhdGljIGFzc2V0IGFjY2Vzc1xuXHRyb3V0ZXIudXNlKChyZXEsIHJlcywgbmV4dCkgPT4ge1xuXHRcdGNvbnN0IGFzc2V0VHlwZXMgPSBbJ2NzcycsICdqcycsICdpbWFnZXMnLCAnZm9udHMnLCAnaWNvbnMnXTtcblx0XHRpZiAoYXNzZXRUeXBlcy5zb21lKHR5cGUgPT4gcmVxLnVybC5zdGFydHNXaXRoKHR5cGUpKSkge1xuXHRcdFx0bG9nZ2VyLmluZm8oYEdFVCByZXF1ZXN0IHJlY2VpdmVkIGF0ICR7cmVxLnVybH1gKTtcblx0XHR9XG5cdFx0bmV4dCgpO1xuXHR9KTtcblxuXHQvLyBEZWZpbmUgcm9vdCBmaWxlIHBhdGggZm9yIHB1YmxpYy9cblx0cm91dGVyLmdldCgnLycsIChyZXEsIHJlcykgPT4ge1xuXHRcdGxvZ2dlci5pbmZvKCdHRVQgcmVxdWVzdCByZWNlaXZlZCBhdCAvJyk7XG5cdFx0cmVzLnNlbmRGaWxlKHBhdGguam9pbihzdGF0aWNSb290UGF0aCwgJ2luZGV4Lmh0bWwnKSk7XG5cdFx0bG9nZ2VyLmluZm8oJ2luZGV4Lmh0bWwgd2FzIGFjY2Vzc2VkJyk7XG5cdH0pO1xuXG5cdC8vIFNlcnZlIHJvb3QgSFRNTCBmaWxlc1xuXHRyb3V0ZXIuZ2V0KCcvOnBhZ2UnLCAocmVxLCByZXMpID0+IHtcblx0XHRjb25zdCBwYWdlID0gcmVxLnBhcmFtcy5wYWdlO1xuXHRcdHJlcy5zZW5kRmlsZShwYXRoLmpvaW4oc3RhdGljUm9vdFBhdGgsIGAke3BhZ2V9Lmh0bWxgKSwgZXJyID0+IHtcblx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0cmVzLnN0YXR1cyg0MDQpLnNlbmQoJ1BhZ2Ugbm90IGZvdW5kJyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0pO1xuXG5cdC8vIFNlcnZlIHN0YXRpYyBkaXJlY3Rvcmllc1xuXHRyb3V0ZXIudXNlKCcvY3NzJywgZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKHN0YXRpY1Jvb3RQYXRoLCAnYXNzZXRzL2NzcycpKSk7XG5cdHJvdXRlci51c2UoJy9qcycsIGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihzdGF0aWNSb290UGF0aCwgJ2Fzc2V0cy9qcycpKSk7XG5cdHJvdXRlci51c2UoXG5cdFx0Jy9pbWFnZXMnLFxuXHRcdGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihzdGF0aWNSb290UGF0aCwgJ2Fzc2V0cy9pbWFnZXMnKSlcblx0KTtcblx0cm91dGVyLnVzZShcblx0XHQnL2ZvbnRzJyxcblx0XHRleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4oc3RhdGljUm9vdFBhdGgsICdhc3NldHMvZm9udHMnKSlcblx0KTtcblx0cm91dGVyLnVzZShcblx0XHQnL2ljb25zJyxcblx0XHRleHByZXNzLnN0YXRpYyhwYXRoLmpvaW4oc3RhdGljUm9vdFBhdGgsICdhc3NldHMvaWNvbnMnKSlcblx0KTtcblxuXHQvLyBTZXJ2ZSBuZXN0ZWQgSFRNTCBmaWxlc1xuXHRyb3V0ZXIuZ2V0KCcvKicsIChyZXEsIHJlcykgPT4ge1xuXHRcdHJlcy5zZW5kRmlsZShwYXRoLmpvaW4oc3RhdGljUm9vdFBhdGgsIGAke3JlcS5wYXRofS5odG1sYCksIGVyciA9PiB7XG5cdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdHJlcy5zdGF0dXMoNDA0KS5zZW5kKCdQYWdlIG5vdCBmb3VuZCcpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9KTtcblxuXHQvLyBTZXJ2ZSBzcGVjaWZpYyBzdGF0aWMgZmlsZXNcblx0cm91dGVyLmdldCgnL2FwcC5qcycsIChyZXEsIHJlcykgPT4ge1xuXHRcdGxvZ2dlci5pbmZvKCdHRVQgcmVxdWVzdCByZWNlaXZlZCBhdCAvYXBwLmpzJyk7XG5cdFx0cmVzLnNlbmRGaWxlKHByb2Nlc3MuZW52LkZST05URU5EX0FQUF9KU19QQVRIIGFzIHN0cmluZyk7XG5cdFx0bG9nZ2VyLmluZm8oJ2FwcC5qcyB3YXMgYWNjZXNzZWQnKTtcblx0fSk7XG5cblx0cm91dGVyLmdldCgnL3NlY3JldHMuanNvbi5ncGcnLCAocmVxLCByZXMpID0+IHtcblx0XHRsb2dnZXIuaW5mbygnR0VUIHJlcXVlc3QgcmVjZWl2ZWQgYXQgL3NlY3JldHMuanNvbi5ncGcnKTtcblx0XHRyZXMuc2VuZEZpbGUocHJvY2Vzcy5lbnYuRlJPTlRFTkRfU0VDUkVUU19QQVRIIGFzIHN0cmluZywgZXJyID0+IHtcblx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0bG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gc2VuZCBzZWNyZXRzLmpzb24uZ3BnOicsIGVycik7XG5cdFx0XHRcdHJlcy5zdGF0dXMoNDA0KS5zZW5kKCdGaWxlIG5vdCBmb3VuZCcpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bG9nZ2VyLmluZm8oJ3NlY3JldHMuanNvbi5ncGcgd2FzIGFjY2Vzc2VkJyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0pO1xuXG5cdHJvdXRlci5nZXQoJy9icm93c2VyLWNvbmZpZy54bWwnLCAocmVxLCByZXMpID0+IHtcblx0XHRsb2dnZXIuaW5mbygnR0VUIHJlcXVlc3QgcmVjZWl2ZWQgYXQgL2Jyb3dzZXItY29uZmlnLnhtbCcpO1xuXHRcdHJlcy5zZW5kRmlsZShwcm9jZXNzLmVudi5GUk9OVEVORF9CUk9XU0VSX0NPTkZJR19YTUxfUEFUSCBhcyBzdHJpbmcpO1xuXHRcdGxvZ2dlci5pbmZvKCdicm93c2VyLWNvbmZpZy54bWwgd2FzIGFjY2Vzc2VkJyk7XG5cdH0pO1xuXG5cdHJvdXRlci5nZXQoJy9odW1hbnMubWQnLCAocmVxLCByZXMpID0+IHtcblx0XHRsb2dnZXIuaW5mbygnR0VUIHJlcXVlc3QgcmVjZWl2ZWQgYXQgL2h1bWFucy5tZCcpO1xuXHRcdHJlcy5zZW5kRmlsZShwcm9jZXNzLmVudi5GUk9OVEVORF9IVU1BTlNfTURfUEFUSCBhcyBzdHJpbmcpO1xuXHRcdGxvZ2dlci5pbmZvKCdodW1hbnMubWQgd2FzIGFjY2Vzc2VkJyk7XG5cdH0pO1xuXG5cdHJvdXRlci5nZXQoJy9yb2JvdHMudHh0JywgKHJlcSwgcmVzKSA9PiB7XG5cdFx0bG9nZ2VyLmluZm8oJ0dFVCByZXF1ZXN0IHJlY2VpdmVkIGF0IC9yb2JvdHMudHh0Jyk7XG5cdFx0cmVzLnNlbmRGaWxlKHByb2Nlc3MuZW52LkZST05URU5EX1JPQk9UU19UWFRfUEFUSCBhcyBzdHJpbmcpO1xuXHRcdGxvZ2dlci5pbmZvKCdyb2JvdHMudHh0IHdhcyBhY2Nlc3NlZCcpO1xuXHR9KTtcblxuXHQvLyA0MDQgaGFuZGxlciBmb3IgdW5tYXRjaGVkIHJvdXRlc1xuXHRyb3V0ZXIudXNlKChyZXEsIHJlcykgPT4ge1xuXHRcdGxvZ2dlci5pbmZvKGA0MDQgLSAke3JlcS51cmx9IHdhcyBub3QgZm91bmRgKTtcblx0XHRyZXMuc3RhdHVzKDQwNCkuc2VuZEZpbGUocGF0aC5qb2luKHN0YXRpY1Jvb3RQYXRoLCAnbm90LWZvdW5kLmh0bWwnKSk7XG5cdH0pO1xufVxuXG4vLyBGb3Igc2V0dGluZyB1cCByb3V0ZXMgd2hlbiBpbml0aWFsaXppbmcgdGhlIGFwcGxpY2F0aW9uXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBpbml0aWFsaXplU3RhdGljUm91dGVzKFxuXHRhcHA6IGV4cHJlc3MuQXBwbGljYXRpb25cbik6IFByb21pc2U8dm9pZD4ge1xuXHR0cnkge1xuXHRcdGF3YWl0IHNldHVwU3RhdGljUm91dGVzKCk7XG5cdFx0YXBwLnVzZSgnLycsIHJvdXRlcik7XG5cdH0gY2F0Y2ggKGVycikge1xuXHRcdGxvZ2dlci5lcnJvcihgRXJyb3Igc2V0dGluZyB1cCByb3V0ZXM6ICR7ZXJyfWApO1xuXHR9XG59XG4iXX0=
