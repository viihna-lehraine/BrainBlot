import os from 'os';
import fs from 'fs';
import toobusy from 'toobusy-js';
import { LoggerServiceFactory } from '../index/factory/subfactories/LoggerServiceFactory.mjs';
import { ErrorHandlerServiceFactory } from '../index/factory/subfactories/ErrorHandlerServiceFactory.mjs';
import { EnvConfigServiceFactory } from '../index/factory/subfactories/EnvConfigServiceFactory.mjs';
import { CacheLayerServiceFactory } from '../index/factory/subfactories/CacheLayerServiceFactory.mjs';
import { DatabaseControllerFactory } from '../index/factory/subfactories/DatabaseControllerFactory.mjs';
export class ResourceManager {
	static instance = null;
	logger;
	errorLogger;
	errorHandler;
	envConfig;
	redisService;
	cacheService;
	memoryCacheLRU = new Map();
	constructor(
		logger,
		errorLogger,
		errorHandler,
		envConfig,
		redisService,
		cacheService
	) {
		this.logger = logger;
		this.errorLogger = errorLogger;
		this.errorHandler = errorHandler;
		this.envConfig = envConfig;
		this.redisService = redisService;
		this.cacheService = cacheService;
	}
	static async getInstance() {
		if (!ResourceManager.instance) {
			const logger = await LoggerServiceFactory.getLoggerService();
			const errorLogger =
				await LoggerServiceFactory.getErrorLoggerService();
			const errorHandler =
				await ErrorHandlerServiceFactory.getErrorHandlerService();
			const envConfig =
				await EnvConfigServiceFactory.getEnvConfigService();
			const redisService =
				await CacheLayerServiceFactory.getRedisService();
			const cacheService =
				await CacheLayerServiceFactory.getCacheService();
			ResourceManager.instance = new ResourceManager(
				logger,
				errorLogger,
				errorHandler,
				envConfig,
				redisService,
				cacheService
			);
		}
		return ResourceManager.instance;
	}
	getCpuUsage() {
		try {
			const cpus = os.cpus();
			return cpus.map((cpu, index) => {
				const total = Object.values(cpu.times).reduce(
					(acc, time) => acc + time,
					0
				);
				const usage = ((total - cpu.times.idle) / total) * 100;
				return { core: index + 1, usage: `${usage.toFixed(2)}%` };
			});
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'CPU_USAGE_ERROR',
				{},
				'Error getting CPU usage'
			);
			return [];
		}
	}
	adjustResources() {
		// *DEV-NOTE* this is unused in the current implementation
		try {
			const memoryUsage = process.memoryUsage();
			const memoryLimit = this.envConfig.getEnvVariable('memoryLimit');
			const usedHeapPercentage =
				(memoryUsage.heapUsed / memoryUsage.heapTotal) * 100;
			if (usedHeapPercentage > memoryLimit || 80) {
				this.logger.warn(
					`Memory usage high: ${usedHeapPercentage}% of heap used.`
				);
				this.clearCaches('highMemoryUsageService');
				this.closeIdleConnections();
				this.adjustMemory();
			}
			const cpuUsage = this.getCpuUsage();
			if (cpuUsage.some(cpu => parseFloat(cpu.usage) > 89)) {
				this.logger.warn(
					'High CPU usage detected, adjusting CPU resources...'
				);
				this.adjustCPU();
			}
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'ADJUST_RESOURCES_ERROR',
				{},
				'Error adjusting resources'
			);
		}
	}
	getMemoryUsage() {
		try {
			const memoryUsage = process.memoryUsage();
			const memoryLimit =
				this.envConfig.getEnvVariable('memoryLimit') || os.totalmem();
			const usedHeapPercentage =
				(memoryUsage.heapUsed / memoryUsage.heapTotal) * 100;
			return {
				heapUsed: memoryUsage.heapUsed,
				heapTotal: memoryUsage.heapTotal,
				heapUsedPercentage: usedHeapPercentage,
				memoryLimit,
				isMemoryHealthy: memoryUsage.heapUsed < memoryLimit
			};
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'MEMORY_USAGE_ERROR',
				{},
				'Error getting memory usage'
			);
			return {
				heapUsed: 0,
				heapTotal: 0,
				heapUsedPercentage: 0,
				memoryLimit: 0,
				isMemoryHealthy: true
			};
		}
	}
	async getDiskUsage() {
		try {
			const diskPath = this.envConfig.getEnvVariable('diskPath') || '/';
			return new Promise(resolve => {
				fs.stat(diskPath, (err, stats) => {
					if (err) {
						this.errorLogger.logError(
							`Error getting disk usage: ${err.message}`
						);
						resolve({ error: err.message });
					} else {
						resolve({
							diskPath,
							diskStats: stats
						});
					}
				});
			});
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'DISK_USAGE_ERROR',
				{},
				'Error getting disk usage'
			);
			return {};
		}
	}
	getNetworkUsage() {
		try {
			const networkInterfaces = os.networkInterfaces();
			return Object.keys(networkInterfaces)
				.map(interfaceName => {
					const netStats = networkInterfaces[interfaceName];
					if (netStats) {
						return netStats.map(netStat => ({
							interface: interfaceName,
							address: netStat.address,
							family: netStat.family,
							internal: netStat.internal
						}));
					}
					return [];
				})
				.flat();
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'NETWORK_USAGE_ERROR',
				{},
				'Error getting network usage'
			);
			return [];
		}
	}
	adjustMemory() {
		try {
			const memoryUsage = process.memoryUsage();
			const memoryLimit = this.envConfig.getEnvVariable('memoryLimit');
			if (memoryUsage.heapUsed > memoryLimit * 0.9) {
				this.logger.warn(
					'Memory usage is critically high, initiating memory cleanup...'
				);
				// *DEV-NOTE* pass an appropriate context string to the clearCaches method
				this.clearCaches('memoryAdjustmentService');
				if (global.gc) {
					global.gc();
					this.logger.info('Garbage collection forced');
				} else {
					this.logger.warn(
						'Garbage collection not exposed. Use --expose-gc to allow forced GC.'
					);
				}
			}
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'ADJUST_MEMORY_ERROR',
				{},
				'Error adjusting memory resources'
			);
		}
	}
	manageMemory() {
		try {
			const memoryUsage = process.memoryUsage();
			const memoryLimit = this.envConfig.getEnvVariable('memoryLimit');
			const usedHeapPercentage =
				(memoryUsage.heapUsed / memoryUsage.heapTotal) * 100;
			this.logger.info(
				`Memory usage: ${usedHeapPercentage.toFixed(2)}% of heap used`
			);
			if (memoryUsage.heapUsed > memoryLimit) {
				this.logger.warn(
					`Memory usage exceeded the limit (${memoryLimit} bytes). Initiating memory cleanup...`
				);
				this.clearCaches('memoryCleanupService');
				if (global.gc) {
					this.logger.info('Forcing garbage collection');
					global.gc();
				} else {
					this.logger.warn(
						'Garbage collection is not exposed. Start the process with --expose-gc to enable forced GC.'
					);
				}
				this.closeIdleConnections();
				this.removeTemporaryFiles();
				const postCleanupMemoryUsage = process.memoryUsage();
				this.logger.info(
					`Post-cleanup memory usage: ${postCleanupMemoryUsage.heapUsed} bytes`
				);
			}
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'MEMORY_MANAGEMENT_ERROR',
				{},
				'Error managing memory usage'
			);
		}
	}
	evictCacheEntries(service) {
		const maxCacheSize = this.envConfig.getEnvVariable('maxCacheSize');
		const serviceMemoryCache = this.cacheService.getMemoryCache(service);
		if (!serviceMemoryCache || serviceMemoryCache.size <= maxCacheSize) {
			return;
		}
		const excessEntries = serviceMemoryCache.size - maxCacheSize;
		const sortedLRUEntries = Array.from(this.memoryCacheLRU.entries()).sort(
			(a, b) => a[1] - b[1]
		);
		for (let i = 0; i < excessEntries; i++) {
			const [oldestKey] = sortedLRUEntries[i];
			this.cacheService.del(oldestKey, service);
			this.memoryCacheLRU.delete(oldestKey);
			this.cacheService.del(oldestKey, service);
			this.logger.info(`Evicted cache entry for key: ${oldestKey}`);
		}
	}
	updateCacheAccessLRU(key) {
		this.memoryCacheLRU.set(key, Date.now());
	}
	autoScaleResources() {
		if (this.envConfig.getFeatureFlags().enableAutoScaling) {
			const memoryUsage = process.memoryUsage();
			if (
				memoryUsage.heapUsed >
				this.envConfig.getEnvVariable('memoryThreshold')
			) {
				this.logger.warn('Scaling up memory resources...');
				// *DEV-NOTE* logic for scaling memory resources dynamically
			}
		}
	}
	throttleBackgroundProcesses() {
		// *DEV-NOTE* logic to reduce background process frequency
	}
	async getFromCache(key, service) {
		try {
			const cachedData = await this.cacheService.get(key, service);
			if (cachedData) {
				return cachedData;
			}
			return null;
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'CACHE_RETRIEVAL_ERROR',
				{ key },
				`Error retrieving data from cache for key: ${key}`
			);
			return null;
		}
	}
	async saveToCache(key, value, service, expiration) {
		try {
			await this.cacheService.set(key, value, service, expiration);
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'CACHE_SAVE_ERROR',
				{ key, value, expiration },
				`Error saving data to cache for key: ${key}`
			);
		}
	}
	async clearCaches(service) {
		try {
			this.logger.info(`Clearing cache for service ${service}...`);
			await this.cacheService
				.flushCache(service)
				.then(() => {
					this.logger.info(
						`Cache flushed successfully for service ${service}`
					);
				})
				.catch(error => {
					this.errorLogger.logError(
						`Failed to flush cache for service ${service}: ${error.message}`
					);
				});
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'CLEAR_CACHES_ERROR',
				{},
				`Error clearing caches for service ${service}`
			);
		}
	}
	async closeIdleConnections() {
		try {
			this.logger.info('Closing idle database connections...');
			const databaseController =
				await DatabaseControllerFactory.getDatabaseController();
			databaseController.clearIdleConnections();
			this.logger.info('Idle database connections closed successfully');
			this.logger.info(
				'Clearing cache after closing idle connections...'
			);
			await this.clearCaches('idleConnectionService');
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'IDLE_CONNECTIONS_ERROR',
				{},
				'Error closing idle connections'
			);
		}
	}
	removeTemporaryFiles() {
		try {
			const tempDir = this.envConfig.getEnvVariable('tempDir') || '/tmp';
			this.logger.info(`Removing temporary files from ${tempDir}...`);
			fs.readdir(tempDir, (err, files) => {
				if (err) {
					this.logger.error(`Error reading temp directory: ${err}`);
					return;
				}
				files.forEach(file => {
					const filePath = `${tempDir}/${file}`;
					fs.unlink(filePath, err => {
						if (err) {
							this.logger.error(
								`Error deleting file ${filePath}: ${err}`
							);
						} else {
							this.logger.info(`Deleted file: ${filePath}`);
						}
					});
				});
			});
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'REMOVE_TEMP_FILES_ERROR',
				{},
				'Error removing temporary files'
			);
		}
	}
	adjustCPU() {
		try {
			const cpuUsage = this.getCpuUsage();
			cpuUsage.forEach(({ usage }) => {
				if (parseFloat(usage) > 85) {
					this.logger.warn(
						'CPU usage is critically high, adjusting CPU resources...'
					);
					this.clearCaches('aTaskService');
					// *DEV-NOTE* clear caches for CPU-intensive services
				}
			});
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'ADJUST_CPU_ERROR',
				{},
				'Error adjusting CPU resources'
			);
		}
	}
	slowDownBackgroundProcesses() {
		// *DEV-NOTE* logic to reduce background process frequency
	}
	pauseNonEssentialTasks() {
		// *DEV-NOTE* logic to temporarily pause non-essential services or processes
	}
	handleOverload() {
		try {
			if (toobusy()) {
				this.logger.error(
					'Server is overloaded, rejecting new requests'
				);
				this.slowDownBackgroundProcesses();
				this.pauseNonEssentialTasks();
				// *DEV-NOTE* reject-requesting middleware goes here
			}
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'OVERLOAD_ERROR',
				{},
				'Error handling server overload'
			);
		}
	}
	async shutdown() {
		try {
			this.logger.info('Shutting down Resource Manager...');
			toobusy.shutdown();
			this.logger.info('TooBusy.js shutdown complete.');
			this.memoryCacheLRU.clear();
			this.logger.info('Memory cache (LRU) cleared.');
			await this.clearCaches('resourceManager');
			this.logger.info('Caches cleared successfully.');
			await this.closeIdleConnections();
			this.logger.info('Idle database connections closed successfully.');
			this.logger.info('Resource Manager shutdown complete.');
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'SHUTDOWN_ERROR',
				{},
				'Error during Resource Manager shutdown'
			);
		}
	}
	handleResourceManagerError(
		error,
		errorHeader,
		errorDetails,
		customMessage
	) {
		try {
			const errorMessage = `${customMessage}: ${error}\n${error instanceof Error ? error.stack : ''}`;
			this.errorLogger.logError(errorMessage);
			const resourceError =
				new this.errorHandler.ErrorClasses.ResourceManagerError(
					errorHeader,
					{
						details: errorDetails,
						exposeToClient: false
					}
				);
			this.errorHandler.handleError({
				error: resourceError
			});
		} catch (error) {
			this.logger.error(
				`Error handling resource manager error: ${error}`
			);
			const severity = this.errorHandler.ErrorSeverity.WARNING;
			this.errorHandler.handleError({
				error,
				details: {
					context: 'Resource Manager',
					action: 'Passing error from resource manager handle to ErrorHandlerService',
					notes: 'Error occurred while handling resource manager error: ResourceManager.handleResourceManagerError'
				},
				severity
			});
		}
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVzb3VyY2VNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlcnZpY2VzL1Jlc291cmNlTWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFTQSxPQUFPLEVBQUUsTUFBTSxJQUFJLENBQUM7QUFDcEIsT0FBTyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ3BCLE9BQU8sT0FBTyxNQUFNLFlBQVksQ0FBQztBQUNqQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUMxRixPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSwwREFBMEQsQ0FBQztBQUN0RyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx1REFBdUQsQ0FBQztBQUNoRyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSx3REFBd0QsQ0FBQztBQUNsRyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSx5REFBeUQsQ0FBQztBQUVwRyxNQUFNLE9BQU8sZUFBZTtJQUNuQixNQUFNLENBQUMsUUFBUSxHQUEyQixJQUFJLENBQUM7SUFDL0MsTUFBTSxDQUE0QjtJQUNsQyxXQUFXLENBQThCO0lBQ3pDLFlBQVksQ0FBK0I7SUFDM0MsU0FBUyxDQUE0QjtJQUNyQyxZQUFZLENBQXdCO0lBQ3BDLFlBQVksQ0FBd0I7SUFDcEMsY0FBYyxHQUF3QixJQUFJLEdBQUcsRUFBRSxDQUFDO0lBRXhELFlBQ0MsTUFBaUMsRUFDakMsV0FBd0MsRUFDeEMsWUFBMEMsRUFDMUMsU0FBb0MsRUFDcEMsWUFBbUMsRUFDbkMsWUFBbUM7UUFFbkMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDL0IsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFDakMsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDM0IsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENB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RUFBRSxhQUFhO2FBQ3BCLENBQUMsQ0FBQztRQUNKLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUNoQiwwQ0FBMEMsS0FBSyxFQUFFLENBQ2pELENBQUM7WUFDRixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUM7WUFDekQsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7Z0JBQzdCLEtBQUs7Z0JBQ0wsT0FBTyxFQUFFO29CQUNSLE9BQU8sRUFBRSxrQkFBa0I7b0JBQzNCLE1BQU0sRUFBRSxtRUFBbUU7b0JBQzNFLEtBQUssRUFBRSxrR0FBa0c7aUJBQ3pHO2dCQUNELFFBQVE7YUFDUixDQUFDLENBQUM7UUFDSixDQUFDO0lBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG5cdEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2UsXG5cdENhY2hlU2VydmljZUludGVyZmFjZSxcblx0RW52Q29uZmlnU2VydmljZUludGVyZmFjZSxcblx0RXJyb3JMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRSZWRpc1NlcnZpY2VJbnRlcmZhY2UsXG5cdFJlc291cmNlTWFuYWdlckludGVyZmFjZVxufSBmcm9tICcuLi9pbmRleC9pbnRlcmZhY2VzL21haW4nO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgdG9vYnVzeSBmcm9tICd0b29idXN5LWpzJztcbmltcG9ydCB7IExvZ2dlclNlcnZpY2VGYWN0b3J5IH0gZnJvbSAnLi4vaW5kZXgvZmFjdG9yeS9zdWJmYWN0b3JpZXMvTG9nZ2VyU2VydmljZUZhY3RvcnknO1xuaW1wb3J0IHsgRXJyb3JIYW5kbGVyU2VydmljZUZhY3RvcnkgfSBmcm9tICcuLi9pbmRleC9mYWN0b3J5L3N1YmZhY3Rvcmllcy9FcnJvckhhbmRsZXJTZXJ2aWNlRmFjdG9yeSc7XG5pbXBvcnQgeyBFbnZDb25maWdTZXJ2aWNlRmFjdG9yeSB9IGZyb20gJy4uL2luZGV4L2ZhY3Rvcnkvc3ViZmFjdG9yaWVzL0VudkNvbmZpZ1NlcnZpY2VGYWN0b3J5JztcbmltcG9ydCB7IENhY2hlTGF5ZXJTZXJ2aWNlRmFjdG9yeSB9IGZyb20gJy4uL2luZGV4L2ZhY3Rvcnkvc3ViZmFjdG9yaWVzL0NhY2hlTGF5ZXJTZXJ2aWNlRmFjdG9yeSc7XG5pbXBvcnQgeyBEYXRhYmFzZUNvbnRyb2xsZXJGYWN0b3J5IH0gZnJvbSAnLi4vaW5kZXgvZmFjdG9yeS9zdWJmYWN0b3JpZXMvRGF0YWJhc2VDb250cm9sbGVyRmFjdG9yeSc7XG5cbmV4cG9ydCBjbGFzcyBSZXNvdXJjZU1hbmFnZXIgaW1wbGVtZW50cyBSZXNvdXJjZU1hbmFnZXJJbnRlcmZhY2Uge1xuXHRwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUmVzb3VyY2VNYW5hZ2VyIHwgbnVsbCA9IG51bGw7XG5cdHByaXZhdGUgbG9nZ2VyOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIGVycm9yTG9nZ2VyOiBFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2U7XG5cdHByaXZhdGUgZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIGVudkNvbmZpZzogRW52Q29uZmlnU2VydmljZUludGVyZmFjZTtcblx0cHJpdmF0ZSByZWRpc1NlcnZpY2U6IFJlZGlzU2VydmljZUludGVyZmFjZTtcblx0cHJpdmF0ZSBjYWNoZVNlcnZpY2U6IENhY2hlU2VydmljZUludGVyZmFjZTtcblx0cHJpdmF0ZSBtZW1vcnlDYWNoZUxSVTogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTtcblxuXHRwcml2YXRlIGNvbnN0cnVjdG9yKFxuXHRcdGxvZ2dlcjogQXBwTG9nZ2VyU2VydmljZUludGVyZmFjZSxcblx0XHRlcnJvckxvZ2dlcjogRXJyb3JMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRcdGVycm9ySGFuZGxlcjogRXJyb3JIYW5kbGVyU2VydmljZUludGVyZmFjZSxcblx0XHRlbnZDb25maWc6IEVudkNvbmZpZ1NlcnZpY2VJbnRlcmZhY2UsXG5cdFx0cmVkaXNTZXJ2aWNlOiBSZWRpc1NlcnZpY2VJbnRlcmZhY2UsXG5cdFx0Y2FjaGVTZXJ2aWNlOiBDYWNoZVNlcnZpY2VJbnRlcmZhY2Vcblx0KSB7XG5cdFx0dGhpcy5sb2dnZXIgPSBsb2dnZXI7XG5cdFx0dGhpcy5lcnJvckxvZ2dlciA9IGVycm9yTG9nZ2VyO1xuXHRcdHRoaXMuZXJyb3JIYW5kbGVyID0gZXJyb3JIYW5kbGVyO1xuXHRcdHRoaXMuZW52Q29uZmlnID0gZW52Q29uZmlnO1xuXHRcdHRoaXMucmVkaXNTZXJ2aWNlID0gcmVkaXNTZXJ2aWNlO1xuXHRcdHRoaXMuY2FjaGVTZXJ2aWNlID0gY2FjaGVTZXJ2aWNlO1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBhc3luYyBnZXRJbnN0YW5jZSgpOiBQcm9taXNlPFJlc291cmNlTWFuYWdlcj4ge1xuXHRcdGlmICghUmVzb3VyY2VNYW5hZ2VyLmluc3RhbmNlKSB7XG5cdFx0XHRjb25zdCBsb2dnZXIgPSBhd2FpdCBMb2dnZXJTZXJ2aWNlRmFjdG9yeS5nZXRMb2dnZXJTZXJ2aWNlKCk7XG5cdFx0XHRjb25zdCBlcnJvckxvZ2dlciA9XG5cdFx0XHRcdGF3YWl0IExvZ2dlclNlcnZpY2VGYWN0b3J5LmdldEVycm9yTG9nZ2VyU2VydmljZSgpO1xuXHRcdFx0Y29uc3QgZXJyb3JIYW5kbGVyID1cblx0XHRcdFx0YXdhaXQgRXJyb3JIYW5kbGVyU2VydmljZUZhY3RvcnkuZ2V0RXJyb3JIYW5kbGVyU2VydmljZSgpO1xuXHRcdFx0Y29uc3QgZW52Q29uZmlnID1cblx0XHRcdFx0YXdhaXQgRW52Q29uZmlnU2VydmljZUZhY3RvcnkuZ2V0RW52Q29uZmlnU2VydmljZSgpO1xuXHRcdFx0Y29uc3QgcmVkaXNTZXJ2aWNlID1cblx0XHRcdFx0YXdhaXQgQ2FjaGVMYXllclNlcnZpY2VGYWN0b3J5LmdldFJlZGlzU2VydmljZSgpO1xuXHRcdFx0Y29uc3QgY2FjaGVTZXJ2aWNlID1cblx0XHRcdFx0YXdhaXQgQ2FjaGVMYXllclNlcnZpY2VGYWN0b3J5LmdldENhY2hlU2VydmljZSgpO1xuXG5cdFx0XHRSZXNvdXJjZU1hbmFnZXIuaW5zdGFuY2UgPSBuZXcgUmVzb3VyY2VNYW5hZ2VyKFxuXHRcdFx0XHRsb2dnZXIsXG5cdFx0XHRcdGVycm9yTG9nZ2VyLFxuXHRcdFx0XHRlcnJvckhhbmRsZXIsXG5cdFx0XHRcdGVudkNvbmZpZyxcblx0XHRcdFx0cmVkaXNTZXJ2aWNlLFxuXHRcdFx0XHRjYWNoZVNlcnZpY2Vcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIFJlc291cmNlTWFuYWdlci5pbnN0YW5jZTtcblx0fVxuXG5cdHB1YmxpYyBnZXRDcHVVc2FnZSgpOiBBcnJheTx7IGNvcmU6IG51bWJlcjsgdXNhZ2U6IHN0cmluZyB9PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGNwdXMgPSBvcy5jcHVzKCk7XG5cdFx0XHRyZXR1cm4gY3B1cy5tYXAoKGNwdSwgaW5kZXgpID0+IHtcblx0XHRcdFx0Y29uc3QgdG90YWwgPSBPYmplY3QudmFsdWVzKGNwdS50aW1lcykucmVkdWNlKFxuXHRcdFx0XHRcdChhY2MsIHRpbWUpID0+IGFjYyArIHRpbWUsXG5cdFx0XHRcdFx0MFxuXHRcdFx0XHQpO1xuXHRcdFx0XHRjb25zdCB1c2FnZSA9ICgodG90YWwgLSBjcHUudGltZXMuaWRsZSkgLyB0b3RhbCkgKiAxMDA7XG5cdFx0XHRcdHJldHVybiB7IGNvcmU6IGluZGV4ICsgMSwgdXNhZ2U6IGAke3VzYWdlLnRvRml4ZWQoMil9JWAgfTtcblx0XHRcdH0pO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZVJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J0NQVV9VU0FHRV9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgZ2V0dGluZyBDUFUgdXNhZ2UnXG5cdFx0XHQpO1xuXHRcdFx0cmV0dXJuIFtdO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhZGp1c3RSZXNvdXJjZXMoKTogdm9pZCB7XG5cdFx0Ly8gKkRFVi1OT1RFKiB0aGlzIGlzIHVudXNlZCBpbiB0aGUgY3VycmVudCBpbXBsZW1lbnRhdGlvblxuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBtZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcblx0XHRcdGNvbnN0IG1lbW9yeUxpbWl0ID0gdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21lbW9yeUxpbWl0Jyk7XG5cdFx0XHRjb25zdCB1c2VkSGVhcFBlcmNlbnRhZ2UgPVxuXHRcdFx0XHQobWVtb3J5VXNhZ2UuaGVhcFVzZWQgLyBtZW1vcnlVc2FnZS5oZWFwVG90YWwpICogMTAwO1xuXG5cdFx0XHRpZiAodXNlZEhlYXBQZXJjZW50YWdlID4gbWVtb3J5TGltaXQgfHwgODApIHtcblx0XHRcdFx0dGhpcy5sb2dnZXIud2Fybihcblx0XHRcdFx0XHRgTWVtb3J5IHVzYWdlIGhpZ2g6ICR7dXNlZEhlYXBQZXJjZW50YWdlfSUgb2YgaGVhcCB1c2VkLmBcblx0XHRcdFx0KTtcblx0XHRcdFx0dGhpcy5jbGVhckNhY2hlcygnaGlnaE1lbW9yeVVzYWdlU2VydmljZScpO1xuXHRcdFx0XHR0aGlzLmNsb3NlSWRsZUNvbm5lY3Rpb25zKCk7XG5cdFx0XHRcdHRoaXMuYWRqdXN0TWVtb3J5KCk7XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IGNwdVVzYWdlID0gdGhpcy5nZXRDcHVVc2FnZSgpO1xuXG5cdFx0XHRpZiAoY3B1VXNhZ2Uuc29tZShjcHUgPT4gcGFyc2VGbG9hdChjcHUudXNhZ2UpID4gODkpKSB7XG5cdFx0XHRcdHRoaXMubG9nZ2VyLndhcm4oXG5cdFx0XHRcdFx0J0hpZ2ggQ1BVIHVzYWdlIGRldGVjdGVkLCBhZGp1c3RpbmcgQ1BVIHJlc291cmNlcy4uLidcblx0XHRcdFx0KTtcblx0XHRcdFx0dGhpcy5hZGp1c3RDUFUoKTtcblx0XHRcdH1cblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdBREpVU1RfUkVTT1VSQ0VTX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdCdFcnJvciBhZGp1c3RpbmcgcmVzb3VyY2VzJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgZ2V0TWVtb3J5VXNhZ2UoKToge1xuXHRcdGhlYXBVc2VkOiBudW1iZXI7XG5cdFx0aGVhcFRvdGFsOiBudW1iZXI7XG5cdFx0aGVhcFVzZWRQZXJjZW50YWdlOiBudW1iZXI7XG5cdFx0bWVtb3J5TGltaXQ6IG51bWJlcjtcblx0XHRpc01lbW9yeUhlYWx0aHk6IGJvb2xlYW47XG5cdH0ge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBtZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcblx0XHRcdGNvbnN0IG1lbW9yeUxpbWl0ID1cblx0XHRcdFx0dGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21lbW9yeUxpbWl0JykgfHwgb3MudG90YWxtZW0oKTtcblx0XHRcdGNvbnN0IHVzZWRIZWFwUGVyY2VudGFnZSA9XG5cdFx0XHRcdChtZW1vcnlVc2FnZS5oZWFwVXNlZCAvIG1lbW9yeVVzYWdlLmhlYXBUb3RhbCkgKiAxMDA7XG5cblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdGhlYXBVc2VkOiBtZW1vcnlVc2FnZS5oZWFwVXNlZCxcblx0XHRcdFx0aGVhcFRvdGFsOiBtZW1vcnlVc2FnZS5oZWFwVG90YWwsXG5cdFx0XHRcdGhlYXBVc2VkUGVyY2VudGFnZTogdXNlZEhlYXBQZXJjZW50YWdlLFxuXHRcdFx0XHRtZW1vcnlMaW1pdCxcblx0XHRcdFx0aXNNZW1vcnlIZWFsdGh5OiBtZW1vcnlVc2FnZS5oZWFwVXNlZCA8IG1lbW9yeUxpbWl0XG5cdFx0XHR9O1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZVJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J01FTU9SWV9VU0FHRV9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgZ2V0dGluZyBtZW1vcnkgdXNhZ2UnXG5cdFx0XHQpO1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0aGVhcFVzZWQ6IDAsXG5cdFx0XHRcdGhlYXBUb3RhbDogMCxcblx0XHRcdFx0aGVhcFVzZWRQZXJjZW50YWdlOiAwLFxuXHRcdFx0XHRtZW1vcnlMaW1pdDogMCxcblx0XHRcdFx0aXNNZW1vcnlIZWFsdGh5OiB0cnVlXG5cdFx0XHR9O1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhc3luYyBnZXREaXNrVXNhZ2UoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBkaXNrUGF0aCA9IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdkaXNrUGF0aCcpIHx8ICcvJztcblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcblx0XHRcdFx0ZnMuc3RhdChkaXNrUGF0aCwgKGVyciwgc3RhdHMpID0+IHtcblx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHR0aGlzLmVycm9yTG9nZ2VyLmxvZ0Vycm9yKFxuXHRcdFx0XHRcdFx0XHRgRXJyb3IgZ2V0dGluZyBkaXNrIHVzYWdlOiAke2Vyci5tZXNzYWdlfWBcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHRyZXNvbHZlKHsgZXJyb3I6IGVyci5tZXNzYWdlIH0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRyZXNvbHZlKHtcblx0XHRcdFx0XHRcdFx0ZGlza1BhdGgsXG5cdFx0XHRcdFx0XHRcdGRpc2tTdGF0czogc3RhdHNcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdESVNLX1VTQUdFX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdCdFcnJvciBnZXR0aW5nIGRpc2sgdXNhZ2UnXG5cdFx0XHQpO1xuXHRcdFx0cmV0dXJuIHt9O1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBnZXROZXR3b3JrVXNhZ2UoKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj5bXSB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IG5ldHdvcmtJbnRlcmZhY2VzID0gb3MubmV0d29ya0ludGVyZmFjZXMoKTtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhuZXR3b3JrSW50ZXJmYWNlcylcblx0XHRcdFx0Lm1hcChpbnRlcmZhY2VOYW1lID0+IHtcblx0XHRcdFx0XHRjb25zdCBuZXRTdGF0cyA9IG5ldHdvcmtJbnRlcmZhY2VzW2ludGVyZmFjZU5hbWVdO1xuXHRcdFx0XHRcdGlmIChuZXRTdGF0cykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIG5ldFN0YXRzLm1hcChuZXRTdGF0ID0+ICh7XG5cdFx0XHRcdFx0XHRcdGludGVyZmFjZTogaW50ZXJmYWNlTmFtZSxcblx0XHRcdFx0XHRcdFx0YWRkcmVzczogbmV0U3RhdC5hZGRyZXNzLFxuXHRcdFx0XHRcdFx0XHRmYW1pbHk6IG5ldFN0YXQuZmFtaWx5LFxuXHRcdFx0XHRcdFx0XHRpbnRlcm5hbDogbmV0U3RhdC5pbnRlcm5hbFxuXHRcdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gW107XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5mbGF0KCk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnTkVUV09SS19VU0FHRV9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgZ2V0dGluZyBuZXR3b3JrIHVzYWdlJ1xuXHRcdFx0KTtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGFkanVzdE1lbW9yeSgpOiB2b2lkIHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgbWVtb3J5VXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XG5cdFx0XHRjb25zdCBtZW1vcnlMaW1pdCA9IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdtZW1vcnlMaW1pdCcpO1xuXG5cdFx0XHRpZiAobWVtb3J5VXNhZ2UuaGVhcFVzZWQgPiBtZW1vcnlMaW1pdCAqIDAuOSkge1xuXHRcdFx0XHR0aGlzLmxvZ2dlci53YXJuKFxuXHRcdFx0XHRcdCdNZW1vcnkgdXNhZ2UgaXMgY3JpdGljYWxseSBoaWdoLCBpbml0aWF0aW5nIG1lbW9yeSBjbGVhbnVwLi4uJ1xuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdC8vICpERVYtTk9URSogcGFzcyBhbiBhcHByb3ByaWF0ZSBjb250ZXh0IHN0cmluZyB0byB0aGUgY2xlYXJDYWNoZXMgbWV0aG9kXG5cdFx0XHRcdHRoaXMuY2xlYXJDYWNoZXMoJ21lbW9yeUFkanVzdG1lbnRTZXJ2aWNlJyk7XG5cblx0XHRcdFx0aWYgKGdsb2JhbC5nYykge1xuXHRcdFx0XHRcdGdsb2JhbC5nYygpO1xuXHRcdFx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ0dhcmJhZ2UgY29sbGVjdGlvbiBmb3JjZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmxvZ2dlci53YXJuKFxuXHRcdFx0XHRcdFx0J0dhcmJhZ2UgY29sbGVjdGlvbiBub3QgZXhwb3NlZC4gVXNlIC0tZXhwb3NlLWdjIHRvIGFsbG93IGZvcmNlZCBHQy4nXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZVJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J0FESlVTVF9NRU1PUllfRVJST1InLFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0J0Vycm9yIGFkanVzdGluZyBtZW1vcnkgcmVzb3VyY2VzJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIG1hbmFnZU1lbW9yeSgpOiB2b2lkIHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgbWVtb3J5VXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XG5cdFx0XHRjb25zdCBtZW1vcnlMaW1pdCA9IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdtZW1vcnlMaW1pdCcpO1xuXHRcdFx0Y29uc3QgdXNlZEhlYXBQZXJjZW50YWdlID1cblx0XHRcdFx0KG1lbW9yeVVzYWdlLmhlYXBVc2VkIC8gbWVtb3J5VXNhZ2UuaGVhcFRvdGFsKSAqIDEwMDtcblxuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbyhcblx0XHRcdFx0YE1lbW9yeSB1c2FnZTogJHt1c2VkSGVhcFBlcmNlbnRhZ2UudG9GaXhlZCgyKX0lIG9mIGhlYXAgdXNlZGBcblx0XHRcdCk7XG5cblx0XHRcdGlmIChtZW1vcnlVc2FnZS5oZWFwVXNlZCA+IG1lbW9yeUxpbWl0KSB7XG5cdFx0XHRcdHRoaXMubG9nZ2VyLndhcm4oXG5cdFx0XHRcdFx0YE1lbW9yeSB1c2FnZSBleGNlZWRlZCB0aGUgbGltaXQgKCR7bWVtb3J5TGltaXR9IGJ5dGVzKS4gSW5pdGlhdGluZyBtZW1vcnkgY2xlYW51cC4uLmBcblx0XHRcdFx0KTtcblx0XHRcdFx0dGhpcy5jbGVhckNhY2hlcygnbWVtb3J5Q2xlYW51cFNlcnZpY2UnKTtcblxuXHRcdFx0XHRpZiAoZ2xvYmFsLmdjKSB7XG5cdFx0XHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnRm9yY2luZyBnYXJiYWdlIGNvbGxlY3Rpb24nKTtcblx0XHRcdFx0XHRnbG9iYWwuZ2MoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmxvZ2dlci53YXJuKFxuXHRcdFx0XHRcdFx0J0dhcmJhZ2UgY29sbGVjdGlvbiBpcyBub3QgZXhwb3NlZC4gU3RhcnQgdGhlIHByb2Nlc3Mgd2l0aCAtLWV4cG9zZS1nYyB0byBlbmFibGUgZm9yY2VkIEdDLidcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5jbG9zZUlkbGVDb25uZWN0aW9ucygpO1xuXHRcdFx0XHR0aGlzLnJlbW92ZVRlbXBvcmFyeUZpbGVzKCk7XG5cblx0XHRcdFx0Y29uc3QgcG9zdENsZWFudXBNZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcblx0XHRcdFx0dGhpcy5sb2dnZXIuaW5mbyhcblx0XHRcdFx0XHRgUG9zdC1jbGVhbnVwIG1lbW9yeSB1c2FnZTogJHtwb3N0Q2xlYW51cE1lbW9yeVVzYWdlLmhlYXBVc2VkfSBieXRlc2Bcblx0XHRcdFx0KTtcblx0XHRcdH1cblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdNRU1PUllfTUFOQUdFTUVOVF9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgbWFuYWdpbmcgbWVtb3J5IHVzYWdlJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgZXZpY3RDYWNoZUVudHJpZXMoc2VydmljZTogc3RyaW5nKTogdm9pZCB7XG5cdFx0Y29uc3QgbWF4Q2FjaGVTaXplID0gdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21heENhY2hlU2l6ZScpO1xuXG5cdFx0Y29uc3Qgc2VydmljZU1lbW9yeUNhY2hlID0gdGhpcy5jYWNoZVNlcnZpY2UuZ2V0TWVtb3J5Q2FjaGUoc2VydmljZSk7XG5cblx0XHRpZiAoIXNlcnZpY2VNZW1vcnlDYWNoZSB8fCBzZXJ2aWNlTWVtb3J5Q2FjaGUuc2l6ZSA8PSBtYXhDYWNoZVNpemUpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRjb25zdCBleGNlc3NFbnRyaWVzID0gc2VydmljZU1lbW9yeUNhY2hlLnNpemUgLSBtYXhDYWNoZVNpemU7XG5cdFx0Y29uc3Qgc29ydGVkTFJVRW50cmllcyA9IEFycmF5LmZyb20odGhpcy5tZW1vcnlDYWNoZUxSVS5lbnRyaWVzKCkpLnNvcnQoXG5cdFx0XHQoYSwgYikgPT4gYVsxXSAtIGJbMV1cblx0XHQpO1xuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBleGNlc3NFbnRyaWVzOyBpKyspIHtcblx0XHRcdGNvbnN0IFtvbGRlc3RLZXldID0gc29ydGVkTFJVRW50cmllc1tpXTtcblxuXHRcdFx0dGhpcy5jYWNoZVNlcnZpY2UuZGVsKG9sZGVzdEtleSwgc2VydmljZSk7XG5cdFx0XHR0aGlzLm1lbW9yeUNhY2hlTFJVLmRlbGV0ZShvbGRlc3RLZXkpO1xuXHRcdFx0dGhpcy5jYWNoZVNlcnZpY2UuZGVsKG9sZGVzdEtleSwgc2VydmljZSk7XG5cblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oYEV2aWN0ZWQgY2FjaGUgZW50cnkgZm9yIGtleTogJHtvbGRlc3RLZXl9YCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIHVwZGF0ZUNhY2hlQWNjZXNzTFJVKGtleTogc3RyaW5nKTogdm9pZCB7XG5cdFx0dGhpcy5tZW1vcnlDYWNoZUxSVS5zZXQoa2V5LCBEYXRlLm5vdygpKTtcblx0fVxuXG5cdHByaXZhdGUgYXV0b1NjYWxlUmVzb3VyY2VzKCk6IHZvaWQge1xuXHRcdGlmICh0aGlzLmVudkNvbmZpZy5nZXRGZWF0dXJlRmxhZ3MoKS5lbmFibGVBdXRvU2NhbGluZykge1xuXHRcdFx0Y29uc3QgbWVtb3J5VXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XG5cdFx0XHRpZiAoXG5cdFx0XHRcdG1lbW9yeVVzYWdlLmhlYXBVc2VkID5cblx0XHRcdFx0dGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21lbW9yeVRocmVzaG9sZCcpXG5cdFx0XHQpIHtcblx0XHRcdFx0dGhpcy5sb2dnZXIud2FybignU2NhbGluZyB1cCBtZW1vcnkgcmVzb3VyY2VzLi4uJyk7XG5cdFx0XHRcdC8vICpERVYtTk9URSogbG9naWMgZm9yIHNjYWxpbmcgbWVtb3J5IHJlc291cmNlcyBkeW5hbWljYWxseVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgdGhyb3R0bGVCYWNrZ3JvdW5kUHJvY2Vzc2VzKCk6IHZvaWQge1xuXHRcdC8vICpERVYtTk9URSogbG9naWMgdG8gcmVkdWNlIGJhY2tncm91bmQgcHJvY2VzcyBmcmVxdWVuY3lcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBnZXRGcm9tQ2FjaGU8VD4oXG5cdFx0a2V5OiBzdHJpbmcsXG5cdFx0c2VydmljZTogc3RyaW5nXG5cdCk6IFByb21pc2U8VCB8IG51bGw+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgY2FjaGVkRGF0YSA9IGF3YWl0IHRoaXMuY2FjaGVTZXJ2aWNlLmdldDxUPihrZXksIHNlcnZpY2UpO1xuXHRcdFx0aWYgKGNhY2hlZERhdGEpIHtcblx0XHRcdFx0cmV0dXJuIGNhY2hlZERhdGE7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdDQUNIRV9SRVRSSUVWQUxfRVJST1InLFxuXHRcdFx0XHR7IGtleSB9LFxuXHRcdFx0XHRgRXJyb3IgcmV0cmlldmluZyBkYXRhIGZyb20gY2FjaGUgZm9yIGtleTogJHtrZXl9YFxuXHRcdFx0KTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhc3luYyBzYXZlVG9DYWNoZTxUPihcblx0XHRrZXk6IHN0cmluZyxcblx0XHR2YWx1ZTogVCxcblx0XHRzZXJ2aWNlOiBzdHJpbmcsXG5cdFx0ZXhwaXJhdGlvbjogbnVtYmVyXG5cdCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRyeSB7XG5cdFx0XHRhd2FpdCB0aGlzLmNhY2hlU2VydmljZS5zZXQoa2V5LCB2YWx1ZSwgc2VydmljZSwgZXhwaXJhdGlvbik7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnQ0FDSEVfU0FWRV9FUlJPUicsXG5cdFx0XHRcdHsga2V5LCB2YWx1ZSwgZXhwaXJhdGlvbiB9LFxuXHRcdFx0XHRgRXJyb3Igc2F2aW5nIGRhdGEgdG8gY2FjaGUgZm9yIGtleTogJHtrZXl9YFxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgY2xlYXJDYWNoZXMoc2VydmljZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oYENsZWFyaW5nIGNhY2hlIGZvciBzZXJ2aWNlICR7c2VydmljZX0uLi5gKTtcblxuXHRcdFx0YXdhaXQgdGhpcy5jYWNoZVNlcnZpY2Vcblx0XHRcdFx0LmZsdXNoQ2FjaGUoc2VydmljZSlcblx0XHRcdFx0LnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMubG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0XHRgQ2FjaGUgZmx1c2hlZCBzdWNjZXNzZnVsbHkgZm9yIHNlcnZpY2UgJHtzZXJ2aWNlfWBcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9KVxuXHRcdFx0XHQuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdHRoaXMuZXJyb3JMb2dnZXIubG9nRXJyb3IoXG5cdFx0XHRcdFx0XHRgRmFpbGVkIHRvIGZsdXNoIGNhY2hlIGZvciBzZXJ2aWNlICR7c2VydmljZX06ICR7ZXJyb3IubWVzc2FnZX1gXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fSk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnQ0xFQVJfQ0FDSEVTX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdGBFcnJvciBjbGVhcmluZyBjYWNoZXMgZm9yIHNlcnZpY2UgJHtzZXJ2aWNlfWBcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGFzeW5jIGNsb3NlSWRsZUNvbm5lY3Rpb25zKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRyeSB7XG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdDbG9zaW5nIGlkbGUgZGF0YWJhc2UgY29ubmVjdGlvbnMuLi4nKTtcblxuXHRcdFx0Y29uc3QgZGF0YWJhc2VDb250cm9sbGVyID1cblx0XHRcdFx0YXdhaXQgRGF0YWJhc2VDb250cm9sbGVyRmFjdG9yeS5nZXREYXRhYmFzZUNvbnRyb2xsZXIoKTtcblx0XHRcdGRhdGFiYXNlQ29udHJvbGxlci5jbGVhcklkbGVDb25uZWN0aW9ucygpO1xuXG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdJZGxlIGRhdGFiYXNlIGNvbm5lY3Rpb25zIGNsb3NlZCBzdWNjZXNzZnVsbHknKTtcblxuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbyhcblx0XHRcdFx0J0NsZWFyaW5nIGNhY2hlIGFmdGVyIGNsb3NpbmcgaWRsZSBjb25uZWN0aW9ucy4uLidcblx0XHRcdCk7XG5cdFx0XHRhd2FpdCB0aGlzLmNsZWFyQ2FjaGVzKCdpZGxlQ29ubmVjdGlvblNlcnZpY2UnKTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdJRExFX0NPTk5FQ1RJT05TX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdCdFcnJvciBjbG9zaW5nIGlkbGUgY29ubmVjdGlvbnMnXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgcmVtb3ZlVGVtcG9yYXJ5RmlsZXMoKTogdm9pZCB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHRlbXBEaXIgPSB0aGlzLmVudkNvbmZpZy5nZXRFbnZWYXJpYWJsZSgndGVtcERpcicpIHx8ICcvdG1wJztcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oYFJlbW92aW5nIHRlbXBvcmFyeSBmaWxlcyBmcm9tICR7dGVtcERpcn0uLi5gKTtcblx0XHRcdGZzLnJlYWRkaXIodGVtcERpciwgKGVyciwgZmlsZXMpID0+IHtcblx0XHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRcdHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciByZWFkaW5nIHRlbXAgZGlyZWN0b3J5OiAke2Vycn1gKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0ZmlsZXMuZm9yRWFjaChmaWxlID0+IHtcblx0XHRcdFx0XHRjb25zdCBmaWxlUGF0aCA9IGAke3RlbXBEaXJ9LyR7ZmlsZX1gO1xuXHRcdFx0XHRcdGZzLnVubGluayhmaWxlUGF0aCwgZXJyID0+IHtcblx0XHRcdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5sb2dnZXIuZXJyb3IoXG5cdFx0XHRcdFx0XHRcdFx0YEVycm9yIGRlbGV0aW5nIGZpbGUgJHtmaWxlUGF0aH06ICR7ZXJyfWBcblx0XHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMubG9nZ2VyLmluZm8oYERlbGV0ZWQgZmlsZTogJHtmaWxlUGF0aH1gKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdSRU1PVkVfVEVNUF9GSUxFU19FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgcmVtb3ZpbmcgdGVtcG9yYXJ5IGZpbGVzJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGFkanVzdENQVSgpOiB2b2lkIHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgY3B1VXNhZ2UgPSB0aGlzLmdldENwdVVzYWdlKCk7XG5cblx0XHRcdGNwdVVzYWdlLmZvckVhY2goKHsgdXNhZ2UgfSkgPT4ge1xuXHRcdFx0XHRpZiAocGFyc2VGbG9hdCh1c2FnZSkgPiA4NSkge1xuXHRcdFx0XHRcdHRoaXMubG9nZ2VyLndhcm4oXG5cdFx0XHRcdFx0XHQnQ1BVIHVzYWdlIGlzIGNyaXRpY2FsbHkgaGlnaCwgYWRqdXN0aW5nIENQVSByZXNvdXJjZXMuLi4nXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0XHR0aGlzLmNsZWFyQ2FjaGVzKCdhVGFza1NlcnZpY2UnKTtcblx0XHRcdFx0XHQvLyAqREVWLU5PVEUqIGNsZWFyIGNhY2hlcyBmb3IgQ1BVLWludGVuc2l2ZSBzZXJ2aWNlc1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdBREpVU1RfQ1BVX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdCdFcnJvciBhZGp1c3RpbmcgQ1BVIHJlc291cmNlcydcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBzbG93RG93bkJhY2tncm91bmRQcm9jZXNzZXMoKTogdm9pZCB7XG5cdFx0Ly8gKkRFVi1OT1RFKiBsb2dpYyB0byByZWR1Y2UgYmFja2dyb3VuZCBwcm9jZXNzIGZyZXF1ZW5jeVxuXHR9XG5cblx0cHJpdmF0ZSBwYXVzZU5vbkVzc2VudGlhbFRhc2tzKCk6IHZvaWQge1xuXHRcdC8vICpERVYtTk9URSogbG9naWMgdG8gdGVtcG9yYXJpbHkgcGF1c2Ugbm9uLWVzc2VudGlhbCBzZXJ2aWNlcyBvciBwcm9jZXNzZXNcblx0fVxuXG5cdHByaXZhdGUgaGFuZGxlT3ZlcmxvYWQoKTogdm9pZCB7XG5cdFx0dHJ5IHtcblx0XHRcdGlmICh0b29idXN5KCkpIHtcblx0XHRcdFx0dGhpcy5sb2dnZXIuZXJyb3IoXG5cdFx0XHRcdFx0J1NlcnZlciBpcyBvdmVybG9hZGVkLCByZWplY3RpbmcgbmV3IHJlcXVlc3RzJ1xuXHRcdFx0XHQpO1xuXHRcdFx0XHR0aGlzLnNsb3dEb3duQmFja2dyb3VuZFByb2Nlc3NlcygpO1xuXHRcdFx0XHR0aGlzLnBhdXNlTm9uRXNzZW50aWFsVGFza3MoKTtcblxuXHRcdFx0XHQvLyAqREVWLU5PVEUqIHJlamVjdC1yZXF1ZXN0aW5nIG1pZGRsZXdhcmUgZ29lcyBoZXJlXG5cdFx0XHR9XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnT1ZFUkxPQURfRVJST1InLFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0J0Vycm9yIGhhbmRsaW5nIHNlcnZlciBvdmVybG9hZCdcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGFzeW5jIHNodXRkb3duKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRyeSB7XG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdTaHV0dGluZyBkb3duIFJlc291cmNlIE1hbmFnZXIuLi4nKTtcblxuXHRcdFx0dG9vYnVzeS5zaHV0ZG93bigpO1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnVG9vQnVzeS5qcyBzaHV0ZG93biBjb21wbGV0ZS4nKTtcblxuXHRcdFx0dGhpcy5tZW1vcnlDYWNoZUxSVS5jbGVhcigpO1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnTWVtb3J5IGNhY2hlIChMUlUpIGNsZWFyZWQuJyk7XG5cblx0XHRcdGF3YWl0IHRoaXMuY2xlYXJDYWNoZXMoJ3Jlc291cmNlTWFuYWdlcicpO1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnQ2FjaGVzIGNsZWFyZWQgc3VjY2Vzc2Z1bGx5LicpO1xuXG5cdFx0XHRhd2FpdCB0aGlzLmNsb3NlSWRsZUNvbm5lY3Rpb25zKCk7XG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdJZGxlIGRhdGFiYXNlIGNvbm5lY3Rpb25zIGNsb3NlZCBzdWNjZXNzZnVsbHkuJyk7XG5cblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ1Jlc291cmNlIE1hbmFnZXIgc2h1dGRvd24gY29tcGxldGUuJyk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnU0hVVERPV05fRVJST1InLFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0J0Vycm9yIGR1cmluZyBSZXNvdXJjZSBNYW5hZ2VyIHNodXRkb3duJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGhhbmRsZVJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdGVycm9yOiB1bmtub3duLFxuXHRcdGVycm9ySGVhZGVyOiBzdHJpbmcsXG5cdFx0ZXJyb3JEZXRhaWxzOiBvYmplY3QsXG5cdFx0Y3VzdG9tTWVzc2FnZTogc3RyaW5nXG5cdCk6IHZvaWQge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBlcnJvck1lc3NhZ2UgPSBgJHtjdXN0b21NZXNzYWdlfTogJHtlcnJvcn1cXG4ke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6ICcnfWA7XG5cdFx0XHR0aGlzLmVycm9yTG9nZ2VyLmxvZ0Vycm9yKGVycm9yTWVzc2FnZSk7XG5cblx0XHRcdGNvbnN0IHJlc291cmNlRXJyb3IgPVxuXHRcdFx0XHRuZXcgdGhpcy5lcnJvckhhbmRsZXIuRXJyb3JDbGFzc2VzLlJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdFx0XHRcdGVycm9ySGVhZGVyLFxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdGRldGFpbHM6IGVycm9yRGV0YWlscyxcblx0XHRcdFx0XHRcdGV4cG9zZVRvQ2xpZW50OiBmYWxzZVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0KTtcblxuXHRcdFx0dGhpcy5lcnJvckhhbmRsZXIuaGFuZGxlRXJyb3Ioe1xuXHRcdFx0XHRlcnJvcjogcmVzb3VyY2VFcnJvclxuXHRcdFx0fSk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMubG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRXJyb3IgaGFuZGxpbmcgcmVzb3VyY2UgbWFuYWdlciBlcnJvcjogJHtlcnJvcn1gXG5cdFx0XHQpO1xuXHRcdFx0Y29uc3Qgc2V2ZXJpdHkgPSB0aGlzLmVycm9ySGFuZGxlci5FcnJvclNldmVyaXR5LldBUk5JTkc7XG5cdFx0XHR0aGlzLmVycm9ySGFuZGxlci5oYW5kbGVFcnJvcih7XG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHRkZXRhaWxzOiB7XG5cdFx0XHRcdFx0Y29udGV4dDogJ1Jlc291cmNlIE1hbmFnZXInLFxuXHRcdFx0XHRcdGFjdGlvbjogJ1Bhc3NpbmcgZXJyb3IgZnJvbSByZXNvdXJjZSBtYW5hZ2VyIGhhbmRsZSB0byBFcnJvckhhbmRsZXJTZXJ2aWNlJyxcblx0XHRcdFx0XHRub3RlczogJ0Vycm9yIG9jY3VycmVkIHdoaWxlIGhhbmRsaW5nIHJlc291cmNlIG1hbmFnZXIgZXJyb3I6IFJlc291cmNlTWFuYWdlci5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcidcblx0XHRcdFx0fSxcblx0XHRcdFx0c2V2ZXJpdHlcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxufVxuIl19
