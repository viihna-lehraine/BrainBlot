import { ServiceFactory } from '../index/factory.mjs';
import os from 'os';
import fs from 'fs';
import toobusy from 'toobusy-js';
export class ResourceManager {
	static instance = null;
	logger;
	errorLogger;
	errorHandler;
	envConfig;
	redisService;
	cacheService;
	memoryCacheLRU = new Map();
	constructor(
		logger,
		errorLogger,
		errorHandler,
		envConfig,
		redisService,
		cacheService
	) {
		this.logger = logger;
		this.errorLogger = errorLogger;
		this.errorHandler = errorHandler;
		this.envConfig = envConfig;
		this.redisService = redisService;
		this.cacheService = cacheService;
	}
	static async getInstance() {
		if (!ResourceManager.instance) {
			const logger = await ServiceFactory.getLoggerService();
			const errorLogger = await ServiceFactory.getErrorLoggerService();
			const errorHandler = await ServiceFactory.getErrorHandlerService();
			const envConfig = await ServiceFactory.getEnvConfigService();
			const redisService = await ServiceFactory.getRedisService();
			const cacheService = await ServiceFactory.getCacheService();
			ResourceManager.instance = new ResourceManager(
				logger,
				errorLogger,
				errorHandler,
				envConfig,
				redisService,
				cacheService
			);
		}
		return ResourceManager.instance;
	}
	getCpuUsage() {
		try {
			const cpus = os.cpus();
			return cpus.map((cpu, index) => {
				const total = Object.values(cpu.times).reduce(
					(acc, time) => acc + time,
					0
				);
				const usage = ((total - cpu.times.idle) / total) * 100;
				return { core: index + 1, usage: `${usage.toFixed(2)}%` };
			});
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'CPU_USAGE_ERROR',
				{},
				'Error getting CPU usage'
			);
			return [];
		}
	}
	adjustResources() {
		// *DEV-NOTE* this is unused in the current implementation
		try {
			const memoryUsage = process.memoryUsage();
			const memoryLimit = this.envConfig.getEnvVariable('memoryLimit');
			const usedHeapPercentage =
				(memoryUsage.heapUsed / memoryUsage.heapTotal) * 100;
			if (usedHeapPercentage > memoryLimit || 80) {
				this.logger.warn(
					`Memory usage high: ${usedHeapPercentage}% of heap used.`
				);
				this.clearCaches('highMemoryUsageService');
				this.closeIdleConnections();
				this.adjustMemory();
			}
			const cpuUsage = this.getCpuUsage();
			if (cpuUsage.some(cpu => parseFloat(cpu.usage) > 89)) {
				this.logger.warn(
					'High CPU usage detected, adjusting CPU resources...'
				);
				this.adjustCPU();
			}
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'ADJUST_RESOURCES_ERROR',
				{},
				'Error adjusting resources'
			);
		}
	}
	getMemoryUsage() {
		try {
			const memoryUsage = process.memoryUsage();
			const memoryLimit =
				this.envConfig.getEnvVariable('memoryLimit') || os.totalmem();
			const usedHeapPercentage =
				(memoryUsage.heapUsed / memoryUsage.heapTotal) * 100;
			return {
				heapUsed: memoryUsage.heapUsed,
				heapTotal: memoryUsage.heapTotal,
				heapUsedPercentage: usedHeapPercentage,
				memoryLimit,
				isMemoryHealthy: memoryUsage.heapUsed < memoryLimit
			};
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'MEMORY_USAGE_ERROR',
				{},
				'Error getting memory usage'
			);
			return {
				heapUsed: 0,
				heapTotal: 0,
				heapUsedPercentage: 0,
				memoryLimit: 0,
				isMemoryHealthy: true
			};
		}
	}
	async getDiskUsage() {
		try {
			const diskPath = this.envConfig.getEnvVariable('diskPath') || '/';
			return new Promise(resolve => {
				fs.stat(diskPath, (err, stats) => {
					if (err) {
						this.errorLogger.logError(
							`Error getting disk usage: ${err.message}`
						);
						resolve({ error: err.message });
					} else {
						resolve({
							diskPath,
							diskStats: stats
						});
					}
				});
			});
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'DISK_USAGE_ERROR',
				{},
				'Error getting disk usage'
			);
			return {};
		}
	}
	getNetworkUsage() {
		try {
			const networkInterfaces = os.networkInterfaces();
			return Object.keys(networkInterfaces)
				.map(interfaceName => {
					const netStats = networkInterfaces[interfaceName];
					if (netStats) {
						return netStats.map(netStat => ({
							interface: interfaceName,
							address: netStat.address,
							family: netStat.family,
							internal: netStat.internal
						}));
					}
					return [];
				})
				.flat();
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'NETWORK_USAGE_ERROR',
				{},
				'Error getting network usage'
			);
			return [];
		}
	}
	adjustMemory() {
		try {
			const memoryUsage = process.memoryUsage();
			const memoryLimit = this.envConfig.getEnvVariable('memoryLimit');
			if (memoryUsage.heapUsed > memoryLimit * 0.9) {
				this.logger.warn(
					'Memory usage is critically high, initiating memory cleanup...'
				);
				// *DEV-NOTE* pass an appropriate context string to the clearCaches method
				this.clearCaches('memoryAdjustmentService');
				if (global.gc) {
					global.gc();
					this.logger.info('Garbage collection forced');
				} else {
					this.logger.warn(
						'Garbage collection not exposed. Use --expose-gc to allow forced GC.'
					);
				}
			}
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'ADJUST_MEMORY_ERROR',
				{},
				'Error adjusting memory resources'
			);
		}
	}
	manageMemory() {
		try {
			const memoryUsage = process.memoryUsage();
			const memoryLimit = this.envConfig.getEnvVariable('memoryLimit');
			const usedHeapPercentage =
				(memoryUsage.heapUsed / memoryUsage.heapTotal) * 100;
			this.logger.info(
				`Memory usage: ${usedHeapPercentage.toFixed(2)}% of heap used`
			);
			if (memoryUsage.heapUsed > memoryLimit) {
				this.logger.warn(
					`Memory usage exceeded the limit (${memoryLimit} bytes). Initiating memory cleanup...`
				);
				this.clearCaches('memoryCleanupService');
				if (global.gc) {
					this.logger.info('Forcing garbage collection');
					global.gc();
				} else {
					this.logger.warn(
						'Garbage collection is not exposed. Start the process with --expose-gc to enable forced GC.'
					);
				}
				this.closeIdleConnections();
				this.removeTemporaryFiles();
				const postCleanupMemoryUsage = process.memoryUsage();
				this.logger.info(
					`Post-cleanup memory usage: ${postCleanupMemoryUsage.heapUsed} bytes`
				);
			}
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'MEMORY_MANAGEMENT_ERROR',
				{},
				'Error managing memory usage'
			);
		}
	}
	evictCacheEntries(service) {
		const maxCacheSize = this.envConfig.getEnvVariable('maxCacheSize');
		const serviceMemoryCache = this.cacheService.getMemoryCache(service);
		if (!serviceMemoryCache || serviceMemoryCache.size <= maxCacheSize) {
			return;
		}
		const excessEntries = serviceMemoryCache.size - maxCacheSize;
		const sortedLRUEntries = Array.from(this.memoryCacheLRU.entries()).sort(
			(a, b) => a[1] - b[1]
		);
		for (let i = 0; i < excessEntries; i++) {
			const [oldestKey] = sortedLRUEntries[i];
			this.cacheService.del(oldestKey, service);
			this.memoryCacheLRU.delete(oldestKey);
			this.cacheService.del(oldestKey, service);
			this.logger.info(`Evicted cache entry for key: ${oldestKey}`);
		}
	}
	updateCacheAccessLRU(key) {
		this.memoryCacheLRU.set(key, Date.now());
	}
	autoScaleResources() {
		if (this.envConfig.getFeatureFlags().enableAutoScaling) {
			const memoryUsage = process.memoryUsage();
			if (
				memoryUsage.heapUsed >
				this.envConfig.getEnvVariable('memoryThreshold')
			) {
				this.logger.warn('Scaling up memory resources...');
				// *DEV-NOTE* logic for scaling memory resources dynamically
			}
		}
	}
	throttleBackgroundProcesses() {
		// *DEV-NOTE* logic to reduce background process frequency
	}
	async getFromCache(key, service) {
		try {
			const cachedData = await this.cacheService.get(key, service);
			if (cachedData) {
				return cachedData;
			}
			return null;
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'CACHE_RETRIEVAL_ERROR',
				{ key },
				`Error retrieving data from cache for key: ${key}`
			);
			return null;
		}
	}
	async saveToCache(key, value, service, expiration) {
		try {
			await this.cacheService.set(key, value, service, expiration);
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'CACHE_SAVE_ERROR',
				{ key, value, expiration },
				`Error saving data to cache for key: ${key}`
			);
		}
	}
	async clearCaches(service) {
		try {
			this.logger.info(`Clearing cache for service ${service}...`);
			await this.cacheService
				.flushCache(service)
				.then(() => {
					this.logger.info(
						`Cache flushed successfully for service ${service}`
					);
				})
				.catch(error => {
					this.errorLogger.logError(
						`Failed to flush cache for service ${service}: ${error.message}`
					);
				});
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'CLEAR_CACHES_ERROR',
				{},
				`Error clearing caches for service ${service}`
			);
		}
	}
	async closeIdleConnections() {
		try {
			this.logger.info('Closing idle database connections...');
			const databaseController =
				await ServiceFactory.getDatabaseController();
			databaseController.clearIdleConnections();
			this.logger.info('Idle database connections closed successfully');
			this.logger.info(
				'Clearing cache after closing idle connections...'
			);
			await this.clearCaches('idleConnectionService');
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'IDLE_CONNECTIONS_ERROR',
				{},
				'Error closing idle connections'
			);
		}
	}
	removeTemporaryFiles() {
		try {
			const tempDir = this.envConfig.getEnvVariable('tempDir') || '/tmp';
			this.logger.info(`Removing temporary files from ${tempDir}...`);
			fs.readdir(tempDir, (err, files) => {
				if (err) {
					this.logger.error(`Error reading temp directory: ${err}`);
					return;
				}
				files.forEach(file => {
					const filePath = `${tempDir}/${file}`;
					fs.unlink(filePath, err => {
						if (err) {
							this.logger.error(
								`Error deleting file ${filePath}: ${err}`
							);
						} else {
							this.logger.info(`Deleted file: ${filePath}`);
						}
					});
				});
			});
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'REMOVE_TEMP_FILES_ERROR',
				{},
				'Error removing temporary files'
			);
		}
	}
	adjustCPU() {
		try {
			const cpuUsage = this.getCpuUsage();
			cpuUsage.forEach(({ usage }) => {
				if (parseFloat(usage) > 85) {
					this.logger.warn(
						'CPU usage is critically high, adjusting CPU resources...'
					);
					this.clearCaches('aTaskService');
					// *DEV-NOTE* clear caches for CPU-intensive services
				}
			});
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'ADJUST_CPU_ERROR',
				{},
				'Error adjusting CPU resources'
			);
		}
	}
	slowDownBackgroundProcesses() {
		// *DEV-NOTE* logic to reduce background process frequency
	}
	pauseNonEssentialTasks() {
		// *DEV-NOTE* logic to temporarily pause non-essential services or processes
	}
	handleOverload() {
		try {
			if (toobusy()) {
				this.logger.error(
					'Server is overloaded, rejecting new requests'
				);
				this.slowDownBackgroundProcesses();
				this.pauseNonEssentialTasks();
				// *DEV-NOTE* reject-requesting middleware goes here
			}
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'OVERLOAD_ERROR',
				{},
				'Error handling server overload'
			);
		}
	}
	async shutdown() {
		try {
			this.logger.info('Shutting down Resource Manager...');
			toobusy.shutdown();
			this.logger.info('TooBusy.js shutdown complete.');
			this.memoryCacheLRU.clear();
			this.logger.info('Memory cache (LRU) cleared.');
			await this.clearCaches('resourceManager');
			this.logger.info('Caches cleared successfully.');
			await this.closeIdleConnections();
			this.logger.info('Idle database connections closed successfully.');
			this.logger.info('Resource Manager shutdown complete.');
		} catch (error) {
			this.handleResourceManagerError(
				error,
				'SHUTDOWN_ERROR',
				{},
				'Error during Resource Manager shutdown'
			);
		}
	}
	handleResourceManagerError(
		error,
		errorHeader,
		errorDetails,
		customMessage
	) {
		try {
			const errorMessage = `${customMessage}: ${error}\n${error instanceof Error ? error.stack : ''}`;
			this.errorLogger.logError(errorMessage);
			const resourceError =
				new this.errorHandler.ErrorClasses.ResourceManagerError(
					errorHeader,
					{
						details: errorDetails,
						exposeToClient: false
					}
				);
			this.errorHandler.handleError({
				error: resourceError
			});
		} catch (error) {
			this.logger.error(
				`Error handling resource manager error: ${error}`
			);
			const severity = this.errorHandler.ErrorSeverity.WARNING;
			this.errorHandler.handleError({
				error,
				details: {
					context: 'Resource Manager',
					action: 'Passing error from resource manager handle to ErrorHandlerService',
					notes: 'Error occurred while handling resource manager error: ResourceManager.handleResourceManagerError'
				},
				severity
			});
		}
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVzb3VyY2VNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlcnZpY2VzL1Jlc291cmNlTWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFTQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ3BCLE9BQU8sRUFBRSxNQUFNLElBQUksQ0FBQztBQUNwQixPQUFPLE9BQU8sTUFBTSxZQUFZLENBQUM7QUFFakMsTUFBTSxPQUFPLGVBQWU7SUFDbkIsTUFBTSxDQUFDLFFBQVEsR0FBMkIsSUFBSSxDQUFDO0lBQy9DLE1BQU0sQ0FBNEI7SUFDbEMsV0FBVyxDQUE4QjtJQUN6QyxZQUFZLENBQStCO0lBQzNDLFNBQVMsQ0FBNEI7SUFDckMsWUFBWSxDQUF3QjtJQUNwQyxZQUFZLENBQXdCO0lBQ3BDLGNBQWMsR0FBd0IsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUV4RCxZQUNDLE1BQWlDLEVBQ2pDLFdBQXdDLEVBQ3hDLFlBQTBDLEVBQzFDLFNBQW9DLEVBQ3BDLFlBQW1DLEVBQ25DLFlBQW1DO1FBRW5DLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO0lBQ2xDLENBQUM7SUFFTSxNQUFNLENBQUMsS0FBSyxDQUFDLFdBQVc7UUFDOUIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUMvQixNQUFNLE1BQU0sR0FBRyxNQUFNLGNBQWMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1lBQ3ZELE1BQU0sV0FBVyxHQUFHLE1BQU0sY0FBYyxDQUFDLHFCQUFxQixFQUFFLENBQUM7WUFDakUsTUFBTSxZQUFZLEdBQUcsTUFBTSxjQUFjLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztZQUNuRSxNQUFNLFNBQVMsR0FBRyxNQUFNLGNBQWMsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1lBQzdELE1BQU0sWUFBWSxHQUFHLE1BQU0sY0FBYyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQzVELE1BQU0sWUFBWSxHQUFHLE1BQU0sY0FBYyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBRTVELGVBQWUsQ0FBQyxRQUFRLEdBQUcsSUFBSSxlQUFlLENBQzdDLE1BQU0sRUFDTixXQUFXLEVBQ1gsWUFBWSxFQUNaLFNBQVMsRUFDVCxZQUFZLEVBQ1osWUFBWSxDQUNaLENBQUM7UUFDSCxDQUFDO1FBRUQsT0FBTyxlQUFlLENBQUMsUUFBUSxDQUFDO0lBQ2pDLENBQUM7SUFFTSxXQUFXO1FBQ2pCLElBQUksQ0FBQztZQUNKLE1BQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUN2QixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUU7Z0JBQzlCLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FDNUMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsSUFBSSxFQUN6QixDQUFDLENBQ0QsQ0FBQztnQkFDRixNQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDO2dCQUN2RCxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxFQUFFLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDM0QsQ0FBQyxDQUFDLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNoQixJQUFJLENBQUMsMEJBQTBCLENBQzlCLEtBQUssRUFDTCxpQkFBaUIsRUFDakIsRUFBRSxFQUNGLHlCQUF5QixDQUN6QixDQUFDO1lBQ0YsT0FBTyxFQUFFLENBQUM7UUFDWCxDQUFDO0lBQ0YsQ0FBQztJQUVNLGVBQWU7UUFDckIsMERBQTBEO1FBQzFELElBQUksQ0FBQztZQUNKLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMxQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUNqRSxNQUFNLGtCQUFrQixHQUN2QixDQUFDLFdBQVcsQ0FBQyxRQUFRLEdBQUcsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUV0RCxJQUFJLGtCQUFrQixHQUFHLFdBQVcsSUFBSSxFQUFFLEVBQUUsQ0FBQztnQkFDNUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQ2Ysc0JBQXNCLGtCQUFrQixpQkFBaUIsQ0FDekQsQ0FBQztnQkFDRixJQUFJLENBQUMsV0FBVyxDQUFDLHdCQUF3QixDQUFDLENBQUM7Z0JBQzNDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO2dCQUM1QixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDckIsQ0FBQztZQUVELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUVwQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUM7Z0JBQ3RELElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNmLHFEQUFxRCxDQUNyRCxDQUFDO2dCQUNGLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNsQixDQUFDO1FBQ0YsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLDBCQUEwQixDQUM5QixLQUFLLEVBQ0wsd0JBQXdCLEVBQ3hCLEVBQUUsRUFDRiwyQkFBMkIsQ0FDM0IsQ0FBQztRQUNILENBQUM7SUFDRixDQUFDO0lBRU0sY0FBYztRQU9wQixJQUFJLENBQUM7WUFDSixNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDMUMsTUFBTSxXQUFXLEdBQ2hCLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUMvRCxNQUFNLGtCQUFrQixHQUN2QixDQUFDLFdBQVcsQ0FBQyxRQUFRLEdBQUcsV0FBVyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUV0RCxPQUFPO2dCQUNOLFFBQVEsRUFBRSxXQUFXLENBQUMsUUFBUTtnQkFDOUIsU0FBUyxFQUFFLFdBQVcsQ0FBQyxTQUFTO2dCQUNoQyxrQkFBa0IsRUFBRSxrQkFBa0I7Z0JBQ3RDLFdBQVc7Z0JBQ1gsZUFBZSxFQUFFLFdBQVcsQ0FBQyxRQUFRLEdBQUcsV0FBVzthQUNuRCxDQUFDO1FBQ0gsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLDBCQUEwQixDQUM5QixLQUFLLEVBQ0wsb0JBQW9CLEVBQ3BCLEVBQUUsRUFDRiw0QkFBNEIsQ0FDNUIsQ0FBQztZQUNGLE9BQU87Z0JBQ04sUUFBUSxFQUFFLENBQUM7Z0JBQ1gsU0FBUyxFQUFFLENBQUM7Z0JBQ1osa0JBQWtCLEVBQUUsQ0FBQztnQkFDckIsV0FBVyxFQUFFLENBQUM7Z0JBQ2QsZUFBZSxFQUFFLElBQUk7YUFDckIsQ0FBQztRQUNILENBQUM7SUFDRixDQUFDO0lBRU0sS0FBSyxDQUFDLFlBQVk7UUFDeEIsSUFBSSxDQUFDO1lBQ0osTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLElBQUksR0FBRyxDQUFDO1lBQ2xFLE9BQU8sSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQzVCLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFO29CQUNoQyxJQUFJLEdBQUcsRUFBRSxDQUFDO3dCQUNULElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUN4Qiw2QkFBNkIsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUMxQyxDQUFDO3dCQUNGLE9BQU8sQ0FBQyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztvQkFDakMsQ0FBQzt5QkFBTSxDQUFDO3dCQUNQLE9BQU8sQ0FBQzs0QkFDUCxRQUFROzRCQUNSLFNBQVMsRUFBRSxLQUFLO3lCQUNoQixDQUFDLENBQUM7b0JBQ0osQ0FBQztnQkFDRixDQUFDLENBQUMsQ0FBQztZQUNKLENBQUMsQ0FBQyxDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLDBCQUEwQixDQUM5QixLQUFLLEVBQ0wsa0JBQWtCLEVBQ2xCLEVBQUUsRUFDRiwwQkFBMEIsQ0FDMUIsQ0FBQztZQUNGLE9BQU8sRUFBRSxDQUFDO1FBQ1gsQ0FBQztJQUNGLENBQUM7SUFFTSxlQUFlO1FBQ3JCLElBQUksQ0FBQztZQUNKLE1BQU0saUJBQWlCLEdBQUcsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDakQsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDO2lCQUNuQyxHQUFHLENBQUMsYUFBYSxDQUFDLEVBQUU7Z0JBQ3BCLE1BQU0sUUFBUSxHQUFHLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxDQUFDO2dCQUNsRCxJQUFJLFFBQVEsRUFBRSxDQUFDO29CQUNkLE9BQU8sUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7d0JBQy9CLFNBQVMsRUFBRSxhQUFhO3dCQUN4QixPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU87d0JBQ3hCLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTTt3QkFDdEIsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO3FCQUMxQixDQUFDLENBQUMsQ0FBQztnQkFDTCxDQUFDO2dCQUNELE9BQU8sRUFBRSxDQUFDO1lBQ1gsQ0FBQyxDQUFDO2lCQUNELElBQUksRUFBRSxDQUFDO1FBQ1YsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLDBCQUEwQixDQUM5QixLQUFLLEVBQ0wscUJBQXFCLEVBQ3JCLEVBQUUsRUFDRiw2QkFBNkIsQ0FDN0IsQ0FBQztZQUNGLE9BQU8sRUFBRSxDQUFDO1FBQ1gsQ0FBQztJQUNGLENBQUM7SUFFTyxZQUFZO1FBQ25CLElBQUksQ0FBQztZQUNKLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMxQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUVqRSxJQUFJLFdBQVcsQ0FBQyxRQUFRLEdBQUcsV0FBVyxHQUFHLEdBQUcsRUFBRSxDQUFDO2dCQUM5QyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDZiwrREFBK0QsQ0FDL0QsQ0FBQztnQkFFRiwwRUFBMEU7Z0JBQzFFLElBQUksQ0FBQyxXQUFXLENBQUMseUJBQXlCLENBQUMsQ0FBQztnQkFFNUMsSUFBSSxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUM7b0JBQ2YsTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDO29CQUNaLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLDJCQUEyQixDQUFDLENBQUM7Z0JBQy9DLENBQUM7cUJBQU0sQ0FBQztvQkFDUCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDZixxRUFBcUUsQ0FDckUsQ0FBQztnQkFDSCxDQUFDO1lBQ0YsQ0FBQztRQUNGLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQywwQkFBMEIsQ0FDOUIsS0FBSyxFQUNMLHFCQUFxQixFQUNyQixFQUFFLEVBQ0Ysa0NBQWtDLENBQ2xDLENBQUM7UUFDSCxDQUFDO0lBQ0YsQ0FBQztJQUVPLFlBQVk7UUFDbkIsSUFBSSxDQUFDO1lBQ0osTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzFDLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ2pFLE1BQU0sa0JBQWtCLEdBQ3ZCLENBQUMsV0FBVyxDQUFDLFFBQVEsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLEdBQUcsR0FBRyxDQUFDO1lBRXRELElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNmLGlCQUFpQixrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUM5RCxDQUFDO1lBRUYsSUFBSSxXQUFXLENBQUMsUUFBUSxHQUFHLFdBQVcsRUFBRSxDQUFDO2dCQUN4QyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDZixvQ0FBb0MsV0FBVyx1Q0FBdUMsQ0FDdEYsQ0FBQztnQkFDRixJQUFJLENBQUMsV0FBVyxDQUFDLHNCQUFzQixDQUFDLENBQUM7Z0JBRXpDLElBQUksTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDO29CQUNmLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLENBQUM7b0JBQy9DLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDYixDQUFDO3FCQUFNLENBQUM7b0JBQ1AsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQ2YsNEZBQTRGLENBQzVGLENBQUM7Z0JBQ0gsQ0FBQztnQkFFRCxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztnQkFDNUIsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7Z0JBRTVCLE1BQU0sc0JBQXNCLEdBQUcsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUNyRCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FDZiw4QkFBOEIsc0JBQXNCLENBQUMsUUFBUSxRQUFRLENBQ3JFLENBQUM7WUFDSCxDQUFDO1FBQ0YsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLDBCQUEwQixDQUM5QixLQUFLLEVBQ0wseUJBQXlCLEVBQ3pCLEVBQUUsRUFDRiw2QkFBNkIsQ0FDN0IsQ0FBQztRQUNILENBQUM7SUFDRixDQUFDO0lBRU0saUJBQWlCLENBQUMsT0FBZTtRQUN2QyxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUVuRSxNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRXJFLElBQUksQ0FBQyxrQkFBa0IsSUFBSSxrQkFBa0IsQ0FBQyxJQUFJLElBQUksWUFBWSxFQUFFLENBQUM7WUFDcEUsT0FBTztRQUNSLENBQUM7UUFFRCxNQUFNLGFBQWEsR0FBRyxrQkFBa0IsQ0FBQyxJQUFJLEdBQUcsWUFBWSxDQUFDO1FBQzdELE1BQU0sZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsSUFBSSxDQUN0RSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3JCLENBQUM7UUFFRixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsYUFBYSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDeEMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXhDLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUMxQyxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN0QyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFMUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFDL0QsQ0FBQztJQUNGLENBQUM7SUFFTSxvQkFBb0IsQ0FBQyxHQUFXO1FBQ3RDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRU8sa0JBQWtCO1FBQ3pCLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3hELE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMxQyxJQUNDLFdBQVcsQ0FBQyxRQUFRO2dCQUNwQixJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxFQUMvQyxDQUFDO2dCQUNGLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7Z0JBQ25ELDREQUE0RDtZQUM3RCxDQUFDO1FBQ0YsQ0FBQztJQUNGLENBQUM7SUFFTywyQkFBMkI7UUFDbEMsMERBQTBEO0lBQzNELENBQUM7SUFFTSxLQUFLLENBQUMsWUFBWSxDQUN4QixHQUFXLEVBQ1gsT0FBZTtRQUVmLElBQUksQ0FBQztZQUNKLE1BQU0sVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUksR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ2hFLElBQUksVUFBVSxFQUFFLENBQUM7Z0JBQ2hCLE9BQU8sVUFBVSxDQUFDO1lBQ25CLENBQUM7WUFDRCxPQUFPLElBQUksQ0FBQztRQUNiLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQywwQkFBMEIsQ0FDOUIsS0FBSyxFQUNMLHVCQUF1QixFQUN2QixFQUFFLEdBQUcsRUFBRSxFQUNQLDZDQUE2QyxHQUFHLEVBQUUsQ0FDbEQsQ0FBQztZQUNGLE9BQU8sSUFBSSxDQUFDO1FBQ2IsQ0FBQztJQUNGLENBQUM7SUFFTSxLQUFLLENBQUMsV0FBVyxDQUN2QixHQUFXLEVBQ1gsS0FBUSxFQUNSLE9BQWUsRUFDZixVQUFrQjtRQUVsQixJQUFJLENBQUM7WUFDSixNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQzlELENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQywwQkFBMEIsQ0FDOUIsS0FBSyxFQUNMLGtCQUFrQixFQUNsQixFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLEVBQzFCLHVDQUF1QyxHQUFHLEVBQUUsQ0FDNUMsQ0FBQztRQUNILENBQUM7SUFDRixDQUFDO0lBRU0sS0FBSyxDQUFDLFdBQVcsQ0FBQyxPQUFlO1FBQ3ZDLElBQUksQ0FBQztZQUNKLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLDhCQUE4QixPQUFPLEtBQUssQ0FBQyxDQUFDO1lBRTdELE1BQU0sSUFBSSxDQUFDLFlBQVk7aUJBQ3JCLFVBQVUsQ0FBQyxPQUFPLENBQUM7aUJBQ25CLElBQUksQ0FBQyxHQUFHLEVBQUU7Z0JBQ1YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQ2YsMENBQTBDLE9BQU8sRUFBRSxDQUNuRCxDQUFDO1lBQ0gsQ0FBQyxDQUFDO2lCQUNELEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FDeEIscUNBQXFDLE9BQU8sS0FBSyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQ2hFLENBQUM7WUFDSCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQywwQkFBMEIsQ0FDOUIsS0FBSyxFQUNMLG9CQUFvQixFQUNwQixFQUFFLEVBQ0YscUNBQXFDLE9BQU8sRUFBRSxDQUM5QyxDQUFDO1FBQ0gsQ0FBQztJQUNGLENBQUM7SUFFTSxLQUFLLENBQUMsb0JBQW9CO1FBQ2hDLElBQUksQ0FBQztZQUNKLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxDQUFDLENBQUM7WUFFekQsTUFBTSxrQkFBa0IsR0FDdkIsTUFBTSxjQUFjLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUM5QyxrQkFBa0IsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1lBRTFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLCtDQUErQyxDQUFDLENBQUM7WUFFbEUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQ2Ysa0RBQWtELENBQ2xELENBQUM7WUFDRixNQUFNLElBQUksQ0FBQyxXQUFXLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUNqRCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNoQixJQUFJLENBQUMsMEJBQTBCLENBQzlCLEtBQUssRUFDTCx3QkFBd0IsRUFDeEIsRUFBRSxFQUNGLGdDQUFnQyxDQUNoQyxDQUFDO1FBQ0gsQ0FBQztJQUNGLENBQUM7SUFFTyxvQkFBb0I7UUFDM0IsSUFBSSxDQUFDO1lBQ0osTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLElBQUksTUFBTSxDQUFDO1lBQ25FLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGlDQUFpQyxPQUFPLEtBQUssQ0FBQyxDQUFDO1lBQ2hFLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFO2dCQUNsQyxJQUFJLEdBQUcsRUFBRSxDQUFDO29CQUNULElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLGlDQUFpQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO29CQUMxRCxPQUFPO2dCQUNSLENBQUM7Z0JBQ0QsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtvQkFDcEIsTUFBTSxRQUFRLEdBQUcsR0FBRyxPQUFPLElBQUksSUFBSSxFQUFFLENBQUM7b0JBQ3RDLEVBQUUsQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxFQUFFO3dCQUN6QixJQUFJLEdBQUcsRUFBRSxDQUFDOzRCQUNULElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUNoQix1QkFBdUIsUUFBUSxLQUFLLEdBQUcsRUFBRSxDQUN6QyxDQUFDO3dCQUNILENBQUM7NkJBQU0sQ0FBQzs0QkFDUCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsUUFBUSxFQUFFLENBQUMsQ0FBQzt3QkFDL0MsQ0FBQztvQkFDRixDQUFDLENBQUMsQ0FBQztnQkFDSixDQUFDLENBQUMsQ0FBQztZQUNKLENBQUMsQ0FBQyxDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLDBCQUEwQixDQUM5QixLQUFLLEVBQ0wseUJBQXlCLEVBQ3pCLEVBQUUsRUFDRixnQ0FBZ0MsQ0FDaEMsQ0FBQztRQUNILENBQUM7SUFDRixDQUFDO0lBRU8sU0FBUztRQUNoQixJQUFJLENBQUM7WUFDSixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFFcEMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRTtnQkFDOUIsSUFBSSxVQUFVLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUM7b0JBQzVCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNmLDBEQUEwRCxDQUMxRCxDQUFDO29CQUNGLElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUM7b0JBQ2pDLHFEQUFxRDtnQkFDdEQsQ0FBQztZQUNGLENBQUMsQ0FBQyxDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLDBCQUEwQixDQUM5QixLQUFLLEVBQ0wsa0JBQWtCLEVBQ2xCLEVBQUUsRUFDRiwrQkFBK0IsQ0FDL0IsQ0FBQztRQUNILENBQUM7SUFDRixDQUFDO0lBRU8sMkJBQTJCO1FBQ2xDLDBEQUEwRDtJQUMzRCxDQUFDO0lBRU8sc0JBQXNCO1FBQzdCLDRFQUE0RTtJQUM3RSxDQUFDO0lBRU8sY0FBYztRQUNyQixJQUFJLENBQUM7WUFDSixJQUFJLE9BQU8sRUFBRSxFQUFFLENBQUM7Z0JBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQ2hCLDhDQUE4QyxDQUM5QyxDQUFDO2dCQUNGLElBQUksQ0FBQywyQkFBMkIsRUFBRSxDQUFDO2dCQUNuQyxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztnQkFFOUIsb0RBQW9EO1lBQ3JELENBQUM7UUFDRixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNoQixJQUFJLENBQUMsMEJBQTBCLENBQzlCLEtBQUssRUFDTCxnQkFBZ0IsRUFDaEIsRUFBRSxFQUNGLGdDQUFnQyxDQUNoQyxDQUFDO1FBQ0gsQ0FBQztJQUNGLENBQUM7SUFFTSxLQUFLLENBQUMsUUFBUTtRQUNwQixJQUFJLENBQUM7WUFDSixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO1lBRXRELE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNuQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1lBRWxELElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsNkJBQTZCLENBQUMsQ0FBQztZQUVoRCxNQUFNLElBQUksQ0FBQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUMxQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1lBRWpELE1BQU0sSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7WUFDbEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0RBQWdELENBQUMsQ0FBQztZQUVuRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO1FBQ3pELENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQywwQkFBMEIsQ0FDOUIsS0FBSyxFQUNMLGdCQUFnQixFQUNoQixFQUFFLEVBQ0Ysd0NBQXdDLENBQ3hDLENBQUM7UUFDSCxDQUFDO0lBQ0YsQ0FBQztJQUVPLDBCQUEwQixDQUNqQyxLQUFjLEVBQ2QsV0FBbUIsRUFDbkIsWUFBb0IsRUFDcEIsYUFBcUI7UUFFckIsSUFBSSxDQUFDO1lBQ0osTUFBTSxZQUFZLEdBQUcsR0FBRyxhQUFhLEtBQUssS0FBSyxLQUFLLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2hHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRXhDLE1BQU0sYUFBYSxHQUNsQixJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLG9CQUFvQixDQUN0RCxXQUFXLEVBQ1g7Z0JBQ0MsT0FBTyxFQUFFLFlBQVk7Z0JBQ3JCLGNBQWMsRUFBRSxLQUFLO2FBQ3JCLENBQ0QsQ0FBQztZQUVILElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDO2dCQUM3QixLQUFLLEVBQUUsYUFBYTthQUNwQixDQUFDLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FDaEIsMENBQTBDLEtBQUssRUFBRSxDQUNqRCxDQUFDO1lBQ0YsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDO1lBQ3pELElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDO2dCQUM3QixLQUFLO2dCQUNMLE9BQU8sRUFBRTtvQkFDUixPQUFPLEVBQUUsa0JBQWtCO29CQUMzQixNQUFNLEVBQUUsbUVBQW1FO29CQUMzRSxLQUFLLEVBQUUsa0dBQWtHO2lCQUN6RztnQkFDRCxRQUFRO2FBQ1IsQ0FBQyxDQUFDO1FBQ0osQ0FBQztJQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuXHRBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRDYWNoZVNlcnZpY2VJbnRlcmZhY2UsXG5cdEVudkNvbmZpZ1NlcnZpY2VJbnRlcmZhY2UsXG5cdEVycm9yTG9nZ2VyU2VydmljZUludGVyZmFjZSxcblx0RXJyb3JIYW5kbGVyU2VydmljZUludGVyZmFjZSxcblx0UmVkaXNTZXJ2aWNlSW50ZXJmYWNlLFxuXHRSZXNvdXJjZU1hbmFnZXJJbnRlcmZhY2Vcbn0gZnJvbSAnLi4vaW5kZXgvaW50ZXJmYWNlcy9zZXJ2aWNlcyc7XG5pbXBvcnQgeyBTZXJ2aWNlRmFjdG9yeSB9IGZyb20gJy4uL2luZGV4L2ZhY3RvcnknO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgdG9vYnVzeSBmcm9tICd0b29idXN5LWpzJztcblxuZXhwb3J0IGNsYXNzIFJlc291cmNlTWFuYWdlciBpbXBsZW1lbnRzIFJlc291cmNlTWFuYWdlckludGVyZmFjZSB7XG5cdHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBSZXNvdXJjZU1hbmFnZXIgfCBudWxsID0gbnVsbDtcblx0cHJpdmF0ZSBsb2dnZXI6IEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2U7XG5cdHByaXZhdGUgZXJyb3JMb2dnZXI6IEVycm9yTG9nZ2VyU2VydmljZUludGVyZmFjZTtcblx0cHJpdmF0ZSBlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlclNlcnZpY2VJbnRlcmZhY2U7XG5cdHByaXZhdGUgZW52Q29uZmlnOiBFbnZDb25maWdTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIHJlZGlzU2VydmljZTogUmVkaXNTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIGNhY2hlU2VydmljZTogQ2FjaGVTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIG1lbW9yeUNhY2hlTFJVOiBNYXA8c3RyaW5nLCBudW1iZXI+ID0gbmV3IE1hcCgpO1xuXG5cdHByaXZhdGUgY29uc3RydWN0b3IoXG5cdFx0bG9nZ2VyOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRcdGVycm9yTG9nZ2VyOiBFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2UsXG5cdFx0ZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRcdGVudkNvbmZpZzogRW52Q29uZmlnU2VydmljZUludGVyZmFjZSxcblx0XHRyZWRpc1NlcnZpY2U6IFJlZGlzU2VydmljZUludGVyZmFjZSxcblx0XHRjYWNoZVNlcnZpY2U6IENhY2hlU2VydmljZUludGVyZmFjZVxuXHQpIHtcblx0XHR0aGlzLmxvZ2dlciA9IGxvZ2dlcjtcblx0XHR0aGlzLmVycm9yTG9nZ2VyID0gZXJyb3JMb2dnZXI7XG5cdFx0dGhpcy5lcnJvckhhbmRsZXIgPSBlcnJvckhhbmRsZXI7XG5cdFx0dGhpcy5lbnZDb25maWcgPSBlbnZDb25maWc7XG5cdFx0dGhpcy5yZWRpc1NlcnZpY2UgPSByZWRpc1NlcnZpY2U7XG5cdFx0dGhpcy5jYWNoZVNlcnZpY2UgPSBjYWNoZVNlcnZpY2U7XG5cdH1cblxuXHRwdWJsaWMgc3RhdGljIGFzeW5jIGdldEluc3RhbmNlKCk6IFByb21pc2U8UmVzb3VyY2VNYW5hZ2VyPiB7XG5cdFx0aWYgKCFSZXNvdXJjZU1hbmFnZXIuaW5zdGFuY2UpIHtcblx0XHRcdGNvbnN0IGxvZ2dlciA9IGF3YWl0IFNlcnZpY2VGYWN0b3J5LmdldExvZ2dlclNlcnZpY2UoKTtcblx0XHRcdGNvbnN0IGVycm9yTG9nZ2VyID0gYXdhaXQgU2VydmljZUZhY3RvcnkuZ2V0RXJyb3JMb2dnZXJTZXJ2aWNlKCk7XG5cdFx0XHRjb25zdCBlcnJvckhhbmRsZXIgPSBhd2FpdCBTZXJ2aWNlRmFjdG9yeS5nZXRFcnJvckhhbmRsZXJTZXJ2aWNlKCk7XG5cdFx0XHRjb25zdCBlbnZDb25maWcgPSBhd2FpdCBTZXJ2aWNlRmFjdG9yeS5nZXRFbnZDb25maWdTZXJ2aWNlKCk7XG5cdFx0XHRjb25zdCByZWRpc1NlcnZpY2UgPSBhd2FpdCBTZXJ2aWNlRmFjdG9yeS5nZXRSZWRpc1NlcnZpY2UoKTtcblx0XHRcdGNvbnN0IGNhY2hlU2VydmljZSA9IGF3YWl0IFNlcnZpY2VGYWN0b3J5LmdldENhY2hlU2VydmljZSgpO1xuXG5cdFx0XHRSZXNvdXJjZU1hbmFnZXIuaW5zdGFuY2UgPSBuZXcgUmVzb3VyY2VNYW5hZ2VyKFxuXHRcdFx0XHRsb2dnZXIsXG5cdFx0XHRcdGVycm9yTG9nZ2VyLFxuXHRcdFx0XHRlcnJvckhhbmRsZXIsXG5cdFx0XHRcdGVudkNvbmZpZyxcblx0XHRcdFx0cmVkaXNTZXJ2aWNlLFxuXHRcdFx0XHRjYWNoZVNlcnZpY2Vcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIFJlc291cmNlTWFuYWdlci5pbnN0YW5jZTtcblx0fVxuXG5cdHB1YmxpYyBnZXRDcHVVc2FnZSgpOiBBcnJheTx7IGNvcmU6IG51bWJlcjsgdXNhZ2U6IHN0cmluZyB9PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGNwdXMgPSBvcy5jcHVzKCk7XG5cdFx0XHRyZXR1cm4gY3B1cy5tYXAoKGNwdSwgaW5kZXgpID0+IHtcblx0XHRcdFx0Y29uc3QgdG90YWwgPSBPYmplY3QudmFsdWVzKGNwdS50aW1lcykucmVkdWNlKFxuXHRcdFx0XHRcdChhY2MsIHRpbWUpID0+IGFjYyArIHRpbWUsXG5cdFx0XHRcdFx0MFxuXHRcdFx0XHQpO1xuXHRcdFx0XHRjb25zdCB1c2FnZSA9ICgodG90YWwgLSBjcHUudGltZXMuaWRsZSkgLyB0b3RhbCkgKiAxMDA7XG5cdFx0XHRcdHJldHVybiB7IGNvcmU6IGluZGV4ICsgMSwgdXNhZ2U6IGAke3VzYWdlLnRvRml4ZWQoMil9JWAgfTtcblx0XHRcdH0pO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZVJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J0NQVV9VU0FHRV9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgZ2V0dGluZyBDUFUgdXNhZ2UnXG5cdFx0XHQpO1xuXHRcdFx0cmV0dXJuIFtdO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhZGp1c3RSZXNvdXJjZXMoKTogdm9pZCB7XG5cdFx0Ly8gKkRFVi1OT1RFKiB0aGlzIGlzIHVudXNlZCBpbiB0aGUgY3VycmVudCBpbXBsZW1lbnRhdGlvblxuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBtZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcblx0XHRcdGNvbnN0IG1lbW9yeUxpbWl0ID0gdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21lbW9yeUxpbWl0Jyk7XG5cdFx0XHRjb25zdCB1c2VkSGVhcFBlcmNlbnRhZ2UgPVxuXHRcdFx0XHQobWVtb3J5VXNhZ2UuaGVhcFVzZWQgLyBtZW1vcnlVc2FnZS5oZWFwVG90YWwpICogMTAwO1xuXG5cdFx0XHRpZiAodXNlZEhlYXBQZXJjZW50YWdlID4gbWVtb3J5TGltaXQgfHwgODApIHtcblx0XHRcdFx0dGhpcy5sb2dnZXIud2Fybihcblx0XHRcdFx0XHRgTWVtb3J5IHVzYWdlIGhpZ2g6ICR7dXNlZEhlYXBQZXJjZW50YWdlfSUgb2YgaGVhcCB1c2VkLmBcblx0XHRcdFx0KTtcblx0XHRcdFx0dGhpcy5jbGVhckNhY2hlcygnaGlnaE1lbW9yeVVzYWdlU2VydmljZScpO1xuXHRcdFx0XHR0aGlzLmNsb3NlSWRsZUNvbm5lY3Rpb25zKCk7XG5cdFx0XHRcdHRoaXMuYWRqdXN0TWVtb3J5KCk7XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IGNwdVVzYWdlID0gdGhpcy5nZXRDcHVVc2FnZSgpO1xuXG5cdFx0XHRpZiAoY3B1VXNhZ2Uuc29tZShjcHUgPT4gcGFyc2VGbG9hdChjcHUudXNhZ2UpID4gODkpKSB7XG5cdFx0XHRcdHRoaXMubG9nZ2VyLndhcm4oXG5cdFx0XHRcdFx0J0hpZ2ggQ1BVIHVzYWdlIGRldGVjdGVkLCBhZGp1c3RpbmcgQ1BVIHJlc291cmNlcy4uLidcblx0XHRcdFx0KTtcblx0XHRcdFx0dGhpcy5hZGp1c3RDUFUoKTtcblx0XHRcdH1cblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdBREpVU1RfUkVTT1VSQ0VTX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdCdFcnJvciBhZGp1c3RpbmcgcmVzb3VyY2VzJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgZ2V0TWVtb3J5VXNhZ2UoKToge1xuXHRcdGhlYXBVc2VkOiBudW1iZXI7XG5cdFx0aGVhcFRvdGFsOiBudW1iZXI7XG5cdFx0aGVhcFVzZWRQZXJjZW50YWdlOiBudW1iZXI7XG5cdFx0bWVtb3J5TGltaXQ6IG51bWJlcjtcblx0XHRpc01lbW9yeUhlYWx0aHk6IGJvb2xlYW47XG5cdH0ge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBtZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcblx0XHRcdGNvbnN0IG1lbW9yeUxpbWl0ID1cblx0XHRcdFx0dGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21lbW9yeUxpbWl0JykgfHwgb3MudG90YWxtZW0oKTtcblx0XHRcdGNvbnN0IHVzZWRIZWFwUGVyY2VudGFnZSA9XG5cdFx0XHRcdChtZW1vcnlVc2FnZS5oZWFwVXNlZCAvIG1lbW9yeVVzYWdlLmhlYXBUb3RhbCkgKiAxMDA7XG5cblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdGhlYXBVc2VkOiBtZW1vcnlVc2FnZS5oZWFwVXNlZCxcblx0XHRcdFx0aGVhcFRvdGFsOiBtZW1vcnlVc2FnZS5oZWFwVG90YWwsXG5cdFx0XHRcdGhlYXBVc2VkUGVyY2VudGFnZTogdXNlZEhlYXBQZXJjZW50YWdlLFxuXHRcdFx0XHRtZW1vcnlMaW1pdCxcblx0XHRcdFx0aXNNZW1vcnlIZWFsdGh5OiBtZW1vcnlVc2FnZS5oZWFwVXNlZCA8IG1lbW9yeUxpbWl0XG5cdFx0XHR9O1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZVJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J01FTU9SWV9VU0FHRV9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgZ2V0dGluZyBtZW1vcnkgdXNhZ2UnXG5cdFx0XHQpO1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0aGVhcFVzZWQ6IDAsXG5cdFx0XHRcdGhlYXBUb3RhbDogMCxcblx0XHRcdFx0aGVhcFVzZWRQZXJjZW50YWdlOiAwLFxuXHRcdFx0XHRtZW1vcnlMaW1pdDogMCxcblx0XHRcdFx0aXNNZW1vcnlIZWFsdGh5OiB0cnVlXG5cdFx0XHR9O1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhc3luYyBnZXREaXNrVXNhZ2UoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBkaXNrUGF0aCA9IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdkaXNrUGF0aCcpIHx8ICcvJztcblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcblx0XHRcdFx0ZnMuc3RhdChkaXNrUGF0aCwgKGVyciwgc3RhdHMpID0+IHtcblx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHR0aGlzLmVycm9yTG9nZ2VyLmxvZ0Vycm9yKFxuXHRcdFx0XHRcdFx0XHRgRXJyb3IgZ2V0dGluZyBkaXNrIHVzYWdlOiAke2Vyci5tZXNzYWdlfWBcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHRyZXNvbHZlKHsgZXJyb3I6IGVyci5tZXNzYWdlIH0pO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRyZXNvbHZlKHtcblx0XHRcdFx0XHRcdFx0ZGlza1BhdGgsXG5cdFx0XHRcdFx0XHRcdGRpc2tTdGF0czogc3RhdHNcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdESVNLX1VTQUdFX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdCdFcnJvciBnZXR0aW5nIGRpc2sgdXNhZ2UnXG5cdFx0XHQpO1xuXHRcdFx0cmV0dXJuIHt9O1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBnZXROZXR3b3JrVXNhZ2UoKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj5bXSB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IG5ldHdvcmtJbnRlcmZhY2VzID0gb3MubmV0d29ya0ludGVyZmFjZXMoKTtcblx0XHRcdHJldHVybiBPYmplY3Qua2V5cyhuZXR3b3JrSW50ZXJmYWNlcylcblx0XHRcdFx0Lm1hcChpbnRlcmZhY2VOYW1lID0+IHtcblx0XHRcdFx0XHRjb25zdCBuZXRTdGF0cyA9IG5ldHdvcmtJbnRlcmZhY2VzW2ludGVyZmFjZU5hbWVdO1xuXHRcdFx0XHRcdGlmIChuZXRTdGF0cykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIG5ldFN0YXRzLm1hcChuZXRTdGF0ID0+ICh7XG5cdFx0XHRcdFx0XHRcdGludGVyZmFjZTogaW50ZXJmYWNlTmFtZSxcblx0XHRcdFx0XHRcdFx0YWRkcmVzczogbmV0U3RhdC5hZGRyZXNzLFxuXHRcdFx0XHRcdFx0XHRmYW1pbHk6IG5ldFN0YXQuZmFtaWx5LFxuXHRcdFx0XHRcdFx0XHRpbnRlcm5hbDogbmV0U3RhdC5pbnRlcm5hbFxuXHRcdFx0XHRcdFx0fSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gW107XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5mbGF0KCk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnTkVUV09SS19VU0FHRV9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgZ2V0dGluZyBuZXR3b3JrIHVzYWdlJ1xuXHRcdFx0KTtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGFkanVzdE1lbW9yeSgpOiB2b2lkIHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgbWVtb3J5VXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XG5cdFx0XHRjb25zdCBtZW1vcnlMaW1pdCA9IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdtZW1vcnlMaW1pdCcpO1xuXG5cdFx0XHRpZiAobWVtb3J5VXNhZ2UuaGVhcFVzZWQgPiBtZW1vcnlMaW1pdCAqIDAuOSkge1xuXHRcdFx0XHR0aGlzLmxvZ2dlci53YXJuKFxuXHRcdFx0XHRcdCdNZW1vcnkgdXNhZ2UgaXMgY3JpdGljYWxseSBoaWdoLCBpbml0aWF0aW5nIG1lbW9yeSBjbGVhbnVwLi4uJ1xuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdC8vICpERVYtTk9URSogcGFzcyBhbiBhcHByb3ByaWF0ZSBjb250ZXh0IHN0cmluZyB0byB0aGUgY2xlYXJDYWNoZXMgbWV0aG9kXG5cdFx0XHRcdHRoaXMuY2xlYXJDYWNoZXMoJ21lbW9yeUFkanVzdG1lbnRTZXJ2aWNlJyk7XG5cblx0XHRcdFx0aWYgKGdsb2JhbC5nYykge1xuXHRcdFx0XHRcdGdsb2JhbC5nYygpO1xuXHRcdFx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ0dhcmJhZ2UgY29sbGVjdGlvbiBmb3JjZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmxvZ2dlci53YXJuKFxuXHRcdFx0XHRcdFx0J0dhcmJhZ2UgY29sbGVjdGlvbiBub3QgZXhwb3NlZC4gVXNlIC0tZXhwb3NlLWdjIHRvIGFsbG93IGZvcmNlZCBHQy4nXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZVJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J0FESlVTVF9NRU1PUllfRVJST1InLFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0J0Vycm9yIGFkanVzdGluZyBtZW1vcnkgcmVzb3VyY2VzJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIG1hbmFnZU1lbW9yeSgpOiB2b2lkIHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgbWVtb3J5VXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XG5cdFx0XHRjb25zdCBtZW1vcnlMaW1pdCA9IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdtZW1vcnlMaW1pdCcpO1xuXHRcdFx0Y29uc3QgdXNlZEhlYXBQZXJjZW50YWdlID1cblx0XHRcdFx0KG1lbW9yeVVzYWdlLmhlYXBVc2VkIC8gbWVtb3J5VXNhZ2UuaGVhcFRvdGFsKSAqIDEwMDtcblxuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbyhcblx0XHRcdFx0YE1lbW9yeSB1c2FnZTogJHt1c2VkSGVhcFBlcmNlbnRhZ2UudG9GaXhlZCgyKX0lIG9mIGhlYXAgdXNlZGBcblx0XHRcdCk7XG5cblx0XHRcdGlmIChtZW1vcnlVc2FnZS5oZWFwVXNlZCA+IG1lbW9yeUxpbWl0KSB7XG5cdFx0XHRcdHRoaXMubG9nZ2VyLndhcm4oXG5cdFx0XHRcdFx0YE1lbW9yeSB1c2FnZSBleGNlZWRlZCB0aGUgbGltaXQgKCR7bWVtb3J5TGltaXR9IGJ5dGVzKS4gSW5pdGlhdGluZyBtZW1vcnkgY2xlYW51cC4uLmBcblx0XHRcdFx0KTtcblx0XHRcdFx0dGhpcy5jbGVhckNhY2hlcygnbWVtb3J5Q2xlYW51cFNlcnZpY2UnKTtcblxuXHRcdFx0XHRpZiAoZ2xvYmFsLmdjKSB7XG5cdFx0XHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnRm9yY2luZyBnYXJiYWdlIGNvbGxlY3Rpb24nKTtcblx0XHRcdFx0XHRnbG9iYWwuZ2MoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmxvZ2dlci53YXJuKFxuXHRcdFx0XHRcdFx0J0dhcmJhZ2UgY29sbGVjdGlvbiBpcyBub3QgZXhwb3NlZC4gU3RhcnQgdGhlIHByb2Nlc3Mgd2l0aCAtLWV4cG9zZS1nYyB0byBlbmFibGUgZm9yY2VkIEdDLidcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhpcy5jbG9zZUlkbGVDb25uZWN0aW9ucygpO1xuXHRcdFx0XHR0aGlzLnJlbW92ZVRlbXBvcmFyeUZpbGVzKCk7XG5cblx0XHRcdFx0Y29uc3QgcG9zdENsZWFudXBNZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcblx0XHRcdFx0dGhpcy5sb2dnZXIuaW5mbyhcblx0XHRcdFx0XHRgUG9zdC1jbGVhbnVwIG1lbW9yeSB1c2FnZTogJHtwb3N0Q2xlYW51cE1lbW9yeVVzYWdlLmhlYXBVc2VkfSBieXRlc2Bcblx0XHRcdFx0KTtcblx0XHRcdH1cblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdNRU1PUllfTUFOQUdFTUVOVF9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgbWFuYWdpbmcgbWVtb3J5IHVzYWdlJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgZXZpY3RDYWNoZUVudHJpZXMoc2VydmljZTogc3RyaW5nKTogdm9pZCB7XG5cdFx0Y29uc3QgbWF4Q2FjaGVTaXplID0gdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21heENhY2hlU2l6ZScpO1xuXG5cdFx0Y29uc3Qgc2VydmljZU1lbW9yeUNhY2hlID0gdGhpcy5jYWNoZVNlcnZpY2UuZ2V0TWVtb3J5Q2FjaGUoc2VydmljZSk7XG5cblx0XHRpZiAoIXNlcnZpY2VNZW1vcnlDYWNoZSB8fCBzZXJ2aWNlTWVtb3J5Q2FjaGUuc2l6ZSA8PSBtYXhDYWNoZVNpemUpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRjb25zdCBleGNlc3NFbnRyaWVzID0gc2VydmljZU1lbW9yeUNhY2hlLnNpemUgLSBtYXhDYWNoZVNpemU7XG5cdFx0Y29uc3Qgc29ydGVkTFJVRW50cmllcyA9IEFycmF5LmZyb20odGhpcy5tZW1vcnlDYWNoZUxSVS5lbnRyaWVzKCkpLnNvcnQoXG5cdFx0XHQoYSwgYikgPT4gYVsxXSAtIGJbMV1cblx0XHQpO1xuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBleGNlc3NFbnRyaWVzOyBpKyspIHtcblx0XHRcdGNvbnN0IFtvbGRlc3RLZXldID0gc29ydGVkTFJVRW50cmllc1tpXTtcblxuXHRcdFx0dGhpcy5jYWNoZVNlcnZpY2UuZGVsKG9sZGVzdEtleSwgc2VydmljZSk7XG5cdFx0XHR0aGlzLm1lbW9yeUNhY2hlTFJVLmRlbGV0ZShvbGRlc3RLZXkpO1xuXHRcdFx0dGhpcy5jYWNoZVNlcnZpY2UuZGVsKG9sZGVzdEtleSwgc2VydmljZSk7XG5cblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oYEV2aWN0ZWQgY2FjaGUgZW50cnkgZm9yIGtleTogJHtvbGRlc3RLZXl9YCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIHVwZGF0ZUNhY2hlQWNjZXNzTFJVKGtleTogc3RyaW5nKTogdm9pZCB7XG5cdFx0dGhpcy5tZW1vcnlDYWNoZUxSVS5zZXQoa2V5LCBEYXRlLm5vdygpKTtcblx0fVxuXG5cdHByaXZhdGUgYXV0b1NjYWxlUmVzb3VyY2VzKCk6IHZvaWQge1xuXHRcdGlmICh0aGlzLmVudkNvbmZpZy5nZXRGZWF0dXJlRmxhZ3MoKS5lbmFibGVBdXRvU2NhbGluZykge1xuXHRcdFx0Y29uc3QgbWVtb3J5VXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XG5cdFx0XHRpZiAoXG5cdFx0XHRcdG1lbW9yeVVzYWdlLmhlYXBVc2VkID5cblx0XHRcdFx0dGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21lbW9yeVRocmVzaG9sZCcpXG5cdFx0XHQpIHtcblx0XHRcdFx0dGhpcy5sb2dnZXIud2FybignU2NhbGluZyB1cCBtZW1vcnkgcmVzb3VyY2VzLi4uJyk7XG5cdFx0XHRcdC8vICpERVYtTk9URSogbG9naWMgZm9yIHNjYWxpbmcgbWVtb3J5IHJlc291cmNlcyBkeW5hbWljYWxseVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgdGhyb3R0bGVCYWNrZ3JvdW5kUHJvY2Vzc2VzKCk6IHZvaWQge1xuXHRcdC8vICpERVYtTk9URSogbG9naWMgdG8gcmVkdWNlIGJhY2tncm91bmQgcHJvY2VzcyBmcmVxdWVuY3lcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBnZXRGcm9tQ2FjaGU8VD4oXG5cdFx0a2V5OiBzdHJpbmcsXG5cdFx0c2VydmljZTogc3RyaW5nXG5cdCk6IFByb21pc2U8VCB8IG51bGw+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgY2FjaGVkRGF0YSA9IGF3YWl0IHRoaXMuY2FjaGVTZXJ2aWNlLmdldDxUPihrZXksIHNlcnZpY2UpO1xuXHRcdFx0aWYgKGNhY2hlZERhdGEpIHtcblx0XHRcdFx0cmV0dXJuIGNhY2hlZERhdGE7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdDQUNIRV9SRVRSSUVWQUxfRVJST1InLFxuXHRcdFx0XHR7IGtleSB9LFxuXHRcdFx0XHRgRXJyb3IgcmV0cmlldmluZyBkYXRhIGZyb20gY2FjaGUgZm9yIGtleTogJHtrZXl9YFxuXHRcdFx0KTtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhc3luYyBzYXZlVG9DYWNoZTxUPihcblx0XHRrZXk6IHN0cmluZyxcblx0XHR2YWx1ZTogVCxcblx0XHRzZXJ2aWNlOiBzdHJpbmcsXG5cdFx0ZXhwaXJhdGlvbjogbnVtYmVyXG5cdCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRyeSB7XG5cdFx0XHRhd2FpdCB0aGlzLmNhY2hlU2VydmljZS5zZXQoa2V5LCB2YWx1ZSwgc2VydmljZSwgZXhwaXJhdGlvbik7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnQ0FDSEVfU0FWRV9FUlJPUicsXG5cdFx0XHRcdHsga2V5LCB2YWx1ZSwgZXhwaXJhdGlvbiB9LFxuXHRcdFx0XHRgRXJyb3Igc2F2aW5nIGRhdGEgdG8gY2FjaGUgZm9yIGtleTogJHtrZXl9YFxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgY2xlYXJDYWNoZXMoc2VydmljZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oYENsZWFyaW5nIGNhY2hlIGZvciBzZXJ2aWNlICR7c2VydmljZX0uLi5gKTtcblxuXHRcdFx0YXdhaXQgdGhpcy5jYWNoZVNlcnZpY2Vcblx0XHRcdFx0LmZsdXNoQ2FjaGUoc2VydmljZSlcblx0XHRcdFx0LnRoZW4oKCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMubG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0XHRgQ2FjaGUgZmx1c2hlZCBzdWNjZXNzZnVsbHkgZm9yIHNlcnZpY2UgJHtzZXJ2aWNlfWBcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9KVxuXHRcdFx0XHQuY2F0Y2goZXJyb3IgPT4ge1xuXHRcdFx0XHRcdHRoaXMuZXJyb3JMb2dnZXIubG9nRXJyb3IoXG5cdFx0XHRcdFx0XHRgRmFpbGVkIHRvIGZsdXNoIGNhY2hlIGZvciBzZXJ2aWNlICR7c2VydmljZX06ICR7ZXJyb3IubWVzc2FnZX1gXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fSk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnQ0xFQVJfQ0FDSEVTX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdGBFcnJvciBjbGVhcmluZyBjYWNoZXMgZm9yIHNlcnZpY2UgJHtzZXJ2aWNlfWBcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGFzeW5jIGNsb3NlSWRsZUNvbm5lY3Rpb25zKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRyeSB7XG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdDbG9zaW5nIGlkbGUgZGF0YWJhc2UgY29ubmVjdGlvbnMuLi4nKTtcblxuXHRcdFx0Y29uc3QgZGF0YWJhc2VDb250cm9sbGVyID1cblx0XHRcdFx0YXdhaXQgU2VydmljZUZhY3RvcnkuZ2V0RGF0YWJhc2VDb250cm9sbGVyKCk7XG5cdFx0XHRkYXRhYmFzZUNvbnRyb2xsZXIuY2xlYXJJZGxlQ29ubmVjdGlvbnMoKTtcblxuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnSWRsZSBkYXRhYmFzZSBjb25uZWN0aW9ucyBjbG9zZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oXG5cdFx0XHRcdCdDbGVhcmluZyBjYWNoZSBhZnRlciBjbG9zaW5nIGlkbGUgY29ubmVjdGlvbnMuLi4nXG5cdFx0XHQpO1xuXHRcdFx0YXdhaXQgdGhpcy5jbGVhckNhY2hlcygnaWRsZUNvbm5lY3Rpb25TZXJ2aWNlJyk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnSURMRV9DT05ORUNUSU9OU19FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgY2xvc2luZyBpZGxlIGNvbm5lY3Rpb25zJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIHJlbW92ZVRlbXBvcmFyeUZpbGVzKCk6IHZvaWQge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCB0ZW1wRGlyID0gdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ3RlbXBEaXInKSB8fCAnL3RtcCc7XG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKGBSZW1vdmluZyB0ZW1wb3JhcnkgZmlsZXMgZnJvbSAke3RlbXBEaXJ9Li4uYCk7XG5cdFx0XHRmcy5yZWFkZGlyKHRlbXBEaXIsIChlcnIsIGZpbGVzKSA9PiB7XG5cdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHR0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgcmVhZGluZyB0ZW1wIGRpcmVjdG9yeTogJHtlcnJ9YCk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGZpbGVzLmZvckVhY2goZmlsZSA9PiB7XG5cdFx0XHRcdFx0Y29uc3QgZmlsZVBhdGggPSBgJHt0ZW1wRGlyfS8ke2ZpbGV9YDtcblx0XHRcdFx0XHRmcy51bmxpbmsoZmlsZVBhdGgsIGVyciA9PiB7XG5cdFx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMubG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRcdFx0XHRcdGBFcnJvciBkZWxldGluZyBmaWxlICR7ZmlsZVBhdGh9OiAke2Vycn1gXG5cdFx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHR0aGlzLmxvZ2dlci5pbmZvKGBEZWxldGVkIGZpbGU6ICR7ZmlsZVBhdGh9YCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnUkVNT1ZFX1RFTVBfRklMRVNfRVJST1InLFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0J0Vycm9yIHJlbW92aW5nIHRlbXBvcmFyeSBmaWxlcydcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBhZGp1c3RDUFUoKTogdm9pZCB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGNwdVVzYWdlID0gdGhpcy5nZXRDcHVVc2FnZSgpO1xuXG5cdFx0XHRjcHVVc2FnZS5mb3JFYWNoKCh7IHVzYWdlIH0pID0+IHtcblx0XHRcdFx0aWYgKHBhcnNlRmxvYXQodXNhZ2UpID4gODUpIHtcblx0XHRcdFx0XHR0aGlzLmxvZ2dlci53YXJuKFxuXHRcdFx0XHRcdFx0J0NQVSB1c2FnZSBpcyBjcml0aWNhbGx5IGhpZ2gsIGFkanVzdGluZyBDUFUgcmVzb3VyY2VzLi4uJ1xuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0dGhpcy5jbGVhckNhY2hlcygnYVRhc2tTZXJ2aWNlJyk7XG5cdFx0XHRcdFx0Ly8gKkRFVi1OT1RFKiBjbGVhciBjYWNoZXMgZm9yIENQVS1pbnRlbnNpdmUgc2VydmljZXNcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnQURKVVNUX0NQVV9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgYWRqdXN0aW5nIENQVSByZXNvdXJjZXMnXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgc2xvd0Rvd25CYWNrZ3JvdW5kUHJvY2Vzc2VzKCk6IHZvaWQge1xuXHRcdC8vICpERVYtTk9URSogbG9naWMgdG8gcmVkdWNlIGJhY2tncm91bmQgcHJvY2VzcyBmcmVxdWVuY3lcblx0fVxuXG5cdHByaXZhdGUgcGF1c2VOb25Fc3NlbnRpYWxUYXNrcygpOiB2b2lkIHtcblx0XHQvLyAqREVWLU5PVEUqIGxvZ2ljIHRvIHRlbXBvcmFyaWx5IHBhdXNlIG5vbi1lc3NlbnRpYWwgc2VydmljZXMgb3IgcHJvY2Vzc2VzXG5cdH1cblxuXHRwcml2YXRlIGhhbmRsZU92ZXJsb2FkKCk6IHZvaWQge1xuXHRcdHRyeSB7XG5cdFx0XHRpZiAodG9vYnVzeSgpKSB7XG5cdFx0XHRcdHRoaXMubG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRcdCdTZXJ2ZXIgaXMgb3ZlcmxvYWRlZCwgcmVqZWN0aW5nIG5ldyByZXF1ZXN0cydcblx0XHRcdFx0KTtcblx0XHRcdFx0dGhpcy5zbG93RG93bkJhY2tncm91bmRQcm9jZXNzZXMoKTtcblx0XHRcdFx0dGhpcy5wYXVzZU5vbkVzc2VudGlhbFRhc2tzKCk7XG5cblx0XHRcdFx0Ly8gKkRFVi1OT1RFKiByZWplY3QtcmVxdWVzdGluZyBtaWRkbGV3YXJlIGdvZXMgaGVyZVxuXHRcdFx0fVxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZVJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J09WRVJMT0FEX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdCdFcnJvciBoYW5kbGluZyBzZXJ2ZXIgb3ZlcmxvYWQnXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhc3luYyBzaHV0ZG93bigpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0cnkge1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnU2h1dHRpbmcgZG93biBSZXNvdXJjZSBNYW5hZ2VyLi4uJyk7XG5cblx0XHRcdHRvb2J1c3kuc2h1dGRvd24oKTtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ1Rvb0J1c3kuanMgc2h1dGRvd24gY29tcGxldGUuJyk7XG5cblx0XHRcdHRoaXMubWVtb3J5Q2FjaGVMUlUuY2xlYXIoKTtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ01lbW9yeSBjYWNoZSAoTFJVKSBjbGVhcmVkLicpO1xuXG5cdFx0XHRhd2FpdCB0aGlzLmNsZWFyQ2FjaGVzKCdyZXNvdXJjZU1hbmFnZXInKTtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ0NhY2hlcyBjbGVhcmVkIHN1Y2Nlc3NmdWxseS4nKTtcblxuXHRcdFx0YXdhaXQgdGhpcy5jbG9zZUlkbGVDb25uZWN0aW9ucygpO1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnSWRsZSBkYXRhYmFzZSBjb25uZWN0aW9ucyBjbG9zZWQgc3VjY2Vzc2Z1bGx5LicpO1xuXG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdSZXNvdXJjZSBNYW5hZ2VyIHNodXRkb3duIGNvbXBsZXRlLicpO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZVJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J1NIVVRET1dOX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdCdFcnJvciBkdXJpbmcgUmVzb3VyY2UgTWFuYWdlciBzaHV0ZG93bidcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBoYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRlcnJvcjogdW5rbm93bixcblx0XHRlcnJvckhlYWRlcjogc3RyaW5nLFxuXHRcdGVycm9yRGV0YWlsczogb2JqZWN0LFxuXHRcdGN1c3RvbU1lc3NhZ2U6IHN0cmluZ1xuXHQpOiB2b2lkIHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgZXJyb3JNZXNzYWdlID0gYCR7Y3VzdG9tTWVzc2FnZX06ICR7ZXJyb3J9XFxuJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiAnJ31gO1xuXHRcdFx0dGhpcy5lcnJvckxvZ2dlci5sb2dFcnJvcihlcnJvck1lc3NhZ2UpO1xuXG5cdFx0XHRjb25zdCByZXNvdXJjZUVycm9yID1cblx0XHRcdFx0bmV3IHRoaXMuZXJyb3JIYW5kbGVyLkVycm9yQ2xhc3Nlcy5SZXNvdXJjZU1hbmFnZXJFcnJvcihcblx0XHRcdFx0XHRlcnJvckhlYWRlcixcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRkZXRhaWxzOiBlcnJvckRldGFpbHMsXG5cdFx0XHRcdFx0XHRleHBvc2VUb0NsaWVudDogZmFsc2Vcblx0XHRcdFx0XHR9XG5cdFx0XHRcdCk7XG5cblx0XHRcdHRoaXMuZXJyb3JIYW5kbGVyLmhhbmRsZUVycm9yKHtcblx0XHRcdFx0ZXJyb3I6IHJlc291cmNlRXJyb3Jcblx0XHRcdH0pO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGhhbmRsaW5nIHJlc291cmNlIG1hbmFnZXIgZXJyb3I6ICR7ZXJyb3J9YFxuXHRcdFx0KTtcblx0XHRcdGNvbnN0IHNldmVyaXR5ID0gdGhpcy5lcnJvckhhbmRsZXIuRXJyb3JTZXZlcml0eS5XQVJOSU5HO1xuXHRcdFx0dGhpcy5lcnJvckhhbmRsZXIuaGFuZGxlRXJyb3Ioe1xuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0ZGV0YWlsczoge1xuXHRcdFx0XHRcdGNvbnRleHQ6ICdSZXNvdXJjZSBNYW5hZ2VyJyxcblx0XHRcdFx0XHRhY3Rpb246ICdQYXNzaW5nIGVycm9yIGZyb20gcmVzb3VyY2UgbWFuYWdlciBoYW5kbGUgdG8gRXJyb3JIYW5kbGVyU2VydmljZScsXG5cdFx0XHRcdFx0bm90ZXM6ICdFcnJvciBvY2N1cnJlZCB3aGlsZSBoYW5kbGluZyByZXNvdXJjZSBtYW5hZ2VyIGVycm9yOiBSZXNvdXJjZU1hbmFnZXIuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3InXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNldmVyaXR5XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cbn1cbiJdfQ==
