import toobusy from 'toobusy-js';
import express from 'express';
import { ServiceFactory } from '../index/factory.mjs';
import fs from 'fs';
import os from 'os';
export class HealthCheckService {
	static instance = null;
	logger;
	errorLogger;
	errorHandler;
	envConfig;
	cacheService;
	redisService;
	resourceManager;
	databaseController;
	httpsServer;
	healthCheckHistory = [];
	thresholdBreaches = [];
	healthCheckInterval = null;
	constructor(
		logger,
		errorLogger,
		errorHandler,
		envConfig,
		cacheService,
		redisService,
		resourceManager,
		databaseController,
		httpsServer
	) {
		this.logger = logger;
		this.errorLogger = errorLogger;
		this.errorHandler = errorHandler;
		this.envConfig = envConfig;
		this.cacheService = cacheService;
		this.redisService = redisService;
		this.resourceManager = resourceManager;
		this.databaseController = databaseController;
		this.httpsServer = httpsServer;
		this.healthCheckInterval = setInterval(() => {
			this.performHealthCheck();
		}, 10000);
	}
	static async getInstance() {
		if (!HealthCheckService.instance) {
			const logger = await ServiceFactory.getLoggerService();
			const errorLogger = await ServiceFactory.getErrorLoggerService();
			const errorHandler = await ServiceFactory.getErrorHandlerService();
			const envConfig = await ServiceFactory.getEnvConfigService();
			const cacheService = await ServiceFactory.getCacheService();
			const redisService = await ServiceFactory.getRedisService();
			const resourceManager = await ServiceFactory.getResourceManager();
			const databaseController =
				await ServiceFactory.getDatabaseController();
			const httpsServer = await ServiceFactory.getHTTPSServer(
				express.application
			);
			HealthCheckService.instance = new HealthCheckService(
				logger,
				errorLogger,
				errorHandler,
				envConfig,
				cacheService,
				redisService,
				resourceManager,
				databaseController,
				httpsServer
			);
		}
		return HealthCheckService.instance;
	}
	async performHealthCheck() {
		try {
			const databaseInfo =
				await this.databaseController.getDatabaseInfo();
			const httpsServerInfo = await this.httpsServer.getHTTPSServerInfo();
			const redisInfo = await this.redisService.getRedisInfo();
			const databaseHealth = {
				status: databaseInfo ? 'Connected' : 'Not connected',
				uptime: databaseInfo?.uptime_in_seconds ?? 0,
				cpuUsed: databaseInfo?.used_cpu_sys ?? 0,
				memoryUsed: databaseInfo?.used_memory ?? 0,
				cacheSize: databaseInfo?.cacheSize ?? 0,
				connectedClients: databaseInfo?.connected_clients ?? 0
			};
			const httpsServerHealth = {
				status: httpsServerInfo ? 'Running' : 'Stopped',
				uptime: httpsServerInfo?.uptime_in_seconds ?? 0,
				memoryUsed: (httpsServerInfo?.memoryUsage).heapUsed ?? 0,
				heapTotal: (httpsServerInfo?.memoryUsage).heapTotal ?? 0,
				cpuUsage: (httpsServerInfo?.cpuUsage).user ?? 0,
				connections: httpsServerInfo?.connections ?? 0
			};
			const redisHealth = {
				status: redisInfo ? 'Connected' : 'Not connected',
				uptime: redisInfo?.uptime_in_seconds ?? 0,
				memoryUsed: redisInfo?.used_memory ?? 0,
				cacheSize: redisInfo?.db0_size ?? 0,
				connectedClients: redisInfo?.connected_clients ?? 0
			};
			const healthSummary = {
				timestamp: new Date().toISOString(),
				databaseStatus: databaseHealth.status,
				httpsServerStatus: httpsServerHealth.status,
				redisStatus: redisHealth.status,
				databaseMetrics: databaseHealth,
				httpsServerMetrics: httpsServerHealth,
				redisMetrics: redisHealth,
				cacheServiceMetrics:
					this.cacheService.getCacheMetrics('healthCheckService'),
				eventLoopLag: toobusy.lag(),
				cpuUsage: this.resourceManager.getCpuUsage(),
				memoryUsage: this.resourceManager.getMemoryUsage(),
				diskUsage: await this.resourceManager.getDiskUsage(),
				networkStatus: this.resourceManager.getNetworkUsage(),
				eventLoopLagThreshold: this.envConfig.getEnvVariable(
					'eventLoopLagThreshold'
				),
				cpuThreshold: this.envConfig.getEnvVariable('cpuThreshold'),
				cpuLimit: this.envConfig.getEnvVariable('cpuLimit'),
				memoryThreshold:
					this.envConfig.getEnvVariable('memoryThreshold'),
				memoryLimit: this.envConfig.getEnvVariable('memoryLimit'),
				maxCacheSize: this.envConfig.getEnvVariable('maxCacheSize'),
				maxRedisCacheSize:
					this.envConfig.getEnvVariable('maxRedisCacheSize')
			};
			this.saveHealthCheckToHistory(healthSummary);
			this.logger.debug(`Health Check: ${JSON.stringify(healthSummary)}`);
			return healthSummary;
		} catch (error) {
			this.handleHealthCheckError(
				error,
				'HEALTH_CHECK_ERROR',
				{},
				'Error performing health check'
			);
			return {};
		}
	}
	async getHTTPSServerMetrics(serviceName) {
		try {
			const serverMetrics =
				await this.httpsServer.getHTTPSServerMetrics(serviceName);
			return {
				averageResponseTime: serverMetrics.averageResponseTime,
				requestRate: serverMetrics.requestsPerSecond,
				openConnections: serverMetrics.openConnections
			};
		} catch (error) {
			this.logger.error(
				`Failed to fetch HTTPS server metrics for ${serviceName}`,
				error
			);
			throw error;
		}
	}
	getHealthCheckHistory() {
		return this.healthCheckHistory;
	}
	async getHealthDataForDashboard() {
		return {
			currentHealth: await this.performHealthCheck(),
			history: this.getHealthCheckHistory()
		};
	}
	monitorEventLoopLag() {
		try {
			const lagThreshold =
				this.envConfig.getEnvVariable('eventLoopLagThreshold') || 70;
			setInterval(() => {
				const lag = toobusy.lag();
				if (lag > lagThreshold) {
					this.logger.warn(`High event loop lag detected: ${lag}ms`);
					this.resourceManager.adjustResources();
				}
			}, 10000);
		} catch (error) {
			this.handleHealthCheckError(
				error,
				'EVENT_LOOP_LAG_MONITOR_ERROR',
				{},
				'Error monitoring event loop lag'
			);
		}
	}
	monitorCPU() {
		setInterval(() => {
			const cpuUsage = this.resourceManager.getCpuUsage();
			cpuUsage.forEach(({ core, usage }) => {
				this.logger.info(`CPU ${core}: Usage ${usage}`);
			});
			this.resourceManager.adjustResources();
		}, 5000);
	}
	monitorMemoryUsage() {
		setInterval(() => {
			const memoryUsage = this.resourceManager.getMemoryUsage();
			this.logger.info(`Memory Usage: ${JSON.stringify(memoryUsage)}`);
			const memoryLimit = this.envConfig.getEnvVariable('memoryLimit');
			if (memoryUsage.heapUsed > memoryLimit) {
				this.logger.warn(
					`Memory usage exceeded limit (${memoryLimit} bytes). Adjusting resources...`
				);
				this.resourceManager.adjustResources();
			}
		}, 10000);
	}
	monitorDiskUsage() {
		try {
			const diskPath = this.envConfig.getEnvVariable('diskPath') || '/';
			setInterval(() => {
				fs.stat(diskPath, (err, stats) => {
					if (err) {
						this.logger.error(`Error getting disk usage: ${err}`);
						return;
					}
					this.logger.info(`Disk usage: ${JSON.stringify(stats)}`);
				});
			}, 30000);
		} catch (error) {
			this.handleHealthCheckError(
				error,
				'DISK_MONITOR_ERROR',
				{},
				'Error monitoring disk usage'
			);
		}
	}
	monitorCacheSize() {
		const cacheMetrics =
			this.cacheService.getCacheMetrics('resourceManager');
		const cacheSize = cacheMetrics.cacheSize;
		if (cacheSize) {
			if (cacheSize > this.envConfig.getEnvVariable('maxCacheSize')) {
				this.logger.warn(
					`Cache size exceeded limit. Clearing old entries...`
				);
				this.resourceManager.evictCacheEntries('resourceManager');
			}
		} else {
			this.logger.error('Error getting cache size');
		}
	}
	monitorNetworkUsage() {
		try {
			setInterval(() => {
				const networkInterfaces = os.networkInterfaces();
				Object.keys(networkInterfaces).forEach(interfaceName => {
					const netStats = networkInterfaces[interfaceName];
					if (netStats) {
						netStats.forEach(netStat => {
							this.logger.info(
								`Interface ${interfaceName}: Address ${netStat.address}, Family ${netStat.family}, Internal ${netStat.internal}`
							);
						});
					}
				});
			}, 10000);
		} catch (error) {
			this.handleHealthCheckError(
				error,
				'NETWORK_MONITOR_ERROR',
				{},
				'Error monitoring network usage'
			);
		}
	}
	saveHealthCheckToHistory(healthCheckData) {
		if (this.healthCheckHistory.length >= 100) {
			this.healthCheckHistory.shift();
		}
		this.healthCheckHistory.push(healthCheckData);
	}
	checkThresholds(healthSummary) {
		const eventLoopLag = healthSummary.eventLoopLag;
		const cpuUsage = healthSummary.cpuUsage;
		const memoryUsage = healthSummary.memoryUsage;
		if (
			eventLoopLag >
			this.envConfig.getEnvVariable('eventLoopLagThreshold')
		) {
			this.triggerAlert(
				'Event Loop Lag exceeded threshold',
				eventLoopLag
			);
		}
		if (
			cpuUsage.some(
				cpu =>
					parseFloat(cpu.usage) >
					this.envConfig.getEnvVariable('cpuThreshold')
			)
		) {
			this.triggerAlert('CPU Usage exceeded threshold', cpuUsage);
		}
		if (
			memoryUsage.heapUsed >
			this.envConfig.getEnvVariable('memoryThreshold')
		) {
			this.triggerAlert(
				'Memory Usage exceeded threshold',
				memoryUsage.heapUsed
			);
		}
	}
	triggerAlert(message, value) {
		this.logger.warn(`${message}: ${value}`);
		// *DEV-NOTE* email alert + webhook notification here.
	}
	autoRecover(healthSummary) {
		const memoryUsage = healthSummary.memoryUsage;
		if (
			memoryUsage.heapUsed > this.envConfig.getEnvVariable('memoryLimit')
		) {
			this.logger.warn('Memory usage high, attempting recovery...');
			const serviceName = 'healthCheckService'; // Specify the service name
			this.resourceManager.clearCaches(serviceName).catch(err => {
				this.logger.error(
					`Failed to clear caches for service: ${serviceName}`,
					err
				);
			});
			this.resourceManager.closeIdleConnections().catch(err => {
				this.logger.error('Failed to close idle connections', err);
			});
		}
	}
	logThresholdBreach(metric, value) {
		this.thresholdBreaches.push({
			metric,
			value,
			timestamp: new Date().toISOString()
		});
		if (this.thresholdBreaches.length > 100) {
			this.thresholdBreaches.shift();
		}
	}
	async shutdown() {
		try {
			this.logger.info('Shutting down HealthCheckService...');
			if (this.healthCheckInterval) {
				clearInterval(this.healthCheckInterval);
				this.logger.info('Health check interval cleared.');
			}
			await this.cacheService.clearNamespace('healthCheckService');
			this.logger.info('Health check cache cleared.');
			if (toobusy) {
				toobusy.shutdown();
				this.logger.info('Toobusy.js shutdown complete.');
			}
			this.logger.info('HealthCheckService shutdown completed.');
		} catch (error) {
			this.handleHealthCheckError(
				error,
				'SHUTDOWN_ERROR',
				{},
				'Error during HealthCheckService shutdown'
			);
		}
	}
	handleHealthCheckError(error, errorHeader, errorDetails, customMessage) {
		try {
			const errorMessage = `${customMessage}: ${error}\n${error instanceof Error ? error.stack : ''}`;
			this.errorLogger.logError(errorMessage);
			const healthCheckError =
				new this.errorHandler.ErrorClasses.ResourceManagerError(
					errorHeader,
					{
						details: errorDetails,
						exposeToClient: false
					}
				);
			this.errorHandler.handleError({
				error: healthCheckError
			});
		} catch (error) {
			this.errorLogger.logError(
				`Error handling health check error: ${error}`
			);
			const severity = this.errorHandler.ErrorSeverity.WARNING;
			this.errorHandler.handleError({
				error,
				details: {
					context: 'Health Check Service',
					action: 'Passing error from health check error handler to ErrorHandlerService',
					notes: 'Error occurred while handling Health Check error: ResourceManager.handleResourceManagerError'
				},
				severity
			});
		}
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSGVhbHRoQ2hlY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2VydmljZXMvSGVhbHRoQ2hlY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxPQUFPLE1BQU0sWUFBWSxDQUFDO0FBQ2pDLE9BQU8sT0FBTyxNQUFNLFNBQVMsQ0FBQztBQWE5QixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ3BCLE9BQU8sRUFBRSxNQUFNLElBQUksQ0FBQztBQUVwQixNQUFNLE9BQU8sa0JBQWtCO0lBQ3RCLE1BQU0sQ0FBQyxRQUFRLEdBQThCLElBQUksQ0FBQztJQUNsRCxNQUFNLENBQTRCO0lBQ2xDLFdBQVcsQ0FBOEI7SUFDekMsWUFBWSxDQUErQjtJQUMzQyxTQUFTLENBQTRCO0lBQ3JDLFlBQVksQ0FBd0I7SUFDcEMsWUFBWSxDQUF3QjtJQUNwQyxlQUFlLENBQTJCO0lBQzFDLGtCQUFrQixDQUE4QjtJQUNoRCxXQUFXLENBQXVCO0lBRWxDLGtCQUFrQixHQUE4QixFQUFFLENBQUM7SUFDbkQsaUJBQWlCLEdBQW1DLEVBQUUsQ0FBQztJQUN2RCxtQkFBbUIsR0FBMEIsSUFBSSxDQUFDO0lBRTFELFlBQ0MsTUFBaUMsRUFDakMsV0FBd0MsRUFDeEMsWUFBMEMsRUFDMUMsU0FBb0MsRUFDcEMsWUFBbUMsRUFDbkMsWUFBbUMsRUFDbkMsZUFBeUMsRUFDekMsa0JBQStDLEVBQy9DLFdBQWlDO1FBRWpDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBQ2pDLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO1FBQ2pDLElBQUksQ0FB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QUUsZ0JBQWdCO2FBQ3ZCLENBQUMsQ0FBQztRQUNKLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2hCLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUN4QixzQ0FBc0MsS0FBSyxFQUFFLENBQzdDLENBQUM7WUFDRixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUM7WUFDekQsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLENBQUM7Z0JBQzdCLEtBQUs7Z0JBQ0wsT0FBTyxFQUFFO29CQUNSLE9BQU8sRUFBRSxzQkFBc0I7b0JBQy9CLE1BQU0sRUFBRSxzRUFBc0U7b0JBQzlFLEtBQUssRUFBRSw4RkFBOEY7aUJBQ3JHO2dCQUNELFFBQVE7YUFDUixDQUFDLENBQUM7UUFDSixDQUFDO0lBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0b29idXN5IGZyb20gJ3Rvb2J1c3ktanMnO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQge1xuXHRBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRDYWNoZVNlcnZpY2VJbnRlcmZhY2UsXG5cdERhdGFiYXNlQ29udHJvbGxlckludGVyZmFjZSxcblx0RW52Q29uZmlnU2VydmljZUludGVyZmFjZSxcblx0RXJyb3JMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRIZWFsdGhDaGVja1NlcnZpY2VJbnRlcmZhY2UsXG5cdEhUVFBTU2VydmVySW50ZXJmYWNlLFxuXHRSZWRpc1NlcnZpY2VJbnRlcmZhY2UsXG5cdFJlc291cmNlTWFuYWdlckludGVyZmFjZVxufSBmcm9tICcuLi9pbmRleC9pbnRlcmZhY2VzL3NlcnZpY2VzJztcbmltcG9ydCB7IFNlcnZpY2VGYWN0b3J5IH0gZnJvbSAnLi4vaW5kZXgvZmFjdG9yeSc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcblxuZXhwb3J0IGNsYXNzIEhlYWx0aENoZWNrU2VydmljZSBpbXBsZW1lbnRzIEhlYWx0aENoZWNrU2VydmljZUludGVyZmFjZSB7XG5cdHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBIZWFsdGhDaGVja1NlcnZpY2UgfCBudWxsID0gbnVsbDtcblx0cHJpdmF0ZSBsb2dnZXI6IEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2U7XG5cdHByaXZhdGUgZXJyb3JMb2dnZXI6IEVycm9yTG9nZ2VyU2VydmljZUludGVyZmFjZTtcblx0cHJpdmF0ZSBlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlclNlcnZpY2VJbnRlcmZhY2U7XG5cdHByaXZhdGUgZW52Q29uZmlnOiBFbnZDb25maWdTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIGNhY2hlU2VydmljZTogQ2FjaGVTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIHJlZGlzU2VydmljZTogUmVkaXNTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIHJlc291cmNlTWFuYWdlcjogUmVzb3VyY2VNYW5hZ2VySW50ZXJmYWNlO1xuXHRwcml2YXRlIGRhdGFiYXNlQ29udHJvbGxlcjogRGF0YWJhc2VDb250cm9sbGVySW50ZXJmYWNlO1xuXHRwcml2YXRlIGh0dHBzU2VydmVyOiBIVFRQU1NlcnZlckludGVyZmFjZTtcblxuXHRwcml2YXRlIGhlYWx0aENoZWNrSGlzdG9yeTogUmVjb3JkPHN0cmluZywgdW5rbm93bj5bXSA9IFtdO1xuXHRwcml2YXRlIHRocmVzaG9sZEJyZWFjaGVzOiBBcnJheTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4gPSBbXTtcblx0cHJpdmF0ZSBoZWFsdGhDaGVja0ludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuXG5cdHByaXZhdGUgY29uc3RydWN0b3IoXG5cdFx0bG9nZ2VyOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRcdGVycm9yTG9nZ2VyOiBFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2UsXG5cdFx0ZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRcdGVudkNvbmZpZzogRW52Q29uZmlnU2VydmljZUludGVyZmFjZSxcblx0XHRjYWNoZVNlcnZpY2U6IENhY2hlU2VydmljZUludGVyZmFjZSxcblx0XHRyZWRpc1NlcnZpY2U6IFJlZGlzU2VydmljZUludGVyZmFjZSxcblx0XHRyZXNvdXJjZU1hbmFnZXI6IFJlc291cmNlTWFuYWdlckludGVyZmFjZSxcblx0XHRkYXRhYmFzZUNvbnRyb2xsZXI6IERhdGFiYXNlQ29udHJvbGxlckludGVyZmFjZSxcblx0XHRodHRwc1NlcnZlcjogSFRUUFNTZXJ2ZXJJbnRlcmZhY2Vcblx0KSB7XG5cdFx0dGhpcy5sb2dnZXIgPSBsb2dnZXI7XG5cdFx0dGhpcy5lcnJvckxvZ2dlciA9IGVycm9yTG9nZ2VyO1xuXHRcdHRoaXMuZXJyb3JIYW5kbGVyID0gZXJyb3JIYW5kbGVyO1xuXHRcdHRoaXMuZW52Q29uZmlnID0gZW52Q29uZmlnO1xuXHRcdHRoaXMuY2FjaGVTZXJ2aWNlID0gY2FjaGVTZXJ2aWNlO1xuXHRcdHRoaXMucmVkaXNTZXJ2aWNlID0gcmVkaXNTZXJ2aWNlO1xuXHRcdHRoaXMucmVzb3VyY2VNYW5hZ2VyID0gcmVzb3VyY2VNYW5hZ2VyO1xuXHRcdHRoaXMuZGF0YWJhc2VDb250cm9sbGVyID0gZGF0YWJhc2VDb250cm9sbGVyO1xuXHRcdHRoaXMuaHR0cHNTZXJ2ZXIgPSBodHRwc1NlcnZlcjtcblxuXHRcdHRoaXMuaGVhbHRoQ2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcblx0XHRcdHRoaXMucGVyZm9ybUhlYWx0aENoZWNrKCk7XG5cdFx0fSwgMTAwMDApO1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBhc3luYyBnZXRJbnN0YW5jZSgpOiBQcm9taXNlPEhlYWx0aENoZWNrU2VydmljZT4ge1xuXHRcdGlmICghSGVhbHRoQ2hlY2tTZXJ2aWNlLmluc3RhbmNlKSB7XG5cdFx0XHRjb25zdCBsb2dnZXIgPSBhd2FpdCBTZXJ2aWNlRmFjdG9yeS5nZXRMb2dnZXJTZXJ2aWNlKCk7XG5cdFx0XHRjb25zdCBlcnJvckxvZ2dlciA9IGF3YWl0IFNlcnZpY2VGYWN0b3J5LmdldEVycm9yTG9nZ2VyU2VydmljZSgpO1xuXHRcdFx0Y29uc3QgZXJyb3JIYW5kbGVyID0gYXdhaXQgU2VydmljZUZhY3RvcnkuZ2V0RXJyb3JIYW5kbGVyU2VydmljZSgpO1xuXHRcdFx0Y29uc3QgZW52Q29uZmlnID0gYXdhaXQgU2VydmljZUZhY3RvcnkuZ2V0RW52Q29uZmlnU2VydmljZSgpO1xuXHRcdFx0Y29uc3QgY2FjaGVTZXJ2aWNlID0gYXdhaXQgU2VydmljZUZhY3RvcnkuZ2V0Q2FjaGVTZXJ2aWNlKCk7XG5cdFx0XHRjb25zdCByZWRpc1NlcnZpY2UgPSBhd2FpdCBTZXJ2aWNlRmFjdG9yeS5nZXRSZWRpc1NlcnZpY2UoKTtcblx0XHRcdGNvbnN0IHJlc291cmNlTWFuYWdlciA9IGF3YWl0IFNlcnZpY2VGYWN0b3J5LmdldFJlc291cmNlTWFuYWdlcigpO1xuXHRcdFx0Y29uc3QgZGF0YWJhc2VDb250cm9sbGVyID1cblx0XHRcdFx0YXdhaXQgU2VydmljZUZhY3RvcnkuZ2V0RGF0YWJhc2VDb250cm9sbGVyKCk7XG5cdFx0XHRjb25zdCBodHRwc1NlcnZlciA9IGF3YWl0IFNlcnZpY2VGYWN0b3J5LmdldEhUVFBTU2VydmVyKFxuXHRcdFx0XHRleHByZXNzLmFwcGxpY2F0aW9uXG5cdFx0XHQpO1xuXG5cdFx0XHRIZWFsdGhDaGVja1NlcnZpY2UuaW5zdGFuY2UgPSBuZXcgSGVhbHRoQ2hlY2tTZXJ2aWNlKFxuXHRcdFx0XHRsb2dnZXIsXG5cdFx0XHRcdGVycm9yTG9nZ2VyLFxuXHRcdFx0XHRlcnJvckhhbmRsZXIsXG5cdFx0XHRcdGVudkNvbmZpZyxcblx0XHRcdFx0Y2FjaGVTZXJ2aWNlLFxuXHRcdFx0XHRyZWRpc1NlcnZpY2UsXG5cdFx0XHRcdHJlc291cmNlTWFuYWdlcixcblx0XHRcdFx0ZGF0YWJhc2VDb250cm9sbGVyLFxuXHRcdFx0XHRodHRwc1NlcnZlclxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gSGVhbHRoQ2hlY2tTZXJ2aWNlLmluc3RhbmNlO1xuXHR9XG5cblx0cHVibGljIGFzeW5jIHBlcmZvcm1IZWFsdGhDaGVjaygpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGRhdGFiYXNlSW5mbyA9XG5cdFx0XHRcdGF3YWl0IHRoaXMuZGF0YWJhc2VDb250cm9sbGVyLmdldERhdGFiYXNlSW5mbygpO1xuXHRcdFx0Y29uc3QgaHR0cHNTZXJ2ZXJJbmZvID0gYXdhaXQgdGhpcy5odHRwc1NlcnZlci5nZXRIVFRQU1NlcnZlckluZm8oKTtcblx0XHRcdGNvbnN0IHJlZGlzSW5mbyA9IGF3YWl0IHRoaXMucmVkaXNTZXJ2aWNlLmdldFJlZGlzSW5mbygpO1xuXG5cdFx0XHRjb25zdCBkYXRhYmFzZUhlYWx0aCA9IHtcblx0XHRcdFx0c3RhdHVzOiBkYXRhYmFzZUluZm8gPyAnQ29ubmVjdGVkJyA6ICdOb3QgY29ubmVjdGVkJyxcblx0XHRcdFx0dXB0aW1lOiBkYXRhYmFzZUluZm8/LnVwdGltZV9pbl9zZWNvbmRzID8/IDAsXG5cdFx0XHRcdGNwdVVzZWQ6IGRhdGFiYXNlSW5mbz8udXNlZF9jcHVfc3lzID8/IDAsXG5cdFx0XHRcdG1lbW9yeVVzZWQ6IGRhdGFiYXNlSW5mbz8udXNlZF9tZW1vcnkgPz8gMCxcblx0XHRcdFx0Y2FjaGVTaXplOiBkYXRhYmFzZUluZm8/LmNhY2hlU2l6ZSA/PyAwLFxuXHRcdFx0XHRjb25uZWN0ZWRDbGllbnRzOiBkYXRhYmFzZUluZm8/LmNvbm5lY3RlZF9jbGllbnRzID8/IDBcblx0XHRcdH07XG5cblx0XHRcdGNvbnN0IGh0dHBzU2VydmVySGVhbHRoID0ge1xuXHRcdFx0XHRzdGF0dXM6IGh0dHBzU2VydmVySW5mbyA/ICdSdW5uaW5nJyA6ICdTdG9wcGVkJyxcblx0XHRcdFx0dXB0aW1lOiBodHRwc1NlcnZlckluZm8/LnVwdGltZV9pbl9zZWNvbmRzID8/IDAsXG5cdFx0XHRcdG1lbW9yeVVzZWQ6XG5cdFx0XHRcdFx0KGh0dHBzU2VydmVySW5mbz8ubWVtb3J5VXNhZ2UgYXMgeyBoZWFwVXNlZDogbnVtYmVyIH0pXG5cdFx0XHRcdFx0XHQuaGVhcFVzZWQgPz8gMCxcblx0XHRcdFx0aGVhcFRvdGFsOlxuXHRcdFx0XHRcdChodHRwc1NlcnZlckluZm8/Lm1lbW9yeVVzYWdlIGFzIHsgaGVhcFRvdGFsOiBudW1iZXIgfSlcblx0XHRcdFx0XHRcdC5oZWFwVG90YWwgPz8gMCxcblx0XHRcdFx0Y3B1VXNhZ2U6XG5cdFx0XHRcdFx0KGh0dHBzU2VydmVySW5mbz8uY3B1VXNhZ2UgYXMgeyB1c2VyOiBudW1iZXIgfSkudXNlciA/PyAwLFxuXHRcdFx0XHRjb25uZWN0aW9uczogaHR0cHNTZXJ2ZXJJbmZvPy5jb25uZWN0aW9ucyA/PyAwXG5cdFx0XHR9O1xuXG5cdFx0XHRjb25zdCByZWRpc0hlYWx0aCA9IHtcblx0XHRcdFx0c3RhdHVzOiByZWRpc0luZm8gPyAnQ29ubmVjdGVkJyA6ICdOb3QgY29ubmVjdGVkJyxcblx0XHRcdFx0dXB0aW1lOiByZWRpc0luZm8/LnVwdGltZV9pbl9zZWNvbmRzID8/IDAsXG5cdFx0XHRcdG1lbW9yeVVzZWQ6IHJlZGlzSW5mbz8udXNlZF9tZW1vcnkgPz8gMCxcblx0XHRcdFx0Y2FjaGVTaXplOiByZWRpc0luZm8/LmRiMF9zaXplID8/IDAsXG5cdFx0XHRcdGNvbm5lY3RlZENsaWVudHM6IHJlZGlzSW5mbz8uY29ubmVjdGVkX2NsaWVudHMgPz8gMFxuXHRcdFx0fTtcblxuXHRcdFx0Y29uc3QgaGVhbHRoU3VtbWFyeTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7XG5cdFx0XHRcdHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuXHRcdFx0XHRkYXRhYmFzZVN0YXR1czogZGF0YWJhc2VIZWFsdGguc3RhdHVzLFxuXHRcdFx0XHRodHRwc1NlcnZlclN0YXR1czogaHR0cHNTZXJ2ZXJIZWFsdGguc3RhdHVzLFxuXHRcdFx0XHRyZWRpc1N0YXR1czogcmVkaXNIZWFsdGguc3RhdHVzLFxuXHRcdFx0XHRkYXRhYmFzZU1ldHJpY3M6IGRhdGFiYXNlSGVhbHRoLFxuXHRcdFx0XHRodHRwc1NlcnZlck1ldHJpY3M6IGh0dHBzU2VydmVySGVhbHRoLFxuXHRcdFx0XHRyZWRpc01ldHJpY3M6IHJlZGlzSGVhbHRoLFxuXHRcdFx0XHRjYWNoZVNlcnZpY2VNZXRyaWNzOlxuXHRcdFx0XHRcdHRoaXMuY2FjaGVTZXJ2aWNlLmdldENhY2hlTWV0cmljcygnaGVhbHRoQ2hlY2tTZXJ2aWNlJyksXG5cdFx0XHRcdGV2ZW50TG9vcExhZzogdG9vYnVzeS5sYWcoKSxcblx0XHRcdFx0Y3B1VXNhZ2U6IHRoaXMucmVzb3VyY2VNYW5hZ2VyLmdldENwdVVzYWdlKCksXG5cdFx0XHRcdG1lbW9yeVVzYWdlOiB0aGlzLnJlc291cmNlTWFuYWdlci5nZXRNZW1vcnlVc2FnZSgpLFxuXHRcdFx0XHRkaXNrVXNhZ2U6IGF3YWl0IHRoaXMucmVzb3VyY2VNYW5hZ2VyLmdldERpc2tVc2FnZSgpLFxuXHRcdFx0XHRuZXR3b3JrU3RhdHVzOiB0aGlzLnJlc291cmNlTWFuYWdlci5nZXROZXR3b3JrVXNhZ2UoKSxcblx0XHRcdFx0ZXZlbnRMb29wTGFnVGhyZXNob2xkOiB0aGlzLmVudkNvbmZpZy5nZXRFbnZWYXJpYWJsZShcblx0XHRcdFx0XHQnZXZlbnRMb29wTGFnVGhyZXNob2xkJ1xuXHRcdFx0XHQpLFxuXHRcdFx0XHRjcHVUaHJlc2hvbGQ6IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdjcHVUaHJlc2hvbGQnKSxcblx0XHRcdFx0Y3B1TGltaXQ6IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdjcHVMaW1pdCcpLFxuXHRcdFx0XHRtZW1vcnlUaHJlc2hvbGQ6XG5cdFx0XHRcdFx0dGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21lbW9yeVRocmVzaG9sZCcpLFxuXHRcdFx0XHRtZW1vcnlMaW1pdDogdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21lbW9yeUxpbWl0JyksXG5cdFx0XHRcdG1heENhY2hlU2l6ZTogdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21heENhY2hlU2l6ZScpLFxuXHRcdFx0XHRtYXhSZWRpc0NhY2hlU2l6ZTpcblx0XHRcdFx0XHR0aGlzLmVudkNvbmZpZy5nZXRFbnZWYXJpYWJsZSgnbWF4UmVkaXNDYWNoZVNpemUnKVxuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy5zYXZlSGVhbHRoQ2hlY2tUb0hpc3RvcnkoaGVhbHRoU3VtbWFyeSk7XG5cdFx0XHR0aGlzLmxvZ2dlci5kZWJ1ZyhgSGVhbHRoIENoZWNrOiAke0pTT04uc3RyaW5naWZ5KGhlYWx0aFN1bW1hcnkpfWApO1xuXHRcdFx0cmV0dXJuIGhlYWx0aFN1bW1hcnk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlSGVhbHRoQ2hlY2tFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdIRUFMVEhfQ0hFQ0tfRVJST1InLFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0J0Vycm9yIHBlcmZvcm1pbmcgaGVhbHRoIGNoZWNrJ1xuXHRcdFx0KTtcblx0XHRcdHJldHVybiB7fTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgZ2V0SFRUUFNTZXJ2ZXJNZXRyaWNzKFxuXHRcdHNlcnZpY2VOYW1lOiBzdHJpbmdcblx0KTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBzZXJ2ZXJNZXRyaWNzID1cblx0XHRcdFx0YXdhaXQgdGhpcy5odHRwc1NlcnZlci5nZXRIVFRQU1NlcnZlck1ldHJpY3Moc2VydmljZU5hbWUpO1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0YXZlcmFnZVJlc3BvbnNlVGltZTogc2VydmVyTWV0cmljcy5hdmVyYWdlUmVzcG9uc2VUaW1lLFxuXHRcdFx0XHRyZXF1ZXN0UmF0ZTogc2VydmVyTWV0cmljcy5yZXF1ZXN0c1BlclNlY29uZCxcblx0XHRcdFx0b3BlbkNvbm5lY3Rpb25zOiBzZXJ2ZXJNZXRyaWNzLm9wZW5Db25uZWN0aW9uc1xuXHRcdFx0fTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5sb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZmV0Y2ggSFRUUFMgc2VydmVyIG1ldHJpY3MgZm9yICR7c2VydmljZU5hbWV9YCxcblx0XHRcdFx0ZXJyb3Jcblx0XHRcdCk7XG5cdFx0XHR0aHJvdyBlcnJvcjtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgZ2V0SGVhbHRoQ2hlY2tIaXN0b3J5KCk6IEFycmF5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG5cdFx0cmV0dXJuIHRoaXMuaGVhbHRoQ2hlY2tIaXN0b3J5O1xuXHR9XG5cblx0cHVibGljIGFzeW5jIGdldEhlYWx0aERhdGFGb3JEYXNoYm9hcmQoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuXHRcdHJldHVybiB7XG5cdFx0XHRjdXJyZW50SGVhbHRoOiBhd2FpdCB0aGlzLnBlcmZvcm1IZWFsdGhDaGVjaygpLFxuXHRcdFx0aGlzdG9yeTogdGhpcy5nZXRIZWFsdGhDaGVja0hpc3RvcnkoKVxuXHRcdH07XG5cdH1cblxuXHRwdWJsaWMgbW9uaXRvckV2ZW50TG9vcExhZygpOiB2b2lkIHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgbGFnVGhyZXNob2xkID1cblx0XHRcdFx0dGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ2V2ZW50TG9vcExhZ1RocmVzaG9sZCcpIHx8IDcwO1xuXG5cdFx0XHRzZXRJbnRlcnZhbCgoKSA9PiB7XG5cdFx0XHRcdGNvbnN0IGxhZyA9IHRvb2J1c3kubGFnKCk7XG5cblx0XHRcdFx0aWYgKGxhZyA+IGxhZ1RocmVzaG9sZCkge1xuXHRcdFx0XHRcdHRoaXMubG9nZ2VyLndhcm4oYEhpZ2ggZXZlbnQgbG9vcCBsYWcgZGV0ZWN0ZWQ6ICR7bGFnfW1zYCk7XG5cdFx0XHRcdFx0dGhpcy5yZXNvdXJjZU1hbmFnZXIuYWRqdXN0UmVzb3VyY2VzKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIDEwMDAwKTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVIZWFsdGhDaGVja0Vycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J0VWRU5UX0xPT1BfTEFHX01PTklUT1JfRVJST1InLFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0J0Vycm9yIG1vbml0b3JpbmcgZXZlbnQgbG9vcCBsYWcnXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBtb25pdG9yQ1BVKCk6IHZvaWQge1xuXHRcdHNldEludGVydmFsKCgpID0+IHtcblx0XHRcdGNvbnN0IGNwdVVzYWdlID0gdGhpcy5yZXNvdXJjZU1hbmFnZXIuZ2V0Q3B1VXNhZ2UoKTtcblx0XHRcdGNwdVVzYWdlLmZvckVhY2goKHsgY29yZSwgdXNhZ2UgfSkgPT4ge1xuXHRcdFx0XHR0aGlzLmxvZ2dlci5pbmZvKGBDUFUgJHtjb3JlfTogVXNhZ2UgJHt1c2FnZX1gKTtcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5yZXNvdXJjZU1hbmFnZXIuYWRqdXN0UmVzb3VyY2VzKCk7XG5cdFx0fSwgNTAwMCk7XG5cdH1cblxuXHRwdWJsaWMgbW9uaXRvck1lbW9yeVVzYWdlKCk6IHZvaWQge1xuXHRcdHNldEludGVydmFsKCgpID0+IHtcblx0XHRcdGNvbnN0IG1lbW9yeVVzYWdlID0gdGhpcy5yZXNvdXJjZU1hbmFnZXIuZ2V0TWVtb3J5VXNhZ2UoKTtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oYE1lbW9yeSBVc2FnZTogJHtKU09OLnN0cmluZ2lmeShtZW1vcnlVc2FnZSl9YCk7XG5cdFx0XHRjb25zdCBtZW1vcnlMaW1pdCA9IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdtZW1vcnlMaW1pdCcpO1xuXHRcdFx0aWYgKG1lbW9yeVVzYWdlLmhlYXBVc2VkID4gbWVtb3J5TGltaXQpIHtcblx0XHRcdFx0dGhpcy5sb2dnZXIud2Fybihcblx0XHRcdFx0XHRgTWVtb3J5IHVzYWdlIGV4Y2VlZGVkIGxpbWl0ICgke21lbW9yeUxpbWl0fSBieXRlcykuIEFkanVzdGluZyByZXNvdXJjZXMuLi5gXG5cdFx0XHRcdCk7XG5cdFx0XHRcdHRoaXMucmVzb3VyY2VNYW5hZ2VyLmFkanVzdFJlc291cmNlcygpO1xuXHRcdFx0fVxuXHRcdH0sIDEwMDAwKTtcblx0fVxuXG5cdHB1YmxpYyBtb25pdG9yRGlza1VzYWdlKCk6IHZvaWQge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBkaXNrUGF0aCA9IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdkaXNrUGF0aCcpIHx8ICcvJztcblx0XHRcdHNldEludGVydmFsKCgpID0+IHtcblx0XHRcdFx0ZnMuc3RhdChkaXNrUGF0aCwgKGVyciwgc3RhdHMpID0+IHtcblx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHR0aGlzLmxvZ2dlci5lcnJvcihgRXJyb3IgZ2V0dGluZyBkaXNrIHVzYWdlOiAke2Vycn1gKTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0dGhpcy5sb2dnZXIuaW5mbyhgRGlzayB1c2FnZTogJHtKU09OLnN0cmluZ2lmeShzdGF0cyl9YCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSwgMzAwMDApO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZUhlYWx0aENoZWNrRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnRElTS19NT05JVE9SX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdCdFcnJvciBtb25pdG9yaW5nIGRpc2sgdXNhZ2UnXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBtb25pdG9yQ2FjaGVTaXplKCk6IHZvaWQge1xuXHRcdGNvbnN0IGNhY2hlTWV0cmljcyA9XG5cdFx0XHR0aGlzLmNhY2hlU2VydmljZS5nZXRDYWNoZU1ldHJpY3MoJ3Jlc291cmNlTWFuYWdlcicpO1xuXHRcdGNvbnN0IGNhY2hlU2l6ZSA9IGNhY2hlTWV0cmljcy5jYWNoZVNpemU7XG5cblx0XHRpZiAoY2FjaGVTaXplKSB7XG5cdFx0XHRpZiAoY2FjaGVTaXplID4gdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21heENhY2hlU2l6ZScpKSB7XG5cdFx0XHRcdHRoaXMubG9nZ2VyLndhcm4oXG5cdFx0XHRcdFx0YENhY2hlIHNpemUgZXhjZWVkZWQgbGltaXQuIENsZWFyaW5nIG9sZCBlbnRyaWVzLi4uYFxuXHRcdFx0XHQpO1xuXHRcdFx0XHR0aGlzLnJlc291cmNlTWFuYWdlci5ldmljdENhY2hlRW50cmllcygncmVzb3VyY2VNYW5hZ2VyJyk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMubG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIGNhY2hlIHNpemUnKTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgbW9uaXRvck5ldHdvcmtVc2FnZSgpOiB2b2lkIHtcblx0XHR0cnkge1xuXHRcdFx0c2V0SW50ZXJ2YWwoKCkgPT4ge1xuXHRcdFx0XHRjb25zdCBuZXR3b3JrSW50ZXJmYWNlcyA9IG9zLm5ldHdvcmtJbnRlcmZhY2VzKCk7XG5cdFx0XHRcdE9iamVjdC5rZXlzKG5ldHdvcmtJbnRlcmZhY2VzKS5mb3JFYWNoKGludGVyZmFjZU5hbWUgPT4ge1xuXHRcdFx0XHRcdGNvbnN0IG5ldFN0YXRzID0gbmV0d29ya0ludGVyZmFjZXNbaW50ZXJmYWNlTmFtZV07XG5cdFx0XHRcdFx0aWYgKG5ldFN0YXRzKSB7XG5cdFx0XHRcdFx0XHRuZXRTdGF0cy5mb3JFYWNoKG5ldFN0YXQgPT4ge1xuXHRcdFx0XHRcdFx0XHR0aGlzLmxvZ2dlci5pbmZvKFxuXHRcdFx0XHRcdFx0XHRcdGBJbnRlcmZhY2UgJHtpbnRlcmZhY2VOYW1lfTogQWRkcmVzcyAke25ldFN0YXQuYWRkcmVzc30sIEZhbWlseSAke25ldFN0YXQuZmFtaWx5fSwgSW50ZXJuYWwgJHtuZXRTdGF0LmludGVybmFsfWBcblx0XHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9LCAxMDAwMCk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlSGVhbHRoQ2hlY2tFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdORVRXT1JLX01PTklUT1JfRVJST1InLFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0J0Vycm9yIG1vbml0b3JpbmcgbmV0d29yayB1c2FnZSdcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBzYXZlSGVhbHRoQ2hlY2tUb0hpc3RvcnkoXG5cdFx0aGVhbHRoQ2hlY2tEYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuXHQpOiB2b2lkIHtcblx0XHRpZiAodGhpcy5oZWFsdGhDaGVja0hpc3RvcnkubGVuZ3RoID49IDEwMCkge1xuXHRcdFx0dGhpcy5oZWFsdGhDaGVja0hpc3Rvcnkuc2hpZnQoKTtcblx0XHR9XG5cdFx0dGhpcy5oZWFsdGhDaGVja0hpc3RvcnkucHVzaChoZWFsdGhDaGVja0RhdGEpO1xuXHR9XG5cblx0cHJpdmF0ZSBjaGVja1RocmVzaG9sZHMoaGVhbHRoU3VtbWFyeTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiB2b2lkIHtcblx0XHRjb25zdCBldmVudExvb3BMYWcgPSBoZWFsdGhTdW1tYXJ5LmV2ZW50TG9vcExhZyBhcyBudW1iZXI7XG5cdFx0Y29uc3QgY3B1VXNhZ2UgPSBoZWFsdGhTdW1tYXJ5LmNwdVVzYWdlIGFzIEFycmF5PHtcblx0XHRcdGNvcmU6IG51bWJlcjtcblx0XHRcdHVzYWdlOiBzdHJpbmc7XG5cdFx0fT47XG5cdFx0Y29uc3QgbWVtb3J5VXNhZ2UgPSBoZWFsdGhTdW1tYXJ5Lm1lbW9yeVVzYWdlIGFzIHtcblx0XHRcdGhlYXBVc2VkOiBudW1iZXI7XG5cdFx0XHRoZWFwVG90YWw6IG51bWJlcjtcblx0XHR9O1xuXG5cdFx0aWYgKFxuXHRcdFx0ZXZlbnRMb29wTGFnID5cblx0XHRcdHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdldmVudExvb3BMYWdUaHJlc2hvbGQnKVxuXHRcdCkge1xuXHRcdFx0dGhpcy50cmlnZ2VyQWxlcnQoXG5cdFx0XHRcdCdFdmVudCBMb29wIExhZyBleGNlZWRlZCB0aHJlc2hvbGQnLFxuXHRcdFx0XHRldmVudExvb3BMYWdcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKFxuXHRcdFx0Y3B1VXNhZ2Uuc29tZShcblx0XHRcdFx0Y3B1ID0+XG5cdFx0XHRcdFx0cGFyc2VGbG9hdChjcHUudXNhZ2UpID5cblx0XHRcdFx0XHR0aGlzLmVudkNvbmZpZy5nZXRFbnZWYXJpYWJsZSgnY3B1VGhyZXNob2xkJylcblx0XHRcdClcblx0XHQpIHtcblx0XHRcdHRoaXMudHJpZ2dlckFsZXJ0KCdDUFUgVXNhZ2UgZXhjZWVkZWQgdGhyZXNob2xkJywgY3B1VXNhZ2UpO1xuXHRcdH1cblxuXHRcdGlmIChcblx0XHRcdG1lbW9yeVVzYWdlLmhlYXBVc2VkID5cblx0XHRcdHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdtZW1vcnlUaHJlc2hvbGQnKVxuXHRcdCkge1xuXHRcdFx0dGhpcy50cmlnZ2VyQWxlcnQoXG5cdFx0XHRcdCdNZW1vcnkgVXNhZ2UgZXhjZWVkZWQgdGhyZXNob2xkJyxcblx0XHRcdFx0bWVtb3J5VXNhZ2UuaGVhcFVzZWRcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSB0cmlnZ2VyQWxlcnQobWVzc2FnZTogc3RyaW5nLCB2YWx1ZTogdW5rbm93bik6IHZvaWQge1xuXHRcdHRoaXMubG9nZ2VyLndhcm4oYCR7bWVzc2FnZX06ICR7dmFsdWV9YCk7XG5cdFx0Ly8gKkRFVi1OT1RFKiBlbWFpbCBhbGVydCArIHdlYmhvb2sgbm90aWZpY2F0aW9uIGhlcmUuXG5cdH1cblxuXHRwcml2YXRlIGF1dG9SZWNvdmVyKGhlYWx0aFN1bW1hcnk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KTogdm9pZCB7XG5cdFx0Y29uc3QgbWVtb3J5VXNhZ2UgPSBoZWFsdGhTdW1tYXJ5Lm1lbW9yeVVzYWdlIGFzIHtcblx0XHRcdGhlYXBVc2VkOiBudW1iZXI7XG5cdFx0XHRoZWFwVG90YWw6IG51bWJlcjtcblx0XHR9O1xuXG5cdFx0aWYgKFxuXHRcdFx0bWVtb3J5VXNhZ2UuaGVhcFVzZWQgPiB0aGlzLmVudkNvbmZpZy5nZXRFbnZWYXJpYWJsZSgnbWVtb3J5TGltaXQnKVxuXHRcdCkge1xuXHRcdFx0dGhpcy5sb2dnZXIud2FybignTWVtb3J5IHVzYWdlIGhpZ2gsIGF0dGVtcHRpbmcgcmVjb3ZlcnkuLi4nKTtcblx0XHRcdGNvbnN0IHNlcnZpY2VOYW1lID0gJ2hlYWx0aENoZWNrU2VydmljZSc7IC8vIFNwZWNpZnkgdGhlIHNlcnZpY2UgbmFtZVxuXG5cdFx0XHR0aGlzLnJlc291cmNlTWFuYWdlci5jbGVhckNhY2hlcyhzZXJ2aWNlTmFtZSkuY2F0Y2goZXJyID0+IHtcblx0XHRcdFx0dGhpcy5sb2dnZXIuZXJyb3IoXG5cdFx0XHRcdFx0YEZhaWxlZCB0byBjbGVhciBjYWNoZXMgZm9yIHNlcnZpY2U6ICR7c2VydmljZU5hbWV9YCxcblx0XHRcdFx0XHRlcnJcblx0XHRcdFx0KTtcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5yZXNvdXJjZU1hbmFnZXIuY2xvc2VJZGxlQ29ubmVjdGlvbnMoKS5jYXRjaChlcnIgPT4ge1xuXHRcdFx0XHR0aGlzLmxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGNsb3NlIGlkbGUgY29ubmVjdGlvbnMnLCBlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBsb2dUaHJlc2hvbGRCcmVhY2gobWV0cmljOiBzdHJpbmcsIHZhbHVlOiB1bmtub3duKTogdm9pZCB7XG5cdFx0dGhpcy50aHJlc2hvbGRCcmVhY2hlcy5wdXNoKHtcblx0XHRcdG1ldHJpYyxcblx0XHRcdHZhbHVlLFxuXHRcdFx0dGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcblx0XHR9KTtcblx0XHRpZiAodGhpcy50aHJlc2hvbGRCcmVhY2hlcy5sZW5ndGggPiAxMDApIHtcblx0XHRcdHRoaXMudGhyZXNob2xkQnJlYWNoZXMuc2hpZnQoKTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgc2h1dGRvd24oKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ1NodXR0aW5nIGRvd24gSGVhbHRoQ2hlY2tTZXJ2aWNlLi4uJyk7XG5cblx0XHRcdGlmICh0aGlzLmhlYWx0aENoZWNrSW50ZXJ2YWwpIHtcblx0XHRcdFx0Y2xlYXJJbnRlcnZhbCh0aGlzLmhlYWx0aENoZWNrSW50ZXJ2YWwpO1xuXHRcdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdIZWFsdGggY2hlY2sgaW50ZXJ2YWwgY2xlYXJlZC4nKTtcblx0XHRcdH1cblxuXHRcdFx0YXdhaXQgdGhpcy5jYWNoZVNlcnZpY2UuY2xlYXJOYW1lc3BhY2UoJ2hlYWx0aENoZWNrU2VydmljZScpO1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnSGVhbHRoIGNoZWNrIGNhY2hlIGNsZWFyZWQuJyk7XG5cblx0XHRcdGlmICh0b29idXN5KSB7XG5cdFx0XHRcdHRvb2J1c3kuc2h1dGRvd24oKTtcblx0XHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnVG9vYnVzeS5qcyBzaHV0ZG93biBjb21wbGV0ZS4nKTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnSGVhbHRoQ2hlY2tTZXJ2aWNlIHNodXRkb3duIGNvbXBsZXRlZC4nKTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVIZWFsdGhDaGVja0Vycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J1NIVVRET1dOX0VSUk9SJyxcblx0XHRcdFx0e30sXG5cdFx0XHRcdCdFcnJvciBkdXJpbmcgSGVhbHRoQ2hlY2tTZXJ2aWNlIHNodXRkb3duJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGhhbmRsZUhlYWx0aENoZWNrRXJyb3IoXG5cdFx0ZXJyb3I6IHVua25vd24sXG5cdFx0ZXJyb3JIZWFkZXI6IHN0cmluZyxcblx0XHRlcnJvckRldGFpbHM6IG9iamVjdCxcblx0XHRjdXN0b21NZXNzYWdlOiBzdHJpbmdcblx0KTogdm9pZCB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGVycm9yTWVzc2FnZSA9IGAke2N1c3RvbU1lc3NhZ2V9OiAke2Vycm9yfVxcbiR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogJyd9YDtcblx0XHRcdHRoaXMuZXJyb3JMb2dnZXIubG9nRXJyb3IoZXJyb3JNZXNzYWdlKTtcblx0XHRcdGNvbnN0IGhlYWx0aENoZWNrRXJyb3IgPVxuXHRcdFx0XHRuZXcgdGhpcy5lcnJvckhhbmRsZXIuRXJyb3JDbGFzc2VzLlJlc291cmNlTWFuYWdlckVycm9yKFxuXHRcdFx0XHRcdGVycm9ySGVhZGVyLFxuXHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdGRldGFpbHM6IGVycm9yRGV0YWlscyxcblx0XHRcdFx0XHRcdGV4cG9zZVRvQ2xpZW50OiBmYWxzZVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0KTtcblxuXHRcdFx0dGhpcy5lcnJvckhhbmRsZXIuaGFuZGxlRXJyb3Ioe1xuXHRcdFx0XHRlcnJvcjogaGVhbHRoQ2hlY2tFcnJvclxuXHRcdFx0fSk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuZXJyb3JMb2dnZXIubG9nRXJyb3IoXG5cdFx0XHRcdGBFcnJvciBoYW5kbGluZyBoZWFsdGggY2hlY2sgZXJyb3I6ICR7ZXJyb3J9YFxuXHRcdFx0KTtcblx0XHRcdGNvbnN0IHNldmVyaXR5ID0gdGhpcy5lcnJvckhhbmRsZXIuRXJyb3JTZXZlcml0eS5XQVJOSU5HO1xuXHRcdFx0dGhpcy5lcnJvckhhbmRsZXIuaGFuZGxlRXJyb3Ioe1xuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0ZGV0YWlsczoge1xuXHRcdFx0XHRcdGNvbnRleHQ6ICdIZWFsdGggQ2hlY2sgU2VydmljZScsXG5cdFx0XHRcdFx0YWN0aW9uOiAnUGFzc2luZyBlcnJvciBmcm9tIGhlYWx0aCBjaGVjayBlcnJvciBoYW5kbGVyIHRvIEVycm9ySGFuZGxlclNlcnZpY2UnLFxuXHRcdFx0XHRcdG5vdGVzOiAnRXJyb3Igb2NjdXJyZWQgd2hpbGUgaGFuZGxpbmcgSGVhbHRoIENoZWNrIGVycm9yOiBSZXNvdXJjZU1hbmFnZXIuaGFuZGxlUmVzb3VyY2VNYW5hZ2VyRXJyb3InXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHNldmVyaXR5XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cbn1cbiJdfQ==
