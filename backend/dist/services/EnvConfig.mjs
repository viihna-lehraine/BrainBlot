import { config } from 'dotenv';
import path from 'path';
import { fileURLToPath } from 'url';
import { dirname } from 'path';
import { HandleErrorStaticParameters } from '../index/parameters.mjs';
import { ServiceFactory } from '../index/factory.mjs';
export const __filename = fileURLToPath(import.meta.url);
export const __dirname = dirname(__filename);
export class EnvConfigService {
	static instance = null;
	logger;
	errorLogger;
	errorHandler;
	constructor(logger, errorLogger, errorHandler) {
		this.logger = logger;
		this.errorLogger = errorLogger;
		this.errorHandler = errorHandler;
		this.loadEnv();
	}
	static async getInstance() {
		if (!EnvConfigService.instance) {
			const logger = await ServiceFactory.getLoggerService();
			const errorLogger = await ServiceFactory.getErrorLoggerService();
			const errorHandler = await ServiceFactory.getErrorHandlerService();
			EnvConfigService.instance = new EnvConfigService(
				logger,
				errorLogger,
				errorHandler
			);
		}
		return EnvConfigService.instance;
	}
	loadEnv() {
		try {
			const masterEnvPath = path.join(
				__dirname,
				'../../config/env/backend.master.env'
			);
			config({ path: masterEnvPath });
			const envType = process.env.ENV_TYPE || 'dev';
			console.debug(`envType = ${envType}`);
			const envFile =
				envType === 'docker'
					? 'backend.docker-dev.env'
					: 'backend.dev.env';
			const envPath = path.join(process.cwd(), `./config/env/${envFile}`);
			console.debug(`Loading environment variables from ${envFile}`);
			config({ path: envPath });
		} catch (configError) {
			const configurationError =
				new this.errorHandler.ErrorClasses.ConfigurationError(
					`Failed to load environment variables from .env file\n${configError instanceof Error ? configError.message : configError}\nShutting down...`,
					{ originalError: configError }
				);
			this.errorLogger.logError(configurationError.message);
			const processErrorParams = {
				...HandleErrorStaticParameters,
				error: configurationError,
				details: {
					reason: 'Failed to load environment variables from .env file'
				}
			};
			this.errorHandler.handleError(processErrorParams);
			throw configurationError;
		}
	}
	getEnvVariable(key) {
		const value = process.env[key];
		if (value === undefined) {
			throw new Error(`Environment variable ${String(key)} not found`);
		}
		return this.parseEnvValue(value, key);
	}
	parseEnvValue(value, key) {
		switch (key) {
			// strings
			case 'baseUrl':
			case 'dbHost':
			case 'dbName':
			case 'dbUser':
			case 'diskPath':
			case 'emailHost':
			case 'emailUser':
			case 'frontendSecretsPath':
			case 'ipWhitelistPath':
			case 'logExportPath':
			case 'loggerServiceName':
			case 'logStashHost':
			case 'logStashNode':
			case 'npmLogPath':
			case 'primaryLogPath':
			case 'redisUrl':
			case 'requestTimeout':
			case 'revokedTokenRetentionPeriod':
			case 'rpName':
			case 'rpIcon':
			case 'rpId':
			case 'rpOrigin':
			case 'secretsFilePath1':
			case 'serverDataFilePath1':
			case 'serverDataFilePath2':
			case 'serverDataFilePath3':
			case 'serverDataFilePath4':
			case 'staticRootPath':
			case 'tempDir':
			case 'tokenExpiryListPath':
			case 'tokenRevokedListPath':
			case 'tlsCertPath1':
			case 'tlsKeyPath1':
			case 'yubicoApiUrl':
				return value;
			// number
			case 'batchReEncryptSecretsInterval':
			case 'blacklistSyncInterval':
			case 'clearExpiredSecretsInterval':
			case 'cpuLimit':
			case 'cpuThreshold':
			case 'cronLoggerSetting':
			case 'dbInitMaxRetries':
			case 'dbInitRetryAfter':
			case 'emailPort':
			case 'eventLoopLagThreshold':
			case 'fido2Timeout':
			case 'fidoChallengeSize':
			case 'gracefulShutdownTimeout':
			case 'logStashPort':
			case 'maxCacheSize':
			case 'maxRedisCacheSize':
			case 'memoryLimit':
			case 'memoryThreshold':
			case 'memoryMonitorInterval':
			case 'multerFileSizeLimit':
			case 'rateLimiterBaseDuration':
			case 'rateLimiterBasePoints':
			case 'rateLimiterGlobalReset':
			case 'secretsExpiryTimeout':
			case 'secretsRateLimitMaxAttempts':
			case 'secretsRateLimitWindow':
			case 'serverPort':
			case 'slowdownThreshold':
			case 'tokenCacheDuration':
				return Number(value);
			// boolean
			case 'emailSecure':
			case 'featureApiRoutesCsrf':
			case 'featureDbSync':
			case 'featureEnableIpBlacklist':
			case 'featureEnableJwtAuth':
			case 'featureEnableLogStash':
			case 'featureEnableRateLimit':
			case 'featureEnableResourceAutoScaling':
			case 'featureEnableSession':
			case 'featureEncryptSecretsStore':
			case 'featureHonorCipherOrder':
			case 'featureHttpsRedirect':
			case 'featureLoadTestRoutes':
			case 'featureSequelizeLogging':
			case 'fidoAuthRequireResidentKey':
				return value.toLowerCase() === 'true';
			// number[]
			case 'fidoCryptoParams':
				return value.split(',').map(Number);
			// enum-like
			case 'dbDialect':
			case 'nodeEnv':
			case 'fidoAuthUserVerification':
			case 'logLevel':
				return value;
			default:
				throw new Error(
					`Unsupported environment variable key: ${String(key)}`
				);
		}
	}
	getFeatureFlags() {
		return {
			apiRoutesCsrf: this.parseBoolean(
				process.env.FEATURE_API_ROUTES_CSRF
			),
			dbSync: this.parseBoolean(process.env.FEATURE_DB_SYNC),
			enableIpBlacklist: this.parseBoolean(
				process.env.FEATURE_ENABLE_IP_BLACKLIST
			),
			enableJwtAuth: this.parseBoolean(
				process.env.FEATURE_ENABLE_JWT_AUTH
			),
			enableRateLimit: this.parseBoolean(
				process.env.FEATURE_ENABLE_RATE_LIMIT
			),
			enableRedis: this.parseBoolean(process.env.FEATURE_ENABLE_REDIS),
			enableResourceAutoScaling: this.parseBoolean(
				process.env.FEATURE_ENABLE_RESOURCE_AUTO_SCALING
			),
			encryptSecretsStore: this.parseBoolean(
				process.env.FEATURE_ENCRYPT_STORE
			),
			honorCipherOrder: this.parseBoolean(
				process.env.FEATURE_HONOR_CIPHER_ORDER
			),
			httpsRedirect: this.parseBoolean(
				process.env.FEATURE_HTTPS_REDIRECT
			),
			loadTestRoutes: this.parseBoolean(
				process.env.FEATURE_LOAD_TEST_ROUTE
			),
			sequelizeLogging: this.parseBoolean(
				process.env.FEATURE_SEQUELIZE_LOGGING
			)
		};
	}
	parseBoolean(value) {
		return value?.toLowerCase() === 'true';
	}
	clearAllEnvVariables() {
		Object.keys(process.env).forEach(key => {
			delete process.env[key];
		});
		this.logger.info('All environment variables cleared from memory.');
	}
	async shutdown() {
		try {
			this.logger.info('Shutting down EnvConfigService...');
			this.clearAllEnvVariables();
			EnvConfigService.instance = null;
			this.logger.info('EnvConfigService instance nullified.');
		} catch (error) {
			this.errorLogger.logError(
				`Error during EnvConfigService shutdown: ${error instanceof Error ? error.message : String(error)}`
			);
			const shutdownError =
				new this.errorHandler.ErrorClasses.UtilityErrorRecoverable(
					`EnvConfigService shutdown failed: ${error instanceof Error ? error.message : String(error)}`,
					{ originalError: error }
				);
			this.errorHandler.handleError({ error: shutdownError });
			throw shutdownError;
		}
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW52Q29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlcnZpY2VzL0VudkNvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ2hDLE9BQU8sSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUN4QixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sS0FBSyxDQUFDO0FBQ3BDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFRL0IsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRWxELE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN6RCxNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBRTdDLE1BQU0sT0FBTyxnQkFBZ0I7SUFDcEIsTUFBTSxDQUFDLFFBQVEsR0FBNEIsSUFBSSxDQUFDO0lBQ2hELE1BQU0sQ0FBNEI7SUFDbEMsV0FBVyxDQUE4QjtJQUN6QyxZQUFZLENBQStCO0lBRW5ELFlBQ0MsTUFBaUMsRUFDakMsV0FBd0MsRUFDeEMsWUFBMEM7UUFFMUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDL0IsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFDakMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2hCLENBQUM7SUFFTSxNQUFNLENBQUMsS0FBSyxDQUFDLFdBQVc7UUFDOUIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2hDLE1BQU0sTUFBTSxHQUFHLE1BQU0sY0FBYyxD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QVksQ0FBQyx1QkFBdUIsQ0FDekQscUNBQXFDLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUM3RixFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUUsQ0FDeEIsQ0FBQztZQUNILElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLGFBQWEsRUFBRSxDQUFDLENBQUM7WUFDeEQsTUFBTSxhQUFhLENBQUM7UUFDckIsQ0FBQztJQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb25maWcgfSBmcm9tICdkb3RlbnYnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBmaWxlVVJMVG9QYXRoIH0gZnJvbSAndXJsJztcbmltcG9ydCB7IGRpcm5hbWUgfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IEVudlZhcmlhYmxlVHlwZXMsIEZlYXR1cmVGbGFnVHlwZXMgfSBmcm9tICcuLi9pbmRleC9pbnRlcmZhY2VzL2Vudic7XG5pbXBvcnQge1xuXHRBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRFbnZDb25maWdTZXJ2aWNlSW50ZXJmYWNlLFxuXHRFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2Vcbn0gZnJvbSAnLi4vaW5kZXgvaW50ZXJmYWNlcy9zZXJ2aWNlcyc7XG5pbXBvcnQgeyBIYW5kbGVFcnJvclN0YXRpY1BhcmFtZXRlcnMgfSBmcm9tICcuLi9pbmRleC9wYXJhbWV0ZXJzJztcbmltcG9ydCB7IFNlcnZpY2VGYWN0b3J5IH0gZnJvbSAnLi4vaW5kZXgvZmFjdG9yeSc7XG5cbmV4cG9ydCBjb25zdCBfX2ZpbGVuYW1lID0gZmlsZVVSTFRvUGF0aChpbXBvcnQubWV0YS51cmwpO1xuZXhwb3J0IGNvbnN0IF9fZGlybmFtZSA9IGRpcm5hbWUoX19maWxlbmFtZSk7XG5cbmV4cG9ydCBjbGFzcyBFbnZDb25maWdTZXJ2aWNlIGltcGxlbWVudHMgRW52Q29uZmlnU2VydmljZUludGVyZmFjZSB7XG5cdHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBFbnZDb25maWdTZXJ2aWNlIHwgbnVsbCA9IG51bGw7XG5cdHByaXZhdGUgbG9nZ2VyOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIGVycm9yTG9nZ2VyOiBFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2U7XG5cdHByaXZhdGUgZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlO1xuXG5cdHByaXZhdGUgY29uc3RydWN0b3IoXG5cdFx0bG9nZ2VyOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRcdGVycm9yTG9nZ2VyOiBFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2UsXG5cdFx0ZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlXG5cdCkge1xuXHRcdHRoaXMubG9nZ2VyID0gbG9nZ2VyO1xuXHRcdHRoaXMuZXJyb3JMb2dnZXIgPSBlcnJvckxvZ2dlcjtcblx0XHR0aGlzLmVycm9ySGFuZGxlciA9IGVycm9ySGFuZGxlcjtcblx0XHR0aGlzLmxvYWRFbnYoKTtcblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgYXN5bmMgZ2V0SW5zdGFuY2UoKTogUHJvbWlzZTxFbnZDb25maWdTZXJ2aWNlPiB7XG5cdFx0aWYgKCFFbnZDb25maWdTZXJ2aWNlLmluc3RhbmNlKSB7XG5cdFx0XHRjb25zdCBsb2dnZXIgPSBhd2FpdCBTZXJ2aWNlRmFjdG9yeS5nZXRMb2dnZXJTZXJ2aWNlKCk7XG5cdFx0XHRjb25zdCBlcnJvckxvZ2dlciA9IGF3YWl0IFNlcnZpY2VGYWN0b3J5LmdldEVycm9yTG9nZ2VyU2VydmljZSgpO1xuXHRcdFx0Y29uc3QgZXJyb3JIYW5kbGVyID0gYXdhaXQgU2VydmljZUZhY3RvcnkuZ2V0RXJyb3JIYW5kbGVyU2VydmljZSgpO1xuXG5cdFx0XHRFbnZDb25maWdTZXJ2aWNlLmluc3RhbmNlID0gbmV3IEVudkNvbmZpZ1NlcnZpY2UoXG5cdFx0XHRcdGxvZ2dlcixcblx0XHRcdFx0ZXJyb3JMb2dnZXIsXG5cdFx0XHRcdGVycm9ySGFuZGxlclxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gRW52Q29uZmlnU2VydmljZS5pbnN0YW5jZTtcblx0fVxuXG5cdHByaXZhdGUgbG9hZEVudigpOiB2b2lkIHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgbWFzdGVyRW52UGF0aDogc3RyaW5nID0gcGF0aC5qb2luKFxuXHRcdFx0XHRfX2Rpcm5hbWUsXG5cdFx0XHRcdCcuLi8uLi9jb25maWcvZW52L2JhY2tlbmQubWFzdGVyLmVudidcblx0XHRcdCk7XG5cdFx0XHRjb25maWcoeyBwYXRoOiBtYXN0ZXJFbnZQYXRoIH0pO1xuXG5cdFx0XHRjb25zdCBlbnZUeXBlID0gcHJvY2Vzcy5lbnYuRU5WX1RZUEUgfHwgJ2Rldic7XG5cdFx0XHRjb25zb2xlLmRlYnVnKGBlbnZUeXBlID0gJHtlbnZUeXBlfWApO1xuXHRcdFx0Y29uc3QgZW52RmlsZSA9XG5cdFx0XHRcdGVudlR5cGUgPT09ICdkb2NrZXInXG5cdFx0XHRcdFx0PyAnYmFja2VuZC5kb2NrZXItZGV2LmVudidcblx0XHRcdFx0XHQ6ICdiYWNrZW5kLmRldi5lbnYnO1xuXHRcdFx0Y29uc3QgZW52UGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBgLi9jb25maWcvZW52LyR7ZW52RmlsZX1gKTtcblx0XHRcdGNvbnNvbGUuZGVidWcoYExvYWRpbmcgZW52aXJvbm1lbnQgdmFyaWFibGVzIGZyb20gJHtlbnZGaWxlfWApO1xuXG5cdFx0XHRjb25maWcoeyBwYXRoOiBlbnZQYXRoIH0pO1xuXHRcdH0gY2F0Y2ggKGNvbmZpZ0Vycm9yKSB7XG5cdFx0XHRjb25zdCBjb25maWd1cmF0aW9uRXJyb3IgPVxuXHRcdFx0XHRuZXcgdGhpcy5lcnJvckhhbmRsZXIuRXJyb3JDbGFzc2VzLkNvbmZpZ3VyYXRpb25FcnJvcihcblx0XHRcdFx0XHRgRmFpbGVkIHRvIGxvYWQgZW52aXJvbm1lbnQgdmFyaWFibGVzIGZyb20gLmVudiBmaWxlXFxuJHtjb25maWdFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gY29uZmlnRXJyb3IubWVzc2FnZSA6IGNvbmZpZ0Vycm9yfVxcblNodXR0aW5nIGRvd24uLi5gLFxuXHRcdFx0XHRcdHsgb3JpZ2luYWxFcnJvcjogY29uZmlnRXJyb3IgfVxuXHRcdFx0XHQpO1xuXHRcdFx0dGhpcy5lcnJvckxvZ2dlci5sb2dFcnJvcihjb25maWd1cmF0aW9uRXJyb3IubWVzc2FnZSk7XG5cdFx0XHRjb25zdCBwcm9jZXNzRXJyb3JQYXJhbXMgPSB7XG5cdFx0XHRcdC4uLkhhbmRsZUVycm9yU3RhdGljUGFyYW1ldGVycyxcblx0XHRcdFx0ZXJyb3I6IGNvbmZpZ3VyYXRpb25FcnJvcixcblx0XHRcdFx0ZGV0YWlsczoge1xuXHRcdFx0XHRcdHJlYXNvbjogJ0ZhaWxlZCB0byBsb2FkIGVudmlyb25tZW50IHZhcmlhYmxlcyBmcm9tIC5lbnYgZmlsZSdcblx0XHRcdFx0fVxuXHRcdFx0fTtcblx0XHRcdHRoaXMuZXJyb3JIYW5kbGVyLmhhbmRsZUVycm9yKHByb2Nlc3NFcnJvclBhcmFtcyk7XG5cdFx0XHR0aHJvdyBjb25maWd1cmF0aW9uRXJyb3I7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGdldEVudlZhcmlhYmxlPEsgZXh0ZW5kcyBrZXlvZiBFbnZWYXJpYWJsZVR5cGVzPihcblx0XHRrZXk6IEtcblx0KTogRW52VmFyaWFibGVUeXBlc1tLXSB7XG5cdFx0Y29uc3QgdmFsdWUgPSBwcm9jZXNzLmVudltrZXkgYXMgc3RyaW5nXTtcblxuXHRcdGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEVudmlyb25tZW50IHZhcmlhYmxlICR7U3RyaW5nKGtleSl9IG5vdCBmb3VuZGApO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLnBhcnNlRW52VmFsdWUodmFsdWUsIGtleSk7XG5cdH1cblxuXHRwcml2YXRlIHBhcnNlRW52VmFsdWU8SyBleHRlbmRzIGtleW9mIEVudlZhcmlhYmxlVHlwZXM+KFxuXHRcdHZhbHVlOiBzdHJpbmcsXG5cdFx0a2V5OiBLXG5cdCk6IEVudlZhcmlhYmxlVHlwZXNbS10ge1xuXHRcdHN3aXRjaCAoa2V5KSB7XG5cdFx0XHQvLyBzdHJpbmdzXG5cdFx0XHRjYXNlICdiYXNlVXJsJzpcblx0XHRcdGNhc2UgJ2RiSG9zdCc6XG5cdFx0XHRjYXNlICdkYk5hbWUnOlxuXHRcdFx0Y2FzZSAnZGJVc2VyJzpcblx0XHRcdGNhc2UgJ2Rpc2tQYXRoJzpcblx0XHRcdGNhc2UgJ2VtYWlsSG9zdCc6XG5cdFx0XHRjYXNlICdlbWFpbFVzZXInOlxuXHRcdFx0Y2FzZSAnZnJvbnRlbmRTZWNyZXRzUGF0aCc6XG5cdFx0XHRjYXNlICdpcFdoaXRlbGlzdFBhdGgnOlxuXHRcdFx0Y2FzZSAnbG9nRXhwb3J0UGF0aCc6XG5cdFx0XHRjYXNlICdsb2dnZXJTZXJ2aWNlTmFtZSc6XG5cdFx0XHRjYXNlICdsb2dTdGFzaEhvc3QnOlxuXHRcdFx0Y2FzZSAnbG9nU3Rhc2hOb2RlJzpcblx0XHRcdGNhc2UgJ25wbUxvZ1BhdGgnOlxuXHRcdFx0Y2FzZSAncHJpbWFyeUxvZ1BhdGgnOlxuXHRcdFx0Y2FzZSAncmVkaXNVcmwnOlxuXHRcdFx0Y2FzZSAncmVxdWVzdFRpbWVvdXQnOlxuXHRcdFx0Y2FzZSAncmV2b2tlZFRva2VuUmV0ZW50aW9uUGVyaW9kJzpcblx0XHRcdGNhc2UgJ3JwTmFtZSc6XG5cdFx0XHRjYXNlICdycEljb24nOlxuXHRcdFx0Y2FzZSAncnBJZCc6XG5cdFx0XHRjYXNlICdycE9yaWdpbic6XG5cdFx0XHRjYXNlICdzZWNyZXRzRmlsZVBhdGgxJzpcblx0XHRcdGNhc2UgJ3NlcnZlckRhdGFGaWxlUGF0aDEnOlxuXHRcdFx0Y2FzZSAnc2VydmVyRGF0YUZpbGVQYXRoMic6XG5cdFx0XHRjYXNlICdzZXJ2ZXJEYXRhRmlsZVBhdGgzJzpcblx0XHRcdGNhc2UgJ3NlcnZlckRhdGFGaWxlUGF0aDQnOlxuXHRcdFx0Y2FzZSAnc3RhdGljUm9vdFBhdGgnOlxuXHRcdFx0Y2FzZSAndGVtcERpcic6XG5cdFx0XHRjYXNlICd0b2tlbkV4cGlyeUxpc3RQYXRoJzpcblx0XHRcdGNhc2UgJ3Rva2VuUmV2b2tlZExpc3RQYXRoJzpcblx0XHRcdGNhc2UgJ3Rsc0NlcnRQYXRoMSc6XG5cdFx0XHRjYXNlICd0bHNLZXlQYXRoMSc6XG5cdFx0XHRjYXNlICd5dWJpY29BcGlVcmwnOlxuXHRcdFx0XHRyZXR1cm4gdmFsdWUgYXMgRW52VmFyaWFibGVUeXBlc1tLXTtcblxuXHRcdFx0Ly8gbnVtYmVyXG5cdFx0XHRjYXNlICdiYXRjaFJlRW5jcnlwdFNlY3JldHNJbnRlcnZhbCc6XG5cdFx0XHRjYXNlICdibGFja2xpc3RTeW5jSW50ZXJ2YWwnOlxuXHRcdFx0Y2FzZSAnY2xlYXJFeHBpcmVkU2VjcmV0c0ludGVydmFsJzpcblx0XHRcdGNhc2UgJ2NwdUxpbWl0Jzpcblx0XHRcdGNhc2UgJ2NwdVRocmVzaG9sZCc6XG5cdFx0XHRjYXNlICdjcm9uTG9nZ2VyU2V0dGluZyc6XG5cdFx0XHRjYXNlICdkYkluaXRNYXhSZXRyaWVzJzpcblx0XHRcdGNhc2UgJ2RiSW5pdFJldHJ5QWZ0ZXInOlxuXHRcdFx0Y2FzZSAnZW1haWxQb3J0Jzpcblx0XHRcdGNhc2UgJ2V2ZW50TG9vcExhZ1RocmVzaG9sZCc6XG5cdFx0XHRjYXNlICdmaWRvMlRpbWVvdXQnOlxuXHRcdFx0Y2FzZSAnZmlkb0NoYWxsZW5nZVNpemUnOlxuXHRcdFx0Y2FzZSAnZ3JhY2VmdWxTaHV0ZG93blRpbWVvdXQnOlxuXHRcdFx0Y2FzZSAnbG9nU3Rhc2hQb3J0Jzpcblx0XHRcdGNhc2UgJ21heENhY2hlU2l6ZSc6XG5cdFx0XHRjYXNlICdtYXhSZWRpc0NhY2hlU2l6ZSc6XG5cdFx0XHRjYXNlICdtZW1vcnlMaW1pdCc6XG5cdFx0XHRjYXNlICdtZW1vcnlUaHJlc2hvbGQnOlxuXHRcdFx0Y2FzZSAnbWVtb3J5TW9uaXRvckludGVydmFsJzpcblx0XHRcdGNhc2UgJ211bHRlckZpbGVTaXplTGltaXQnOlxuXHRcdFx0Y2FzZSAncmF0ZUxpbWl0ZXJCYXNlRHVyYXRpb24nOlxuXHRcdFx0Y2FzZSAncmF0ZUxpbWl0ZXJCYXNlUG9pbnRzJzpcblx0XHRcdGNhc2UgJ3JhdGVMaW1pdGVyR2xvYmFsUmVzZXQnOlxuXHRcdFx0Y2FzZSAnc2VjcmV0c0V4cGlyeVRpbWVvdXQnOlxuXHRcdFx0Y2FzZSAnc2VjcmV0c1JhdGVMaW1pdE1heEF0dGVtcHRzJzpcblx0XHRcdGNhc2UgJ3NlY3JldHNSYXRlTGltaXRXaW5kb3cnOlxuXHRcdFx0Y2FzZSAnc2VydmVyUG9ydCc6XG5cdFx0XHRjYXNlICdzbG93ZG93blRocmVzaG9sZCc6XG5cdFx0XHRjYXNlICd0b2tlbkNhY2hlRHVyYXRpb24nOlxuXHRcdFx0XHRyZXR1cm4gTnVtYmVyKHZhbHVlKSBhcyBFbnZWYXJpYWJsZVR5cGVzW0tdO1xuXG5cdFx0XHQvLyBib29sZWFuXG5cdFx0XHRjYXNlICdlbWFpbFNlY3VyZSc6XG5cdFx0XHRjYXNlICdmZWF0dXJlQXBpUm91dGVzQ3NyZic6XG5cdFx0XHRjYXNlICdmZWF0dXJlRGJTeW5jJzpcblx0XHRcdGNhc2UgJ2ZlYXR1cmVFbmFibGVJcEJsYWNrbGlzdCc6XG5cdFx0XHRjYXNlICdmZWF0dXJlRW5hYmxlSnd0QXV0aCc6XG5cdFx0XHRjYXNlICdmZWF0dXJlRW5hYmxlTG9nU3Rhc2gnOlxuXHRcdFx0Y2FzZSAnZmVhdHVyZUVuYWJsZVJhdGVMaW1pdCc6XG5cdFx0XHRjYXNlICdmZWF0dXJlRW5hYmxlUmVzb3VyY2VBdXRvU2NhbGluZyc6XG5cdFx0XHRjYXNlICdmZWF0dXJlRW5hYmxlU2Vzc2lvbic6XG5cdFx0XHRjYXNlICdmZWF0dXJlRW5jcnlwdFNlY3JldHNTdG9yZSc6XG5cdFx0XHRjYXNlICdmZWF0dXJlSG9ub3JDaXBoZXJPcmRlcic6XG5cdFx0XHRjYXNlICdmZWF0dXJlSHR0cHNSZWRpcmVjdCc6XG5cdFx0XHRjYXNlICdmZWF0dXJlTG9hZFRlc3RSb3V0ZXMnOlxuXHRcdFx0Y2FzZSAnZmVhdHVyZVNlcXVlbGl6ZUxvZ2dpbmcnOlxuXHRcdFx0Y2FzZSAnZmlkb0F1dGhSZXF1aXJlUmVzaWRlbnRLZXknOlxuXHRcdFx0XHRyZXR1cm4gKHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJykgYXMgRW52VmFyaWFibGVUeXBlc1tLXTtcblxuXHRcdFx0Ly8gbnVtYmVyW11cblx0XHRcdGNhc2UgJ2ZpZG9DcnlwdG9QYXJhbXMnOlxuXHRcdFx0XHRyZXR1cm4gdmFsdWUuc3BsaXQoJywnKS5tYXAoTnVtYmVyKSBhcyBFbnZWYXJpYWJsZVR5cGVzW0tdO1xuXG5cdFx0XHQvLyBlbnVtLWxpa2Vcblx0XHRcdGNhc2UgJ2RiRGlhbGVjdCc6XG5cdFx0XHRjYXNlICdub2RlRW52Jzpcblx0XHRcdGNhc2UgJ2ZpZG9BdXRoVXNlclZlcmlmaWNhdGlvbic6XG5cdFx0XHRjYXNlICdsb2dMZXZlbCc6XG5cdFx0XHRcdHJldHVybiB2YWx1ZSBhcyBFbnZWYXJpYWJsZVR5cGVzW0tdO1xuXG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHRcdFx0YFVuc3VwcG9ydGVkIGVudmlyb25tZW50IHZhcmlhYmxlIGtleTogJHtTdHJpbmcoa2V5KX1gXG5cdFx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGdldEZlYXR1cmVGbGFncygpOiBGZWF0dXJlRmxhZ1R5cGVzIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0YXBpUm91dGVzQ3NyZjogdGhpcy5wYXJzZUJvb2xlYW4oXG5cdFx0XHRcdHByb2Nlc3MuZW52LkZFQVRVUkVfQVBJX1JPVVRFU19DU1JGXG5cdFx0XHQpLFxuXHRcdFx0ZGJTeW5jOiB0aGlzLnBhcnNlQm9vbGVhbihwcm9jZXNzLmVudi5GRUFUVVJFX0RCX1NZTkMpLFxuXHRcdFx0ZW5hYmxlSXBCbGFja2xpc3Q6IHRoaXMucGFyc2VCb29sZWFuKFxuXHRcdFx0XHRwcm9jZXNzLmVudi5GRUFUVVJFX0VOQUJMRV9JUF9CTEFDS0xJU1Rcblx0XHRcdCkhLFxuXHRcdFx0ZW5hYmxlSnd0QXV0aDogdGhpcy5wYXJzZUJvb2xlYW4oXG5cdFx0XHRcdHByb2Nlc3MuZW52LkZFQVRVUkVfRU5BQkxFX0pXVF9BVVRIXG5cdFx0XHQpISxcblx0XHRcdGVuYWJsZVJhdGVMaW1pdDogdGhpcy5wYXJzZUJvb2xlYW4oXG5cdFx0XHRcdHByb2Nlc3MuZW52LkZFQVRVUkVfRU5BQkxFX1JBVEVfTElNSVRcblx0XHRcdCkhLFxuXHRcdFx0ZW5hYmxlUmVkaXM6IHRoaXMucGFyc2VCb29sZWFuKHByb2Nlc3MuZW52LkZFQVRVUkVfRU5BQkxFX1JFRElTKSxcblx0XHRcdGVuYWJsZVJlc291cmNlQXV0b1NjYWxpbmc6IHRoaXMucGFyc2VCb29sZWFuKFxuXHRcdFx0XHRwcm9jZXNzLmVudi5GRUFUVVJFX0VOQUJMRV9SRVNPVVJDRV9BVVRPX1NDQUxJTkdcblx0XHRcdCksXG5cdFx0XHRlbmNyeXB0U2VjcmV0c1N0b3JlOiB0aGlzLnBhcnNlQm9vbGVhbihcblx0XHRcdFx0cHJvY2Vzcy5lbnYuRkVBVFVSRV9FTkNSWVBUX1NUT1JFXG5cdFx0XHQpLFxuXHRcdFx0aG9ub3JDaXBoZXJPcmRlcjogdGhpcy5wYXJzZUJvb2xlYW4oXG5cdFx0XHRcdHByb2Nlc3MuZW52LkZFQVRVUkVfSE9OT1JfQ0lQSEVSX09SREVSXG5cdFx0XHQpLFxuXHRcdFx0aHR0cHNSZWRpcmVjdDogdGhpcy5wYXJzZUJvb2xlYW4oXG5cdFx0XHRcdHByb2Nlc3MuZW52LkZFQVRVUkVfSFRUUFNfUkVESVJFQ1Rcblx0XHRcdCksXG5cdFx0XHRsb2FkVGVzdFJvdXRlczogdGhpcy5wYXJzZUJvb2xlYW4oXG5cdFx0XHRcdHByb2Nlc3MuZW52LkZFQVRVUkVfTE9BRF9URVNUX1JPVVRFIVxuXHRcdFx0KSxcblx0XHRcdHNlcXVlbGl6ZUxvZ2dpbmc6IHRoaXMucGFyc2VCb29sZWFuKFxuXHRcdFx0XHRwcm9jZXNzLmVudi5GRUFUVVJFX1NFUVVFTElaRV9MT0dHSU5HXG5cdFx0XHQpXG5cdFx0fTtcblx0fVxuXG5cdHByaXZhdGUgcGFyc2VCb29sZWFuKHZhbHVlOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdmFsdWU/LnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJztcblx0fVxuXG5cdHByaXZhdGUgY2xlYXJBbGxFbnZWYXJpYWJsZXMoKTogdm9pZCB7XG5cdFx0T2JqZWN0LmtleXMocHJvY2Vzcy5lbnYpLmZvckVhY2goa2V5ID0+IHtcblx0XHRcdGRlbGV0ZSBwcm9jZXNzLmVudltrZXldO1xuXHRcdH0pO1xuXHRcdHRoaXMubG9nZ2VyLmluZm8oJ0FsbCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgY2xlYXJlZCBmcm9tIG1lbW9yeS4nKTtcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBzaHV0ZG93bigpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0cnkge1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnU2h1dHRpbmcgZG93biBFbnZDb25maWdTZXJ2aWNlLi4uJyk7XG5cblx0XHRcdHRoaXMuY2xlYXJBbGxFbnZWYXJpYWJsZXMoKTtcblx0XHRcdEVudkNvbmZpZ1NlcnZpY2UuaW5zdGFuY2UgPSBudWxsO1xuXG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdFbnZDb25maWdTZXJ2aWNlIGluc3RhbmNlIG51bGxpZmllZC4nKTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5lcnJvckxvZ2dlci5sb2dFcnJvcihcblx0XHRcdFx0YEVycm9yIGR1cmluZyBFbnZDb25maWdTZXJ2aWNlIHNodXRkb3duOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gXG5cdFx0XHQpO1xuXHRcdFx0Y29uc3Qgc2h1dGRvd25FcnJvciA9XG5cdFx0XHRcdG5ldyB0aGlzLmVycm9ySGFuZGxlci5FcnJvckNsYXNzZXMuVXRpbGl0eUVycm9yUmVjb3ZlcmFibGUoXG5cdFx0XHRcdFx0YEVudkNvbmZpZ1NlcnZpY2Ugc2h1dGRvd24gZmFpbGVkOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gLFxuXHRcdFx0XHRcdHsgb3JpZ2luYWxFcnJvcjogZXJyb3IgfVxuXHRcdFx0XHQpO1xuXHRcdFx0dGhpcy5lcnJvckhhbmRsZXIuaGFuZGxlRXJyb3IoeyBlcnJvcjogc2h1dGRvd25FcnJvciB9KTtcblx0XHRcdHRocm93IHNodXRkb3duRXJyb3I7XG5cdFx0fVxuXHR9XG59XG4iXX0=
