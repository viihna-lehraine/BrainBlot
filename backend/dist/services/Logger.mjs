import { Op } from 'sequelize';
import { Logger as WinstonLogger } from 'winston';
export class AppLoggerService extends WinstonLogger {
	static instance = null;
	_deps;
	adminId = null;
	redactedLogger = null;
	errorHandler = null;
	secrets = null;
	constructor(deps, logLevel, serviceName) {
		const { format, transports, addColors } = deps.winston;
		const { colorize, combine, errors, json, printf, timestamp } = format;
		const resolvedLogLevel = logLevel || process.env.LOG_LEVEL || 'info';
		const resolvedServiceName =
			serviceName || process.env.LOGGER_SERVICE_NAME || 'Log Service';
		const isProduction = process.env.NODE_ENV === 'production';
		const logDirectory = './data/logs/server/main/';
		const logFormat = printf(({ level, message, timestamp, stack }) => {
			return `${timestamp} ${level}: ${stack || message}`;
		});
		if (!deps.fs.existsSync(logDirectory)) {
			deps.fs.mkdirSync(logDirectory, { recursive: true });
		}
		const loggerTransports = [
			new transports.Console({
				format: combine(colorize(), logFormat),
				level: isProduction ? 'info' : resolvedLogLevel
			}),
			new deps.DailyRotateFile({
				filename: 'server-%DATE%.log',
				dirname: logDirectory,
				datePattern: 'YYYY-MM-DD',
				zippedArchive: true,
				maxSize: '20m',
				maxFiles: '30d',
				format: combine(
					timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),
					logFormat
				),
				level: resolvedLogLevel
			})
		];
		super({
			levels: AppLoggerService.getCustomLogLevels().levels,
			level: resolvedLogLevel,
			format: combine(errors({ stack: true }), json()),
			defaultMeta: { service: resolvedServiceName },
			transports: loggerTransports
		});
		this.addLogstashTransport(loggerTransports);
		this._deps = deps;
		addColors(AppLoggerService.getCustomLogLevels().colors);
	}
	static async getInstance(deps, logLevel, serviceName) {
		if (!AppLoggerService.instance) {
			AppLoggerService.instance = new AppLoggerService(
				deps,
				logLevel,
				serviceName
			);
			await AppLoggerService.instance.initializeAsyncParts();
		}
		return AppLoggerService.instance;
	}
	async initializeAsyncParts() {
		try {
			await this.addLogstashTransport(this.transports); // Await Logstash setup if it's async
		} catch (error) {
			this.logError(
				`Failed to initialize async parts of logger ${error instanceof Error ? error.message : error}`
			);
			throw error;
		}
	}
	static getCustomLogLevels() {
		return {
			levels: {
				critical: 0,
				error: 1,
				warn: 2,
				info: 3,
				debug: 4,
				notice: 5
			},
			colors: {
				critical: 'red',
				error: 'orange',
				warn: 'yellow',
				info: 'green',
				debug: 'blue',
				notice: 'magenta'
			}
		};
	}
	setErrorHandler(errorHandler) {
		this.errorHandler = errorHandler;
	}
	setUpSecrets(secrets) {
		this.secrets = secrets;
		this.setupRedactedLogger();
		console.info('Vault Service injected and redacted logger setup.');
	}
	setupRedactedLogger() {
		if (this.redactedLogger || !this.secrets)
			this.redactedLogger = this.createRedactedLogger();
		this.logInfo('Redacted logger initialized.');
	}
	createRedactedLogger() {
		const redactedLogger = Object.create(this);
		const levels = ['debug', 'info', 'notice', 'warn', 'error', 'crit'];
		levels.forEach(level => {
			const originalMethod = this[level].bind(this);
			redactedLogger[level] = (message, meta) => {
				const redactedMeta =
					typeof meta === 'object'
						? this.secrets?.redactSecrets(meta)
						: meta;
				originalMethod(message, redactedMeta);
			};
		});
		return Object.assign(redactedLogger, {
			getRedactedLogger: this.getRedactedLogger.bind(this)
		});
	}
	getLogger() {
		return this.redactedLogger ? this.redactedLogger : this;
	}
	getRedactedLogger() {
		return this.createRedactedLogger();
	}
	async addLogstashTransport(transportsArray) {
		try {
			const logStashTransport = await this.createLogstashTransport();
			if (logStashTransport) {
				transportsArray.push(logStashTransport);
			}
		} catch (error) {
			this.logError(
				`Error adding Logstash transport ${error instanceof Error ? error.message : error}`
			);
		}
	}
	async createLogstashTransport() {
		try {
			return new this._deps.LogStashTransport({
				port: parseInt(process.env.LOGSTASH_PORT, 10),
				node_name: process.env.LOGSTASH_NODE,
				host: process.env.LOGSTASH_HOST
			});
		} catch (error) {
			const logstashError =
				new this._deps.ErrorClasses.ServiceUnavailableError(
					60,
					'Application Logger Service',
					{
						message:
							'Logger Service Error: Failed to create Logstash transport'
					}
				);
			this.logError(
				`Logstash error: ${error instanceof Error ? error.message : error}`
			);
			if (this.errorHandler) {
				this.errorHandler.handleError({
					...this._deps.HandleErrorStaticParameters,
					error: logstashError,
					details: { reason: 'Failed to create Logstash transport' }
				});
			}
			return null;
		}
	}
	logDebug(message, details) {
		this.debug(message, details);
	}
	logInfo(message, details) {
		this.info(message, details);
	}
	logNotice(message, details) {
		this.notice(message, details);
	}
	logWarn(message, details) {
		this.warn(message, details);
	}
	logError(message, details) {
		this.error(message, details);
	}
	logCritical(message, details) {
		this.crit(message, details);
	}
	async cleanUpOldLogs(sequelize, retentionPeriodDays = 30) {
		const retentionDate = new Date();
		retentionDate.setDate(retentionDate.getDate() - retentionPeriodDays);
		try {
			const ErrorLog = sequelize.model('ErrorLog');
			await ErrorLog.destroy({
				where: {
					timestamp: {
						[Op.lt]: retentionDate
					}
				}
			});
			this.info(
				`Old logs older than ${retentionPeriodDays} days have been deleted.`
			);
		} catch (cleanupError) {
			this.error('Failed to clean up old logs', cleanupError);
		}
	}
	setAdminId(adminId) {
		this.adminId = adminId;
	}
	getErrorDetails(
		getCallerInfo,
		action = 'unknown',
		req,
		userId,
		additionalData
	) {
		const details = {
			requestId: req?.headers['x-request-id'] || this._deps.uuidv4(),
			adminId: this.adminId || 'Unknown Admin',
			userId: userId || null,
			action: action || 'unknown',
			caller: String(getCallerInfo()),
			timestamp: Date.now(),
			requestInfo: {
				method: req?.method || null,
				url: req?.originalUrl || req?.url || null,
				ip:
					req?.ip ||
					req?.headers['x-forwarded-for'] ||
					req?.socket.remoteAddress ||
					null,
				userAgent: req?.headers['user-agent'] || null,
				referrer:
					req?.headers['referer'] || req?.headers['referrer'] || null,
				query: req?.query || null,
				params: req?.params || null,
				body: req?.body ? this.sanitizeRequestBody(req?.body) : null
			},
			...additionalData
		};
		return details;
	}
	get __deps() {
		return this._deps;
	}
	sanitizeRequestBody(body) {
		const sanitizedBody = new Map(Object.entries(body));
		const sensitiveFields = [
			'email',
			'key',
			'newPassword',
			'oldPassword',
			'passphrase',
			'password',
			'secret',
			'token',
			'username'
		];
		sensitiveFields.forEach(field => {
			if (sanitizedBody.has(field)) {
				sanitizedBody.set(field, '[REDACTED]');
			}
		});
		return Object.fromEntries(sanitizedBody);
	}
	async shutdown() {
		this.info('Shutting down logger services...');
		await new Promise((resolve, reject) => {
			this.on('finish', () => {
				this.info('All logs have been flushed.');
				resolve();
			});
			this.on('error', error => {
				this.error(
					`Error while shutting down logger: ${error.message}`
				);
				reject(error);
			});
			this.end();
		});
	}
	handleError(message, error) {
		if (this.errorHandler) {
			this.errorHandler.handleError({
				error,
				details: { message }
			});
		} else {
			this.logError(`Error Handler not set. Error: ${message}`);
		}
	}
}
export class ErrorLoggerService extends AppLoggerService {
	static instance;
	errorCounts;
	constructor(deps, logLevel, serviceName) {
		super(deps, logLevel, serviceName);
		this.errorCounts = new Map();
	}
	static async getInstance(deps, logLevel, serviceName) {
		if (!ErrorLoggerService.instance) {
			ErrorLoggerService.instance = new ErrorLoggerService(
				deps,
				logLevel,
				serviceName
			);
		}
		return Object.assign(ErrorLoggerService.instance, {
			logAppError: ErrorLoggerService.instance.logAppError.bind(
				ErrorLoggerService.instance
			),
			getErrorCount: ErrorLoggerService.instance.getErrorCount.bind(
				ErrorLoggerService.instance
			),
			getRedactedLogger:
				ErrorLoggerService.instance.getRedactedLogger.bind(
					ErrorLoggerService.instance
				),
			logDebug: ErrorLoggerService.instance.logDebug.bind(
				ErrorLoggerService.instance
			),
			logInfo: ErrorLoggerService.instance.logInfo.bind(
				ErrorLoggerService.instance
			),
			logNotice: ErrorLoggerService.instance.logNotice.bind(
				ErrorLoggerService.instance
			),
			logWarn: ErrorLoggerService.instance.logWarn.bind(
				ErrorLoggerService.instance
			),
			logError: ErrorLoggerService.instance.logError.bind(
				ErrorLoggerService.instance
			),
			logCritical: ErrorLoggerService.instance.logCritical.bind(
				ErrorLoggerService.instance
			),
			cleanUpOldLogs: ErrorLoggerService.instance.cleanUpOldLogs.bind(
				ErrorLoggerService.instance
			),
			getErrorDetails: ErrorLoggerService.instance.getErrorDetails.bind(
				ErrorLoggerService.instance
			)
		});
	}
	logAppError(error, sequelize, details = {}) {
		if (sequelize) {
			this.logToDatabase(error, sequelize).catch(databaseError => {
				this.warn(
					`Could not log error to database: ${databaseError.message || databaseError}`
				);
			});
		} else {
			this.logWarn(
				'Sequelize instance not provided for logging error to database'
			);
		}
		const errorCount = this.errorCounts.get(error.name) || 0;
		this.errorCounts.set(error.name, errorCount + 1);
		if (this.errorHandler) {
			if (error.severity === this.errorHandler.ErrorSeverity.FATAL) {
				this.logError(`FATAL: ${error.message}`, {
					...details,
					severity: error.severity
				});
			} else if (
				error.severity === this.errorHandler.ErrorSeverity.RECOVERABLE
			) {
				this.logWarn(`RECOVERABLE: ${error.message}`, { ...details });
			}
		} else {
			this.handleError('Error Handler not set', error);
		}
	}
	async logToDatabase(error, sequelize, retryCount = 3) {
		try {
			const ErrorLog = sequelize.model('ErrorLog');
			await ErrorLog.create({
				name: error.name,
				message: error.message,
				statusCode: error.statusCode,
				severity: error.severity,
				timestamp: new Date(),
				count: this.errorCounts.get(error.name) || 1
			});
			this.info('Error logged to database');
		} catch (databaseError) {
			this.error(`Failed to log error to the database: ${databaseError}`);
			if (retryCount > 0) {
				setTimeout(
					() => {
						this.logToDatabase(error, sequelize, retryCount - 1);
					},
					1000 * (4 - retryCount)
				);
			}
		}
	}
	getErrorCount(errorName) {
		return this.errorCounts.get(errorName) || 0;
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlcnZpY2VzL0xvZ2dlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFRQSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQy9CLE9BQU8sRUFBRSxNQUFNLElBQUksYUFBYSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBR2xELE1BQU0sT0FBTyxnQkFDWixTQUFRLGFBQWE7SUFHZCxNQUFNLENBQUMsUUFBUSxHQUE0QixJQUFJLENBQUM7SUFDN0MsS0FBSyxDQUF1QjtJQUM5QixPQUFPLEdBQWtCLElBQUksQ0FBQztJQUM5QixjQUFjLEdBQXFDLElBQUksQ0FBQztJQUN0RCxZQUFZLEdBQXdDLElBQUksQ0FBQztJQUMzRCxPQUFPLEdBQWlDLElBQUksQ0FBQztJQUVyRCxZQUNDLElBQTBCLEVBQzFCLFFBQWlCLEVBQ2pCLFdBQW9CO1FBRXBCLE1BQU0sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDdkQsTUFBTSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLEdBQUcsTUFBTSxDQUFDO1FBRXRFLE1BQU0sZ0JBQWdCLEdBQUcsUUFBUSxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxJQUFJLE1BQU0sQ0FBQztRQUNyRSxNQUFNLG1CQUFtQixHQUN4QixXQUFXLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsSUFBSSxhQUFhLENBQUM7UUFDakUsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssWUFBWSxDQUFDO1FBQzNELE1BQU0sWUFBWSxHQUFHLDBCQUEwQixDQUFDO1FBQ2hELE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8s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QUFHLENBQUMsRUFBRSxDQUFDO2dCQUNwQixVQUFVLENBQ1QsR0FBRyxFQUFFO29CQUNKLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RELENBQUMsRUFDRCxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLENBQ3ZCLENBQUM7WUFDSCxDQUFDO1FBQ0YsQ0FBQztJQUNGLENBQUM7SUFFTSxhQUFhLENBQUMsU0FBaUI7UUFDckMsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0MsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFRyYW5zcG9ydFN0cmVhbSBmcm9tICd3aW5zdG9uLXRyYW5zcG9ydCc7XG5pbXBvcnQge1xuXHRBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2UsXG5cdFZhdWx0U2VydmljZUludGVyZmFjZVxufSBmcm9tICcuLi9pbmRleC9pbnRlcmZhY2VzL3NlcnZpY2VzJztcbmltcG9ydCB7IEFwcExvZ2dlclNlcnZpY2VEZXBzIH0gZnJvbSAnLi4vaW5kZXgvaW50ZXJmYWNlcy9zZXJ2aWNlRGVwcyc7XG5pbXBvcnQgeyBPcCB9IGZyb20gJ3NlcXVlbGl6ZSc7XG5pbXBvcnQgeyBMb2dnZXIgYXMgV2luc3RvbkxvZ2dlciB9IGZyb20gJ3dpbnN0b24nO1xuaW1wb3J0IHsgUmVxdWVzdCB9IGZyb20gJ2V4cHJlc3MnO1xuXG5leHBvcnQgY2xhc3MgQXBwTG9nZ2VyU2VydmljZVxuXHRleHRlbmRzIFdpbnN0b25Mb2dnZXJcblx0aW1wbGVtZW50cyBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlXG57XG5cdHB1YmxpYyBzdGF0aWMgaW5zdGFuY2U6IEFwcExvZ2dlclNlcnZpY2UgfCBudWxsID0gbnVsbDtcblx0cHJvdGVjdGVkIF9kZXBzOiBBcHBMb2dnZXJTZXJ2aWNlRGVwcztcblx0cHJpdmF0ZSBhZG1pbklkOiBudW1iZXIgfCBudWxsID0gbnVsbDtcblx0cHJpdmF0ZSByZWRhY3RlZExvZ2dlcjogQXBwTG9nZ2VyU2VydmljZUludGVyZmFjZSB8IG51bGwgPSBudWxsO1xuXHRwcm90ZWN0ZWQgZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlIHwgbnVsbCA9IG51bGw7XG5cdHByaXZhdGUgc2VjcmV0czogVmF1bHRTZXJ2aWNlSW50ZXJmYWNlIHwgbnVsbCA9IG51bGw7XG5cblx0Y29uc3RydWN0b3IoXG5cdFx0ZGVwczogQXBwTG9nZ2VyU2VydmljZURlcHMsXG5cdFx0bG9nTGV2ZWw/OiBzdHJpbmcsXG5cdFx0c2VydmljZU5hbWU/OiBzdHJpbmdcblx0KSB7XG5cdFx0Y29uc3QgeyBmb3JtYXQsIHRyYW5zcG9ydHMsIGFkZENvbG9ycyB9ID0gZGVwcy53aW5zdG9uO1xuXHRcdGNvbnN0IHsgY29sb3JpemUsIGNvbWJpbmUsIGVycm9ycywganNvbiwgcHJpbnRmLCB0aW1lc3RhbXAgfSA9IGZvcm1hdDtcblxuXHRcdGNvbnN0IHJlc29sdmVkTG9nTGV2ZWwgPSBsb2dMZXZlbCB8fCBwcm9jZXNzLmVudi5MT0dfTEVWRUwgfHwgJ2luZm8nO1xuXHRcdGNvbnN0IHJlc29sdmVkU2VydmljZU5hbWUgPVxuXHRcdFx0c2VydmljZU5hbWUgfHwgcHJvY2Vzcy5lbnYuTE9HR0VSX1NFUlZJQ0VfTkFNRSB8fCAnTG9nIFNlcnZpY2UnO1xuXHRcdGNvbnN0IGlzUHJvZHVjdGlvbiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbic7XG5cdFx0Y29uc3QgbG9nRGlyZWN0b3J5ID0gJy4vZGF0YS9sb2dzL3NlcnZlci9tYWluLyc7XG5cdFx0Y29uc3QgbG9nRm9ybWF0ID0gcHJpbnRmKCh7IGxldmVsLCBtZXNzYWdlLCB0aW1lc3RhbXAsIHN0YWNrIH0pID0+IHtcblx0XHRcdHJldHVybiBgJHt0aW1lc3RhbXB9ICR7bGV2ZWx9OiAke3N0YWNrIHx8IG1lc3NhZ2V9YDtcblx0XHR9KTtcblxuXHRcdGlmICghZGVwcy5mcy5leGlzdHNTeW5jKGxvZ0RpcmVjdG9yeSkpIHtcblx0XHRcdGRlcHMuZnMubWtkaXJTeW5jKGxvZ0RpcmVjdG9yeSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgbG9nZ2VyVHJhbnNwb3J0czogVHJhbnNwb3J0U3RyZWFtW10gPSBbXG5cdFx0XHRuZXcgdHJhbnNwb3J0cy5Db25zb2xlKHtcblx0XHRcdFx0Zm9ybWF0OiBjb21iaW5lKGNvbG9yaXplKCksIGxvZ0Zvcm1hdCksXG5cdFx0XHRcdGxldmVsOiBpc1Byb2R1Y3Rpb24gPyAnaW5mbycgOiByZXNvbHZlZExvZ0xldmVsXG5cdFx0XHR9KSxcblx0XHRcdG5ldyBkZXBzLkRhaWx5Um90YXRlRmlsZSh7XG5cdFx0XHRcdGZpbGVuYW1lOiAnc2VydmVyLSVEQVRFJS5sb2cnLFxuXHRcdFx0XHRkaXJuYW1lOiBsb2dEaXJlY3RvcnksXG5cdFx0XHRcdGRhdGVQYXR0ZXJuOiAnWVlZWS1NTS1ERCcsXG5cdFx0XHRcdHppcHBlZEFyY2hpdmU6IHRydWUsXG5cdFx0XHRcdG1heFNpemU6ICcyMG0nLFxuXHRcdFx0XHRtYXhGaWxlczogJzMwZCcsXG5cdFx0XHRcdGZvcm1hdDogY29tYmluZShcblx0XHRcdFx0XHR0aW1lc3RhbXAoeyBmb3JtYXQ6ICdZWVlZLU1NLUREIEhIOm1tOnNzJyB9KSxcblx0XHRcdFx0XHRsb2dGb3JtYXRcblx0XHRcdFx0KSxcblx0XHRcdFx0bGV2ZWw6IHJlc29sdmVkTG9nTGV2ZWxcblx0XHRcdH0pXG5cdFx0XTtcblxuXHRcdHN1cGVyKHtcblx0XHRcdGxldmVsczogQXBwTG9nZ2VyU2VydmljZS5nZXRDdXN0b21Mb2dMZXZlbHMoKS5sZXZlbHMsXG5cdFx0XHRsZXZlbDogcmVzb2x2ZWRMb2dMZXZlbCxcblx0XHRcdGZvcm1hdDogY29tYmluZShlcnJvcnMoeyBzdGFjazogdHJ1ZSB9KSwganNvbigpKSxcblx0XHRcdGRlZmF1bHRNZXRhOiB7IHNlcnZpY2U6IHJlc29sdmVkU2VydmljZU5hbWUgfSxcblx0XHRcdHRyYW5zcG9ydHM6IGxvZ2dlclRyYW5zcG9ydHNcblx0XHR9KTtcblxuXHRcdHRoaXMuYWRkTG9nc3Rhc2hUcmFuc3BvcnQobG9nZ2VyVHJhbnNwb3J0cyk7XG5cblx0XHR0aGlzLl9kZXBzID0gZGVwcztcblx0XHRhZGRDb2xvcnMoQXBwTG9nZ2VyU2VydmljZS5nZXRDdXN0b21Mb2dMZXZlbHMoKS5jb2xvcnMpO1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBhc3luYyBnZXRJbnN0YW5jZShcblx0XHRkZXBzOiBBcHBMb2dnZXJTZXJ2aWNlRGVwcyxcblx0XHRsb2dMZXZlbD86IHN0cmluZyxcblx0XHRzZXJ2aWNlTmFtZT86IHN0cmluZ1xuXHQpOiBQcm9taXNlPEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2U+IHtcblx0XHRpZiAoIUFwcExvZ2dlclNlcnZpY2UuaW5zdGFuY2UpIHtcblx0XHRcdEFwcExvZ2dlclNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgQXBwTG9nZ2VyU2VydmljZShcblx0XHRcdFx0ZGVwcyxcblx0XHRcdFx0bG9nTGV2ZWwsXG5cdFx0XHRcdHNlcnZpY2VOYW1lXG5cdFx0XHQpO1xuXG5cdFx0XHRhd2FpdCBBcHBMb2dnZXJTZXJ2aWNlLmluc3RhbmNlLmluaXRpYWxpemVBc3luY1BhcnRzKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIEFwcExvZ2dlclNlcnZpY2UuaW5zdGFuY2U7XG5cdH1cblxuXHRwcml2YXRlIGFzeW5jIGluaXRpYWxpemVBc3luY1BhcnRzKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRyeSB7XG5cdFx0XHRhd2FpdCB0aGlzLmFkZExvZ3N0YXNoVHJhbnNwb3J0KHRoaXMudHJhbnNwb3J0cyk7IC8vIEF3YWl0IExvZ3N0YXNoIHNldHVwIGlmIGl0J3MgYXN5bmNcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5sb2dFcnJvcihcblx0XHRcdFx0YEZhaWxlZCB0byBpbml0aWFsaXplIGFzeW5jIHBhcnRzIG9mIGxvZ2dlciAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogZXJyb3J9YFxuXHRcdFx0KTtcblx0XHRcdHRocm93IGVycm9yO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgZ2V0Q3VzdG9tTG9nTGV2ZWxzKCk6IHtcblx0XHRsZXZlbHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG5cdFx0Y29sb3JzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuXHR9IHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0bGV2ZWxzOiB7XG5cdFx0XHRcdGNyaXRpY2FsOiAwLFxuXHRcdFx0XHRlcnJvcjogMSxcblx0XHRcdFx0d2FybjogMixcblx0XHRcdFx0aW5mbzogMyxcblx0XHRcdFx0ZGVidWc6IDQsXG5cdFx0XHRcdG5vdGljZTogNVxuXHRcdFx0fSxcblx0XHRcdGNvbG9yczoge1xuXHRcdFx0XHRjcml0aWNhbDogJ3JlZCcsXG5cdFx0XHRcdGVycm9yOiAnb3JhbmdlJyxcblx0XHRcdFx0d2FybjogJ3llbGxvdycsXG5cdFx0XHRcdGluZm86ICdncmVlbicsXG5cdFx0XHRcdGRlYnVnOiAnYmx1ZScsXG5cdFx0XHRcdG5vdGljZTogJ21hZ2VudGEnXG5cdFx0XHR9XG5cdFx0fTtcblx0fVxuXG5cdHB1YmxpYyBzZXRFcnJvckhhbmRsZXIoZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlKTogdm9pZCB7XG5cdFx0dGhpcy5lcnJvckhhbmRsZXIgPSBlcnJvckhhbmRsZXI7XG5cdH1cblxuXHRwdWJsaWMgc2V0VXBTZWNyZXRzKHNlY3JldHM6IFZhdWx0U2VydmljZUludGVyZmFjZSk6IHZvaWQge1xuXHRcdHRoaXMuc2VjcmV0cyA9IHNlY3JldHM7XG5cdFx0dGhpcy5zZXR1cFJlZGFjdGVkTG9nZ2VyKCk7XG5cdFx0Y29uc29sZS5pbmZvKCdWYXVsdCBTZXJ2aWNlIGluamVjdGVkIGFuZCByZWRhY3RlZCBsb2dnZXIgc2V0dXAuJyk7XG5cdH1cblxuXHRwcml2YXRlIHNldHVwUmVkYWN0ZWRMb2dnZXIoKTogdm9pZCB7XG5cdFx0aWYgKHRoaXMucmVkYWN0ZWRMb2dnZXIgfHwgIXRoaXMuc2VjcmV0cylcblx0XHRcdHRoaXMucmVkYWN0ZWRMb2dnZXIgPSB0aGlzLmNyZWF0ZVJlZGFjdGVkTG9nZ2VyKCk7XG5cdFx0dGhpcy5sb2dJbmZvKCdSZWRhY3RlZCBsb2dnZXIgaW5pdGlhbGl6ZWQuJyk7XG5cdH1cblxuXHRwcml2YXRlIGNyZWF0ZVJlZGFjdGVkTG9nZ2VyKCk6IEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2Uge1xuXHRcdGNvbnN0IHJlZGFjdGVkTG9nZ2VyOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlID0gT2JqZWN0LmNyZWF0ZSh0aGlzKTtcblxuXHRcdGNvbnN0IGxldmVsczogKFxuXHRcdFx0fCAnZGVidWcnXG5cdFx0XHR8ICdpbmZvJ1xuXHRcdFx0fCAnbm90aWNlJ1xuXHRcdFx0fCAnd2Fybidcblx0XHRcdHwgJ2Vycm9yJ1xuXHRcdFx0fCAnY3JpdCdcblx0XHQpW10gPSBbJ2RlYnVnJywgJ2luZm8nLCAnbm90aWNlJywgJ3dhcm4nLCAnZXJyb3InLCAnY3JpdCddO1xuXG5cdFx0bGV2ZWxzLmZvckVhY2gobGV2ZWwgPT4ge1xuXHRcdFx0Y29uc3Qgb3JpZ2luYWxNZXRob2QgPSB0aGlzW2xldmVsXS5iaW5kKHRoaXMpO1xuXG5cdFx0XHRyZWRhY3RlZExvZ2dlcltsZXZlbF0gPSAoKFxuXHRcdFx0XHRtZXNzYWdlOiBzdHJpbmcsXG5cdFx0XHRcdG1ldGE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB8IHN0cmluZ1xuXHRcdFx0KTogdm9pZCA9PiB7XG5cdFx0XHRcdGNvbnN0IHJlZGFjdGVkTWV0YSA9XG5cdFx0XHRcdFx0dHlwZW9mIG1ldGEgPT09ICdvYmplY3QnXG5cdFx0XHRcdFx0XHQ/IHRoaXMuc2VjcmV0cz8ucmVkYWN0U2VjcmV0cyhtZXRhKVxuXHRcdFx0XHRcdFx0OiBtZXRhO1xuXHRcdFx0XHRvcmlnaW5hbE1ldGhvZChtZXNzYWdlLCByZWRhY3RlZE1ldGEpO1xuXHRcdFx0fSkgYXMgdHlwZW9mIG9yaWdpbmFsTWV0aG9kO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIE9iamVjdC5hc3NpZ24ocmVkYWN0ZWRMb2dnZXIsIHtcblx0XHRcdGdldFJlZGFjdGVkTG9nZ2VyOiB0aGlzLmdldFJlZGFjdGVkTG9nZ2VyLmJpbmQodGhpcylcblx0XHR9KSBhcyBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlO1xuXHR9XG5cblx0cHVibGljIGdldExvZ2dlcigpOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlIHtcblx0XHRyZXR1cm4gdGhpcy5yZWRhY3RlZExvZ2dlciA/IHRoaXMucmVkYWN0ZWRMb2dnZXIgOiB0aGlzO1xuXHR9XG5cblx0cHVibGljIGdldFJlZGFjdGVkTG9nZ2VyKCk6IEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2Uge1xuXHRcdHJldHVybiB0aGlzLmNyZWF0ZVJlZGFjdGVkTG9nZ2VyKCk7XG5cdH1cblxuXHRwcml2YXRlIGFzeW5jIGFkZExvZ3N0YXNoVHJhbnNwb3J0KFxuXHRcdHRyYW5zcG9ydHNBcnJheTogVHJhbnNwb3J0U3RyZWFtW11cblx0KTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGxvZ1N0YXNoVHJhbnNwb3J0ID0gYXdhaXQgdGhpcy5jcmVhdGVMb2dzdGFzaFRyYW5zcG9ydCgpO1xuXHRcdFx0aWYgKGxvZ1N0YXNoVHJhbnNwb3J0KSB7XG5cdFx0XHRcdHRyYW5zcG9ydHNBcnJheS5wdXNoKGxvZ1N0YXNoVHJhbnNwb3J0KTtcblx0XHRcdH1cblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5sb2dFcnJvcihcblx0XHRcdFx0YEVycm9yIGFkZGluZyBMb2dzdGFzaCB0cmFuc3BvcnQgJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IGVycm9yfWBcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBhc3luYyBjcmVhdGVMb2dzdGFzaFRyYW5zcG9ydCgpOiBQcm9taXNlPFRyYW5zcG9ydFN0cmVhbSB8IG51bGw+IHtcblx0XHR0cnkge1xuXHRcdFx0cmV0dXJuIG5ldyB0aGlzLl9kZXBzLkxvZ1N0YXNoVHJhbnNwb3J0KHtcblx0XHRcdFx0cG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuTE9HU1RBU0hfUE9SVCEsIDEwKSxcblx0XHRcdFx0bm9kZV9uYW1lOiBwcm9jZXNzLmVudi5MT0dTVEFTSF9OT0RFISxcblx0XHRcdFx0aG9zdDogcHJvY2Vzcy5lbnYuTE9HU1RBU0hfSE9TVCFcblx0XHRcdH0pIGFzIHVua25vd24gYXMgVHJhbnNwb3J0U3RyZWFtO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRjb25zdCBsb2dzdGFzaEVycm9yID1cblx0XHRcdFx0bmV3IHRoaXMuX2RlcHMuRXJyb3JDbGFzc2VzLlNlcnZpY2VVbmF2YWlsYWJsZUVycm9yKFxuXHRcdFx0XHRcdDYwLFxuXHRcdFx0XHRcdCdBcHBsaWNhdGlvbiBMb2dnZXIgU2VydmljZScsXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0bWVzc2FnZTpcblx0XHRcdFx0XHRcdFx0J0xvZ2dlciBTZXJ2aWNlIEVycm9yOiBGYWlsZWQgdG8gY3JlYXRlIExvZ3N0YXNoIHRyYW5zcG9ydCdcblx0XHRcdFx0XHR9XG5cdFx0XHRcdCk7XG5cdFx0XHR0aGlzLmxvZ0Vycm9yKFxuXHRcdFx0XHRgTG9nc3Rhc2ggZXJyb3I6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBlcnJvcn1gXG5cdFx0XHQpO1xuXHRcdFx0aWYgKHRoaXMuZXJyb3JIYW5kbGVyKSB7XG5cdFx0XHRcdHRoaXMuZXJyb3JIYW5kbGVyLmhhbmRsZUVycm9yKHtcblx0XHRcdFx0XHQuLi50aGlzLl9kZXBzLkhhbmRsZUVycm9yU3RhdGljUGFyYW1ldGVycyxcblx0XHRcdFx0XHRlcnJvcjogbG9nc3Rhc2hFcnJvcixcblx0XHRcdFx0XHRkZXRhaWxzOiB7IHJlYXNvbjogJ0ZhaWxlZCB0byBjcmVhdGUgTG9nc3Rhc2ggdHJhbnNwb3J0JyB9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGxvZ0RlYnVnKG1lc3NhZ2U6IHN0cmluZywgZGV0YWlscz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+KTogdm9pZCB7XG5cdFx0dGhpcy5kZWJ1ZyhtZXNzYWdlLCBkZXRhaWxzKTtcblx0fVxuXG5cdHB1YmxpYyBsb2dJbmZvKG1lc3NhZ2U6IHN0cmluZywgZGV0YWlscz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+KTogdm9pZCB7XG5cdFx0dGhpcy5pbmZvKG1lc3NhZ2UsIGRldGFpbHMpO1xuXHR9XG5cblx0cHVibGljIGxvZ05vdGljZShtZXNzYWdlOiBzdHJpbmcsIGRldGFpbHM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IHZvaWQge1xuXHRcdHRoaXMubm90aWNlKG1lc3NhZ2UsIGRldGFpbHMpO1xuXHR9XG5cblx0cHVibGljIGxvZ1dhcm4obWVzc2FnZTogc3RyaW5nLCBkZXRhaWxzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiB2b2lkIHtcblx0XHR0aGlzLndhcm4obWVzc2FnZSwgZGV0YWlscyk7XG5cdH1cblxuXHRwdWJsaWMgbG9nRXJyb3IobWVzc2FnZTogc3RyaW5nLCBkZXRhaWxzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiB2b2lkIHtcblx0XHR0aGlzLmVycm9yKG1lc3NhZ2UsIGRldGFpbHMpO1xuXHR9XG5cblx0cHVibGljIGxvZ0NyaXRpY2FsKFxuXHRcdG1lc3NhZ2U6IHN0cmluZyxcblx0XHRkZXRhaWxzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cblx0KTogdm9pZCB7XG5cdFx0dGhpcy5jcml0KG1lc3NhZ2UsIGRldGFpbHMpO1xuXHR9XG5cblx0cHVibGljIGFzeW5jIGNsZWFuVXBPbGRMb2dzKFxuXHRcdHNlcXVlbGl6ZTogaW1wb3J0KCdzZXF1ZWxpemUnKS5TZXF1ZWxpemUsXG5cdFx0cmV0ZW50aW9uUGVyaW9kRGF5czogbnVtYmVyID0gMzBcblx0KTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0Y29uc3QgcmV0ZW50aW9uRGF0ZSA9IG5ldyBEYXRlKCk7XG5cdFx0cmV0ZW50aW9uRGF0ZS5zZXREYXRlKHJldGVudGlvbkRhdGUuZ2V0RGF0ZSgpIC0gcmV0ZW50aW9uUGVyaW9kRGF5cyk7XG5cblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgRXJyb3JMb2cgPSBzZXF1ZWxpemUubW9kZWwoJ0Vycm9yTG9nJyk7XG5cdFx0XHRhd2FpdCBFcnJvckxvZy5kZXN0cm95KHtcblx0XHRcdFx0d2hlcmU6IHtcblx0XHRcdFx0XHR0aW1lc3RhbXA6IHtcblx0XHRcdFx0XHRcdFtPcC5sdF06IHJldGVudGlvbkRhdGVcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5pbmZvKFxuXHRcdFx0XHRgT2xkIGxvZ3Mgb2xkZXIgdGhhbiAke3JldGVudGlvblBlcmlvZERheXN9IGRheXMgaGF2ZSBiZWVuIGRlbGV0ZWQuYFxuXHRcdFx0KTtcblx0XHR9IGNhdGNoIChjbGVhbnVwRXJyb3IpIHtcblx0XHRcdHRoaXMuZXJyb3IoJ0ZhaWxlZCB0byBjbGVhbiB1cCBvbGQgbG9ncycsIGNsZWFudXBFcnJvcik7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIHNldEFkbWluSWQoYWRtaW5JZDogbnVtYmVyKTogdm9pZCB7XG5cdFx0dGhpcy5hZG1pbklkID0gYWRtaW5JZDtcblx0fVxuXG5cdHB1YmxpYyBnZXRFcnJvckRldGFpbHMoXG5cdFx0Z2V0Q2FsbGVySW5mbzogKCkgPT4gc3RyaW5nLFxuXHRcdGFjdGlvbjogc3RyaW5nID0gJ3Vua25vd24nLFxuXHRcdHJlcT86IFJlcXVlc3QsXG5cdFx0dXNlcklkPzogc3RyaW5nIHwgbnVsbCxcblx0XHRhZGRpdGlvbmFsRGF0YT86IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG5cdCk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHtcblx0XHRjb25zdCBkZXRhaWxzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcblx0XHRcdHJlcXVlc3RJZDogcmVxPy5oZWFkZXJzWyd4LXJlcXVlc3QtaWQnXSB8fCB0aGlzLl9kZXBzLnV1aWR2NCgpLFxuXHRcdFx0YWRtaW5JZDogdGhpcy5hZG1pbklkIHx8ICdVbmtub3duIEFkbWluJyxcblx0XHRcdHVzZXJJZDogdXNlcklkIHx8IG51bGwsXG5cdFx0XHRhY3Rpb246IGFjdGlvbiB8fCAndW5rbm93bicsXG5cdFx0XHRjYWxsZXI6IFN0cmluZyhnZXRDYWxsZXJJbmZvKCkpLFxuXHRcdFx0dGltZXN0YW1wOiBEYXRlLm5vdygpLFxuXHRcdFx0cmVxdWVzdEluZm86IHtcblx0XHRcdFx0bWV0aG9kOiByZXE/Lm1ldGhvZCB8fCBudWxsLFxuXHRcdFx0XHR1cmw6IHJlcT8ub3JpZ2luYWxVcmwgfHwgcmVxPy51cmwgfHwgbnVsbCxcblx0XHRcdFx0aXA6XG5cdFx0XHRcdFx0cmVxPy5pcCB8fFxuXHRcdFx0XHRcdHJlcT8uaGVhZGVyc1sneC1mb3J3YXJkZWQtZm9yJ10gfHxcblx0XHRcdFx0XHRyZXE/LnNvY2tldC5yZW1vdGVBZGRyZXNzIHx8XG5cdFx0XHRcdFx0bnVsbCxcblx0XHRcdFx0dXNlckFnZW50OiByZXE/LmhlYWRlcnNbJ3VzZXItYWdlbnQnXSB8fCBudWxsLFxuXHRcdFx0XHRyZWZlcnJlcjpcblx0XHRcdFx0XHRyZXE/LmhlYWRlcnNbJ3JlZmVyZXInXSB8fCByZXE/LmhlYWRlcnNbJ3JlZmVycmVyJ10gfHwgbnVsbCxcblx0XHRcdFx0cXVlcnk6IHJlcT8ucXVlcnkgfHwgbnVsbCxcblx0XHRcdFx0cGFyYW1zOiByZXE/LnBhcmFtcyB8fCBudWxsLFxuXHRcdFx0XHRib2R5OiByZXE/LmJvZHkgPyB0aGlzLnNhbml0aXplUmVxdWVzdEJvZHkocmVxPy5ib2R5KSA6IG51bGxcblx0XHRcdH0sXG5cdFx0XHQuLi5hZGRpdGlvbmFsRGF0YVxuXHRcdH07XG5cblx0XHRyZXR1cm4gZGV0YWlscztcblx0fVxuXG5cdHByb3RlY3RlZCBnZXQgX19kZXBzKCk6IEFwcExvZ2dlclNlcnZpY2VEZXBzIHtcblx0XHRyZXR1cm4gdGhpcy5fZGVwcztcblx0fVxuXG5cdHByaXZhdGUgc2FuaXRpemVSZXF1ZXN0Qm9keShcblx0XHRib2R5OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuXHQpOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB7XG5cdFx0Y29uc3Qgc2FuaXRpemVkQm9keSA9IG5ldyBNYXAoT2JqZWN0LmVudHJpZXMoYm9keSkpO1xuXHRcdGNvbnN0IHNlbnNpdGl2ZUZpZWxkcyA9IFtcblx0XHRcdCdlbWFpbCcsXG5cdFx0XHQna2V5Jyxcblx0XHRcdCduZXdQYXNzd29yZCcsXG5cdFx0XHQnb2xkUGFzc3dvcmQnLFxuXHRcdFx0J3Bhc3NwaHJhc2UnLFxuXHRcdFx0J3Bhc3N3b3JkJyxcblx0XHRcdCdzZWNyZXQnLFxuXHRcdFx0J3Rva2VuJyxcblx0XHRcdCd1c2VybmFtZSdcblx0XHRdO1xuXG5cdFx0c2Vuc2l0aXZlRmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xuXHRcdFx0aWYgKHNhbml0aXplZEJvZHkuaGFzKGZpZWxkKSkge1xuXHRcdFx0XHRzYW5pdGl6ZWRCb2R5LnNldChmaWVsZCwgJ1tSRURBQ1RFRF0nKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoc2FuaXRpemVkQm9keSk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgc2h1dGRvd24oKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dGhpcy5pbmZvKCdTaHV0dGluZyBkb3duIGxvZ2dlciBzZXJ2aWNlcy4uLicpO1xuXG5cdFx0YXdhaXQgbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdFx0dGhpcy5vbignZmluaXNoJywgKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmluZm8oJ0FsbCBsb2dzIGhhdmUgYmVlbiBmbHVzaGVkLicpO1xuXHRcdFx0XHRyZXNvbHZlKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5vbignZXJyb3InLCBlcnJvciA9PiB7XG5cdFx0XHRcdHRoaXMuZXJyb3IoXG5cdFx0XHRcdFx0YEVycm9yIHdoaWxlIHNodXR0aW5nIGRvd24gbG9nZ2VyOiAke2Vycm9yLm1lc3NhZ2V9YFxuXHRcdFx0XHQpO1xuXHRcdFx0XHRyZWplY3QoZXJyb3IpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuZW5kKCk7XG5cdFx0fSk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgaGFuZGxlRXJyb3IobWVzc2FnZTogc3RyaW5nLCBlcnJvcjogRXJyb3IpOiB2b2lkIHtcblx0XHRpZiAodGhpcy5lcnJvckhhbmRsZXIpIHtcblx0XHRcdHRoaXMuZXJyb3JIYW5kbGVyLmhhbmRsZUVycm9yKHtcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdGRldGFpbHM6IHsgbWVzc2FnZSB9XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5sb2dFcnJvcihgRXJyb3IgSGFuZGxlciBub3Qgc2V0LiBFcnJvcjogJHttZXNzYWdlfWApO1xuXHRcdH1cblx0fVxufVxuXG5leHBvcnQgY2xhc3MgRXJyb3JMb2dnZXJTZXJ2aWNlXG5cdGV4dGVuZHMgQXBwTG9nZ2VyU2VydmljZVxuXHRpbXBsZW1lbnRzIEVycm9yTG9nZ2VyU2VydmljZUludGVyZmFjZVxue1xuXHRwdWJsaWMgc3RhdGljIG92ZXJyaWRlIGluc3RhbmNlOiBFcnJvckxvZ2dlclNlcnZpY2U7XG5cdHByaXZhdGUgZXJyb3JDb3VudHM6IE1hcDxzdHJpbmcsIG51bWJlcj47XG5cblx0Y29uc3RydWN0b3IoXG5cdFx0ZGVwczogQXBwTG9nZ2VyU2VydmljZURlcHMsXG5cdFx0bG9nTGV2ZWw/OiBzdHJpbmcsXG5cdFx0c2VydmljZU5hbWU/OiBzdHJpbmdcblx0KSB7XG5cdFx0c3VwZXIoZGVwcywgbG9nTGV2ZWwsIHNlcnZpY2VOYW1lKTtcblx0XHR0aGlzLmVycm9yQ291bnRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgb3ZlcnJpZGUgYXN5bmMgZ2V0SW5zdGFuY2UoXG5cdFx0ZGVwczogQXBwTG9nZ2VyU2VydmljZURlcHMsXG5cdFx0bG9nTGV2ZWw/OiBzdHJpbmcsXG5cdFx0c2VydmljZU5hbWU/OiBzdHJpbmdcblx0KTogUHJvbWlzZTxFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2U+IHtcblx0XHRpZiAoIUVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZSkge1xuXHRcdFx0RXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlID0gbmV3IEVycm9yTG9nZ2VyU2VydmljZShcblx0XHRcdFx0ZGVwcyxcblx0XHRcdFx0bG9nTGV2ZWwsXG5cdFx0XHRcdHNlcnZpY2VOYW1lXG5cdFx0XHQpO1xuXHRcdH1cblx0XHRyZXR1cm4gT2JqZWN0LmFzc2lnbihFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2UsIHtcblx0XHRcdGxvZ0FwcEVycm9yOiBFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2UubG9nQXBwRXJyb3IuYmluZChcblx0XHRcdFx0RXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlXG5cdFx0XHQpLFxuXHRcdFx0Z2V0RXJyb3JDb3VudDogRXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlLmdldEVycm9yQ291bnQuYmluZChcblx0XHRcdFx0RXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlXG5cdFx0XHQpLFxuXHRcdFx0Z2V0UmVkYWN0ZWRMb2dnZXI6XG5cdFx0XHRcdEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZS5nZXRSZWRhY3RlZExvZ2dlci5iaW5kKFxuXHRcdFx0XHRcdEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZVxuXHRcdFx0XHQpLFxuXHRcdFx0bG9nRGVidWc6IEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZS5sb2dEZWJ1Zy5iaW5kKFxuXHRcdFx0XHRFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2Vcblx0XHRcdCksXG5cdFx0XHRsb2dJbmZvOiBFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2UubG9nSW5mby5iaW5kKFxuXHRcdFx0XHRFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2Vcblx0XHRcdCksXG5cdFx0XHRsb2dOb3RpY2U6IEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZS5sb2dOb3RpY2UuYmluZChcblx0XHRcdFx0RXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlXG5cdFx0XHQpLFxuXHRcdFx0bG9nV2FybjogRXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlLmxvZ1dhcm4uYmluZChcblx0XHRcdFx0RXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlXG5cdFx0XHQpLFxuXHRcdFx0bG9nRXJyb3I6IEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZS5sb2dFcnJvci5iaW5kKFxuXHRcdFx0XHRFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2Vcblx0XHRcdCksXG5cdFx0XHRsb2dDcml0aWNhbDogRXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlLmxvZ0NyaXRpY2FsLmJpbmQoXG5cdFx0XHRcdEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZVxuXHRcdFx0KSxcblx0XHRcdGNsZWFuVXBPbGRMb2dzOiBFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2UuY2xlYW5VcE9sZExvZ3MuYmluZChcblx0XHRcdFx0RXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlXG5cdFx0XHQpLFxuXHRcdFx0Z2V0RXJyb3JEZXRhaWxzOiBFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2UuZ2V0RXJyb3JEZXRhaWxzLmJpbmQoXG5cdFx0XHRcdEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZVxuXHRcdFx0KVxuXHRcdH0pIGFzIEVycm9yTG9nZ2VyU2VydmljZUludGVyZmFjZTtcblx0fVxuXG5cdHB1YmxpYyBsb2dBcHBFcnJvcihcblx0XHRlcnJvcjogaW1wb3J0KCcuLi9lcnJvcnMvRXJyb3JDbGFzc2VzJykuQXBwRXJyb3IsXG5cdFx0c2VxdWVsaXplPzogaW1wb3J0KCdzZXF1ZWxpemUnKS5TZXF1ZWxpemUsXG5cdFx0ZGV0YWlsczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fVxuXHQpOiB2b2lkIHtcblx0XHRpZiAoc2VxdWVsaXplKSB7XG5cdFx0XHR0aGlzLmxvZ1RvRGF0YWJhc2UoZXJyb3IsIHNlcXVlbGl6ZSkuY2F0Y2goZGF0YWJhc2VFcnJvciA9PiB7XG5cdFx0XHRcdHRoaXMud2Fybihcblx0XHRcdFx0XHRgQ291bGQgbm90IGxvZyBlcnJvciB0byBkYXRhYmFzZTogJHtkYXRhYmFzZUVycm9yLm1lc3NhZ2UgfHwgZGF0YWJhc2VFcnJvcn1gXG5cdFx0XHRcdCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5sb2dXYXJuKFxuXHRcdFx0XHQnU2VxdWVsaXplIGluc3RhbmNlIG5vdCBwcm92aWRlZCBmb3IgbG9nZ2luZyBlcnJvciB0byBkYXRhYmFzZSdcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgZXJyb3JDb3VudCA9IHRoaXMuZXJyb3JDb3VudHMuZ2V0KGVycm9yLm5hbWUpIHx8IDA7XG5cdFx0dGhpcy5lcnJvckNvdW50cy5zZXQoZXJyb3IubmFtZSwgZXJyb3JDb3VudCArIDEpO1xuXG5cdFx0aWYgKHRoaXMuZXJyb3JIYW5kbGVyKSB7XG5cdFx0XHRpZiAoZXJyb3Iuc2V2ZXJpdHkgPT09IHRoaXMuZXJyb3JIYW5kbGVyLkVycm9yU2V2ZXJpdHkuRkFUQUwpIHtcblx0XHRcdFx0dGhpcy5sb2dFcnJvcihgRkFUQUw6ICR7ZXJyb3IubWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0Li4uZGV0YWlscyxcblx0XHRcdFx0XHRzZXZlcml0eTogZXJyb3Iuc2V2ZXJpdHlcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2UgaWYgKFxuXHRcdFx0XHRlcnJvci5zZXZlcml0eSA9PT0gdGhpcy5lcnJvckhhbmRsZXIuRXJyb3JTZXZlcml0eS5SRUNPVkVSQUJMRVxuXHRcdFx0KSB7XG5cdFx0XHRcdHRoaXMubG9nV2FybihgUkVDT1ZFUkFCTEU6ICR7ZXJyb3IubWVzc2FnZX1gLCB7IC4uLmRldGFpbHMgfSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuaGFuZGxlRXJyb3IoJ0Vycm9yIEhhbmRsZXIgbm90IHNldCcsIGVycm9yKTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgbG9nVG9EYXRhYmFzZShcblx0XHRlcnJvcjogaW1wb3J0KCcuLi9lcnJvcnMvRXJyb3JDbGFzc2VzJykuQXBwRXJyb3IsXG5cdFx0c2VxdWVsaXplOiBpbXBvcnQoJ3NlcXVlbGl6ZScpLlNlcXVlbGl6ZSxcblx0XHRyZXRyeUNvdW50OiBudW1iZXIgPSAzXG5cdCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBFcnJvckxvZyA9IHNlcXVlbGl6ZS5tb2RlbCgnRXJyb3JMb2cnKTtcblx0XHRcdGF3YWl0IEVycm9yTG9nLmNyZWF0ZSh7XG5cdFx0XHRcdG5hbWU6IGVycm9yLm5hbWUsXG5cdFx0XHRcdG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG5cdFx0XHRcdHN0YXR1c0NvZGU6IGVycm9yLnN0YXR1c0NvZGUsXG5cdFx0XHRcdHNldmVyaXR5OiBlcnJvci5zZXZlcml0eSxcblx0XHRcdFx0dGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuXHRcdFx0XHRjb3VudDogdGhpcy5lcnJvckNvdW50cy5nZXQoZXJyb3IubmFtZSkgfHwgMVxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLmluZm8oJ0Vycm9yIGxvZ2dlZCB0byBkYXRhYmFzZScpO1xuXHRcdH0gY2F0Y2ggKGRhdGFiYXNlRXJyb3IpIHtcblx0XHRcdHRoaXMuZXJyb3IoYEZhaWxlZCB0byBsb2cgZXJyb3IgdG8gdGhlIGRhdGFiYXNlOiAke2RhdGFiYXNlRXJyb3J9YCk7XG5cdFx0XHRpZiAocmV0cnlDb3VudCA+IDApIHtcblx0XHRcdFx0c2V0VGltZW91dChcblx0XHRcdFx0XHQoKSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLmxvZ1RvRGF0YWJhc2UoZXJyb3IsIHNlcXVlbGl6ZSwgcmV0cnlDb3VudCAtIDEpO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0MTAwMCAqICg0IC0gcmV0cnlDb3VudClcblx0XHRcdFx0KTtcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgZ2V0RXJyb3JDb3VudChlcnJvck5hbWU6IHN0cmluZyk6IG51bWJlciB7XG5cdFx0cmV0dXJuIHRoaXMuZXJyb3JDb3VudHMuZ2V0KGVycm9yTmFtZSkgfHwgMDtcblx0fVxufVxuIl19
