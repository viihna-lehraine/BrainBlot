import { Op } from 'sequelize';
import { Logger as WinstonLogger } from 'winston';
export class AppLoggerService extends WinstonLogger {
	static instance = null;
	_deps;
	adminId = null;
	redactedLogger = null;
	errorHandler = null;
	secrets = null;
	constructor(deps, logLevel, serviceName) {
		const { format, transports, addColors } = deps.winston;
		const { colorize, combine, errors, json, printf, timestamp } = format;
		const resolvedLogLevel = logLevel || process.env.LOG_LEVEL || 'info';
		const resolvedServiceName =
			serviceName || process.env.LOGGER_SERVICE_NAME || 'Log Service';
		const isProduction = process.env.NODE_ENV === 'production';
		const logDirectory = './data/logs/server/main/';
		const logFormat = printf(({ level, message, timestamp, stack }) => {
			return `${timestamp} ${level}: ${stack || message}`;
		});
		if (!deps.fs.existsSync(logDirectory)) {
			deps.fs.mkdirSync(logDirectory, { recursive: true });
		}
		const loggerTransports = [
			new transports.Console({
				format: combine(colorize(), logFormat),
				level: isProduction ? 'info' : resolvedLogLevel
			}),
			new deps.DailyRotateFile({
				filename: 'server-%DATE%.log',
				dirname: logDirectory,
				datePattern: 'YYYY-MM-DD',
				zippedArchive: true,
				maxSize: '20m',
				maxFiles: '30d',
				format: combine(
					timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),
					logFormat
				),
				level: resolvedLogLevel
			})
		];
		super({
			levels: AppLoggerService.getCustomLogLevels().levels,
			level: resolvedLogLevel,
			format: combine(errors({ stack: true }), json()),
			defaultMeta: { service: resolvedServiceName },
			transports: loggerTransports
		});
		this.addLogstashTransport(loggerTransports);
		this._deps = deps;
		addColors(AppLoggerService.getCustomLogLevels().colors);
	}
	static async getInstance(deps, logLevel, serviceName) {
		if (!AppLoggerService.instance) {
			AppLoggerService.instance = new AppLoggerService(
				deps,
				logLevel,
				serviceName
			);
			await AppLoggerService.instance.initializeAsyncParts();
		}
		return AppLoggerService.instance;
	}
	async initializeAsyncParts() {
		try {
			await this.addLogstashTransport(this.transports); // Await Logstash setup if it's async
		} catch (error) {
			this.logError(
				`Failed to initialize async parts of logger ${error instanceof Error ? error.message : error}`
			);
			throw error;
		}
	}
	static getCustomLogLevels() {
		return {
			levels: {
				critical: 0,
				error: 1,
				warn: 2,
				info: 3,
				debug: 4,
				notice: 5
			},
			colors: {
				critical: 'red',
				error: 'orange',
				warn: 'yellow',
				info: 'green',
				debug: 'blue',
				notice: 'magenta'
			}
		};
	}
	setErrorHandler(errorHandler) {
		this.errorHandler = errorHandler;
	}
	setUpSecrets(secrets) {
		this.secrets = secrets;
		this.setupRedactedLogger();
		console.info('Vault Service injected and redacted logger setup.');
	}
	setupRedactedLogger() {
		if (this.redactedLogger || !this.secrets)
			this.redactedLogger = this.createRedactedLogger();
		this.logInfo('Redacted logger initialized.');
	}
	createRedactedLogger() {
		const redactedLogger = Object.create(this);
		const levels = ['debug', 'info', 'notice', 'warn', 'error', 'crit'];
		levels.forEach(level => {
			const originalMethod = this[level].bind(this);
			redactedLogger[level] = (message, meta) => {
				const redactedMeta =
					typeof meta === 'object'
						? this.secrets?.redactSecrets(meta)
						: meta;
				originalMethod(message, redactedMeta);
			};
		});
		return Object.assign(redactedLogger, {
			getRedactedLogger: this.getRedactedLogger.bind(this)
		});
	}
	getLogger() {
		return this.redactedLogger ? this.redactedLogger : this;
	}
	getRedactedLogger() {
		return this.createRedactedLogger();
	}
	async addLogstashTransport(transportsArray) {
		try {
			const logStashTransport = await this.createLogstashTransport();
			if (logStashTransport) {
				transportsArray.push(logStashTransport);
			}
		} catch (error) {
			this.logError(
				`Error adding Logstash transport ${error instanceof Error ? error.message : error}`
			);
		}
	}
	async createLogstashTransport() {
		try {
			return new this._deps.LogStashTransport({
				port: parseInt(process.env.LOGSTASH_PORT, 10),
				node_name: process.env.LOGSTASH_NODE,
				host: process.env.LOGSTASH_HOST
			});
		} catch (error) {
			const logstashError =
				new this._deps.ErrorClasses.ServiceUnavailableError(
					60,
					'Application Logger Service',
					{
						message:
							'Logger Service Error: Failed to create Logstash transport'
					}
				);
			this.logError(
				`Logstash error: ${error instanceof Error ? error.message : error}`
			);
			if (this.errorHandler) {
				this.errorHandler.handleError({
					...this._deps.HandleErrorStaticParameters,
					error: logstashError,
					details: { reason: 'Failed to create Logstash transport' }
				});
			}
			return null;
		}
	}
	logDebug(message, details) {
		this.debug(message, details);
	}
	logInfo(message, details) {
		this.info(message, details);
	}
	logNotice(message, details) {
		this.notice(message, details);
	}
	logWarn(message, details) {
		this.warn(message, details);
	}
	logError(message, details) {
		this.error(message, details);
	}
	logCritical(message, details) {
		this.crit(message, details);
	}
	async cleanUpOldLogs(sequelize, retentionPeriodDays = 30) {
		const retentionDate = new Date();
		retentionDate.setDate(retentionDate.getDate() - retentionPeriodDays);
		try {
			const ErrorLog = sequelize.model('ErrorLog');
			await ErrorLog.destroy({
				where: {
					timestamp: {
						[Op.lt]: retentionDate
					}
				}
			});
			this.info(
				`Old logs older than ${retentionPeriodDays} days have been deleted.`
			);
		} catch (cleanupError) {
			this.error('Failed to clean up old logs', cleanupError);
		}
	}
	setAdminId(adminId) {
		this.adminId = adminId;
	}
	getErrorDetails(
		getCallerInfo,
		action = 'unknown',
		req,
		userId,
		additionalData
	) {
		const details = {
			requestId: req?.headers['x-request-id'] || this._deps.uuidv4(),
			adminId: this.adminId || 'Unknown Admin',
			userId: userId || null,
			action: action || 'unknown',
			caller: String(getCallerInfo()),
			timestamp: Date.now(),
			requestInfo: {
				method: req?.method || null,
				url: req?.originalUrl || req?.url || null,
				ip:
					req?.ip ||
					req?.headers['x-forwarded-for'] ||
					req?.socket.remoteAddress ||
					null,
				userAgent: req?.headers['user-agent'] || null,
				referrer:
					req?.headers['referer'] || req?.headers['referrer'] || null,
				query: req?.query || null,
				params: req?.params || null,
				body: req?.body ? this.sanitizeRequestBody(req?.body) : null
			},
			...additionalData
		};
		return details;
	}
	get __deps() {
		return this._deps;
	}
	sanitizeRequestBody(body) {
		const sanitizedBody = new Map(Object.entries(body));
		const sensitiveFields = [
			'email',
			'key',
			'newPassword',
			'oldPassword',
			'passphrase',
			'password',
			'secret',
			'token',
			'username'
		];
		sensitiveFields.forEach(field => {
			if (sanitizedBody.has(field)) {
				sanitizedBody.set(field, '[REDACTED]');
			}
		});
		return Object.fromEntries(sanitizedBody);
	}
	async shutdown() {
		this.info('Shutting down logger services...');
		await new Promise((resolve, reject) => {
			this.on('finish', () => {
				this.info('All logs have been flushed.');
				resolve();
			});
			this.on('error', error => {
				this.error(
					`Error while shutting down logger: ${error.message}`
				);
				reject(error);
			});
			this.end();
		});
	}
	handleError(message, error) {
		if (this.errorHandler) {
			this.errorHandler.handleError({
				error,
				details: { message }
			});
		} else {
			this.logError(`Error Handler not set. Error: ${message}`);
		}
	}
}
export class ErrorLoggerService extends AppLoggerService {
	static instance;
	errorCounts;
	constructor(deps, logLevel, serviceName) {
		super(deps, logLevel, serviceName);
		this.errorCounts = new Map();
	}
	static async getInstance(deps, logLevel, serviceName) {
		if (!ErrorLoggerService.instance) {
			ErrorLoggerService.instance = new ErrorLoggerService(
				deps,
				logLevel,
				serviceName
			);
		}
		return Object.assign(ErrorLoggerService.instance, {
			logAppError: ErrorLoggerService.instance.logAppError.bind(
				ErrorLoggerService.instance
			),
			getErrorCount: ErrorLoggerService.instance.getErrorCount.bind(
				ErrorLoggerService.instance
			),
			getRedactedLogger:
				ErrorLoggerService.instance.getRedactedLogger.bind(
					ErrorLoggerService.instance
				),
			logDebug: ErrorLoggerService.instance.logDebug.bind(
				ErrorLoggerService.instance
			),
			logInfo: ErrorLoggerService.instance.logInfo.bind(
				ErrorLoggerService.instance
			),
			logNotice: ErrorLoggerService.instance.logNotice.bind(
				ErrorLoggerService.instance
			),
			logWarn: ErrorLoggerService.instance.logWarn.bind(
				ErrorLoggerService.instance
			),
			logError: ErrorLoggerService.instance.logError.bind(
				ErrorLoggerService.instance
			),
			logCritical: ErrorLoggerService.instance.logCritical.bind(
				ErrorLoggerService.instance
			),
			cleanUpOldLogs: ErrorLoggerService.instance.cleanUpOldLogs.bind(
				ErrorLoggerService.instance
			),
			getErrorDetails: ErrorLoggerService.instance.getErrorDetails.bind(
				ErrorLoggerService.instance
			)
		});
	}
	logAppError(error, sequelize, details = {}) {
		if (sequelize) {
			this.logToDatabase(error, sequelize).catch(databaseError => {
				this.warn(
					`Could not log error to database: ${databaseError.message || databaseError}`
				);
			});
		} else {
			this.logWarn(
				'Sequelize instance not provided for logging error to database'
			);
		}
		const errorCount = this.errorCounts.get(error.name) || 0;
		this.errorCounts.set(error.name, errorCount + 1);
		if (this.errorHandler) {
			if (error.severity === this.errorHandler.ErrorSeverity.FATAL) {
				this.logError(`FATAL: ${error.message}`, {
					...details,
					severity: error.severity
				});
			} else if (
				error.severity === this.errorHandler.ErrorSeverity.RECOVERABLE
			) {
				this.logWarn(`RECOVERABLE: ${error.message}`, { ...details });
			}
		} else {
			this.handleError('Error Handler not set', error);
		}
	}
	async logToDatabase(error, sequelize, retryCount = 3) {
		try {
			const ErrorLog = sequelize.model('ErrorLog');
			await ErrorLog.create({
				name: error.name,
				message: error.message,
				statusCode: error.statusCode,
				severity: error.severity,
				timestamp: new Date(),
				count: this.errorCounts.get(error.name) || 1
			});
			this.info('Error logged to database');
		} catch (databaseError) {
			this.error(`Failed to log error to the database: ${databaseError}`);
			if (retryCount > 0) {
				setTimeout(
					() => {
						this.logToDatabase(error, sequelize, retryCount - 1);
					},
					1000 * (4 - retryCount)
				);
			}
		}
	}
	getErrorCount(errorName) {
		return this.errorCounts.get(errorName) || 0;
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3NlcnZpY2VzL0xvZ2dlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFRQSxPQUFPLEVBQUUsRUFBRSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQy9CLE9BQU8sRUFBRSxNQUFNLElBQUksYUFBYSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBR2xELE1BQU0sT0FBTyxnQkFDWixTQUFRLGFBQWE7SUFHZCxNQUFNLENBQUMsUUFBUSxHQUE0QixJQUFJLENBQUM7SUFDN0MsS0FBSyxDQUF1QjtJQUM5QixPQUFPLEdBQWtCLElBQUksQ0FBQztJQUM5QixjQUFjLEdBQXFDLElBQUksQ0FBQztJQUN0RCxZQUFZLEdBQXdDLElBQUksQ0FBQztJQUMzRCxPQUFPLEdBQWlDLElBQUksQ0FBQztJQUVyRCxZQUNDLElBQTBCLEVBQzFCLFFBQWlCLEVBQ2pCLFdBQW9CO1FBRXBCLE1BQU0sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDdkQsTUFBTSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLEdBQUcsTUFBTSxDQUFDO1FBRXRFLE1BQU0sZ0JBQWdCLEdBQUcsUUFBUSxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxJQUFJLE1BQU0sQ0FBQztRQUNyRSxNQUFNLG1CQUFtQixHQUN4QixXQUFXLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsSUFBSSxhQUFhLENBQUM7UUFDakUsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssWUFBWSxDQUFDO1FBQzNELE1BQU0sWUFBWSxHQUFHLDBCQUEwQixDQUFDO1FBQ2hELE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8s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QUFHLENBQUMsRUFBRSxDQUFDO2dCQUNwQixVQUFVLENBQ1QsR0FBRyxFQUFFO29CQUNKLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RELENBQUMsRUFDRCxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLENBQ3ZCLENBQUM7WUFDSCxDQUFDO1FBQ0YsQ0FBQztJQUNGLENBQUM7SUFFTSxhQUFhLENBQUMsU0FBaUI7UUFDckMsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0MsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFRyYW5zcG9ydFN0cmVhbSBmcm9tICd3aW5zdG9uLXRyYW5zcG9ydCc7XG5pbXBvcnQge1xuXHRBcHBMb2dnZXJTZXJ2aWNlRGVwcyxcblx0QXBwTG9nZ2VyU2VydmljZUludGVyZmFjZSxcblx0RXJyb3JIYW5kbGVyU2VydmljZUludGVyZmFjZSxcblx0RXJyb3JMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRWYXVsdFNlcnZpY2VJbnRlcmZhY2Vcbn0gZnJvbSAnLi4vaW5kZXgvaW50ZXJmYWNlcy9tYWluJztcbmltcG9ydCB7IE9wIH0gZnJvbSAnc2VxdWVsaXplJztcbmltcG9ydCB7IExvZ2dlciBhcyBXaW5zdG9uTG9nZ2VyIH0gZnJvbSAnd2luc3Rvbic7XG5pbXBvcnQgeyBSZXF1ZXN0IH0gZnJvbSAnZXhwcmVzcyc7XG5cbmV4cG9ydCBjbGFzcyBBcHBMb2dnZXJTZXJ2aWNlXG5cdGV4dGVuZHMgV2luc3RvbkxvZ2dlclxuXHRpbXBsZW1lbnRzIEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2Vcbntcblx0cHVibGljIHN0YXRpYyBpbnN0YW5jZTogQXBwTG9nZ2VyU2VydmljZSB8IG51bGwgPSBudWxsO1xuXHRwcm90ZWN0ZWQgX2RlcHM6IEFwcExvZ2dlclNlcnZpY2VEZXBzO1xuXHRwcml2YXRlIGFkbWluSWQ6IG51bWJlciB8IG51bGwgPSBudWxsO1xuXHRwcml2YXRlIHJlZGFjdGVkTG9nZ2VyOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlIHwgbnVsbCA9IG51bGw7XG5cdHByb3RlY3RlZCBlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlclNlcnZpY2VJbnRlcmZhY2UgfCBudWxsID0gbnVsbDtcblx0cHJpdmF0ZSBzZWNyZXRzOiBWYXVsdFNlcnZpY2VJbnRlcmZhY2UgfCBudWxsID0gbnVsbDtcblxuXHRjb25zdHJ1Y3Rvcihcblx0XHRkZXBzOiBBcHBMb2dnZXJTZXJ2aWNlRGVwcyxcblx0XHRsb2dMZXZlbD86IHN0cmluZyxcblx0XHRzZXJ2aWNlTmFtZT86IHN0cmluZ1xuXHQpIHtcblx0XHRjb25zdCB7IGZvcm1hdCwgdHJhbnNwb3J0cywgYWRkQ29sb3JzIH0gPSBkZXBzLndpbnN0b247XG5cdFx0Y29uc3QgeyBjb2xvcml6ZSwgY29tYmluZSwgZXJyb3JzLCBqc29uLCBwcmludGYsIHRpbWVzdGFtcCB9ID0gZm9ybWF0O1xuXG5cdFx0Y29uc3QgcmVzb2x2ZWRMb2dMZXZlbCA9IGxvZ0xldmVsIHx8IHByb2Nlc3MuZW52LkxPR19MRVZFTCB8fCAnaW5mbyc7XG5cdFx0Y29uc3QgcmVzb2x2ZWRTZXJ2aWNlTmFtZSA9XG5cdFx0XHRzZXJ2aWNlTmFtZSB8fCBwcm9jZXNzLmVudi5MT0dHRVJfU0VSVklDRV9OQU1FIHx8ICdMb2cgU2VydmljZSc7XG5cdFx0Y29uc3QgaXNQcm9kdWN0aW9uID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJztcblx0XHRjb25zdCBsb2dEaXJlY3RvcnkgPSAnLi9kYXRhL2xvZ3Mvc2VydmVyL21haW4vJztcblx0XHRjb25zdCBsb2dGb3JtYXQgPSBwcmludGYoKHsgbGV2ZWwsIG1lc3NhZ2UsIHRpbWVzdGFtcCwgc3RhY2sgfSkgPT4ge1xuXHRcdFx0cmV0dXJuIGAke3RpbWVzdGFtcH0gJHtsZXZlbH06ICR7c3RhY2sgfHwgbWVzc2FnZX1gO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFkZXBzLmZzLmV4aXN0c1N5bmMobG9nRGlyZWN0b3J5KSkge1xuXHRcdFx0ZGVwcy5mcy5ta2RpclN5bmMobG9nRGlyZWN0b3J5LCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcblx0XHR9XG5cblx0XHRjb25zdCBsb2dnZXJUcmFuc3BvcnRzOiBUcmFuc3BvcnRTdHJlYW1bXSA9IFtcblx0XHRcdG5ldyB0cmFuc3BvcnRzLkNvbnNvbGUoe1xuXHRcdFx0XHRmb3JtYXQ6IGNvbWJpbmUoY29sb3JpemUoKSwgbG9nRm9ybWF0KSxcblx0XHRcdFx0bGV2ZWw6IGlzUHJvZHVjdGlvbiA/ICdpbmZvJyA6IHJlc29sdmVkTG9nTGV2ZWxcblx0XHRcdH0pLFxuXHRcdFx0bmV3IGRlcHMuRGFpbHlSb3RhdGVGaWxlKHtcblx0XHRcdFx0ZmlsZW5hbWU6ICdzZXJ2ZXItJURBVEUlLmxvZycsXG5cdFx0XHRcdGRpcm5hbWU6IGxvZ0RpcmVjdG9yeSxcblx0XHRcdFx0ZGF0ZVBhdHRlcm46ICdZWVlZLU1NLUREJyxcblx0XHRcdFx0emlwcGVkQXJjaGl2ZTogdHJ1ZSxcblx0XHRcdFx0bWF4U2l6ZTogJzIwbScsXG5cdFx0XHRcdG1heEZpbGVzOiAnMzBkJyxcblx0XHRcdFx0Zm9ybWF0OiBjb21iaW5lKFxuXHRcdFx0XHRcdHRpbWVzdGFtcCh7IGZvcm1hdDogJ1lZWVktTU0tREQgSEg6bW06c3MnIH0pLFxuXHRcdFx0XHRcdGxvZ0Zvcm1hdFxuXHRcdFx0XHQpLFxuXHRcdFx0XHRsZXZlbDogcmVzb2x2ZWRMb2dMZXZlbFxuXHRcdFx0fSlcblx0XHRdO1xuXG5cdFx0c3VwZXIoe1xuXHRcdFx0bGV2ZWxzOiBBcHBMb2dnZXJTZXJ2aWNlLmdldEN1c3RvbUxvZ0xldmVscygpLmxldmVscyxcblx0XHRcdGxldmVsOiByZXNvbHZlZExvZ0xldmVsLFxuXHRcdFx0Zm9ybWF0OiBjb21iaW5lKGVycm9ycyh7IHN0YWNrOiB0cnVlIH0pLCBqc29uKCkpLFxuXHRcdFx0ZGVmYXVsdE1ldGE6IHsgc2VydmljZTogcmVzb2x2ZWRTZXJ2aWNlTmFtZSB9LFxuXHRcdFx0dHJhbnNwb3J0czogbG9nZ2VyVHJhbnNwb3J0c1xuXHRcdH0pO1xuXG5cdFx0dGhpcy5hZGRMb2dzdGFzaFRyYW5zcG9ydChsb2dnZXJUcmFuc3BvcnRzKTtcblxuXHRcdHRoaXMuX2RlcHMgPSBkZXBzO1xuXHRcdGFkZENvbG9ycyhBcHBMb2dnZXJTZXJ2aWNlLmdldEN1c3RvbUxvZ0xldmVscygpLmNvbG9ycyk7XG5cdH1cblxuXHRwdWJsaWMgc3RhdGljIGFzeW5jIGdldEluc3RhbmNlKFxuXHRcdGRlcHM6IEFwcExvZ2dlclNlcnZpY2VEZXBzLFxuXHRcdGxvZ0xldmVsPzogc3RyaW5nLFxuXHRcdHNlcnZpY2VOYW1lPzogc3RyaW5nXG5cdCk6IFByb21pc2U8QXBwTG9nZ2VyU2VydmljZUludGVyZmFjZT4ge1xuXHRcdGlmICghQXBwTG9nZ2VyU2VydmljZS5pbnN0YW5jZSkge1xuXHRcdFx0QXBwTG9nZ2VyU2VydmljZS5pbnN0YW5jZSA9IG5ldyBBcHBMb2dnZXJTZXJ2aWNlKFxuXHRcdFx0XHRkZXBzLFxuXHRcdFx0XHRsb2dMZXZlbCxcblx0XHRcdFx0c2VydmljZU5hbWVcblx0XHRcdCk7XG5cblx0XHRcdGF3YWl0IEFwcExvZ2dlclNlcnZpY2UuaW5zdGFuY2UuaW5pdGlhbGl6ZUFzeW5jUGFydHMoKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gQXBwTG9nZ2VyU2VydmljZS5pbnN0YW5jZTtcblx0fVxuXG5cdHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZUFzeW5jUGFydHMoKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdGF3YWl0IHRoaXMuYWRkTG9nc3Rhc2hUcmFuc3BvcnQodGhpcy50cmFuc3BvcnRzKTsgLy8gQXdhaXQgTG9nc3Rhc2ggc2V0dXAgaWYgaXQncyBhc3luY1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmxvZ0Vycm9yKFxuXHRcdFx0XHRgRmFpbGVkIHRvIGluaXRpYWxpemUgYXN5bmMgcGFydHMgb2YgbG9nZ2VyICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBlcnJvcn1gXG5cdFx0XHQpO1xuXHRcdFx0dGhyb3cgZXJyb3I7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIHN0YXRpYyBnZXRDdXN0b21Mb2dMZXZlbHMoKToge1xuXHRcdGxldmVsczogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcblx0XHRjb2xvcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG5cdH0ge1xuXHRcdHJldHVybiB7XG5cdFx0XHRsZXZlbHM6IHtcblx0XHRcdFx0Y3JpdGljYWw6IDAsXG5cdFx0XHRcdGVycm9yOiAxLFxuXHRcdFx0XHR3YXJuOiAyLFxuXHRcdFx0XHRpbmZvOiAzLFxuXHRcdFx0XHRkZWJ1ZzogNCxcblx0XHRcdFx0bm90aWNlOiA1XG5cdFx0XHR9LFxuXHRcdFx0Y29sb3JzOiB7XG5cdFx0XHRcdGNyaXRpY2FsOiAncmVkJyxcblx0XHRcdFx0ZXJyb3I6ICdvcmFuZ2UnLFxuXHRcdFx0XHR3YXJuOiAneWVsbG93Jyxcblx0XHRcdFx0aW5mbzogJ2dyZWVuJyxcblx0XHRcdFx0ZGVidWc6ICdibHVlJyxcblx0XHRcdFx0bm90aWNlOiAnbWFnZW50YSdcblx0XHRcdH1cblx0XHR9O1xuXHR9XG5cblx0cHVibGljIHNldEVycm9ySGFuZGxlcihlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlclNlcnZpY2VJbnRlcmZhY2UpOiB2b2lkIHtcblx0XHR0aGlzLmVycm9ySGFuZGxlciA9IGVycm9ySGFuZGxlcjtcblx0fVxuXG5cdHB1YmxpYyBzZXRVcFNlY3JldHMoc2VjcmV0czogVmF1bHRTZXJ2aWNlSW50ZXJmYWNlKTogdm9pZCB7XG5cdFx0dGhpcy5zZWNyZXRzID0gc2VjcmV0cztcblx0XHR0aGlzLnNldHVwUmVkYWN0ZWRMb2dnZXIoKTtcblx0XHRjb25zb2xlLmluZm8oJ1ZhdWx0IFNlcnZpY2UgaW5qZWN0ZWQgYW5kIHJlZGFjdGVkIGxvZ2dlciBzZXR1cC4nKTtcblx0fVxuXG5cdHByaXZhdGUgc2V0dXBSZWRhY3RlZExvZ2dlcigpOiB2b2lkIHtcblx0XHRpZiAodGhpcy5yZWRhY3RlZExvZ2dlciB8fCAhdGhpcy5zZWNyZXRzKVxuXHRcdFx0dGhpcy5yZWRhY3RlZExvZ2dlciA9IHRoaXMuY3JlYXRlUmVkYWN0ZWRMb2dnZXIoKTtcblx0XHR0aGlzLmxvZ0luZm8oJ1JlZGFjdGVkIGxvZ2dlciBpbml0aWFsaXplZC4nKTtcblx0fVxuXG5cdHByaXZhdGUgY3JlYXRlUmVkYWN0ZWRMb2dnZXIoKTogQXBwTG9nZ2VyU2VydmljZUludGVyZmFjZSB7XG5cdFx0Y29uc3QgcmVkYWN0ZWRMb2dnZXI6IEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2UgPSBPYmplY3QuY3JlYXRlKHRoaXMpO1xuXG5cdFx0Y29uc3QgbGV2ZWxzOiAoXG5cdFx0XHR8ICdkZWJ1Zydcblx0XHRcdHwgJ2luZm8nXG5cdFx0XHR8ICdub3RpY2UnXG5cdFx0XHR8ICd3YXJuJ1xuXHRcdFx0fCAnZXJyb3InXG5cdFx0XHR8ICdjcml0J1xuXHRcdClbXSA9IFsnZGVidWcnLCAnaW5mbycsICdub3RpY2UnLCAnd2FybicsICdlcnJvcicsICdjcml0J107XG5cblx0XHRsZXZlbHMuZm9yRWFjaChsZXZlbCA9PiB7XG5cdFx0XHRjb25zdCBvcmlnaW5hbE1ldGhvZCA9IHRoaXNbbGV2ZWxdLmJpbmQodGhpcyk7XG5cblx0XHRcdHJlZGFjdGVkTG9nZ2VyW2xldmVsXSA9ICgoXG5cdFx0XHRcdG1lc3NhZ2U6IHN0cmluZyxcblx0XHRcdFx0bWV0YT86IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHwgc3RyaW5nXG5cdFx0XHQpOiB2b2lkID0+IHtcblx0XHRcdFx0Y29uc3QgcmVkYWN0ZWRNZXRhID1cblx0XHRcdFx0XHR0eXBlb2YgbWV0YSA9PT0gJ29iamVjdCdcblx0XHRcdFx0XHRcdD8gdGhpcy5zZWNyZXRzPy5yZWRhY3RTZWNyZXRzKG1ldGEpXG5cdFx0XHRcdFx0XHQ6IG1ldGE7XG5cdFx0XHRcdG9yaWdpbmFsTWV0aG9kKG1lc3NhZ2UsIHJlZGFjdGVkTWV0YSk7XG5cdFx0XHR9KSBhcyB0eXBlb2Ygb3JpZ2luYWxNZXRob2Q7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gT2JqZWN0LmFzc2lnbihyZWRhY3RlZExvZ2dlciwge1xuXHRcdFx0Z2V0UmVkYWN0ZWRMb2dnZXI6IHRoaXMuZ2V0UmVkYWN0ZWRMb2dnZXIuYmluZCh0aGlzKVxuXHRcdH0pIGFzIEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2U7XG5cdH1cblxuXHRwdWJsaWMgZ2V0TG9nZ2VyKCk6IEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2Uge1xuXHRcdHJldHVybiB0aGlzLnJlZGFjdGVkTG9nZ2VyID8gdGhpcy5yZWRhY3RlZExvZ2dlciA6IHRoaXM7XG5cdH1cblxuXHRwdWJsaWMgZ2V0UmVkYWN0ZWRMb2dnZXIoKTogQXBwTG9nZ2VyU2VydmljZUludGVyZmFjZSB7XG5cdFx0cmV0dXJuIHRoaXMuY3JlYXRlUmVkYWN0ZWRMb2dnZXIoKTtcblx0fVxuXG5cdHByaXZhdGUgYXN5bmMgYWRkTG9nc3Rhc2hUcmFuc3BvcnQoXG5cdFx0dHJhbnNwb3J0c0FycmF5OiBUcmFuc3BvcnRTdHJlYW1bXVxuXHQpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgbG9nU3Rhc2hUcmFuc3BvcnQgPSBhd2FpdCB0aGlzLmNyZWF0ZUxvZ3N0YXNoVHJhbnNwb3J0KCk7XG5cdFx0XHRpZiAobG9nU3Rhc2hUcmFuc3BvcnQpIHtcblx0XHRcdFx0dHJhbnNwb3J0c0FycmF5LnB1c2gobG9nU3Rhc2hUcmFuc3BvcnQpO1xuXHRcdFx0fVxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmxvZ0Vycm9yKFxuXHRcdFx0XHRgRXJyb3IgYWRkaW5nIExvZ3N0YXNoIHRyYW5zcG9ydCAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogZXJyb3J9YFxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGFzeW5jIGNyZWF0ZUxvZ3N0YXNoVHJhbnNwb3J0KCk6IFByb21pc2U8VHJhbnNwb3J0U3RyZWFtIHwgbnVsbD4ge1xuXHRcdHRyeSB7XG5cdFx0XHRyZXR1cm4gbmV3IHRoaXMuX2RlcHMuTG9nU3Rhc2hUcmFuc3BvcnQoe1xuXHRcdFx0XHRwb3J0OiBwYXJzZUludChwcm9jZXNzLmVudi5MT0dTVEFTSF9QT1JUISwgMTApLFxuXHRcdFx0XHRub2RlX25hbWU6IHByb2Nlc3MuZW52LkxPR1NUQVNIX05PREUhLFxuXHRcdFx0XHRob3N0OiBwcm9jZXNzLmVudi5MT0dTVEFTSF9IT1NUIVxuXHRcdFx0fSkgYXMgdW5rbm93biBhcyBUcmFuc3BvcnRTdHJlYW07XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdGNvbnN0IGxvZ3N0YXNoRXJyb3IgPVxuXHRcdFx0XHRuZXcgdGhpcy5fZGVwcy5FcnJvckNsYXNzZXMuU2VydmljZVVuYXZhaWxhYmxlRXJyb3IoXG5cdFx0XHRcdFx0NjAsXG5cdFx0XHRcdFx0J0FwcGxpY2F0aW9uIExvZ2dlciBTZXJ2aWNlJyxcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRtZXNzYWdlOlxuXHRcdFx0XHRcdFx0XHQnTG9nZ2VyIFNlcnZpY2UgRXJyb3I6IEZhaWxlZCB0byBjcmVhdGUgTG9nc3Rhc2ggdHJhbnNwb3J0J1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0KTtcblx0XHRcdHRoaXMubG9nRXJyb3IoXG5cdFx0XHRcdGBMb2dzdGFzaCBlcnJvcjogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IGVycm9yfWBcblx0XHRcdCk7XG5cdFx0XHRpZiAodGhpcy5lcnJvckhhbmRsZXIpIHtcblx0XHRcdFx0dGhpcy5lcnJvckhhbmRsZXIuaGFuZGxlRXJyb3Ioe1xuXHRcdFx0XHRcdC4uLnRoaXMuX2RlcHMuSGFuZGxlRXJyb3JTdGF0aWNQYXJhbWV0ZXJzLFxuXHRcdFx0XHRcdGVycm9yOiBsb2dzdGFzaEVycm9yLFxuXHRcdFx0XHRcdGRldGFpbHM6IHsgcmVhc29uOiAnRmFpbGVkIHRvIGNyZWF0ZSBMb2dzdGFzaCB0cmFuc3BvcnQnIH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgbG9nRGVidWcobWVzc2FnZTogc3RyaW5nLCBkZXRhaWxzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiB2b2lkIHtcblx0XHR0aGlzLmRlYnVnKG1lc3NhZ2UsIGRldGFpbHMpO1xuXHR9XG5cblx0cHVibGljIGxvZ0luZm8obWVzc2FnZTogc3RyaW5nLCBkZXRhaWxzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiB2b2lkIHtcblx0XHR0aGlzLmluZm8obWVzc2FnZSwgZGV0YWlscyk7XG5cdH1cblxuXHRwdWJsaWMgbG9nTm90aWNlKG1lc3NhZ2U6IHN0cmluZywgZGV0YWlscz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+KTogdm9pZCB7XG5cdFx0dGhpcy5ub3RpY2UobWVzc2FnZSwgZGV0YWlscyk7XG5cdH1cblxuXHRwdWJsaWMgbG9nV2FybihtZXNzYWdlOiBzdHJpbmcsIGRldGFpbHM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IHZvaWQge1xuXHRcdHRoaXMud2FybihtZXNzYWdlLCBkZXRhaWxzKTtcblx0fVxuXG5cdHB1YmxpYyBsb2dFcnJvcihtZXNzYWdlOiBzdHJpbmcsIGRldGFpbHM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IHZvaWQge1xuXHRcdHRoaXMuZXJyb3IobWVzc2FnZSwgZGV0YWlscyk7XG5cdH1cblxuXHRwdWJsaWMgbG9nQ3JpdGljYWwoXG5cdFx0bWVzc2FnZTogc3RyaW5nLFxuXHRcdGRldGFpbHM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuXHQpOiB2b2lkIHtcblx0XHR0aGlzLmNyaXQobWVzc2FnZSwgZGV0YWlscyk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgY2xlYW5VcE9sZExvZ3MoXG5cdFx0c2VxdWVsaXplOiBpbXBvcnQoJ3NlcXVlbGl6ZScpLlNlcXVlbGl6ZSxcblx0XHRyZXRlbnRpb25QZXJpb2REYXlzOiBudW1iZXIgPSAzMFxuXHQpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRjb25zdCByZXRlbnRpb25EYXRlID0gbmV3IERhdGUoKTtcblx0XHRyZXRlbnRpb25EYXRlLnNldERhdGUocmV0ZW50aW9uRGF0ZS5nZXREYXRlKCkgLSByZXRlbnRpb25QZXJpb2REYXlzKTtcblxuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBFcnJvckxvZyA9IHNlcXVlbGl6ZS5tb2RlbCgnRXJyb3JMb2cnKTtcblx0XHRcdGF3YWl0IEVycm9yTG9nLmRlc3Ryb3koe1xuXHRcdFx0XHR3aGVyZToge1xuXHRcdFx0XHRcdHRpbWVzdGFtcDoge1xuXHRcdFx0XHRcdFx0W09wLmx0XTogcmV0ZW50aW9uRGF0ZVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLmluZm8oXG5cdFx0XHRcdGBPbGQgbG9ncyBvbGRlciB0aGFuICR7cmV0ZW50aW9uUGVyaW9kRGF5c30gZGF5cyBoYXZlIGJlZW4gZGVsZXRlZC5gXG5cdFx0XHQpO1xuXHRcdH0gY2F0Y2ggKGNsZWFudXBFcnJvcikge1xuXHRcdFx0dGhpcy5lcnJvcignRmFpbGVkIHRvIGNsZWFuIHVwIG9sZCBsb2dzJywgY2xlYW51cEVycm9yKTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgc2V0QWRtaW5JZChhZG1pbklkOiBudW1iZXIpOiB2b2lkIHtcblx0XHR0aGlzLmFkbWluSWQgPSBhZG1pbklkO1xuXHR9XG5cblx0cHVibGljIGdldEVycm9yRGV0YWlscyhcblx0XHRnZXRDYWxsZXJJbmZvOiAoKSA9PiBzdHJpbmcsXG5cdFx0YWN0aW9uOiBzdHJpbmcgPSAndW5rbm93bicsXG5cdFx0cmVxPzogUmVxdWVzdCxcblx0XHR1c2VySWQ/OiBzdHJpbmcgfCBudWxsLFxuXHRcdGFkZGl0aW9uYWxEYXRhPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj5cblx0KTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuXHRcdGNvbnN0IGRldGFpbHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge1xuXHRcdFx0cmVxdWVzdElkOiByZXE/LmhlYWRlcnNbJ3gtcmVxdWVzdC1pZCddIHx8IHRoaXMuX2RlcHMudXVpZHY0KCksXG5cdFx0XHRhZG1pbklkOiB0aGlzLmFkbWluSWQgfHwgJ1Vua25vd24gQWRtaW4nLFxuXHRcdFx0dXNlcklkOiB1c2VySWQgfHwgbnVsbCxcblx0XHRcdGFjdGlvbjogYWN0aW9uIHx8ICd1bmtub3duJyxcblx0XHRcdGNhbGxlcjogU3RyaW5nKGdldENhbGxlckluZm8oKSksXG5cdFx0XHR0aW1lc3RhbXA6IERhdGUubm93KCksXG5cdFx0XHRyZXF1ZXN0SW5mbzoge1xuXHRcdFx0XHRtZXRob2Q6IHJlcT8ubWV0aG9kIHx8IG51bGwsXG5cdFx0XHRcdHVybDogcmVxPy5vcmlnaW5hbFVybCB8fCByZXE/LnVybCB8fCBudWxsLFxuXHRcdFx0XHRpcDpcblx0XHRcdFx0XHRyZXE/LmlwIHx8XG5cdFx0XHRcdFx0cmVxPy5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXSB8fFxuXHRcdFx0XHRcdHJlcT8uc29ja2V0LnJlbW90ZUFkZHJlc3MgfHxcblx0XHRcdFx0XHRudWxsLFxuXHRcdFx0XHR1c2VyQWdlbnQ6IHJlcT8uaGVhZGVyc1sndXNlci1hZ2VudCddIHx8IG51bGwsXG5cdFx0XHRcdHJlZmVycmVyOlxuXHRcdFx0XHRcdHJlcT8uaGVhZGVyc1sncmVmZXJlciddIHx8IHJlcT8uaGVhZGVyc1sncmVmZXJyZXInXSB8fCBudWxsLFxuXHRcdFx0XHRxdWVyeTogcmVxPy5xdWVyeSB8fCBudWxsLFxuXHRcdFx0XHRwYXJhbXM6IHJlcT8ucGFyYW1zIHx8IG51bGwsXG5cdFx0XHRcdGJvZHk6IHJlcT8uYm9keSA/IHRoaXMuc2FuaXRpemVSZXF1ZXN0Qm9keShyZXE/LmJvZHkpIDogbnVsbFxuXHRcdFx0fSxcblx0XHRcdC4uLmFkZGl0aW9uYWxEYXRhXG5cdFx0fTtcblxuXHRcdHJldHVybiBkZXRhaWxzO1xuXHR9XG5cblx0cHJvdGVjdGVkIGdldCBfX2RlcHMoKTogQXBwTG9nZ2VyU2VydmljZURlcHMge1xuXHRcdHJldHVybiB0aGlzLl9kZXBzO1xuXHR9XG5cblx0cHJpdmF0ZSBzYW5pdGl6ZVJlcXVlc3RCb2R5KFxuXHRcdGJvZHk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG5cdCk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHtcblx0XHRjb25zdCBzYW5pdGl6ZWRCb2R5ID0gbmV3IE1hcChPYmplY3QuZW50cmllcyhib2R5KSk7XG5cdFx0Y29uc3Qgc2Vuc2l0aXZlRmllbGRzID0gW1xuXHRcdFx0J2VtYWlsJyxcblx0XHRcdCdrZXknLFxuXHRcdFx0J25ld1Bhc3N3b3JkJyxcblx0XHRcdCdvbGRQYXNzd29yZCcsXG5cdFx0XHQncGFzc3BocmFzZScsXG5cdFx0XHQncGFzc3dvcmQnLFxuXHRcdFx0J3NlY3JldCcsXG5cdFx0XHQndG9rZW4nLFxuXHRcdFx0J3VzZXJuYW1lJ1xuXHRcdF07XG5cblx0XHRzZW5zaXRpdmVGaWVsZHMuZm9yRWFjaChmaWVsZCA9PiB7XG5cdFx0XHRpZiAoc2FuaXRpemVkQm9keS5oYXMoZmllbGQpKSB7XG5cdFx0XHRcdHNhbml0aXplZEJvZHkuc2V0KGZpZWxkLCAnW1JFREFDVEVEXScpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhzYW5pdGl6ZWRCb2R5KTtcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBzaHV0ZG93bigpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0aGlzLmluZm8oJ1NodXR0aW5nIGRvd24gbG9nZ2VyIHNlcnZpY2VzLi4uJyk7XG5cblx0XHRhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cdFx0XHR0aGlzLm9uKCdmaW5pc2gnLCAoKSA9PiB7XG5cdFx0XHRcdHRoaXMuaW5mbygnQWxsIGxvZ3MgaGF2ZSBiZWVuIGZsdXNoZWQuJyk7XG5cdFx0XHRcdHJlc29sdmUoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLm9uKCdlcnJvcicsIGVycm9yID0+IHtcblx0XHRcdFx0dGhpcy5lcnJvcihcblx0XHRcdFx0XHRgRXJyb3Igd2hpbGUgc2h1dHRpbmcgZG93biBsb2dnZXI6ICR7ZXJyb3IubWVzc2FnZX1gXG5cdFx0XHRcdCk7XG5cdFx0XHRcdHJlamVjdChlcnJvcik7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5lbmQoKTtcblx0XHR9KTtcblx0fVxuXG5cdHByb3RlY3RlZCBoYW5kbGVFcnJvcihtZXNzYWdlOiBzdHJpbmcsIGVycm9yOiBFcnJvcik6IHZvaWQge1xuXHRcdGlmICh0aGlzLmVycm9ySGFuZGxlcikge1xuXHRcdFx0dGhpcy5lcnJvckhhbmRsZXIuaGFuZGxlRXJyb3Ioe1xuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0ZGV0YWlsczogeyBtZXNzYWdlIH1cblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmxvZ0Vycm9yKGBFcnJvciBIYW5kbGVyIG5vdCBzZXQuIEVycm9yOiAke21lc3NhZ2V9YCk7XG5cdFx0fVxuXHR9XG59XG5cbmV4cG9ydCBjbGFzcyBFcnJvckxvZ2dlclNlcnZpY2Vcblx0ZXh0ZW5kcyBBcHBMb2dnZXJTZXJ2aWNlXG5cdGltcGxlbWVudHMgRXJyb3JMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlXG57XG5cdHB1YmxpYyBzdGF0aWMgb3ZlcnJpZGUgaW5zdGFuY2U6IEVycm9yTG9nZ2VyU2VydmljZTtcblx0cHJpdmF0ZSBlcnJvckNvdW50czogTWFwPHN0cmluZywgbnVtYmVyPjtcblxuXHRjb25zdHJ1Y3Rvcihcblx0XHRkZXBzOiBBcHBMb2dnZXJTZXJ2aWNlRGVwcyxcblx0XHRsb2dMZXZlbD86IHN0cmluZyxcblx0XHRzZXJ2aWNlTmFtZT86IHN0cmluZ1xuXHQpIHtcblx0XHRzdXBlcihkZXBzLCBsb2dMZXZlbCwgc2VydmljZU5hbWUpO1xuXHRcdHRoaXMuZXJyb3JDb3VudHMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBvdmVycmlkZSBhc3luYyBnZXRJbnN0YW5jZShcblx0XHRkZXBzOiBBcHBMb2dnZXJTZXJ2aWNlRGVwcyxcblx0XHRsb2dMZXZlbD86IHN0cmluZyxcblx0XHRzZXJ2aWNlTmFtZT86IHN0cmluZ1xuXHQpOiBQcm9taXNlPEVycm9yTG9nZ2VyU2VydmljZUludGVyZmFjZT4ge1xuXHRcdGlmICghRXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlKSB7XG5cdFx0XHRFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgRXJyb3JMb2dnZXJTZXJ2aWNlKFxuXHRcdFx0XHRkZXBzLFxuXHRcdFx0XHRsb2dMZXZlbCxcblx0XHRcdFx0c2VydmljZU5hbWVcblx0XHRcdCk7XG5cdFx0fVxuXHRcdHJldHVybiBPYmplY3QuYXNzaWduKEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZSwge1xuXHRcdFx0bG9nQXBwRXJyb3I6IEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZS5sb2dBcHBFcnJvci5iaW5kKFxuXHRcdFx0XHRFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2Vcblx0XHRcdCksXG5cdFx0XHRnZXRFcnJvckNvdW50OiBFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2UuZ2V0RXJyb3JDb3VudC5iaW5kKFxuXHRcdFx0XHRFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2Vcblx0XHRcdCksXG5cdFx0XHRnZXRSZWRhY3RlZExvZ2dlcjpcblx0XHRcdFx0RXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlLmdldFJlZGFjdGVkTG9nZ2VyLmJpbmQoXG5cdFx0XHRcdFx0RXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlXG5cdFx0XHRcdCksXG5cdFx0XHRsb2dEZWJ1ZzogRXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlLmxvZ0RlYnVnLmJpbmQoXG5cdFx0XHRcdEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZVxuXHRcdFx0KSxcblx0XHRcdGxvZ0luZm86IEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZS5sb2dJbmZvLmJpbmQoXG5cdFx0XHRcdEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZVxuXHRcdFx0KSxcblx0XHRcdGxvZ05vdGljZTogRXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlLmxvZ05vdGljZS5iaW5kKFxuXHRcdFx0XHRFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2Vcblx0XHRcdCksXG5cdFx0XHRsb2dXYXJuOiBFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2UubG9nV2Fybi5iaW5kKFxuXHRcdFx0XHRFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2Vcblx0XHRcdCksXG5cdFx0XHRsb2dFcnJvcjogRXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlLmxvZ0Vycm9yLmJpbmQoXG5cdFx0XHRcdEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZVxuXHRcdFx0KSxcblx0XHRcdGxvZ0NyaXRpY2FsOiBFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2UubG9nQ3JpdGljYWwuYmluZChcblx0XHRcdFx0RXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlXG5cdFx0XHQpLFxuXHRcdFx0Y2xlYW5VcE9sZExvZ3M6IEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZS5jbGVhblVwT2xkTG9ncy5iaW5kKFxuXHRcdFx0XHRFcnJvckxvZ2dlclNlcnZpY2UuaW5zdGFuY2Vcblx0XHRcdCksXG5cdFx0XHRnZXRFcnJvckRldGFpbHM6IEVycm9yTG9nZ2VyU2VydmljZS5pbnN0YW5jZS5nZXRFcnJvckRldGFpbHMuYmluZChcblx0XHRcdFx0RXJyb3JMb2dnZXJTZXJ2aWNlLmluc3RhbmNlXG5cdFx0XHQpXG5cdFx0fSkgYXMgRXJyb3JMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlO1xuXHR9XG5cblx0cHVibGljIGxvZ0FwcEVycm9yKFxuXHRcdGVycm9yOiBpbXBvcnQoJy4uL2Vycm9ycy9FcnJvckNsYXNzZXMnKS5BcHBFcnJvcixcblx0XHRzZXF1ZWxpemU/OiBpbXBvcnQoJ3NlcXVlbGl6ZScpLlNlcXVlbGl6ZSxcblx0XHRkZXRhaWxzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9XG5cdCk6IHZvaWQge1xuXHRcdGlmIChzZXF1ZWxpemUpIHtcblx0XHRcdHRoaXMubG9nVG9EYXRhYmFzZShlcnJvciwgc2VxdWVsaXplKS5jYXRjaChkYXRhYmFzZUVycm9yID0+IHtcblx0XHRcdFx0dGhpcy53YXJuKFxuXHRcdFx0XHRcdGBDb3VsZCBub3QgbG9nIGVycm9yIHRvIGRhdGFiYXNlOiAke2RhdGFiYXNlRXJyb3IubWVzc2FnZSB8fCBkYXRhYmFzZUVycm9yfWBcblx0XHRcdFx0KTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLmxvZ1dhcm4oXG5cdFx0XHRcdCdTZXF1ZWxpemUgaW5zdGFuY2Ugbm90IHByb3ZpZGVkIGZvciBsb2dnaW5nIGVycm9yIHRvIGRhdGFiYXNlJ1xuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRjb25zdCBlcnJvckNvdW50ID0gdGhpcy5lcnJvckNvdW50cy5nZXQoZXJyb3IubmFtZSkgfHwgMDtcblx0XHR0aGlzLmVycm9yQ291bnRzLnNldChlcnJvci5uYW1lLCBlcnJvckNvdW50ICsgMSk7XG5cblx0XHRpZiAodGhpcy5lcnJvckhhbmRsZXIpIHtcblx0XHRcdGlmIChlcnJvci5zZXZlcml0eSA9PT0gdGhpcy5lcnJvckhhbmRsZXIuRXJyb3JTZXZlcml0eS5GQVRBTCkge1xuXHRcdFx0XHR0aGlzLmxvZ0Vycm9yKGBGQVRBTDogJHtlcnJvci5tZXNzYWdlfWAsIHtcblx0XHRcdFx0XHQuLi5kZXRhaWxzLFxuXHRcdFx0XHRcdHNldmVyaXR5OiBlcnJvci5zZXZlcml0eVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZiAoXG5cdFx0XHRcdGVycm9yLnNldmVyaXR5ID09PSB0aGlzLmVycm9ySGFuZGxlci5FcnJvclNldmVyaXR5LlJFQ09WRVJBQkxFXG5cdFx0XHQpIHtcblx0XHRcdFx0dGhpcy5sb2dXYXJuKGBSRUNPVkVSQUJMRTogJHtlcnJvci5tZXNzYWdlfWAsIHsgLi4uZGV0YWlscyB9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5oYW5kbGVFcnJvcignRXJyb3IgSGFuZGxlciBub3Qgc2V0JywgZXJyb3IpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhc3luYyBsb2dUb0RhdGFiYXNlKFxuXHRcdGVycm9yOiBpbXBvcnQoJy4uL2Vycm9ycy9FcnJvckNsYXNzZXMnKS5BcHBFcnJvcixcblx0XHRzZXF1ZWxpemU6IGltcG9ydCgnc2VxdWVsaXplJykuU2VxdWVsaXplLFxuXHRcdHJldHJ5Q291bnQ6IG51bWJlciA9IDNcblx0KTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IEVycm9yTG9nID0gc2VxdWVsaXplLm1vZGVsKCdFcnJvckxvZycpO1xuXHRcdFx0YXdhaXQgRXJyb3JMb2cuY3JlYXRlKHtcblx0XHRcdFx0bmFtZTogZXJyb3IubmFtZSxcblx0XHRcdFx0bWVzc2FnZTogZXJyb3IubWVzc2FnZSxcblx0XHRcdFx0c3RhdHVzQ29kZTogZXJyb3Iuc3RhdHVzQ29kZSxcblx0XHRcdFx0c2V2ZXJpdHk6IGVycm9yLnNldmVyaXR5LFxuXHRcdFx0XHR0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG5cdFx0XHRcdGNvdW50OiB0aGlzLmVycm9yQ291bnRzLmdldChlcnJvci5uYW1lKSB8fCAxXG5cdFx0XHR9KTtcblx0XHRcdHRoaXMuaW5mbygnRXJyb3IgbG9nZ2VkIHRvIGRhdGFiYXNlJyk7XG5cdFx0fSBjYXRjaCAoZGF0YWJhc2VFcnJvcikge1xuXHRcdFx0dGhpcy5lcnJvcihgRmFpbGVkIHRvIGxvZyBlcnJvciB0byB0aGUgZGF0YWJhc2U6ICR7ZGF0YWJhc2VFcnJvcn1gKTtcblx0XHRcdGlmIChyZXRyeUNvdW50ID4gMCkge1xuXHRcdFx0XHRzZXRUaW1lb3V0KFxuXHRcdFx0XHRcdCgpID0+IHtcblx0XHRcdFx0XHRcdHRoaXMubG9nVG9EYXRhYmFzZShlcnJvciwgc2VxdWVsaXplLCByZXRyeUNvdW50IC0gMSk7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHQxMDAwICogKDQgLSByZXRyeUNvdW50KVxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBnZXRFcnJvckNvdW50KGVycm9yTmFtZTogc3RyaW5nKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gdGhpcy5lcnJvckNvdW50cy5nZXQoZXJyb3JOYW1lKSB8fCAwO1xuXHR9XG59XG4iXX0=
