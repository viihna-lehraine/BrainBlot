import passport from 'passport';
import loadEnv from './config/loadEnv.mjs';
import {
	initializeDatabase,
	configurePassport,
	initializeIpBlacklist,
	setupHttp
} from './index.mjs';
import { app, initializeApp } from './config/app.mjs';
import { getFeatureFlags } from './config/featureFlags.mjs';
import { getSequelizeInstance } from './config/db.mjs';
import setupLogger from './config/logger.mjs';
import { initializeModels } from './models/ModelsIndex.mjs';
loadEnv();
const logger = setupLogger();
logger.info('Logger is working');
logger.info(
	'NODE_ENV ',
	process.env.NODE_ENV,
	'SERVER PORT ',
	process.env.SERVER_PORT,
	'EMAIL USER ',
	process.env.EMAIL_USER,
	'BACKEND LOG EXPORT PATH ',
	process.env.BACKEND_LOG_EXPORT_PATH,
	'STATIC_ROOT_PATH ',
	process.env.STATIC_ROOT_PATH,
	'FRONTEND_APP_JS_PATH ',
	process.env.FRONTEND_APP_JS_PATH,
	'FRONTEND_BROWSER_CONFIG_XML_PATH ',
	process.env.FRONTEND_BROWSER_CONFIG_XML_PATH,
	'FRONTEND_CSS_PATH ',
	process.env.FRONTEND_CSS_PATH,
	'FRONTEND_FONTS_PATH ',
	process.env.FRONTEND_FONTS_PATH,
	'FRONTEND_HUMANS_MD_PATH ',
	process.env.FRONTEND_HUMANS_MD_PATH,
	'FRONTEND_ICONS_PATH ',
	process.env.FRONTEND_ICONS_PATH,
	'FRONTEND_IMAGES_PATH ',
	process.env.FRONTEND_IMAGES_PATH,
	'FRONTEND_JS_PATH ',
	process.env.FRONTEND_JS_PATH,
	'FRONTEND_KEYS_PATH ',
	process.env.FRONTEND_KEYS_PATH,
	'FRONTEND_LOGOS_PATH ',
	process.env.FRONTEND_LOGOS_PATH,
	'FRONTEND_ROBOTS_TXT_PATH ',
	process.env.FRONTEND_ROBOTS_TXT_PATH,
	'FRONTEND_SECURITY_MD_PATH ',
	process.env.FRONTEND_SECURITY_MD_PATH,
	'FRONTEND_SECRETS_PATH ',
	process.env.FRONTEND_SECRETS_PATH,
	'FRONTEND_SITEMAP_XML_PATH ',
	process.env.FRONTEND_SITEMAP_XML_PATH,
	'SERVER_DATA_FILE_PATH_1 ',
	process.env.SERVER_DATA_FILE_PATH_1,
	'SERVER_DATA_FILE_PATH_2 ',
	process.env.SERVER_DATA_FILE_PATH_2,
	'SERVER_DATA_FILE_PATH_3 ',
	process.env.SERVER_DATA_FILE_PATH_3,
	'SERVER_DATA_FILE_PATH_4 ',
	process.env.SERVER_DATA_FILE_PATH_4,
	'SERVER_LOG_PATH ',
	process.env.SERVER_LOG_PATH,
	'SERVER_NPM_LOG_PATH ',
	process.env.SERVER_NPM_LOG_PATH,
	'SERVER_SSL_KEY_PATH ',
	process.env.SERVER_SSL_KEY_PATH,
	'SERVER_SSL_CERT_PATH ',
	process.env.SERVER_SSL_CERT_PATH,
	'FEATURE API ROUTES CSRF ',
	process.env.FEATURE_API_ROUTES_CSRF,
	'FEATURE DB SYNC ',
	process.env.FEATURE_DB_SYNC,
	'FEATURE HTTPS REDIRECT ',
	process.env.FEATURE_HTTPS_REDIRECT,
	'FEATURE IP BLACKLIST ',
	process.env.FEATURE_IP_BLACKLIST,
	'FEATURE LOAD STATIC ROUTES ',
	process.env.FEATURE_LOAD_STATIC_ROUTES,
	'FEATURE LOAD TEST ROUTES ',
	process.env.FEATURE_LOAD_TEST_ROUTES,
	'FEATURE SECURE HEADERS ',
	process.env.FEATURE_SECURE_HEADERS,
	'FEATURE SEQUELIZE LOGGING ',
	process.env.FEATURE_SEQUELIZE_LOGGING,
	'LOGGER ',
	process.env.LOGGER,
	'YUBICO API URL ',
	process.env.YUBICO_API_URL
);
const featureFlags = getFeatureFlags();
try {
	logger.info('Initializing database');
	await initializeDatabase();
	logger.info('Initializing models');
	initializeModels();
	logger.info('Initializing passport');
	await configurePassport(passport);
	logger.info('Initializing IP blacklist');
	await initializeIpBlacklist();
	logger.info('Initializing app');
	await initializeApp();
	const dbSyncFlag = featureFlags?.dbSyncFlag ?? false;
	if (dbSyncFlag) {
		logger.info(
			'Testing database connection and syncing models using getSequelizeInstance'
		);
		const sequelize = getSequelizeInstance();
		try {
			await sequelize.sync();
			logger.info('Database and tables created!');
		} catch (err) {
			logger.error(
				'Database Connection Test and Sync: Server error:',
				err
			);
			process.exit(1);
		}
	}
	logger.info('Starting server');
	const { startServer } = await setupHttp(app);
	startServer();
	logger.info('Server started successfully!');
} catch (err) {
	logger.error('Unhandled error during server initialization:', err);
	process.exit(1);
}
export default app;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3NlcnZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLFFBQVEsTUFBTSxVQUFVLENBQUM7QUFDaEMsT0FBTyxPQUFPLE1BQU0sa0JBQWtCLENBQUM7QUFDdkMsT0FBTyxFQUNOLGtCQUFrQixFQUNsQixpQkFBaUIsRUFDakIscUJBQXFCLEVBQ3JCLFNBQVMsRUFDVCxNQUFNLFNBQVMsQ0FBQztBQUNqQixPQUFPLEVBQUUsR0FBRyxFQUFFLGFBQWEsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUNsRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDeEQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ25ELE9BQU8sV0FBVyxNQUFNLGlCQUFpQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRXhELE9BQU8sRUFBRSxDQUFDO0FBRVYsTUFBTSxNQUFNLEdBQUcsV0FBVyxFQUFFLENBQUM7QUFDN0IsTUFBTSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBRWpDLE1BQU0sQ0FBQyxJQUFJLENBQ1YsV0FBVyxFQUNYLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUNwQixjQUFjLEVBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQ3ZCLGFBQWEsRUFDYixPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFDdEIsMEJBQTBCLEVBQzFCLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLEVBQ25DLG1CQUFtQixFQUNuQixPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUM1Qix1QkFBdUIsRUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFDaEMsbUNBQW1DLEVBQ25DLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0NBQWdDLEVBQzVDLG9CQUFvQixF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RUFBRSxVQUFVLElBQUksS0FBSyxDQUFDO0lBQ3JELElBQUksVUFBVSxFQUFFLENBQUM7UUFDaEIsTUFBTSxDQUFDLElBQUksQ0FDViwyRUFBMkUsQ0FDM0UsQ0FBQztRQUNGLE1BQU0sU0FBUyxHQUFHLG9CQUFvQixFQUFFLENBQUM7UUFDekMsSUFBSSxDQUFDO1lBQ0osTUFBTSxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1FBQzdDLENBQUM7UUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1lBQ2QsTUFBTSxDQUFDLEtBQUssQ0FDWCxrREFBa0QsRUFDbEQsR0FBRyxDQUNILENBQUM7WUFDRixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pCLENBQUM7SUFDRixDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQy9CLE1BQU0sRUFBRSxXQUFXLEVBQUUsR0FBRyxNQUFNLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM3QyxXQUFXLEVBQUUsQ0FBQztJQUNkLE1BQU0sQ0FBQyxJQUFJLENBQUMsOEJBQThCLENBQUMsQ0FBQztBQUM3QyxDQUFDO0FBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztJQUNkLE1BQU0sQ0FBQyxLQUFLLENBQUMsK0NBQStDLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDbkUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNqQixDQUFDO0FBRUQsZUFBZSxHQUFHLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGFzc3BvcnQgZnJvbSAncGFzc3BvcnQnO1xuaW1wb3J0IGxvYWRFbnYgZnJvbSAnLi9jb25maWcvbG9hZEVudic7XG5pbXBvcnQge1xuXHRpbml0aWFsaXplRGF0YWJhc2UsXG5cdGNvbmZpZ3VyZVBhc3Nwb3J0LFxuXHRpbml0aWFsaXplSXBCbGFja2xpc3QsXG5cdHNldHVwSHR0cFxufSBmcm9tICcuL2luZGV4JztcbmltcG9ydCB7IGFwcCwgaW5pdGlhbGl6ZUFwcCB9IGZyb20gJy4vY29uZmlnL2FwcCc7XG5pbXBvcnQgeyBnZXRGZWF0dXJlRmxhZ3MgfSBmcm9tICcuL2NvbmZpZy9mZWF0dXJlRmxhZ3MnO1xuaW1wb3J0IHsgZ2V0U2VxdWVsaXplSW5zdGFuY2UgfSBmcm9tICcuL2NvbmZpZy9kYic7XG5pbXBvcnQgc2V0dXBMb2dnZXIgZnJvbSAnLi9jb25maWcvbG9nZ2VyJztcbmltcG9ydCB7IGluaXRpYWxpemVNb2RlbHMgfSBmcm9tICcuL21vZGVscy9Nb2RlbHNJbmRleCc7XG5cbmxvYWRFbnYoKTtcblxuY29uc3QgbG9nZ2VyID0gc2V0dXBMb2dnZXIoKTtcbmxvZ2dlci5pbmZvKCdMb2dnZXIgaXMgd29ya2luZycpO1xuXG5sb2dnZXIuaW5mbyhcblx0J05PREVfRU5WICcsXG5cdHByb2Nlc3MuZW52Lk5PREVfRU5WLFxuXHQnU0VSVkVSIFBPUlQgJyxcblx0cHJvY2Vzcy5lbnYuU0VSVkVSX1BPUlQsXG5cdCdFTUFJTCBVU0VSICcsXG5cdHByb2Nlc3MuZW52LkVNQUlMX1VTRVIsXG5cdCdCQUNLRU5EIExPRyBFWFBPUlQgUEFUSCAnLFxuXHRwcm9jZXNzLmVudi5CQUNLRU5EX0xPR19FWFBPUlRfUEFUSCxcblx0J1NUQVRJQ19ST09UX1BBVEggJyxcblx0cHJvY2Vzcy5lbnYuU1RBVElDX1JPT1RfUEFUSCxcblx0J0ZST05URU5EX0FQUF9KU19QQVRIICcsXG5cdHByb2Nlc3MuZW52LkZST05URU5EX0FQUF9KU19QQVRILFxuXHQnRlJPTlRFTkRfQlJPV1NFUl9DT05GSUdfWE1MX1BBVEggJyxcblx0cHJvY2Vzcy5lbnYuRlJPTlRFTkRfQlJPV1NFUl9DT05GSUdfWE1MX1BBVEgsXG5cdCdGUk9OVEVORF9DU1NfUEFUSCAnLFxuXHRwcm9jZXNzLmVudi5GUk9OVEVORF9DU1NfUEFUSCxcblx0J0ZST05URU5EX0ZPTlRTX1BBVEggJyxcblx0cHJvY2Vzcy5lbnYuRlJPTlRFTkRfRk9OVFNfUEFUSCxcblx0J0ZST05URU5EX0hVTUFOU19NRF9QQVRIICcsXG5cdHByb2Nlc3MuZW52LkZST05URU5EX0hVTUFOU19NRF9QQVRILFxuXHQnRlJPTlRFTkRfSUNPTlNfUEFUSCAnLFxuXHRwcm9jZXNzLmVudi5GUk9OVEVORF9JQ09OU19QQVRILFxuXHQnRlJPTlRFTkRfSU1BR0VTX1BBVEggJyxcblx0cHJvY2Vzcy5lbnYuRlJPTlRFTkRfSU1BR0VTX1BBVEgsXG5cdCdGUk9OVEVORF9KU19QQVRIICcsXG5cdHByb2Nlc3MuZW52LkZST05URU5EX0pTX1BBVEgsXG5cdCdGUk9OVEVORF9LRVlTX1BBVEggJyxcblx0cHJvY2Vzcy5lbnYuRlJPTlRFTkRfS0VZU19QQVRILFxuXHQnRlJPTlRFTkRfTE9HT1NfUEFUSCAnLFxuXHRwcm9jZXNzLmVudi5GUk9OVEVORF9MT0dPU19QQVRILFxuXHQnRlJPTlRFTkRfUk9CT1RTX1RYVF9QQVRIICcsXG5cdHByb2Nlc3MuZW52LkZST05URU5EX1JPQk9UU19UWFRfUEFUSCxcblx0J0ZST05URU5EX1NFQ1VSSVRZX01EX1BBVEggJyxcblx0cHJvY2Vzcy5lbnYuRlJPTlRFTkRfU0VDVVJJVFlfTURfUEFUSCxcblx0J0ZST05URU5EX1NFQ1JFVFNfUEFUSCAnLFxuXHRwcm9jZXNzLmVudi5GUk9OVEVORF9TRUNSRVRTX1BBVEgsXG5cdCdGUk9OVEVORF9TSVRFTUFQX1hNTF9QQVRIICcsXG5cdHByb2Nlc3MuZW52LkZST05URU5EX1NJVEVNQVBfWE1MX1BBVEgsXG5cdCdTRVJWRVJfREFUQV9GSUxFX1BBVEhfMSAnLFxuXHRwcm9jZXNzLmVudi5TRVJWRVJfREFUQV9GSUxFX1BBVEhfMSxcblx0J1NFUlZFUl9EQVRBX0ZJTEVfUEFUSF8yICcsXG5cdHByb2Nlc3MuZW52LlNFUlZFUl9EQVRBX0ZJTEVfUEFUSF8yLFxuXHQnU0VSVkVSX0RBVEFfRklMRV9QQVRIXzMgJyxcblx0cHJvY2Vzcy5lbnYuU0VSVkVSX0RBVEFfRklMRV9QQVRIXzMsXG5cdCdTRVJWRVJfREFUQV9GSUxFX1BBVEhfNCAnLFxuXHRwcm9jZXNzLmVudi5TRVJWRVJfREFUQV9GSUxFX1BBVEhfNCxcblx0J1NFUlZFUl9MT0dfUEFUSCAnLFxuXHRwcm9jZXNzLmVudi5TRVJWRVJfTE9HX1BBVEgsXG5cdCdTRVJWRVJfTlBNX0xPR19QQVRIICcsXG5cdHByb2Nlc3MuZW52LlNFUlZFUl9OUE1fTE9HX1BBVEgsXG5cdCdTRVJWRVJfU1NMX0tFWV9QQVRIICcsXG5cdHByb2Nlc3MuZW52LlNFUlZFUl9TU0xfS0VZX1BBVEgsXG5cdCdTRVJWRVJfU1NMX0NFUlRfUEFUSCAnLFxuXHRwcm9jZXNzLmVudi5TRVJWRVJfU1NMX0NFUlRfUEFUSCxcblx0J0ZFQVRVUkUgQVBJIFJPVVRFUyBDU1JGICcsXG5cdHByb2Nlc3MuZW52LkZFQVRVUkVfQVBJX1JPVVRFU19DU1JGLFxuXHQnRkVBVFVSRSBEQiBTWU5DICcsXG5cdHByb2Nlc3MuZW52LkZFQVRVUkVfREJfU1lOQyxcblx0J0ZFQVRVUkUgSFRUUFMgUkVESVJFQ1QgJyxcblx0cHJvY2Vzcy5lbnYuRkVBVFVSRV9IVFRQU19SRURJUkVDVCxcblx0J0ZFQVRVUkUgSVAgQkxBQ0tMSVNUICcsXG5cdHByb2Nlc3MuZW52LkZFQVRVUkVfSVBfQkxBQ0tMSVNULFxuXHQnRkVBVFVSRSBMT0FEIFNUQVRJQyBST1VURVMgJyxcblx0cHJvY2Vzcy5lbnYuRkVBVFVSRV9MT0FEX1NUQVRJQ19ST1VURVMsXG5cdCdGRUFUVVJFIExPQUQgVEVTVCBST1VURVMgJyxcblx0cHJvY2Vzcy5lbnYuRkVBVFVSRV9MT0FEX1RFU1RfUk9VVEVTLFxuXHQnRkVBVFVSRSBTRUNVUkUgSEVBREVSUyAnLFxuXHRwcm9jZXNzLmVudi5GRUFUVVJFX1NFQ1VSRV9IRUFERVJTLFxuXHQnRkVBVFVSRSBTRVFVRUxJWkUgTE9HR0lORyAnLFxuXHRwcm9jZXNzLmVudi5GRUFUVVJFX1NFUVVFTElaRV9MT0dHSU5HLFxuXHQnTE9HR0VSICcsXG5cdHByb2Nlc3MuZW52LkxPR0dFUixcblx0J1lVQklDTyBBUEkgVVJMICcsXG5cdHByb2Nlc3MuZW52LllVQklDT19BUElfVVJMXG4pO1xuXG5jb25zdCBmZWF0dXJlRmxhZ3MgPSBnZXRGZWF0dXJlRmxhZ3MoKTtcblxudHJ5IHtcblx0bG9nZ2VyLmluZm8oJ0luaXRpYWxpemluZyBkYXRhYmFzZScpO1xuXHRhd2FpdCBpbml0aWFsaXplRGF0YWJhc2UoKTtcblxuXHRsb2dnZXIuaW5mbygnSW5pdGlhbGl6aW5nIG1vZGVscycpO1xuXHRpbml0aWFsaXplTW9kZWxzKCk7XG5cblx0bG9nZ2VyLmluZm8oJ0luaXRpYWxpemluZyBwYXNzcG9ydCcpO1xuXHRhd2FpdCBjb25maWd1cmVQYXNzcG9ydChwYXNzcG9ydCk7XG5cblx0bG9nZ2VyLmluZm8oJ0luaXRpYWxpemluZyBJUCBibGFja2xpc3QnKTtcblx0YXdhaXQgaW5pdGlhbGl6ZUlwQmxhY2tsaXN0KCk7XG5cblx0bG9nZ2VyLmluZm8oJ0luaXRpYWxpemluZyBhcHAnKTtcblx0YXdhaXQgaW5pdGlhbGl6ZUFwcCgpO1xuXG5cdGNvbnN0IGRiU3luY0ZsYWcgPSBmZWF0dXJlRmxhZ3M/LmRiU3luY0ZsYWcgPz8gZmFsc2U7XG5cdGlmIChkYlN5bmNGbGFnKSB7XG5cdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHQnVGVzdGluZyBkYXRhYmFzZSBjb25uZWN0aW9uIGFuZCBzeW5jaW5nIG1vZGVscyB1c2luZyBnZXRTZXF1ZWxpemVJbnN0YW5jZSdcblx0XHQpO1xuXHRcdGNvbnN0IHNlcXVlbGl6ZSA9IGdldFNlcXVlbGl6ZUluc3RhbmNlKCk7XG5cdFx0dHJ5IHtcblx0XHRcdGF3YWl0IHNlcXVlbGl6ZS5zeW5jKCk7XG5cdFx0XHRsb2dnZXIuaW5mbygnRGF0YWJhc2UgYW5kIHRhYmxlcyBjcmVhdGVkIScpO1xuXHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHQnRGF0YWJhc2UgQ29ubmVjdGlvbiBUZXN0IGFuZCBTeW5jOiBTZXJ2ZXIgZXJyb3I6Jyxcblx0XHRcdFx0ZXJyXG5cdFx0XHQpO1xuXHRcdFx0cHJvY2Vzcy5leGl0KDEpO1xuXHRcdH1cblx0fVxuXG5cdGxvZ2dlci5pbmZvKCdTdGFydGluZyBzZXJ2ZXInKTtcblx0Y29uc3QgeyBzdGFydFNlcnZlciB9ID0gYXdhaXQgc2V0dXBIdHRwKGFwcCk7XG5cdHN0YXJ0U2VydmVyKCk7XG5cdGxvZ2dlci5pbmZvKCdTZXJ2ZXIgc3RhcnRlZCBzdWNjZXNzZnVsbHkhJyk7XG59IGNhdGNoIChlcnIpIHtcblx0bG9nZ2VyLmVycm9yKCdVbmhhbmRsZWQgZXJyb3IgZHVyaW5nIHNlcnZlciBpbml0aWFsaXphdGlvbjonLCBlcnIpO1xuXHRwcm9jZXNzLmV4aXQoMSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFwcDtcbiJdfQ==
