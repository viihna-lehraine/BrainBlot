import '../../types/custom/express-session';
export function createSlowdownMiddleware({
	slowdownThreshold = 100 // default threshold in ms, can be customized
}) {
	return function slowdownMiddleware(req, res, next) {
		const requestTime = Date.now();
		// check if request time has already been stored for this IP
		if (!req.session.lastRequestTime) {
			req.session.lastRequestTime = requestTime;
			next();
		} else {
			const timeDiff = requestTime - req.session.lastRequestTime;
			if (timeDiff < slowdownThreshold) {
				const waitTime = slowdownThreshold - timeDiff;
				setTimeout(() => {
					req.session.lastRequestTime = requestTime;
					next();
				}, waitTime);
			} else {
				req.session.lastRequestTime = requestTime;
				next();
			}
		}
	};
}
export default createSlowdownMiddleware;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xvd2Rvd24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWlkZGxld2FyZS9zbG93ZG93bi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLG9DQUFvQyxDQUFDO0FBTTVDLE1BQU0sVUFBVSx3QkFBd0IsQ0FBQyxFQUN4QyxpQkFBaUIsR0FBRyxHQUFHLENBQUMsNkNBQTZDO0VBQ3JEO0lBQ2hCLE9BQU8sU0FBUyxrQkFBa0IsQ0FDakMsR0FBWSxFQUNaLEdBQWEsRUFDYixJQUFrQjtRQUVsQixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFL0IsNERBQTREO1FBQzVELElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxDQUFDO1lBQ2xDLEdBQUcsQ0FBQyxPQUFPLENBQUMsZUFBZSxHQUFHLFdBQVcsQ0FBQztZQUMxQyxJQUFJLEVBQUUsQ0FBQztRQUNSLENBQUM7YUFBTSxDQUFDO1lBQ1AsTUFBTSxRQUFRLEdBQUcsV0FBVyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDO1lBRTNELElBQUksUUFBUSxHQUFHLGlCQUFpQixFQUFFLENBQUM7Z0JBQ2xDLE1BQU0sUUFBUSxHQUFHLGlCQUFpQixHQUFHLFFBQVEsQ0FBQztnQkFDOUMsVUFBVSxDQUFDLEdBQUcsRUFBRTtvQkFDZixHQUFHLENBQUMsT0FBTyxDQUFDLGVBQWUsR0FBRyxXQUFXLENBQUM7b0JBQzFDLElBQUksRUFBRSxDQUFDO2dCQUNSLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUNkLENBQUM7aUJBQU0sQ0FBQztnQkFDUCxHQUFHLENBQUMsT0FBTyxDQUFDLGVBQWUsR0FBRyxXQUFXLENBQUM7Z0JBQzFDLElBQUksRUFBRSxDQUFDO1lBQ1IsQ0FBQztRQUNGLENBQUM7SUFDRixDQUFDLENBQUM7QUFDSCxDQUFDO0FBRUQsZUFBZSx3QkFBd0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRGdW5jdGlvbiwgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCAnLi4vLi4vdHlwZXMvY3VzdG9tL2V4cHJlc3Mtc2Vzc2lvbic7XG5cbmludGVyZmFjZSBTbG93ZG93bkNvbmZpZyB7XG5cdHNsb3dkb3duVGhyZXNob2xkOiBudW1iZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTbG93ZG93bk1pZGRsZXdhcmUoe1xuXHRzbG93ZG93blRocmVzaG9sZCA9IDEwMCAvLyBkZWZhdWx0IHRocmVzaG9sZCBpbiBtcywgY2FuIGJlIGN1c3RvbWl6ZWRcbn06IFNsb3dkb3duQ29uZmlnKSB7XG5cdHJldHVybiBmdW5jdGlvbiBzbG93ZG93bk1pZGRsZXdhcmUoXG5cdFx0cmVxOiBSZXF1ZXN0LFxuXHRcdHJlczogUmVzcG9uc2UsXG5cdFx0bmV4dDogTmV4dEZ1bmN0aW9uXG5cdCk6IHZvaWQge1xuXHRcdGNvbnN0IHJlcXVlc3RUaW1lID0gRGF0ZS5ub3coKTtcblxuXHRcdC8vIGNoZWNrIGlmIHJlcXVlc3QgdGltZSBoYXMgYWxyZWFkeSBiZWVuIHN0b3JlZCBmb3IgdGhpcyBJUFxuXHRcdGlmICghcmVxLnNlc3Npb24ubGFzdFJlcXVlc3RUaW1lKSB7XG5cdFx0XHRyZXEuc2Vzc2lvbi5sYXN0UmVxdWVzdFRpbWUgPSByZXF1ZXN0VGltZTtcblx0XHRcdG5leHQoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uc3QgdGltZURpZmYgPSByZXF1ZXN0VGltZSAtIHJlcS5zZXNzaW9uLmxhc3RSZXF1ZXN0VGltZTtcblxuXHRcdFx0aWYgKHRpbWVEaWZmIDwgc2xvd2Rvd25UaHJlc2hvbGQpIHtcblx0XHRcdFx0Y29uc3Qgd2FpdFRpbWUgPSBzbG93ZG93blRocmVzaG9sZCAtIHRpbWVEaWZmO1xuXHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRyZXEuc2Vzc2lvbi5sYXN0UmVxdWVzdFRpbWUgPSByZXF1ZXN0VGltZTtcblx0XHRcdFx0XHRuZXh0KCk7XG5cdFx0XHRcdH0sIHdhaXRUaW1lKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHJlcS5zZXNzaW9uLmxhc3RSZXF1ZXN0VGltZSA9IHJlcXVlc3RUaW1lO1xuXHRcdFx0XHRuZXh0KCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVTbG93ZG93bk1pZGRsZXdhcmU7XG4iXX0=
