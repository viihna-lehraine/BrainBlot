export const createJwtAuthMiddleWare = ({
	logger,
	featureFlags,
	verifyJwToken
}) => {
	const JWT_AUTH_ENABLED = featureFlags.enableJwtAuthFlag;
	return async (req, res, next) => {
		if (JWT_AUTH_ENABLED) {
			logger.info('JWT Auth is enabled');
			const token = req.headers.authorization?.split(' ')[1];
			if (!token) {
				res.sendStatus(403);
				return;
			}
			const user = await verifyJwToken(token);
			if (!user) {
				res.sendStatus(403);
				return;
			}
			req.user = user;
			next();
		} else {
			logger.info('JWT Auth is disabled');
			next();
		}
	};
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiand0QXV0aE1pZGRsZXdhcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWlkZGxld2FyZS9qd3RBdXRoTWlkZGxld2FyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFVQSxNQUFNLENBQUMsTUFBTSx1QkFBdUIsR0FBRyxDQUFDLEVBQ3ZDLE1BQU0sRUFDTixZQUFZLEVBQ1osYUFBYSxFQUNrQixFQUFFLEVBQUU7SUFDbkMsTUFBTSxnQkFBZ0IsR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUM7SUFFeEQsT0FBTyxLQUFLLEVBQ1gsR0FBWSxFQUNaLEdBQWEsRUFDYixJQUFrQixFQUNGLEVBQUU7UUFDbEIsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO1lBQ3RCLE1BQU0sQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUNuQyxNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFdkQsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUNaLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BCLE9BQU87WUFDUixDQUFDO1lBRUQsTUFBTSxJQUFJLEdBQUcsTUFBTSxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFeEMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNYLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BCLE9BQU87WUFDUixDQUFDO1lBRUQsR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDaEIsSUFBSSxFQUFFLENBQUM7UUFDUixDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztZQUNwQyxJQUFJLEVBQUUsQ0FBQztRQUNSLENBQUM7SUFDRixDQUFDLENBQUM7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0RnVuY3Rpb24sIFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XG5cbmludGVyZmFjZSBKd3RBdXRoTWlkZGxld2FyZURlcGVuZGVuY2llcyB7XG5cdGxvZ2dlcjogUmV0dXJuVHlwZTx0eXBlb2YgaW1wb3J0KCcuLi9jb25maWcvbG9nZ2VyJykuZGVmYXVsdD47XG5cdGZlYXR1cmVGbGFnczogUmV0dXJuVHlwZTxcblx0XHR0eXBlb2YgaW1wb3J0KCcuLi9jb25maWcvZmVhdHVyZUZsYWdzJykuZ2V0RmVhdHVyZUZsYWdzXG5cdD47XG5cdHZlcmlmeUp3VG9rZW46ICh0b2tlbjogc3RyaW5nKSA9PiBQcm9taXNlPHN0cmluZyB8IG9iamVjdCB8IG51bGw+O1xufVxuXG5leHBvcnQgY29uc3QgY3JlYXRlSnd0QXV0aE1pZGRsZVdhcmUgPSAoe1xuXHRsb2dnZXIsXG5cdGZlYXR1cmVGbGFncyxcblx0dmVyaWZ5SndUb2tlblxufTogSnd0QXV0aE1pZGRsZXdhcmVEZXBlbmRlbmNpZXMpID0+IHtcblx0Y29uc3QgSldUX0FVVEhfRU5BQkxFRCA9IGZlYXR1cmVGbGFncy5lbmFibGVKd3RBdXRoRmxhZztcblxuXHRyZXR1cm4gYXN5bmMgKFxuXHRcdHJlcTogUmVxdWVzdCxcblx0XHRyZXM6IFJlc3BvbnNlLFxuXHRcdG5leHQ6IE5leHRGdW5jdGlvblxuXHQpOiBQcm9taXNlPHZvaWQ+ID0+IHtcblx0XHRpZiAoSldUX0FVVEhfRU5BQkxFRCkge1xuXHRcdFx0bG9nZ2VyLmluZm8oJ0pXVCBBdXRoIGlzIGVuYWJsZWQnKTtcblx0XHRcdGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbj8uc3BsaXQoJyAnKVsxXTtcblxuXHRcdFx0aWYgKCF0b2tlbikge1xuXHRcdFx0XHRyZXMuc2VuZFN0YXR1cyg0MDMpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IHVzZXIgPSBhd2FpdCB2ZXJpZnlKd1Rva2VuKHRva2VuKTtcblxuXHRcdFx0aWYgKCF1c2VyKSB7XG5cdFx0XHRcdHJlcy5zZW5kU3RhdHVzKDQwMyk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0cmVxLnVzZXIgPSB1c2VyO1xuXHRcdFx0bmV4dCgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2dnZXIuaW5mbygnSldUIEF1dGggaXMgZGlzYWJsZWQnKTtcblx0XHRcdG5leHQoKTtcblx0XHR9XG5cdH07XG59O1xuIl19
