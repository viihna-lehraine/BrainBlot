import { verifyJwToken } from '../utils/auth/jwtUtil.mjs';
import { getFeatureFlags } from 'src/config/featureFlags';
import setupLogger from 'src/config/logger';
const featureFlags = getFeatureFlags();
const logger = setupLogger();
const JWT_AUTH_ENABLED = featureFlags.enableJwtAuthFlag;
export const authenticateJwT = async (req, res, next) => {
	if (JWT_AUTH_ENABLED) {
		logger.info('JWT Auth is enabled');
		const token = req.headers.authorization?.split(' ')[1];
		if (!token) {
			res.sendStatus(403);
			return;
		}
		const user = await verifyJwToken(token);
		if (!user) {
			res.sendStatus(403);
			return;
		}
		req.user = user;
		next();
	} else {
		logger.info('JWT Auth is disabled');
		next();
	}
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiand0QXV0aE1pZGRsZXdhcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWlkZGxld2FyZS9qd3RBdXRoTWlkZGxld2FyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzFELE9BQU8sV0FBVyxNQUFNLG1CQUFtQixDQUFDO0FBRTVDLE1BQU0sWUFBWSxHQUFHLGVBQWUsRUFBRSxDQUFDO0FBQ3ZDLE1BQU0sTUFBTSxHQUFHLFdBQVcsRUFBRSxDQUFDO0FBQzdCLE1BQU0sZ0JBQWdCLEdBQUcsWUFBWSxDQUFDLGlCQUFpQixDQUFDO0FBRXhELE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBRyxLQUFLLEVBQ25DLEdBQVksRUFDWixHQUFhLEVBQ2IsSUFBa0IsRUFDRixFQUFFO0lBQ2xCLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztRQUN0QixNQUFNLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDbkMsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXZELElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNaLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDcEIsT0FBTztRQUNSLENBQUM7UUFFRCxNQUFNLElBQUksR0FBRyxNQUFNLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUV4QyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDWCxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3BCLE9BQU87UUFDUixDQUFDO1FBRUQsR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEIsSUFBSSxFQUFFLENBQUM7SUFDUixDQUFDO1NBQU0sQ0FBQztRQUNQLE1BQU0sQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUNwQyxJQUFJLEVBQUUsQ0FBQztJQUNSLENBQUM7QUFDRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0RnVuY3Rpb24sIFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyB2ZXJpZnlKd1Rva2VuIH0gZnJvbSAnLi4vdXRpbHMvYXV0aC9qd3RVdGlsJztcbmltcG9ydCB7IGdldEZlYXR1cmVGbGFncyB9IGZyb20gJ3NyYy9jb25maWcvZmVhdHVyZUZsYWdzJztcbmltcG9ydCBzZXR1cExvZ2dlciBmcm9tICdzcmMvY29uZmlnL2xvZ2dlcic7XG5cbmNvbnN0IGZlYXR1cmVGbGFncyA9IGdldEZlYXR1cmVGbGFncygpO1xuY29uc3QgbG9nZ2VyID0gc2V0dXBMb2dnZXIoKTtcbmNvbnN0IEpXVF9BVVRIX0VOQUJMRUQgPSBmZWF0dXJlRmxhZ3MuZW5hYmxlSnd0QXV0aEZsYWc7XG5cbmV4cG9ydCBjb25zdCBhdXRoZW50aWNhdGVKd1QgPSBhc3luYyAoXG5cdHJlcTogUmVxdWVzdCxcblx0cmVzOiBSZXNwb25zZSxcblx0bmV4dDogTmV4dEZ1bmN0aW9uXG4pOiBQcm9taXNlPHZvaWQ+ID0+IHtcblx0aWYgKEpXVF9BVVRIX0VOQUJMRUQpIHtcblx0XHRsb2dnZXIuaW5mbygnSldUIEF1dGggaXMgZW5hYmxlZCcpO1xuXHRcdGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbj8uc3BsaXQoJyAnKVsxXTtcblxuXHRcdGlmICghdG9rZW4pIHtcblx0XHRcdHJlcy5zZW5kU3RhdHVzKDQwMyk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y29uc3QgdXNlciA9IGF3YWl0IHZlcmlmeUp3VG9rZW4odG9rZW4pO1xuXG5cdFx0aWYgKCF1c2VyKSB7XG5cdFx0XHRyZXMuc2VuZFN0YXR1cyg0MDMpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdHJlcS51c2VyID0gdXNlcjtcblx0XHRuZXh0KCk7XG5cdH0gZWxzZSB7XG5cdFx0bG9nZ2VyLmluZm8oJ0pXVCBBdXRoIGlzIGRpc2FibGVkJyk7XG5cdFx0bmV4dCgpO1xuXHR9XG59O1xuIl19
