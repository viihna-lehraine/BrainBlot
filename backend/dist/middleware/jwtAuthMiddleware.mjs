export const createJwtAuthMiddleWare = ({
	logger,
	featureFlags,
	verifyJwToken
}) => {
	const JWT_AUTH_ENABLED = featureFlags.enableJwtAuthFlag;
	return async (req, res, next) => {
		if (JWT_AUTH_ENABLED) {
			logger.info('JWT Auth is enabled');
			const token = req.headers.authorization?.split(' ')[1];
			if (!token) {
				res.sendStatus(403);
				return;
			}
			const user = await verifyJwToken(token);
			if (!user) {
				res.sendStatus(403);
				return;
			}
			req.user = user;
			next();
		} else {
			logger.info('JWT Auth is disabled');
			next();
		}
	};
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiand0QXV0aE1pZGRsZXdhcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbWlkZGxld2FyZS9qd3RBdXRoTWlkZGxld2FyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFVQSxNQUFNLENBQUMsTUFBTSx1QkFBdUIsR0FBRyxDQUFDLEVBQ3ZDLE1BQU0sRUFDTixZQUFZLEVBQ1osYUFBYSxFQUNrQixFQUFFLEVBQUU7SUFDbkMsTUFBTSxnQkFBZ0IsR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUM7SUFFeEQsT0FBTyxLQUFLLEVBQ1gsR0FBWSxFQUNaLEdBQWEsRUFDYixJQUFrQixFQUNGLEVBQUU7UUFDbEIsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO1lBQ3RCLE1BQU0sQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUNuQyxNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFdkQsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUNaLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BCLE9BQU87WUFDUixDQUFDO1lBRUQsTUFBTSxJQUFJLEdBQUcsTUFBTSxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFeEMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNYLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BCLE9BQU87WUFDUixDQUFDO1lBRUQsR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDaEIsSUFBSSxFQUFFLENBQUM7UUFDUixDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztZQUNwQyxJQUFJLEVBQUUsQ0FBQztRQUNSLENBQUM7SUFDRixDQUFDLENBQUM7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0RnVuY3Rpb24sIFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XG5cbmludGVyZmFjZSBKd3RBdXRoTWlkZGxld2FyZURlcGVuZGVuY2llcyB7XG5cdGxvZ2dlcjogUmV0dXJuVHlwZTx0eXBlb2YgaW1wb3J0KCcuLi9jb25maWcvbG9nZ2VyJykuZGVmYXVsdD47XG5cdGZlYXR1cmVGbGFnczogUmV0dXJuVHlwZTxcblx0XHR0eXBlb2YgaW1wb3J0KCcuLi91dGlscy9mZWF0dXJlRmxhZ3MnKS5nZXRGZWF0dXJlRmxhZ3Ncblx0Pjtcblx0dmVyaWZ5SndUb2tlbjogKHRva2VuOiBzdHJpbmcpID0+IFByb21pc2U8c3RyaW5nIHwgb2JqZWN0IHwgbnVsbD47XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVKd3RBdXRoTWlkZGxlV2FyZSA9ICh7XG5cdGxvZ2dlcixcblx0ZmVhdHVyZUZsYWdzLFxuXHR2ZXJpZnlKd1Rva2VuXG59OiBKd3RBdXRoTWlkZGxld2FyZURlcGVuZGVuY2llcykgPT4ge1xuXHRjb25zdCBKV1RfQVVUSF9FTkFCTEVEID0gZmVhdHVyZUZsYWdzLmVuYWJsZUp3dEF1dGhGbGFnO1xuXG5cdHJldHVybiBhc3luYyAoXG5cdFx0cmVxOiBSZXF1ZXN0LFxuXHRcdHJlczogUmVzcG9uc2UsXG5cdFx0bmV4dDogTmV4dEZ1bmN0aW9uXG5cdCk6IFByb21pc2U8dm9pZD4gPT4ge1xuXHRcdGlmIChKV1RfQVVUSF9FTkFCTEVEKSB7XG5cdFx0XHRsb2dnZXIuaW5mbygnSldUIEF1dGggaXMgZW5hYmxlZCcpO1xuXHRcdFx0Y29uc3QgdG9rZW4gPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uPy5zcGxpdCgnICcpWzFdO1xuXG5cdFx0XHRpZiAoIXRva2VuKSB7XG5cdFx0XHRcdHJlcy5zZW5kU3RhdHVzKDQwMyk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Y29uc3QgdXNlciA9IGF3YWl0IHZlcmlmeUp3VG9rZW4odG9rZW4pO1xuXG5cdFx0XHRpZiAoIXVzZXIpIHtcblx0XHRcdFx0cmVzLnNlbmRTdGF0dXMoNDAzKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXEudXNlciA9IHVzZXI7XG5cdFx0XHRuZXh0KCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGxvZ2dlci5pbmZvKCdKV1QgQXV0aCBpcyBkaXNhYmxlZCcpO1xuXHRcdFx0bmV4dCgpO1xuXHRcdH1cblx0fTtcbn07XG4iXX0=
