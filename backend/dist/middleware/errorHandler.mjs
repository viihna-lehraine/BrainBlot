import AppError from '../errors/AppError.mjs';
import setupLogger from '../config/logger.mjs';
import { getFeatureFlags } from '../config/featureFlags.mjs';
const logger = setupLogger();
const featureFlags = getFeatureFlags();
const ERROR_HANDLER_ENABLED = featureFlags.enableErrorHandlerFlag;
function errorHandler(err, req, res, next) {
	if (ERROR_HANDLER_ENABLED) {
		logger.info('Error handler middleware enabled');
		if (err instanceof AppError) {
			// operational, trusted error: send message to client
			logger.error(`Operational error occurred: ${err.message}`);
			res.status(err.statusCode).json({
				status: 'error',
				message: err.message
			});
			next();
		} else {
			// programming or other unknown error: don't leak error details
			logger.error(`Unexpected error occured: ${err.message}`);
			res.status(500).json({
				status: 'error',
				message: 'Internal server error'
			});
			next();
		}
	} else {
		logger.info('Error handler middleware disabled');
		next();
	}
}
export default errorHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3JIYW5kbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL21pZGRsZXdhcmUvZXJyb3JIYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sUUFBUSxNQUFNLG9CQUFvQixDQUFDO0FBQzFDLE9BQU8sV0FBVyxNQUFNLGtCQUFrQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUV6RCxNQUFNLE1BQU0sR0FBRyxXQUFXLEVBQUUsQ0FBQztBQUM3QixNQUFNLFlBQVksR0FBRyxlQUFlLEVBQUUsQ0FBQztBQUN2QyxNQUFNLHFCQUFxQixHQUFHLFlBQVksQ0FBQyxzQkFBc0IsQ0FBQztBQUVsRSxTQUFTLFlBQVksQ0FDcEIsR0FBcUIsRUFDckIsR0FBWSxFQUNaLEdBQWEsRUFDYixJQUFrQjtJQUVsQixJQUFJLHFCQUFxQixFQUFFLENBQUM7UUFDM0IsTUFBTSxDQUFDLElBQUksQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1FBQ2hELElBQUksR0FBRyxZQUFZLFFBQVEsRUFBRSxDQUFDO1lBQzdCLHFEQUFxRDtZQUNyRCxNQUFNLENBQUMsS0FBSyxDQUFDLCtCQUErQixHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUMzRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQy9CLE1BQU0sRUFBRSxPQUFPO2dCQUNmLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBTzthQUNwQixDQUFDLENBQUM7WUFDSCxJQUFJLEVBQUUsQ0FBQztRQUNSLENBQUM7YUFBTSxDQUFDO1lBQ1AsK0RBQStEO1lBQy9ELE1BQU0sQ0FBQyxLQUFLLENBQUMsNkJBQTZCLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3pELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNwQixNQUFNLEVBQUUsT0FBTztnQkFDZixPQUFPLEVBQUUsdUJBQXVCO2FBQ2hDLENBQUMsQ0FBQztZQUNILElBQUksRUFBRSxDQUFDO1FBQ1IsQ0FBQztJQUNGLENBQUM7U0FBTSxDQUFDO1FBQ1AsTUFBTSxDQUFDLElBQUksQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO1FBQ2pELElBQUksRUFBRSxDQUFDO0lBQ1IsQ0FBQztBQUNGLENBQUM7QUFFRCxlQUFlLFlBQVksQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBBcHBFcnJvciBmcm9tICcuLi9lcnJvcnMvQXBwRXJyb3InO1xuaW1wb3J0IHNldHVwTG9nZ2VyIGZyb20gJy4uL2NvbmZpZy9sb2dnZXInO1xuaW1wb3J0IHsgZ2V0RmVhdHVyZUZsYWdzIH0gZnJvbSAnLi4vY29uZmlnL2ZlYXR1cmVGbGFncyc7XG5cbmNvbnN0IGxvZ2dlciA9IHNldHVwTG9nZ2VyKCk7XG5jb25zdCBmZWF0dXJlRmxhZ3MgPSBnZXRGZWF0dXJlRmxhZ3MoKTtcbmNvbnN0IEVSUk9SX0hBTkRMRVJfRU5BQkxFRCA9IGZlYXR1cmVGbGFncy5lbmFibGVFcnJvckhhbmRsZXJGbGFnO1xuXG5mdW5jdGlvbiBlcnJvckhhbmRsZXIoXG5cdGVycjogQXBwRXJyb3IgfCBFcnJvcixcblx0cmVxOiBSZXF1ZXN0LFxuXHRyZXM6IFJlc3BvbnNlLFxuXHRuZXh0OiBOZXh0RnVuY3Rpb25cbik6IHZvaWQge1xuXHRpZiAoRVJST1JfSEFORExFUl9FTkFCTEVEKSB7XG5cdFx0bG9nZ2VyLmluZm8oJ0Vycm9yIGhhbmRsZXIgbWlkZGxld2FyZSBlbmFibGVkJyk7XG5cdFx0aWYgKGVyciBpbnN0YW5jZW9mIEFwcEVycm9yKSB7XG5cdFx0XHQvLyBvcGVyYXRpb25hbCwgdHJ1c3RlZCBlcnJvcjogc2VuZCBtZXNzYWdlIHRvIGNsaWVudFxuXHRcdFx0bG9nZ2VyLmVycm9yKGBPcGVyYXRpb25hbCBlcnJvciBvY2N1cnJlZDogJHtlcnIubWVzc2FnZX1gKTtcblx0XHRcdHJlcy5zdGF0dXMoZXJyLnN0YXR1c0NvZGUpLmpzb24oe1xuXHRcdFx0XHRzdGF0dXM6ICdlcnJvcicsXG5cdFx0XHRcdG1lc3NhZ2U6IGVyci5tZXNzYWdlXG5cdFx0XHR9KTtcblx0XHRcdG5leHQoKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gcHJvZ3JhbW1pbmcgb3Igb3RoZXIgdW5rbm93biBlcnJvcjogZG9uJ3QgbGVhayBlcnJvciBkZXRhaWxzXG5cdFx0XHRsb2dnZXIuZXJyb3IoYFVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJlZDogJHtlcnIubWVzc2FnZX1gKTtcblx0XHRcdHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcblx0XHRcdFx0c3RhdHVzOiAnZXJyb3InLFxuXHRcdFx0XHRtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xuXHRcdFx0fSk7XG5cdFx0XHRuZXh0KCk7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdGxvZ2dlci5pbmZvKCdFcnJvciBoYW5kbGVyIG1pZGRsZXdhcmUgZGlzYWJsZWQnKTtcblx0XHRuZXh0KCk7XG5cdH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgZXJyb3JIYW5kbGVyO1xuIl19
