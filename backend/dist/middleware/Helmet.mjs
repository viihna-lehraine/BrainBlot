import helmet from 'helmet';
import {
	cspOptions,
	helmetOptions,
	permissionsPolicyOptions
} from '../config/middlewareOptions.mjs';
import { ServiceFactory } from '../index/factory.mjs';
import { withRetry } from '../utils/helpers.mjs';
export class HelmetMiddlewareService {
	static instance = null;
	logger;
	errorLogger;
	errorHandler;
	constructor(logger, errorLogger, errorHandler) {
		this.logger = logger;
		this.errorLogger = errorLogger;
		this.errorHandler = errorHandler;
	}
	static async getInstance() {
		if (!HelmetMiddlewareService.instance) {
			const logger = await ServiceFactory.getLoggerService();
			const errorLogger = await ServiceFactory.getErrorLoggerService();
			const errorHandler = await ServiceFactory.getErrorHandlerService();
			HelmetMiddlewareService.instance = new HelmetMiddlewareService(
				logger,
				errorLogger,
				errorHandler
			);
		}
		return HelmetMiddlewareService.instance;
	}
	async initializeHelmetMiddleware(app) {
		try {
			await withRetry(() => this.applyHelmet(app), 3, 1000);
			await withRetry(() => this.applyCSP(app), 3, 1000);
			await withRetry(() => this.applyReferrerPolicy(app), 3, 1000);
			await withRetry(() => this.applyExpectCT(app), 3, 1000);
			await withRetry(() => this.applyPermissionsPolicy(app), 3, 1000);
			await withRetry(() => this.applyCrossOriginPolicies(app), 3, 1000);
			await withRetry(() => this.applyXssFilter(app), 3, 1000);
			this.logger.info('Helmet middleware initialized successfully');
		} catch (error) {
			this.errorLogger.logError(
				'Failed to initialize Helmet middleware stack'
			);
			this.errorHandler.handleError({ error });
		}
	}
	async applyHelmet(app) {
		try {
			this.logger.info('Applying Helmet middleware');
			app.use(helmet(helmetOptions));
			this.logger.info('Helmet middleware applied successfully');
		} catch (configError) {
			this.handleHelmetError('applyHelmet', configError);
		}
	}
	async applyCSP(app) {
		try {
			this.logger.info('Applying Content Security Policy');
			app.use(
				helmet.contentSecurityPolicy({
					directives: {
						...cspOptions.directives,
						styleSrc: ['self', 'nonce-{NONCE}'],
						scriptSrc: ['self', 'nonce-{NONCE}']
					},
					reportOnly: cspOptions.reportOnly
				})
			);
			this.logger.info('Content Security Policy applied successfully');
		} catch (configError) {
			this.handleHelmetError('applyContentSecurityPolicy', configError);
		}
	}
	async applyExpectCT(app) {
		try {
			app.use((req, res, next) => {
				res.setHeader('Expect-CT', 'enforce, max-age=86400');
				this.logger.info('Expect-CT header set successfully');
				next();
			});
		} catch (configError) {
			this.handleHelmetError('applyExpectCT', configError);
		}
	}
	async applyPermissionsPolicy(app) {
		if (
			permissionsPolicyOptions &&
			typeof permissionsPolicyOptions === 'object'
		) {
			app.use((req, res, next) => {
				try {
					const policies = Object.entries(permissionsPolicyOptions)
						.map(
							([feature, origins]) =>
								`${feature} ${origins.join(' ')}`
						)
						.join(', ');
					res.setHeader('Permissions-Policy', policies);
					this.logger.info(
						'Permissions-Policy header set successfully'
					);
					next();
				} catch (expressError) {
					this.handleHelmetExpressError(
						'Permissions-Policy Middleware',
						expressError,
						req,
						res,
						next
					);
				}
			});
		} else {
			this.logger.warn(
				'Permissions-Policy options are not provided or invalid'
			);
		}
	}
	async applyCrossOriginPolicies(app) {
		try {
			this.logger.info('Applying Cross-Origin policies');
			app.use(helmet.crossOriginOpenerPolicy({ policy: 'same-origin' }));
			app.use(
				helmet.crossOriginResourcePolicy({ policy: 'same-origin' })
			);
			app.use(
				helmet.crossOriginEmbedderPolicy({ policy: 'require-corp' })
			);
			this.logger.info('Cross-Origin policies applied successfully');
		} catch (configError) {
			this.handleHelmetError('applyCrossOriginPolicies', configError);
		}
	}
	async applyReferrerPolicy(app) {
		try {
			this.logger.info('Applying Referrer-Policy');
			app.use(helmet.referrerPolicy({ policy: 'same-origin' }));
			this.logger.info('Referrer-Policy applied successfully');
		} catch (configError) {
			this.handleHelmetError('applyReferrerPolicy', configError);
		}
	}
	async applyXssFilter(app) {
		try {
			this.logger.info('Applying XSS Filter');
			app.use(helmet.xssFilter());
			this.logger.info('XSS Filter applied successfully');
		} catch (configError) {
			this.handleHelmetError('applyXssFilter', configError);
		}
	}
	async shutdown() {
		try {
			this.logger.info('Shutting down Helmet middleware service...');
			HelmetMiddlewareService.instance = null;
			this.logger.info('Helmet middleware service has been shut down.');
		} catch (error) {
			this.errorLogger.logError(
				`Error shutting down Helmet middleware service: ${error instanceof Error ? error.message : error}`
			);
		}
	}
	handleHelmetError(method, error) {
		const configurationError =
			new this.errorHandler.ErrorClasses.ConfigurationError(
				`Failed to apply security headers in ${method}: ${error instanceof Error ? error.message : 'Unknown error'}`,
				{ exposeToClient: false }
			);
		this.errorLogger.logWarn(configurationError.message);
		this.errorHandler.handleError({ error: configurationError });
	}
	handleHelmetExpressError(middleware, error, req, res, next) {
		const expressMiddlewareError =
			new this.errorHandler.ErrorClasses.ExpressError(
				`Error occurred in ${middleware}: ${error instanceof Error ? error.message : String(error)}`,
				{ exposeToClient: false }
			);
		this.errorLogger.logError(expressMiddlewareError.message);
		this.errorHandler.expressErrorHandler()(
			expressMiddlewareError,
			req,
			res,
			next
		);
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSGVsbWV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL21pZGRsZXdhcmUvSGVsbWV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUU1QixPQUFPLEVBQ04sVUFBVSxFQUNWLGFBQWEsRUFDYix3QkFBd0IsRUFDeEIsTUFBTSw2QkFBNkIsQ0FBQztBQU9yQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDbEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRTdDLE1BQU0sT0FBTyx1QkFBdUI7SUFHM0IsTUFBTSxDQUFDLFFBQVEsR0FBbUMsSUFBSSxDQUFDO0lBRXZELE1BQU0sQ0FBNEI7SUFDbEMsV0FBVyxDQUE4QjtJQUN6QyxZQUFZLENBQStCO0lBRW5ELFlBQ0MsTUFBaUMsRUFDakMsV0FBd0MsRUFDeEMsWUFBMEM7UUFFMUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDL0IsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7SUFDbEMsQ0FBQztJQUVNLE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVztRQUM5QixJQUFJLENBQUMsdUJBQXVCLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDdkMsTUFBTSxNQUFNLEdBQUcsTUFBTSxjQUFjLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUN2RCxNQUFNLFdBQVcsR0FBRyxNQUFNLGNBQWMsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBQ2pFLE1BQU0sWUFBWSxHQUFHLE1BQU0sY0FBYyxDQUFDLHNCQUFzQixFQUFFLENBQUM7WUFFbkUsdUJBQXVCLENBQUMsUUFBUSxHQUFHLElBQUksdUJBQXVCLENBQzdELE1BQU0sRUFDTixXQUFXLEVBQ1gsWUFBWSxDQUNaLENBQUM7UUFDSCxDQUFDO1FBRUQsT0FB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LENBQUMsTUFBYyxFQUFFLEtBQWM7UUFDdkQsTUFBTSxrQkFBa0IsR0FDdkIsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxrQkFBa0IsQ0FDcEQsdUNBQXVDLE1BQU0sS0FBSyxLQUFLLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxlQUFlLEVBQUUsRUFDNUcsRUFBRSxjQUFjLEVBQUUsS0FBSyxFQUFFLENBQ3pCLENBQUM7UUFDSCxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyRCxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEtBQUssRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUM7SUFDOUQsQ0FBQztJQUVPLHdCQUF3QixDQUMvQixVQUFrQixFQUNsQixLQUFjLEVBQ2QsR0FBWSxFQUNaLEdBQWEsRUFDYixJQUFrQjtRQUVsQixNQUFNLHNCQUFzQixHQUMzQixJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FDOUMscUJBQXFCLFVBQVUsS0FBSyxLQUFLLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFDNUYsRUFBRSxjQUFjLEVBQUUsS0FBSyxFQUFFLENBQ3pCLENBQUM7UUFDSCxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMxRCxJQUFJLENBQUMsWUFBWSxDQUFDLG1CQUFtQixFQUFFLENBQ3RDLHNCQUFzQixFQUN0QixHQUFHLEVBQ0gsR0FBRyxFQUNILElBQUksQ0FDSixDQUFDO0lBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBoZWxtZXQgZnJvbSAnaGVsbWV0JztcbmltcG9ydCB7IEFwcGxpY2F0aW9uLCBSZXF1ZXN0LCBSZXNwb25zZSwgTmV4dEZ1bmN0aW9uIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQge1xuXHRjc3BPcHRpb25zLFxuXHRoZWxtZXRPcHRpb25zLFxuXHRwZXJtaXNzaW9uc1BvbGljeU9wdGlvbnNcbn0gZnJvbSAnLi4vY29uZmlnL21pZGRsZXdhcmVPcHRpb25zJztcbmltcG9ydCB7XG5cdEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2UsXG5cdEVycm9yTG9nZ2VyU2VydmljZUludGVyZmFjZSxcblx0RXJyb3JIYW5kbGVyU2VydmljZUludGVyZmFjZSxcblx0SGVsbWV0TWlkZGxld2FyZVNlcnZpY2VJbnRlcmZhY2Vcbn0gZnJvbSAnLi4vaW5kZXgvaW50ZXJmYWNlcy9zZXJ2aWNlcyc7XG5pbXBvcnQgeyBTZXJ2aWNlRmFjdG9yeSB9IGZyb20gJy4uL2luZGV4L2ZhY3RvcnknO1xuaW1wb3J0IHsgd2l0aFJldHJ5IH0gZnJvbSAnLi4vdXRpbHMvaGVscGVycyc7XG5cbmV4cG9ydCBjbGFzcyBIZWxtZXRNaWRkbGV3YXJlU2VydmljZVxuXHRpbXBsZW1lbnRzIEhlbG1ldE1pZGRsZXdhcmVTZXJ2aWNlSW50ZXJmYWNlXG57XG5cdHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBIZWxtZXRNaWRkbGV3YXJlU2VydmljZSB8IG51bGwgPSBudWxsO1xuXG5cdHByaXZhdGUgbG9nZ2VyOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIGVycm9yTG9nZ2VyOiBFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2U7XG5cdHByaXZhdGUgZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlO1xuXG5cdHByaXZhdGUgY29uc3RydWN0b3IoXG5cdFx0bG9nZ2VyOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRcdGVycm9yTG9nZ2VyOiBFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2UsXG5cdFx0ZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlXG5cdCkge1xuXHRcdHRoaXMubG9nZ2VyID0gbG9nZ2VyO1xuXHRcdHRoaXMuZXJyb3JMb2dnZXIgPSBlcnJvckxvZ2dlcjtcblx0XHR0aGlzLmVycm9ySGFuZGxlciA9IGVycm9ySGFuZGxlcjtcblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgYXN5bmMgZ2V0SW5zdGFuY2UoKTogUHJvbWlzZTxIZWxtZXRNaWRkbGV3YXJlU2VydmljZT4ge1xuXHRcdGlmICghSGVsbWV0TWlkZGxld2FyZVNlcnZpY2UuaW5zdGFuY2UpIHtcblx0XHRcdGNvbnN0IGxvZ2dlciA9IGF3YWl0IFNlcnZpY2VGYWN0b3J5LmdldExvZ2dlclNlcnZpY2UoKTtcblx0XHRcdGNvbnN0IGVycm9yTG9nZ2VyID0gYXdhaXQgU2VydmljZUZhY3RvcnkuZ2V0RXJyb3JMb2dnZXJTZXJ2aWNlKCk7XG5cdFx0XHRjb25zdCBlcnJvckhhbmRsZXIgPSBhd2FpdCBTZXJ2aWNlRmFjdG9yeS5nZXRFcnJvckhhbmRsZXJTZXJ2aWNlKCk7XG5cblx0XHRcdEhlbG1ldE1pZGRsZXdhcmVTZXJ2aWNlLmluc3RhbmNlID0gbmV3IEhlbG1ldE1pZGRsZXdhcmVTZXJ2aWNlKFxuXHRcdFx0XHRsb2dnZXIsXG5cdFx0XHRcdGVycm9yTG9nZ2VyLFxuXHRcdFx0XHRlcnJvckhhbmRsZXJcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIEhlbG1ldE1pZGRsZXdhcmVTZXJ2aWNlLmluc3RhbmNlO1xuXHR9XG5cblx0cHVibGljIGFzeW5jIGluaXRpYWxpemVIZWxtZXRNaWRkbGV3YXJlKGFwcDogQXBwbGljYXRpb24pOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0cnkge1xuXHRcdFx0YXdhaXQgd2l0aFJldHJ5KCgpID0+IHRoaXMuYXBwbHlIZWxtZXQoYXBwKSwgMywgMTAwMCk7XG5cdFx0XHRhd2FpdCB3aXRoUmV0cnkoKCkgPT4gdGhpcy5hcHBseUNTUChhcHApLCAzLCAxMDAwKTtcblx0XHRcdGF3YWl0IHdpdGhSZXRyeSgoKSA9PiB0aGlzLmFwcGx5UmVmZXJyZXJQb2xpY3koYXBwKSwgMywgMTAwMCk7XG5cdFx0XHRhd2FpdCB3aXRoUmV0cnkoKCkgPT4gdGhpcy5hcHBseUV4cGVjdENUKGFwcCksIDMsIDEwMDApO1xuXHRcdFx0YXdhaXQgd2l0aFJldHJ5KCgpID0+IHRoaXMuYXBwbHlQZXJtaXNzaW9uc1BvbGljeShhcHApLCAzLCAxMDAwKTtcblx0XHRcdGF3YWl0IHdpdGhSZXRyeSgoKSA9PiB0aGlzLmFwcGx5Q3Jvc3NPcmlnaW5Qb2xpY2llcyhhcHApLCAzLCAxMDAwKTtcblx0XHRcdGF3YWl0IHdpdGhSZXRyeSgoKSA9PiB0aGlzLmFwcGx5WHNzRmlsdGVyKGFwcCksIDMsIDEwMDApO1xuXG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdIZWxtZXQgbWlkZGxld2FyZSBpbml0aWFsaXplZCBzdWNjZXNzZnVsbHknKTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5lcnJvckxvZ2dlci5sb2dFcnJvcihcblx0XHRcdFx0J0ZhaWxlZCB0byBpbml0aWFsaXplIEhlbG1ldCBtaWRkbGV3YXJlIHN0YWNrJ1xuXHRcdFx0KTtcblx0XHRcdHRoaXMuZXJyb3JIYW5kbGVyLmhhbmRsZUVycm9yKHsgZXJyb3IgfSk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGFzeW5jIGFwcGx5SGVsbWV0KGFwcDogQXBwbGljYXRpb24pOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0cnkge1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnQXBwbHlpbmcgSGVsbWV0IG1pZGRsZXdhcmUnKTtcblx0XHRcdGFwcC51c2UoaGVsbWV0KGhlbG1ldE9wdGlvbnMpKTtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ0hlbG1ldCBtaWRkbGV3YXJlIGFwcGxpZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cdFx0fSBjYXRjaCAoY29uZmlnRXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlSGVsbWV0RXJyb3IoJ2FwcGx5SGVsbWV0JywgY29uZmlnRXJyb3IpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhc3luYyBhcHBseUNTUChhcHA6IEFwcGxpY2F0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ0FwcGx5aW5nIENvbnRlbnQgU2VjdXJpdHkgUG9saWN5Jyk7XG5cdFx0XHRhcHAudXNlKFxuXHRcdFx0XHRoZWxtZXQuY29udGVudFNlY3VyaXR5UG9saWN5KHtcblx0XHRcdFx0XHRkaXJlY3RpdmVzOiB7XG5cdFx0XHRcdFx0XHQuLi5jc3BPcHRpb25zLmRpcmVjdGl2ZXMsXG5cdFx0XHRcdFx0XHRzdHlsZVNyYzogWydzZWxmJywgJ25vbmNlLXtOT05DRX0nXSxcblx0XHRcdFx0XHRcdHNjcmlwdFNyYzogWydzZWxmJywgJ25vbmNlLXtOT05DRX0nXVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0cmVwb3J0T25seTogY3NwT3B0aW9ucy5yZXBvcnRPbmx5XG5cdFx0XHRcdH0pXG5cdFx0XHQpO1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnQ29udGVudCBTZWN1cml0eSBQb2xpY3kgYXBwbGllZCBzdWNjZXNzZnVsbHknKTtcblx0XHR9IGNhdGNoIChjb25maWdFcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVIZWxtZXRFcnJvcignYXBwbHlDb250ZW50U2VjdXJpdHlQb2xpY3knLCBjb25maWdFcnJvcik7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGFzeW5jIGFwcGx5RXhwZWN0Q1QoYXBwOiBBcHBsaWNhdGlvbik6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRyeSB7XG5cdFx0XHRhcHAudXNlKChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikgPT4ge1xuXHRcdFx0XHRyZXMuc2V0SGVhZGVyKCdFeHBlY3QtQ1QnLCAnZW5mb3JjZSwgbWF4LWFnZT04NjQwMCcpO1xuXHRcdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdFeHBlY3QtQ1QgaGVhZGVyIHNldCBzdWNjZXNzZnVsbHknKTtcblx0XHRcdFx0bmV4dCgpO1xuXHRcdFx0fSk7XG5cdFx0fSBjYXRjaCAoY29uZmlnRXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlSGVsbWV0RXJyb3IoJ2FwcGx5RXhwZWN0Q1QnLCBjb25maWdFcnJvcik7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGFzeW5jIGFwcGx5UGVybWlzc2lvbnNQb2xpY3koYXBwOiBBcHBsaWNhdGlvbik6IFByb21pc2U8dm9pZD4ge1xuXHRcdGlmIChcblx0XHRcdHBlcm1pc3Npb25zUG9saWN5T3B0aW9ucyAmJlxuXHRcdFx0dHlwZW9mIHBlcm1pc3Npb25zUG9saWN5T3B0aW9ucyA9PT0gJ29iamVjdCdcblx0XHQpIHtcblx0XHRcdGFwcC51c2UoKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSA9PiB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0Y29uc3QgcG9saWNpZXMgPSBPYmplY3QuZW50cmllcyhwZXJtaXNzaW9uc1BvbGljeU9wdGlvbnMpXG5cdFx0XHRcdFx0XHQubWFwKFxuXHRcdFx0XHRcdFx0XHQoW2ZlYXR1cmUsIG9yaWdpbnNdKSA9PlxuXHRcdFx0XHRcdFx0XHRcdGAke2ZlYXR1cmV9ICR7b3JpZ2lucy5qb2luKCcgJyl9YFxuXHRcdFx0XHRcdFx0KVxuXHRcdFx0XHRcdFx0LmpvaW4oJywgJyk7XG5cblx0XHRcdFx0XHRyZXMuc2V0SGVhZGVyKCdQZXJtaXNzaW9ucy1Qb2xpY3knLCBwb2xpY2llcyk7XG5cdFx0XHRcdFx0dGhpcy5sb2dnZXIuaW5mbyhcblx0XHRcdFx0XHRcdCdQZXJtaXNzaW9ucy1Qb2xpY3kgaGVhZGVyIHNldCBzdWNjZXNzZnVsbHknXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRuZXh0KCk7XG5cdFx0XHRcdH0gY2F0Y2ggKGV4cHJlc3NFcnJvcikge1xuXHRcdFx0XHRcdHRoaXMuaGFuZGxlSGVsbWV0RXhwcmVzc0Vycm9yKFxuXHRcdFx0XHRcdFx0J1Blcm1pc3Npb25zLVBvbGljeSBNaWRkbGV3YXJlJyxcblx0XHRcdFx0XHRcdGV4cHJlc3NFcnJvcixcblx0XHRcdFx0XHRcdHJlcSxcblx0XHRcdFx0XHRcdHJlcyxcblx0XHRcdFx0XHRcdG5leHRcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5sb2dnZXIud2Fybihcblx0XHRcdFx0J1Blcm1pc3Npb25zLVBvbGljeSBvcHRpb25zIGFyZSBub3QgcHJvdmlkZWQgb3IgaW52YWxpZCdcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGFzeW5jIGFwcGx5Q3Jvc3NPcmlnaW5Qb2xpY2llcyhhcHA6IEFwcGxpY2F0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ0FwcGx5aW5nIENyb3NzLU9yaWdpbiBwb2xpY2llcycpO1xuXG5cdFx0XHRhcHAudXNlKGhlbG1ldC5jcm9zc09yaWdpbk9wZW5lclBvbGljeSh7IHBvbGljeTogJ3NhbWUtb3JpZ2luJyB9KSk7XG5cdFx0XHRhcHAudXNlKFxuXHRcdFx0XHRoZWxtZXQuY3Jvc3NPcmlnaW5SZXNvdXJjZVBvbGljeSh7IHBvbGljeTogJ3NhbWUtb3JpZ2luJyB9KVxuXHRcdFx0KTtcblx0XHRcdGFwcC51c2UoXG5cdFx0XHRcdGhlbG1ldC5jcm9zc09yaWdpbkVtYmVkZGVyUG9saWN5KHsgcG9saWN5OiAncmVxdWlyZS1jb3JwJyB9KVxuXHRcdFx0KTtcblxuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnQ3Jvc3MtT3JpZ2luIHBvbGljaWVzIGFwcGxpZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cdFx0fSBjYXRjaCAoY29uZmlnRXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlSGVsbWV0RXJyb3IoJ2FwcGx5Q3Jvc3NPcmlnaW5Qb2xpY2llcycsIGNvbmZpZ0Vycm9yKTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgYXBwbHlSZWZlcnJlclBvbGljeShhcHA6IEFwcGxpY2F0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ0FwcGx5aW5nIFJlZmVycmVyLVBvbGljeScpO1xuXHRcdFx0YXBwLnVzZShoZWxtZXQucmVmZXJyZXJQb2xpY3koeyBwb2xpY3k6ICdzYW1lLW9yaWdpbicgfSkpO1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnUmVmZXJyZXItUG9saWN5IGFwcGxpZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cdFx0fSBjYXRjaCAoY29uZmlnRXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlSGVsbWV0RXJyb3IoJ2FwcGx5UmVmZXJyZXJQb2xpY3knLCBjb25maWdFcnJvcik7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGFzeW5jIGFwcGx5WHNzRmlsdGVyKGFwcDogQXBwbGljYXRpb24pOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0cnkge1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnQXBwbHlpbmcgWFNTIEZpbHRlcicpO1xuXHRcdFx0YXBwLnVzZShoZWxtZXQueHNzRmlsdGVyKCkpO1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnWFNTIEZpbHRlciBhcHBsaWVkIHN1Y2Nlc3NmdWxseScpO1xuXHRcdH0gY2F0Y2ggKGNvbmZpZ0Vycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZUhlbG1ldEVycm9yKCdhcHBseVhzc0ZpbHRlcicsIGNvbmZpZ0Vycm9yKTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgc2h1dGRvd24oKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0dHJ5IHtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ1NodXR0aW5nIGRvd24gSGVsbWV0IG1pZGRsZXdhcmUgc2VydmljZS4uLicpO1xuXHRcdFx0SGVsbWV0TWlkZGxld2FyZVNlcnZpY2UuaW5zdGFuY2UgPSBudWxsO1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnSGVsbWV0IG1pZGRsZXdhcmUgc2VydmljZSBoYXMgYmVlbiBzaHV0IGRvd24uJyk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuZXJyb3JMb2dnZXIubG9nRXJyb3IoXG5cdFx0XHRcdGBFcnJvciBzaHV0dGluZyBkb3duIEhlbG1ldCBtaWRkbGV3YXJlIHNlcnZpY2U6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBlcnJvcn1gXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgaGFuZGxlSGVsbWV0RXJyb3IobWV0aG9kOiBzdHJpbmcsIGVycm9yOiB1bmtub3duKTogdm9pZCB7XG5cdFx0Y29uc3QgY29uZmlndXJhdGlvbkVycm9yID1cblx0XHRcdG5ldyB0aGlzLmVycm9ySGFuZGxlci5FcnJvckNsYXNzZXMuQ29uZmlndXJhdGlvbkVycm9yKFxuXHRcdFx0XHRgRmFpbGVkIHRvIGFwcGx5IHNlY3VyaXR5IGhlYWRlcnMgaW4gJHttZXRob2R9OiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWAsXG5cdFx0XHRcdHsgZXhwb3NlVG9DbGllbnQ6IGZhbHNlIH1cblx0XHRcdCk7XG5cdFx0dGhpcy5lcnJvckxvZ2dlci5sb2dXYXJuKGNvbmZpZ3VyYXRpb25FcnJvci5tZXNzYWdlKTtcblx0XHR0aGlzLmVycm9ySGFuZGxlci5oYW5kbGVFcnJvcih7IGVycm9yOiBjb25maWd1cmF0aW9uRXJyb3IgfSk7XG5cdH1cblxuXHRwcml2YXRlIGhhbmRsZUhlbG1ldEV4cHJlc3NFcnJvcihcblx0XHRtaWRkbGV3YXJlOiBzdHJpbmcsXG5cdFx0ZXJyb3I6IHVua25vd24sXG5cdFx0cmVxOiBSZXF1ZXN0LFxuXHRcdHJlczogUmVzcG9uc2UsXG5cdFx0bmV4dDogTmV4dEZ1bmN0aW9uXG5cdCk6IHZvaWQge1xuXHRcdGNvbnN0IGV4cHJlc3NNaWRkbGV3YXJlRXJyb3IgPVxuXHRcdFx0bmV3IHRoaXMuZXJyb3JIYW5kbGVyLkVycm9yQ2xhc3Nlcy5FeHByZXNzRXJyb3IoXG5cdFx0XHRcdGBFcnJvciBvY2N1cnJlZCBpbiAke21pZGRsZXdhcmV9OiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gLFxuXHRcdFx0XHR7IGV4cG9zZVRvQ2xpZW50OiBmYWxzZSB9XG5cdFx0XHQpO1xuXHRcdHRoaXMuZXJyb3JMb2dnZXIubG9nRXJyb3IoZXhwcmVzc01pZGRsZXdhcmVFcnJvci5tZXNzYWdlKTtcblx0XHR0aGlzLmVycm9ySGFuZGxlci5leHByZXNzRXJyb3JIYW5kbGVyKCkoXG5cdFx0XHRleHByZXNzTWlkZGxld2FyZUVycm9yLFxuXHRcdFx0cmVxLFxuXHRcdFx0cmVzLFxuXHRcdFx0bmV4dFxuXHRcdCk7XG5cdH1cbn1cbiJdfQ==
