import '../../../types/custom/yub.d.ts';
export default function createYubicoOtpUtil({
	yub,
	getSecrets,
	logger,
	execSync,
	getDirectoryPath
}) {
	let secrets;
	let yubClient;
	async function initializeYubicoOtpUtil() {
		secrets = await getSecrets({ logger, execSync, getDirectoryPath });
		yubClient = yub.init(
			secrets.YUBICO_CLIENT_ID.toString(),
			secrets.YUBICO_SECRET_KEY
		);
	}
	async function validateYubicoOTP(otp) {
		if (!yubClient) {
			await initializeYubicoOtpUtil();
		}
		return new Promise((resolve, reject) => {
			yubClient.verify(otp, (err, data) => {
				if (err) {
					return reject(err);
				}
				if (data && data.status === 'OK') {
					resolve(true);
				} else {
					resolve(false);
				}
			});
		});
	}
	function generateYubicoOtpOptions() {
		if (!secrets) {
			throw new Error('Secrets have not been initialized');
		}
		return {
			clientId: secrets.YUBICO_CLIENT_ID,
			apiKey: secrets.YUBICO_SECRET_KEY,
			apiUrl: secrets.YUBICO_API_URL
		};
	}
	return {
		initializeYubicoOtpUtil,
		validateYubicoOTP,
		generateYubicoOtpOptions
	};
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieXViaWNvT3RwVXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9hdXRoL3l1Ymljb090cFV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxnQ0FBZ0MsQ0FBQztBQStCeEMsTUFBTSxDQUFDLE9BQU8sVUFBVSxtQkFBbUIsQ0FBQyxFQUMzQyxHQUFHLEVBQ0gsVUFBVSxFQUNWLE1BQU0sRUFDTixRQUFRLEVBQ1IsZ0JBQWdCLEVBQ1E7SUFLeEIsSUFBSSxPQUFtQixDQUFDO0lBQ3hCLElBQUksU0FBZ0MsQ0FBQztJQUVyQyxLQUFLLFVBQVUsdUJBQXVCO1FBQ3JDLE9BQU8sR0FBRyxNQUFNLFVBQVUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO1FBQ25FLFNBQVMsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUNuQixPQUFPLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLEVBQ25DLE9BQU8sQ0FBQyxpQkFBaUIsQ0FDWixDQUFDO0lBQ2hCLENBQUM7SUFFRCxLQUFLLFVBQVUsaUJBQWlCLENBQUMsR0FBVztRQUMzQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDaEIsTUFBTSx1QkFBdUIsRUFBRSxDQUFDO1FBQ2pDLENBQUM7UUFFRCxPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1lBQ3RDLFNBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBaUIsRUFBRSxJQUFpQixFQUFFLEVBQUU7Z0JBQy9ELElBQUksR0FBRyxFQUFFLENBQUM7b0JBQ1QsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3BCLENBQUM7Z0JBRUQsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxJQUFJLEVBQUUsQ0FBQztvQkFDbEMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNmLENBQUM7cUJBQU0sQ0FBQztvQkFDUCxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2hCLENBQUM7WUFDRixDQUFDLENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVELFNBQVMsd0JBQXdCO1FBQ2hDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNkLE1BQU0sSUFBSSxLQUFLLENBQUMsbUNBQW1DLENBQUMsQ0FBQztRQUN0RCxDQUFDO1FBRUQsT0FBTztZQUNOLFFBQVEsRUFBRSxPQUFPLENBQUMsZ0JBQTBCO1lBQzVDLE1BQU0sRUFBRSxPQUFPLENBQUMsaUJBQTJCO1lBQzNDLE1BQU0sRUFBRSxPQUFPLENBQUMsY0FBd0I7U0FDeEMsQ0FBQztJQUNILENBQUM7SUFFRCxPQUFPO1FBQ04sdUJBQXVCO1FBQ3ZCLGlCQUFpQjtRQUNqQix3QkFBd0I7S0FDeEIsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeXViIGZyb20gJ3l1Yic7XG5pbXBvcnQgJy4uLy4uLy4uL3R5cGVzL2N1c3RvbS95dWIuZC50cyc7XG5pbXBvcnQgZ2V0U2VjcmV0cywgeyBTZWNyZXRzTWFwIH0gZnJvbSAnLi4vc29wcy5qcyc7XG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHsgTG9nZ2VyIH0gZnJvbSAnd2luc3Rvbic7XG5cbmludGVyZmFjZSBZdWJDbGllbnQge1xuXHR2ZXJpZnkoXG5cdFx0b3RwOiBzdHJpbmcsXG5cdFx0Y2FsbGJhY2s6IChlcnI6IEVycm9yIHwgbnVsbCwgZGF0YTogWXViUmVzcG9uc2UpID0+IHZvaWRcblx0KTogdm9pZDtcbn1cblxuaW50ZXJmYWNlIFl1YlJlc3BvbnNlIHtcblx0c3RhdHVzOiBzdHJpbmc7XG5cdFtrZXk6IHN0cmluZ106IHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfCBvYmplY3QgfCBudWxsIHwgdW5kZWZpbmVkO1xufVxuXG5pbnRlcmZhY2UgWXViaWNvT3RwT3B0aW9ucyB7XG5cdGNsaWVudElkOiBudW1iZXI7XG5cdGFwaUtleTogc3RyaW5nO1xuXHRhcGlVcmw6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFl1Ymljb1V0aWxEZXBlbmRlbmNpZXMge1xuXHR5dWI6IHR5cGVvZiB5dWI7XG5cdGdldFNlY3JldHM6IHR5cGVvZiBnZXRTZWNyZXRzLmdldFNlY3JldHM7XG5cdGxvZ2dlcjogTG9nZ2VyO1xuXHRleGVjU3luYzogdHlwZW9mIGV4ZWNTeW5jO1xuXHRnZXREaXJlY3RvcnlQYXRoOiAoKSA9PiBzdHJpbmc7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZVl1Ymljb090cFV0aWwoe1xuXHR5dWIsXG5cdGdldFNlY3JldHMsXG5cdGxvZ2dlcixcblx0ZXhlY1N5bmMsXG5cdGdldERpcmVjdG9yeVBhdGhcbn06IFl1Ymljb1V0aWxEZXBlbmRlbmNpZXMpOiB7XG5cdGluaXRpYWxpemVZdWJpY29PdHBVdGlsOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuXHR2YWxpZGF0ZVl1Ymljb09UUDogKG90cDogc3RyaW5nKSA9PiBQcm9taXNlPGJvb2xlYW4+O1xuXHRnZW5lcmF0ZVl1Ymljb090cE9wdGlvbnM6ICgpID0+IFl1Ymljb090cE9wdGlvbnM7XG59IHtcblx0bGV0IHNlY3JldHM6IFNlY3JldHNNYXA7XG5cdGxldCB5dWJDbGllbnQ6IFl1YkNsaWVudCB8IHVuZGVmaW5lZDtcblxuXHRhc3luYyBmdW5jdGlvbiBpbml0aWFsaXplWXViaWNvT3RwVXRpbCgpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRzZWNyZXRzID0gYXdhaXQgZ2V0U2VjcmV0cyh7IGxvZ2dlciwgZXhlY1N5bmMsIGdldERpcmVjdG9yeVBhdGggfSk7XG5cdFx0eXViQ2xpZW50ID0geXViLmluaXQoXG5cdFx0XHRzZWNyZXRzLllVQklDT19DTElFTlRfSUQudG9TdHJpbmcoKSxcblx0XHRcdHNlY3JldHMuWVVCSUNPX1NFQ1JFVF9LRVlcblx0XHQpIGFzIFl1YkNsaWVudDtcblx0fVxuXG5cdGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlWXViaWNvT1RQKG90cDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG5cdFx0aWYgKCF5dWJDbGllbnQpIHtcblx0XHRcdGF3YWl0IGluaXRpYWxpemVZdWJpY29PdHBVdGlsKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHRcdHl1YkNsaWVudCEudmVyaWZ5KG90cCwgKGVycjogRXJyb3IgfCBudWxsLCBkYXRhOiBZdWJSZXNwb25zZSkgPT4ge1xuXHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJlamVjdChlcnIpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGRhdGEgJiYgZGF0YS5zdGF0dXMgPT09ICdPSycpIHtcblx0XHRcdFx0XHRyZXNvbHZlKHRydWUpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHJlc29sdmUoZmFsc2UpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fVxuXG5cdGZ1bmN0aW9uIGdlbmVyYXRlWXViaWNvT3RwT3B0aW9ucygpOiBZdWJpY29PdHBPcHRpb25zIHtcblx0XHRpZiAoIXNlY3JldHMpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcignU2VjcmV0cyBoYXZlIG5vdCBiZWVuIGluaXRpYWxpemVkJyk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGNsaWVudElkOiBzZWNyZXRzLllVQklDT19DTElFTlRfSUQgYXMgbnVtYmVyLFxuXHRcdFx0YXBpS2V5OiBzZWNyZXRzLllVQklDT19TRUNSRVRfS0VZIGFzIHN0cmluZyxcblx0XHRcdGFwaVVybDogc2VjcmV0cy5ZVUJJQ09fQVBJX1VSTCBhcyBzdHJpbmdcblx0XHR9O1xuXHR9XG5cblx0cmV0dXJuIHtcblx0XHRpbml0aWFsaXplWXViaWNvT3RwVXRpbCxcblx0XHR2YWxpZGF0ZVl1Ymljb09UUCxcblx0XHRnZW5lcmF0ZVl1Ymljb090cE9wdGlvbnNcblx0fTtcbn1cbiJdfQ==
