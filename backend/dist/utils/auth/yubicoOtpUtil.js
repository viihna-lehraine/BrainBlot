import yub from 'yub';
import getSecrets from '../../config/secrets.js';
const secrets = await getSecrets();
let yubClient;
async function initializeYubicoOtpUtil() {
	yubClient = yub.init(
		secrets.YUBICO_CLIENT_ID.toString(),
		secrets.YUBICO_SECRET_KEY
	);
}
// for validating a Yubico OTP
async function validateYubicoOTP(otp) {
	if (!yubClient) {
		await initializeYubicoOtpUtil();
	}
	return new Promise((resolve, reject) => {
		yubClient.verify(otp, (err, data) => {
			if (err) {
				return reject(err);
			}
			if (data && data.status === 'OK') {
				resolve(true);
			} else {
				resolve(false);
			}
		});
	});
}
// generated OTP configruation options
function generateYubicoOtpOptions() {
	if (!secrets) {
		throw new Error('Secrets have not been initialized');
	}
	return {
		clientId: secrets.YUBICO_CLIENT_ID,
		apiKey: secrets.YUBICO_SECRET_KEY,
		apiUrl: secrets.YUBICO_API_URL
	};
}
export { generateYubicoOtpOptions, validateYubicoOTP };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieXViaWNvT3RwVXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9hdXRoL3l1Ymljb090cFV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxHQUFHLE1BQU0sS0FBSyxDQUFDO0FBQ3RCLE9BQU8sVUFBVSxNQUFNLHNCQUFzQixDQUFDO0FBQzlDLE9BQU8sZ0NBQWdDLENBQUM7QUEwQnhDLE1BQU0sT0FBTyxHQUFZLE1BQU0sVUFBVSxFQUFFLENBQUM7QUFDNUMsSUFBSSxTQUFnQyxDQUFDO0FBRXJDLEtBQUssVUFBVSx1QkFBdUI7SUFDckMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQ25CLE9BQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsRUFDcEMsT0FBUSxDQUFDLGlCQUFpQixDQUNiLENBQUM7QUFDaEIsQ0FBQztBQUVELDhCQUE4QjtBQUM5QixLQUFLLFVBQVUsaUJBQWlCLENBQUMsR0FBVztJQUMzQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDaEIsTUFBTSx1QkFBdUIsRUFBRSxDQUFDO0lBQ2pDLENBQUM7SUFFRCxPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQ3RDLFNBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBaUIsRUFBRSxJQUFpQixFQUFFLEVBQUU7WUFDL0QsSUFBSSxHQUFHLEVBQUUsQ0FBQztnQkFDVCxPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNwQixDQUFDO1lBRUQsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxJQUFJLEVBQUUsQ0FBQztnQkFDbEMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2YsQ0FBQztpQkFBTSxDQUFDO2dCQUNQLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNoQixDQUFDO1FBQ0YsQ0FBQyxDQUFDLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRCxzQ0FBc0M7QUFDdEMsU0FBUyx3QkFBd0I7SUFDaEMsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2QsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFRCxPQUFPO1FBQ04sUUFBUSxFQUFFLE9BQU8sQ0FBQyxnQkFBZ0I7UUFDbEMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxpQkFBaUI7UUFDakMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxjQUFjO0tBQzlCLENBQUM7QUFDSCxDQUFDO0FBRUQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLGlCQUFpQixFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeXViIGZyb20gJ3l1Yic7XG5pbXBvcnQgZ2V0U2VjcmV0cyBmcm9tICcuLi8uLi9jb25maWcvc2VjcmV0cyc7XG5pbXBvcnQgJy4uLy4uLy4uL3R5cGVzL2N1c3RvbS95dWIuZC50cyc7XG5cbmludGVyZmFjZSBTZWNyZXRzIHtcblx0WVVCSUNPX0NMSUVOVF9JRDogbnVtYmVyO1xuXHRZVUJJQ09fU0VDUkVUX0tFWTogc3RyaW5nO1xuXHRZVUJJQ09fQVBJX1VSTDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgWXViQ2xpZW50IHtcblx0dmVyaWZ5KFxuXHRcdG90cDogc3RyaW5nLFxuXHRcdGNhbGxiYWNrOiAoZXJyOiBFcnJvciB8IG51bGwsIGRhdGE6IFl1YlJlc3BvbnNlKSA9PiB2b2lkXG5cdCk6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBZdWJSZXNwb25zZSB7XG5cdHN0YXR1czogc3RyaW5nO1xuXHRba2V5OiBzdHJpbmddOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgb2JqZWN0IHwgbnVsbCB8IHVuZGVmaW5lZDsgLy8gKkRFVi1OT1RFKiBJIGhhdmUgYWJzb2x1dGVseSBubyBpZGVhIHdoYXQgdHlwZSBzaG91bGQgYmVcbn1cblxuaW50ZXJmYWNlIFl1Ymljb090cE9wdGlvbnMge1xuXHRjbGllbnRJZDogbnVtYmVyO1xuXHRhcGlLZXk6IHN0cmluZztcblx0YXBpVXJsOiBzdHJpbmc7XG59XG5cbmNvbnN0IHNlY3JldHM6IFNlY3JldHMgPSBhd2FpdCBnZXRTZWNyZXRzKCk7XG5sZXQgeXViQ2xpZW50OiBZdWJDbGllbnQgfCB1bmRlZmluZWQ7XG5cbmFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVZdWJpY29PdHBVdGlsKCk6IFByb21pc2U8dm9pZD4ge1xuXHR5dWJDbGllbnQgPSB5dWIuaW5pdChcblx0XHRzZWNyZXRzIS5ZVUJJQ09fQ0xJRU5UX0lELnRvU3RyaW5nKCksXG5cdFx0c2VjcmV0cyEuWVVCSUNPX1NFQ1JFVF9LRVlcblx0KSBhcyBZdWJDbGllbnQ7XG59XG5cbi8vIGZvciB2YWxpZGF0aW5nIGEgWXViaWNvIE9UUFxuYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVZdWJpY29PVFAob3RwOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcblx0aWYgKCF5dWJDbGllbnQpIHtcblx0XHRhd2FpdCBpbml0aWFsaXplWXViaWNvT3RwVXRpbCgpO1xuXHR9XG5cblx0cmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblx0XHR5dWJDbGllbnQhLnZlcmlmeShvdHAsIChlcnI6IEVycm9yIHwgbnVsbCwgZGF0YTogWXViUmVzcG9uc2UpID0+IHtcblx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0cmV0dXJuIHJlamVjdChlcnIpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZGF0YSAmJiBkYXRhLnN0YXR1cyA9PT0gJ09LJykge1xuXHRcdFx0XHRyZXNvbHZlKHRydWUpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmVzb2x2ZShmYWxzZSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0pO1xufVxuXG4vLyBnZW5lcmF0ZWQgT1RQIGNvbmZpZ3J1YXRpb24gb3B0aW9uc1xuZnVuY3Rpb24gZ2VuZXJhdGVZdWJpY29PdHBPcHRpb25zKCk6IFl1Ymljb090cE9wdGlvbnMge1xuXHRpZiAoIXNlY3JldHMpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoJ1NlY3JldHMgaGF2ZSBub3QgYmVlbiBpbml0aWFsaXplZCcpO1xuXHR9XG5cblx0cmV0dXJuIHtcblx0XHRjbGllbnRJZDogc2VjcmV0cy5ZVUJJQ09fQ0xJRU5UX0lELFxuXHRcdGFwaUtleTogc2VjcmV0cy5ZVUJJQ09fU0VDUkVUX0tFWSxcblx0XHRhcGlVcmw6IHNlY3JldHMuWVVCSUNPX0FQSV9VUkxcblx0fTtcbn1cblxuZXhwb3J0IHsgZ2VuZXJhdGVZdWJpY29PdHBPcHRpb25zLCB2YWxpZGF0ZVl1Ymljb09UUCB9O1xuIl19
