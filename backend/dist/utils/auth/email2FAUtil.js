import bcrypt from 'bcrypt';
import jwt from 'jsonwebtoken';
import setupLogger from '../../config/logger.js';
import getSecrets from '../../config/secrets.js';
const logger = await setupLogger();
const secrets = await getSecrets();
if (!secrets) {
	throw new Error('Secrets could not be loaded');
}
async function generateEmail2FACode() {
	const email2FACode = await bcrypt.genSalt(6); // generates a 6-character hex code
	const email2FAToken = jwt.sign({ email2FACode }, secrets.EMAIL_2FA_KEY, {
		expiresIn: '30m'
	});
	return {
		email2FACode, // raw 2FA code
		email2FAToken // JWT containing the 2FA code
	};
}
async function verifyEmail2FACode(token, email2FACode) {
	try {
		const decodedEmail2FACode = jwt.verify(token, secrets.EMAIL_2FA_KEY);
		// ensue the decoded 2FA code matches the one provided
		return decodedEmail2FACode.code === email2FACode;
	} catch (err) {
		logger.error(err);
		return false;
	}
}
export { generateEmail2FACode, verifyEmail2FACode };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1haWwyRkFVdGlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3V0aWxzL2F1dGgvZW1haWwyRkFVdGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUM1QixPQUFPLEdBQW1CLE1BQU0sY0FBYyxDQUFDO0FBQy9DLE9BQU8sV0FBVyxNQUFNLHdCQUF3QixDQUFDO0FBQ2pELE9BQU8sVUFBVSxNQUFNLHlCQUF5QixDQUFDO0FBTWpELE1BQU0sTUFBTSxHQUFHLE1BQU0sV0FBVyxFQUFFLENBQUM7QUFDbkMsTUFBTSxPQUFPLEdBQVksTUFBTSxVQUFVLEVBQUUsQ0FBQztBQUU1QyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDZCxNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7QUFDaEQsQ0FBQztBQUVELEtBQUssVUFBVSxvQkFBb0I7SUFJbEMsTUFBTSxZQUFZLEdBQUcsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsbUNBQW1DO0lBQ2pGLE1BQU0sYUFBYSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxZQUFZLEVBQUUsRUFBRSxPQUFPLENBQUMsYUFBYSxFQUFFO1FBQ3ZFLFNBQVMsRUFBRSxLQUFLO0tBQ2hCLENBQUMsQ0FBQztJQUNILE9BQU87UUFDTixZQUFZLEVBQUUsZUFBZTtRQUM3QixhQUFhLENBQUMsOEJBQThCO0tBQzVDLENBQUM7QUFDSCxDQUFDO0FBRUQsS0FBSyxVQUFVLGtCQUFrQixDQUNoQyxLQUFhLEVBQ2IsWUFBb0I7SUFFcEIsSUFBSSxDQUFDO1FBQ0osTUFBTSxtQkFBbUIsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUNyQyxLQUFLLEVBQ0wsT0FBTyxDQUFDLGFBQWEsQ0FDUCxDQUFDO1FBRWhCLHNEQUFzRDtRQUN0RCxPQUFPLG1CQUFtQixDQUFDLElBQUksS0FBSyxZQUFZLENBQUM7SUFDbEQsQ0FBQztJQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDZCxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLE9BQU8sS0FBSyxDQUFDO0lBQ2QsQ0FBQztBQUNGLENBQUM7QUFFRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBiY3J5cHQgZnJvbSAnYmNyeXB0JztcbmltcG9ydCBqd3QsIHsgSnd0UGF5bG9hZCB9IGZyb20gJ2pzb253ZWJ0b2tlbic7XG5pbXBvcnQgc2V0dXBMb2dnZXIgZnJvbSAnLi4vLi4vY29uZmlnL2xvZ2dlci5qcyc7XG5pbXBvcnQgZ2V0U2VjcmV0cyBmcm9tICcuLi8uLi9jb25maWcvc2VjcmV0cy5qcyc7XG5cbmludGVyZmFjZSBTZWNyZXRzIHtcblx0RU1BSUxfMkZBX0tFWTogc3RyaW5nO1xufVxuXG5jb25zdCBsb2dnZXIgPSBhd2FpdCBzZXR1cExvZ2dlcigpO1xuY29uc3Qgc2VjcmV0czogU2VjcmV0cyA9IGF3YWl0IGdldFNlY3JldHMoKTtcblxuaWYgKCFzZWNyZXRzKSB7XG5cdHRocm93IG5ldyBFcnJvcignU2VjcmV0cyBjb3VsZCBub3QgYmUgbG9hZGVkJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlRW1haWwyRkFDb2RlKCk6IFByb21pc2U8e1xuXHRlbWFpbDJGQUNvZGU6IHN0cmluZztcblx0ZW1haWwyRkFUb2tlbjogc3RyaW5nO1xufT4ge1xuXHRjb25zdCBlbWFpbDJGQUNvZGUgPSBhd2FpdCBiY3J5cHQuZ2VuU2FsdCg2KTsgLy8gZ2VuZXJhdGVzIGEgNi1jaGFyYWN0ZXIgaGV4IGNvZGVcblx0Y29uc3QgZW1haWwyRkFUb2tlbiA9IGp3dC5zaWduKHsgZW1haWwyRkFDb2RlIH0sIHNlY3JldHMuRU1BSUxfMkZBX0tFWSwge1xuXHRcdGV4cGlyZXNJbjogJzMwbSdcblx0fSk7XG5cdHJldHVybiB7XG5cdFx0ZW1haWwyRkFDb2RlLCAvLyByYXcgMkZBIGNvZGVcblx0XHRlbWFpbDJGQVRva2VuIC8vIEpXVCBjb250YWluaW5nIHRoZSAyRkEgY29kZVxuXHR9O1xufVxuXG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlFbWFpbDJGQUNvZGUoXG5cdHRva2VuOiBzdHJpbmcsXG5cdGVtYWlsMkZBQ29kZTogc3RyaW5nXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcblx0dHJ5IHtcblx0XHRjb25zdCBkZWNvZGVkRW1haWwyRkFDb2RlID0gand0LnZlcmlmeShcblx0XHRcdHRva2VuLFxuXHRcdFx0c2VjcmV0cy5FTUFJTF8yRkFfS0VZXG5cdFx0KSBhcyBKd3RQYXlsb2FkO1xuXG5cdFx0Ly8gZW5zdWUgdGhlIGRlY29kZWQgMkZBIGNvZGUgbWF0Y2hlcyB0aGUgb25lIHByb3ZpZGVkXG5cdFx0cmV0dXJuIGRlY29kZWRFbWFpbDJGQUNvZGUuY29kZSA9PT0gZW1haWwyRkFDb2RlO1xuXHR9IGNhdGNoIChlcnIpIHtcblx0XHRsb2dnZXIuZXJyb3IoZXJyKTtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cbn1cblxuZXhwb3J0IHsgZ2VuZXJhdGVFbWFpbDJGQUNvZGUsIHZlcmlmeUVtYWlsMkZBQ29kZSB9O1xuIl19
