import { validateDependencies } from './validateDependencies.mjs';
import { isLogger } from '../config/logger.mjs';
import {
	AppError,
	errorClasses,
	ErrorSeverity
} from '../config/errorClasses.mjs';
const {
	AuthenticationError,
	AutoCorrectedInputWarning,
	ConfigurationError,
	ConcurrencyError,
	ConflictError,
	CriticalServiceUnavailableError,
	DatabaseError,
	DataIntegrityError,
	DependencyError,
	DeprecatedApiWarning,
	ExternalServiceError,
	FallbackSuccessInfo,
	FileProcessingError,
	ForbiddenError,
	InsufficientStorageError,
	InvalidCredentialsError,
	InvalidInputError,
	InvalidConfigurationError,
	InvalidTokenError,
	MissingResourceError,
	PartialServiceFailureWarning,
	PasswordValidationError,
	PermissionDeniedError,
	QuotaExceededError,
	RateLimitError,
	ServiceDegradedError,
	SessionExpiredError,
	SlowApiWarning,
	TimeoutError,
	UserActionInfo,
	ValidationError
} = errorClasses;
export function processError(error, logger, req, fallbackLogger = console) {
	try {
		validateDependencies(
			[
				{ name: 'error', instance: error },
				{ name: 'logger', instance: logger },
				{ name: req ? 'req' : 'undefined', instance: req },
				{ name: 'fallbackLogger', instance: fallbackLogger }
			],
			logger || console
		);
		let message;
		let stack;
		let severity = ErrorSeverity.RECOVERABLE;
		const isErrorInstance = error instanceof AppError;
		if (isErrorInstance) {
			const appError = error;
			message = appError.message;
			stack = appError.stack;
			severity = appError.severity;
		} else if (error instanceof Error) {
			message = error.message;
			stack = error.stack;
		} else {
			message = `An unknown error occurred: ${String(error) ?? 'Unknown error'}`;
			stack = 'No stack trace available';
		}
		const method = req?.method ?? 'Unknown method';
		const url = req?.url ?? 'Unknown URL';
		const ip = req?.ip ?? 'Unknown IP';
		// handle specific error types
		if (isErrorInstance) {
			switch (error.constructor) {
				case AuthenticationError:
					logger.warn(`Authentication error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case AutoCorrectedInputWarning:
					logger.warn(`Auto-corrected input warning: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case ConfigurationError:
					logger.warn(`Configuration error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case ConcurrencyError:
					logger.warn(`Concurrency error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case ConflictError:
					logger.warn(`Conflict error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case CriticalServiceUnavailableError:
					logger.error(`Critical service unavailable: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case DatabaseError:
					logger.error(`Database error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case DataIntegrityError:
					logger.error(`Data integrity error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case DependencyError:
					logger.error(`Dependency error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case DeprecatedApiWarning:
					logger.info(`Deprecated API warning: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case ExternalServiceError:
					logger.warn(`External service error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case FallbackSuccessInfo:
					logger.info(`Fallback success: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case FileProcessingError:
					logger.warn(`File processing error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case ForbiddenError:
					logger.warn(`Forbidden error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case InsufficientStorageError:
					logger.error(`Insufficient storage error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case InvalidCredentialsError:
					logger.info(`Invalid credentials error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case InvalidInputError:
					logger.warn(`Invalid input error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case InvalidConfigurationError:
					logger.error(`Invalid configuration error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case InvalidTokenError:
					logger.info(`Invalid token error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case MissingResourceError:
					logger.warn(`Missing resource error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case PartialServiceFailureWarning:
					logger.warn(`Partial service failure warning: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case PasswordValidationError:
					logger.info(`Password validation error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case PermissionDeniedError:
					logger.info(`Permission denied error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case QuotaExceededError:
					logger.warn(`Quota exceeded error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case RateLimitError:
					logger.warn(`Rate limit error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case ServiceDegradedError:
					logger.warn(`Service degraded error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case SessionExpiredError:
					logger.info(`Session expired error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case SlowApiWarning:
					logger.warn(`Slow API warning: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case TimeoutError:
					logger.error(`Timeout error: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case UserActionInfo:
					logger.info(`User action info: ${message}`, {
						method,
						url,
						ip
					});
					break;
				case ValidationError:
					logger.info(`Validation error: ${message}`, {
						method,
						url,
						ip
					});
					break;
			}
		}
		if (isLogger(logger)) {
			switch (severity) {
				case ErrorSeverity.FATAL:
					logger.error(`FATAL: ${message}`, {
						stack,
						method,
						url,
						ip
					});
					break;
				case ErrorSeverity.RECOVERABLE:
					logger.warn(`RECOVERABLE: ${message}`, {
						stack,
						method,
						url,
						ip
					});
					break;
				case ErrorSeverity.WARNING:
					logger.warn(`WARNING: ${message}`, {
						stack,
						method,
						url,
						ip
					});
					break;
				case ErrorSeverity.INFO:
					logger.info(`INFO: ${message}`, { method, url, ip });
					break;
				default:
					logger.error(`UNKNOWN SEVERITY: ${message}`, {
						stack,
						method,
						url,
						ip
					});
					break;
			}
		} else {
			switch (severity) {
				case ErrorSeverity.FATAL:
					fallbackLogger.error(`FATAL: ${message}`, {
						stack,
						method,
						url,
						ip
					});
					break;
				case ErrorSeverity.RECOVERABLE:
					fallbackLogger.warn(`RECOVERABLE: ${message}`, {
						stack,
						method,
						url,
						ip
					});
					break;
				case ErrorSeverity.WARNING:
					fallbackLogger.warn(`WARNING: ${message}`, {
						stack,
						method,
						url,
						ip
					});
					break;
				case ErrorSeverity.INFO:
					fallbackLogger.info(`INFO: ${message}`, {
						method,
						url,
						ip
					});
					break;
				default:
					fallbackLogger.error(`UNKNOWN SEVERITY: ${message}`, {
						stack,
						method,
						url,
						ip
					});
					break;
			}
		}
	} catch (loggingError) {
		fallbackLogger.error('Failed to log the original error', {
			originalError: error,
			loggingError:
				loggingError instanceof Error
					? loggingError.stack
					: String(loggingError)
		});
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzc0Vycm9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWxzL3Byb2Nlc3NFcnJvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsUUFBUSxFQUFVLE1BQU0sa0JBQWtCLENBQUM7QUFFcEQsT0FBTyxFQUNOLFFBQVEsRUFDUixZQUFZLEVBQ1osYUFBYSxFQUViLE1BQU0sd0JBQXdCLENBQUM7QUFFaEMsTUFBTSxFQUNMLG1CQUFtQixFQUNuQix5QkFBeUIsRUFDekIsa0JBQWtCLEVBQ2xCLGdCQUFnQixFQUNoQixhQUFhLEVBQ2IsK0JBQStCLEVBQy9CLGFBQWEsRUFDYixrQkFBa0IsRUFDbEIsZUFBZSxFQUNmLG9CQUFvQixFQUNwQixvQkFBb0IsRUFDcEIsbUJBQW1CLEVBQ25CLG1CQUFtQixFQUNuQixjQUFjLEVBQ2Qsd0JBQXdCLEVBQ3hCLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIseUJBQXlCLEVBQ3pCLGlCQUFpQixFQUNqQixvQkFBb0IsRUFDcEIsNEJBQTRCLEVBQzVCLHVCQUF1QixFQUN2QixxQkFBcUIsRUFDckIsa0JBQWtCLEVBQ2xCLGNBQWMsRUFDZCxvQkFBb0IsRUFDcEIsbUJBQW1CLEVBQ25CLGNBQWMsRUFDZCxZQUFZLEVBQ1osY0FBYyxFQUNkLGVBQWUsRUFDZixHQUFHLFlBQVksQ0FBQztBQUVqQixNQUFNLFVBQVUsWUFBWSxDQUMzQixLQUFjLEVBQ2QsTUFBd0IsRUFDeEIsR0FBYSxFQUNiLGlCQUEwQixPQUFPO0lBRWpDLElBQUksQ0FBQztRQUNKLG9CQUFvQixDQUNuQjtZQUNDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFO1lBQ2xDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFO1lBQ3BDLEVBQUUsSUFB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YyxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsT0FBTyxFQUFFLEVBQUU7d0JBQ3BELEtBQUs7d0JBQ0wsTUFBTTt3QkFDTixHQUFHO3dCQUNILEVBQUU7cUJBQ0YsQ0FBQyxDQUFDO29CQUNILE1BQU07WUFDUixDQUFDO1FBQ0YsQ0FBQztJQUNGLENBQUM7SUFBQyxPQUFPLFlBQVksRUFBRSxDQUFDO1FBQ3ZCLGNBQWMsQ0FBQyxLQUFLLENBQUMsa0NBQWtDLEVBQUU7WUFDeEQsYUFBYSxFQUFFLEtBQUs7WUFDcEIsWUFBWSxFQUNYLFlBQVksWUFBWSxLQUFLO2dCQUM1QixDQUFDLENBQUMsWUFBWSxDQUFDLEtBQUs7Z0JBQ3BCLENBQUMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDO1NBQ3hCLENBQUMsQ0FBQztJQUNKLENBQUM7QUFDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdmFsaWRhdGVEZXBlbmRlbmNpZXMgfSBmcm9tICcuL3ZhbGlkYXRlRGVwZW5kZW5jaWVzJztcbmltcG9ydCB7IGlzTG9nZ2VyLCBMb2dnZXIgfSBmcm9tICcuLi9jb25maWcvbG9nZ2VyJztcbmltcG9ydCB7IFJlcXVlc3QgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7XG5cdEFwcEVycm9yLFxuXHRlcnJvckNsYXNzZXMsXG5cdEVycm9yU2V2ZXJpdHksXG5cdEVycm9yU2V2ZXJpdHlUeXBlXG59IGZyb20gJy4uL2NvbmZpZy9lcnJvckNsYXNzZXMnO1xuXG5jb25zdCB7XG5cdEF1dGhlbnRpY2F0aW9uRXJyb3IsXG5cdEF1dG9Db3JyZWN0ZWRJbnB1dFdhcm5pbmcsXG5cdENvbmZpZ3VyYXRpb25FcnJvcixcblx0Q29uY3VycmVuY3lFcnJvcixcblx0Q29uZmxpY3RFcnJvcixcblx0Q3JpdGljYWxTZXJ2aWNlVW5hdmFpbGFibGVFcnJvcixcblx0RGF0YWJhc2VFcnJvcixcblx0RGF0YUludGVncml0eUVycm9yLFxuXHREZXBlbmRlbmN5RXJyb3IsXG5cdERlcHJlY2F0ZWRBcGlXYXJuaW5nLFxuXHRFeHRlcm5hbFNlcnZpY2VFcnJvcixcblx0RmFsbGJhY2tTdWNjZXNzSW5mbyxcblx0RmlsZVByb2Nlc3NpbmdFcnJvcixcblx0Rm9yYmlkZGVuRXJyb3IsXG5cdEluc3VmZmljaWVudFN0b3JhZ2VFcnJvcixcblx0SW52YWxpZENyZWRlbnRpYWxzRXJyb3IsXG5cdEludmFsaWRJbnB1dEVycm9yLFxuXHRJbnZhbGlkQ29uZmlndXJhdGlvbkVycm9yLFxuXHRJbnZhbGlkVG9rZW5FcnJvcixcblx0TWlzc2luZ1Jlc291cmNlRXJyb3IsXG5cdFBhcnRpYWxTZXJ2aWNlRmFpbHVyZVdhcm5pbmcsXG5cdFBhc3N3b3JkVmFsaWRhdGlvbkVycm9yLFxuXHRQZXJtaXNzaW9uRGVuaWVkRXJyb3IsXG5cdFF1b3RhRXhjZWVkZWRFcnJvcixcblx0UmF0ZUxpbWl0RXJyb3IsXG5cdFNlcnZpY2VEZWdyYWRlZEVycm9yLFxuXHRTZXNzaW9uRXhwaXJlZEVycm9yLFxuXHRTbG93QXBpV2FybmluZyxcblx0VGltZW91dEVycm9yLFxuXHRVc2VyQWN0aW9uSW5mbyxcblx0VmFsaWRhdGlvbkVycm9yXG59ID0gZXJyb3JDbGFzc2VzO1xuXG5leHBvcnQgZnVuY3Rpb24gcHJvY2Vzc0Vycm9yKFxuXHRlcnJvcjogdW5rbm93bixcblx0bG9nZ2VyOiBMb2dnZXIgfCBDb25zb2xlLFxuXHRyZXE/OiBSZXF1ZXN0LFxuXHRmYWxsYmFja0xvZ2dlcjogQ29uc29sZSA9IGNvbnNvbGVcbik6IHZvaWQge1xuXHR0cnkge1xuXHRcdHZhbGlkYXRlRGVwZW5kZW5jaWVzKFxuXHRcdFx0W1xuXHRcdFx0XHR7IG5hbWU6ICdlcnJvcicsIGluc3RhbmNlOiBlcnJvciB9LFxuXHRcdFx0XHR7IG5hbWU6ICdsb2dnZXInLCBpbnN0YW5jZTogbG9nZ2VyIH0sXG5cdFx0XHRcdHsgbmFtZTogcmVxID8gJ3JlcScgOiAndW5kZWZpbmVkJywgaW5zdGFuY2U6IHJlcSB9LFxuXHRcdFx0XHR7IG5hbWU6ICdmYWxsYmFja0xvZ2dlcicsIGluc3RhbmNlOiBmYWxsYmFja0xvZ2dlciB9XG5cdFx0XHRdLFxuXHRcdFx0bG9nZ2VyIHx8IGNvbnNvbGVcblx0XHQpO1xuXG5cdFx0bGV0IG1lc3NhZ2U6IHN0cmluZztcblx0XHRsZXQgc3RhY2s6IHN0cmluZyB8IHVuZGVmaW5lZDtcblx0XHRsZXQgc2V2ZXJpdHk6IEVycm9yU2V2ZXJpdHlUeXBlID0gRXJyb3JTZXZlcml0eS5SRUNPVkVSQUJMRTtcblxuXHRcdGNvbnN0IGlzRXJyb3JJbnN0YW5jZSA9IGVycm9yIGluc3RhbmNlb2YgQXBwRXJyb3I7XG5cblx0XHRpZiAoaXNFcnJvckluc3RhbmNlKSB7XG5cdFx0XHRjb25zdCBhcHBFcnJvciA9IGVycm9yIGFzIEFwcEVycm9yO1xuXHRcdFx0bWVzc2FnZSA9IGFwcEVycm9yLm1lc3NhZ2U7XG5cdFx0XHRzdGFjayA9IGFwcEVycm9yLnN0YWNrO1xuXHRcdFx0c2V2ZXJpdHkgPSBhcHBFcnJvci5zZXZlcml0eTtcblx0XHR9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcblx0XHRcdG1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuXHRcdFx0c3RhY2sgPSBlcnJvci5zdGFjaztcblx0XHR9IGVsc2Uge1xuXHRcdFx0bWVzc2FnZSA9IGBBbiB1bmtub3duIGVycm9yIG9jY3VycmVkOiAke1N0cmluZyhlcnJvcikgPz8gJ1Vua25vd24gZXJyb3InfWA7XG5cdFx0XHRzdGFjayA9ICdObyBzdGFjayB0cmFjZSBhdmFpbGFibGUnO1xuXHRcdH1cblxuXHRcdGNvbnN0IG1ldGhvZCA9IHJlcT8ubWV0aG9kID8/ICdVbmtub3duIG1ldGhvZCc7XG5cdFx0Y29uc3QgdXJsID0gcmVxPy51cmwgPz8gJ1Vua25vd24gVVJMJztcblx0XHRjb25zdCBpcCA9IHJlcT8uaXAgPz8gJ1Vua25vd24gSVAnO1xuXG5cdFx0Ly8gaGFuZGxlIHNwZWNpZmljIGVycm9yIHR5cGVzXG5cdFx0aWYgKGlzRXJyb3JJbnN0YW5jZSkge1xuXHRcdFx0c3dpdGNoIChlcnJvci5jb25zdHJ1Y3Rvcikge1xuXHRcdFx0XHRjYXNlIEF1dGhlbnRpY2F0aW9uRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLndhcm4oYEF1dGhlbnRpY2F0aW9uIGVycm9yOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBBdXRvQ29ycmVjdGVkSW5wdXRXYXJuaW5nOlxuXHRcdFx0XHRcdGxvZ2dlci53YXJuKGBBdXRvLWNvcnJlY3RlZCBpbnB1dCB3YXJuaW5nOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBDb25maWd1cmF0aW9uRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLndhcm4oYENvbmZpZ3VyYXRpb24gZXJyb3I6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIENvbmN1cnJlbmN5RXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLndhcm4oYENvbmN1cnJlbmN5IGVycm9yOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBDb25mbGljdEVycm9yOlxuXHRcdFx0XHRcdGxvZ2dlci53YXJuKGBDb25mbGljdCBlcnJvcjogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdG1ldGhvZCxcblx0XHRcdFx0XHRcdHVybCxcblx0XHRcdFx0XHRcdGlwXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgQ3JpdGljYWxTZXJ2aWNlVW5hdmFpbGFibGVFcnJvcjpcblx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoYENyaXRpY2FsIHNlcnZpY2UgdW5hdmFpbGFibGU6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIERhdGFiYXNlRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLmVycm9yKGBEYXRhYmFzZSBlcnJvcjogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdG1ldGhvZCxcblx0XHRcdFx0XHRcdHVybCxcblx0XHRcdFx0XHRcdGlwXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgRGF0YUludGVncml0eUVycm9yOlxuXHRcdFx0XHRcdGxvZ2dlci5lcnJvcihgRGF0YSBpbnRlZ3JpdHkgZXJyb3I6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIERlcGVuZGVuY3lFcnJvcjpcblx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoYERlcGVuZGVuY3kgZXJyb3I6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIERlcHJlY2F0ZWRBcGlXYXJuaW5nOlxuXHRcdFx0XHRcdGxvZ2dlci5pbmZvKGBEZXByZWNhdGVkIEFQSSB3YXJuaW5nOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBFeHRlcm5hbFNlcnZpY2VFcnJvcjpcblx0XHRcdFx0XHRsb2dnZXIud2FybihgRXh0ZXJuYWwgc2VydmljZSBlcnJvcjogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdG1ldGhvZCxcblx0XHRcdFx0XHRcdHVybCxcblx0XHRcdFx0XHRcdGlwXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgRmFsbGJhY2tTdWNjZXNzSW5mbzpcblx0XHRcdFx0XHRsb2dnZXIuaW5mbyhgRmFsbGJhY2sgc3VjY2VzczogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdG1ldGhvZCxcblx0XHRcdFx0XHRcdHVybCxcblx0XHRcdFx0XHRcdGlwXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgRmlsZVByb2Nlc3NpbmdFcnJvcjpcblx0XHRcdFx0XHRsb2dnZXIud2FybihgRmlsZSBwcm9jZXNzaW5nIGVycm9yOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBGb3JiaWRkZW5FcnJvcjpcblx0XHRcdFx0XHRsb2dnZXIud2FybihgRm9yYmlkZGVuIGVycm9yOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBJbnN1ZmZpY2llbnRTdG9yYWdlRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLmVycm9yKGBJbnN1ZmZpY2llbnQgc3RvcmFnZSBlcnJvcjogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdG1ldGhvZCxcblx0XHRcdFx0XHRcdHVybCxcblx0XHRcdFx0XHRcdGlwXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgSW52YWxpZENyZWRlbnRpYWxzRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLmluZm8oYEludmFsaWQgY3JlZGVudGlhbHMgZXJyb3I6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIEludmFsaWRJbnB1dEVycm9yOlxuXHRcdFx0XHRcdGxvZ2dlci53YXJuKGBJbnZhbGlkIGlucHV0IGVycm9yOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBJbnZhbGlkQ29uZmlndXJhdGlvbkVycm9yOlxuXHRcdFx0XHRcdGxvZ2dlci5lcnJvcihgSW52YWxpZCBjb25maWd1cmF0aW9uIGVycm9yOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBJbnZhbGlkVG9rZW5FcnJvcjpcblx0XHRcdFx0XHRsb2dnZXIuaW5mbyhgSW52YWxpZCB0b2tlbiBlcnJvcjogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdG1ldGhvZCxcblx0XHRcdFx0XHRcdHVybCxcblx0XHRcdFx0XHRcdGlwXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgTWlzc2luZ1Jlc291cmNlRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLndhcm4oYE1pc3NpbmcgcmVzb3VyY2UgZXJyb3I6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFBhcnRpYWxTZXJ2aWNlRmFpbHVyZVdhcm5pbmc6XG5cdFx0XHRcdFx0bG9nZ2VyLndhcm4oYFBhcnRpYWwgc2VydmljZSBmYWlsdXJlIHdhcm5pbmc6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFBhc3N3b3JkVmFsaWRhdGlvbkVycm9yOlxuXHRcdFx0XHRcdGxvZ2dlci5pbmZvKGBQYXNzd29yZCB2YWxpZGF0aW9uIGVycm9yOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBQZXJtaXNzaW9uRGVuaWVkRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLmluZm8oYFBlcm1pc3Npb24gZGVuaWVkIGVycm9yOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBRdW90YUV4Y2VlZGVkRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLndhcm4oYFF1b3RhIGV4Y2VlZGVkIGVycm9yOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBSYXRlTGltaXRFcnJvcjpcblx0XHRcdFx0XHRsb2dnZXIud2FybihgUmF0ZSBsaW1pdCBlcnJvcjogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdG1ldGhvZCxcblx0XHRcdFx0XHRcdHVybCxcblx0XHRcdFx0XHRcdGlwXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgU2VydmljZURlZ3JhZGVkRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLndhcm4oYFNlcnZpY2UgZGVncmFkZWQgZXJyb3I6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFNlc3Npb25FeHBpcmVkRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLmluZm8oYFNlc3Npb24gZXhwaXJlZCBlcnJvcjogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdG1ldGhvZCxcblx0XHRcdFx0XHRcdHVybCxcblx0XHRcdFx0XHRcdGlwXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgU2xvd0FwaVdhcm5pbmc6XG5cdFx0XHRcdFx0bG9nZ2VyLndhcm4oYFNsb3cgQVBJIHdhcm5pbmc6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFRpbWVvdXRFcnJvcjpcblx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoYFRpbWVvdXQgZXJyb3I6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFVzZXJBY3Rpb25JbmZvOlxuXHRcdFx0XHRcdGxvZ2dlci5pbmZvKGBVc2VyIGFjdGlvbiBpbmZvOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBWYWxpZGF0aW9uRXJyb3I6XG5cdFx0XHRcdFx0bG9nZ2VyLmluZm8oYFZhbGlkYXRpb24gZXJyb3I6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChpc0xvZ2dlcihsb2dnZXIpKSB7XG5cdFx0XHRzd2l0Y2ggKHNldmVyaXR5KSB7XG5cdFx0XHRcdGNhc2UgRXJyb3JTZXZlcml0eS5GQVRBTDpcblx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoYEZBVEFMOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0c3RhY2ssXG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIEVycm9yU2V2ZXJpdHkuUkVDT1ZFUkFCTEU6XG5cdFx0XHRcdFx0bG9nZ2VyLndhcm4oYFJFQ09WRVJBQkxFOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0c3RhY2ssXG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIEVycm9yU2V2ZXJpdHkuV0FSTklORzpcblx0XHRcdFx0XHRsb2dnZXIud2FybihgV0FSTklORzogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdHN0YWNrLFxuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBFcnJvclNldmVyaXR5LklORk86XG5cdFx0XHRcdFx0bG9nZ2VyLmluZm8oYElORk86ICR7bWVzc2FnZX1gLCB7IG1ldGhvZCwgdXJsLCBpcCB9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoYFVOS05PV04gU0VWRVJJVFk6ICR7bWVzc2FnZX1gLCB7XG5cdFx0XHRcdFx0XHRzdGFjayxcblx0XHRcdFx0XHRcdG1ldGhvZCxcblx0XHRcdFx0XHRcdHVybCxcblx0XHRcdFx0XHRcdGlwXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHN3aXRjaCAoc2V2ZXJpdHkpIHtcblx0XHRcdFx0Y2FzZSBFcnJvclNldmVyaXR5LkZBVEFMOlxuXHRcdFx0XHRcdGZhbGxiYWNrTG9nZ2VyLmVycm9yKGBGQVRBTDogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdHN0YWNrLFxuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBFcnJvclNldmVyaXR5LlJFQ09WRVJBQkxFOlxuXHRcdFx0XHRcdGZhbGxiYWNrTG9nZ2VyLndhcm4oYFJFQ09WRVJBQkxFOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0c3RhY2ssXG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIEVycm9yU2V2ZXJpdHkuV0FSTklORzpcblx0XHRcdFx0XHRmYWxsYmFja0xvZ2dlci53YXJuKGBXQVJOSU5HOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0c3RhY2ssXG5cdFx0XHRcdFx0XHRtZXRob2QsXG5cdFx0XHRcdFx0XHR1cmwsXG5cdFx0XHRcdFx0XHRpcFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIEVycm9yU2V2ZXJpdHkuSU5GTzpcblx0XHRcdFx0XHRmYWxsYmFja0xvZ2dlci5pbmZvKGBJTkZPOiAke21lc3NhZ2V9YCwge1xuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRmYWxsYmFja0xvZ2dlci5lcnJvcihgVU5LTk9XTiBTRVZFUklUWTogJHttZXNzYWdlfWAsIHtcblx0XHRcdFx0XHRcdHN0YWNrLFxuXHRcdFx0XHRcdFx0bWV0aG9kLFxuXHRcdFx0XHRcdFx0dXJsLFxuXHRcdFx0XHRcdFx0aXBcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cdH0gY2F0Y2ggKGxvZ2dpbmdFcnJvcikge1xuXHRcdGZhbGxiYWNrTG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gbG9nIHRoZSBvcmlnaW5hbCBlcnJvcicsIHtcblx0XHRcdG9yaWdpbmFsRXJyb3I6IGVycm9yLFxuXHRcdFx0bG9nZ2luZ0Vycm9yOlxuXHRcdFx0XHRsb2dnaW5nRXJyb3IgaW5zdGFuY2VvZiBFcnJvclxuXHRcdFx0XHRcdD8gbG9nZ2luZ0Vycm9yLnN0YWNrXG5cdFx0XHRcdFx0OiBTdHJpbmcobG9nZ2luZ0Vycm9yKVxuXHRcdH0pO1xuXHR9XG59XG4iXX0=
