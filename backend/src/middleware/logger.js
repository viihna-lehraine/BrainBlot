import { __awaiter } from 'tslib';
import pkg from 'winston';
import DailyRotateFile from 'winston-daily-rotate-file';
import loadEnv from '../config/loadEnv.js';
const { createLogger, format, transports } = pkg;
const { combine, timestamp, printf, colorize, errors, json } = format;
let logFormat = printf(({ level, message, timestamp, stack }) => {
	return `${timestamp}, ${level}: ${stack || message}`;
});
function setupLogger() {
	return __awaiter(this, void 0, void 0, function* () {
		loadEnv();
		let logger = createLogger({
			level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',
			format: combine(
				timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),
				errors({ stack: true }),
				json()
			),
			defaultMeta: { service: 'guestbook-service' },
			transports: [
				new transports.Console({
					format: combine(colorize(), logFormat)
				}),
				new DailyRotateFile({
					filename: './logs/server/error-%DATE%.log',
					dirname: './logs/server',
					datePattern: 'YYYY-MM-DD',
					zippedArchive: true,
					maxSize: '20m',
					maxFiles: '14d',
					format: logFormat
				})
			]
		});
		return logger;
	});
}
export default setupLogger;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdHMvbWlkZGxld2FyZS9sb2dnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sR0FBRyxNQUFNLFNBQVMsQ0FBQztBQUMxQixPQUFPLGVBQWUsTUFBTSwyQkFBMkIsQ0FBQztBQUN4RCxPQUFPLE9BQU8sTUFBTSxtQkFBbUIsQ0FBQztBQUV4QyxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsR0FBRyxHQUFHLENBQUM7QUFDakQsTUFBTSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxDQUFDO0FBRXRFLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRTtJQUMvRCxPQUFPLEdBQUcsU0FBUyxLQUFLLEtBQUssS0FBSyxLQUFLLElBQUksT0FBTyxFQUFFLENBQUM7QUFDdEQsQ0FBQyxDQUFDLENBQUM7QUFFSCxTQUFlLFdBQVc7O1FBQ3pCLE9BQU8sRUFBRSxDQUFDO1FBRVYsSUFBSSxNQUFNLEdBQUcsWUFBWSxDQUFDO1lBQ3pCLEtBQUssRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxZQUFZLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTztZQUMvRCxNQUFNLEVBQUUsT0FBTyxDQUNkLFNBQVMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxxQkFBcUIsRUFBRSxDQUFDLEVBQzVDLE1BQU0sQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUN2QixJQUFJLEVBQUUsQ0FDTjtZQUNELFdBQVcsRUFBRSxFQUFFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRTtZQUM3QyxVQUFVLEVBQUU7Z0JBQ1gsSUFBSSxVQUFVLENBQUMsT0FBTyxDQUFDO29CQUN0QixNQUFNLEVBQUUsT0FBTyxDQUFDLFFBQVEsRUFBRSxFQUFFLFNBQVMsQ0FBQztpQkFDdEMsQ0FBQztnQkFDRixJQUFJLGVBQWUsQ0FBQztvQkFDbkIsUUFBUSxFQUFFLGdDQUFnQztvQkFDMUMsT0FBTyxFQUFFLGVBQWU7b0JBQ3hCLFdBQVcsRUFBRSxZQUFZO29CQUN6QixhQUFhLEVBQUUsSUFBSTtvQkFDbkIsT0FBTyxFQUFFLEtBQUs7b0JBQ2QsUUFBUSxFQUFFLEtBQUs7b0JBQ2YsTUFBTSxFQUFFLFNBQVM7aUJBQ2pCLENBQUM7YUFDRjtTQUNELENBQUMsQ0FBQztRQUVILE9BQU8sTUFBTSxDQUFDO0lBQ2YsQ0FBQztDQUFBO0FBRUQsZUFBZSxXQUFXLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGtnIGZyb20gJ3dpbnN0b24nO1xuaW1wb3J0IERhaWx5Um90YXRlRmlsZSBmcm9tICd3aW5zdG9uLWRhaWx5LXJvdGF0ZS1maWxlJztcbmltcG9ydCBsb2FkRW52IGZyb20gJy4uL2NvbmZpZy9sb2FkRW52JztcblxuY29uc3QgeyBjcmVhdGVMb2dnZXIsIGZvcm1hdCwgdHJhbnNwb3J0cyB9ID0gcGtnO1xuY29uc3QgeyBjb21iaW5lLCB0aW1lc3RhbXAsIHByaW50ZiwgY29sb3JpemUsIGVycm9ycywganNvbiB9ID0gZm9ybWF0O1xuXG5sZXQgbG9nRm9ybWF0ID0gcHJpbnRmKCh7IGxldmVsLCBtZXNzYWdlLCB0aW1lc3RhbXAsIHN0YWNrIH0pID0+IHtcblx0cmV0dXJuIGAke3RpbWVzdGFtcH0sICR7bGV2ZWx9OiAke3N0YWNrIHx8IG1lc3NhZ2V9YDtcbn0pO1xuXG5hc3luYyBmdW5jdGlvbiBzZXR1cExvZ2dlcigpIHtcblx0bG9hZEVudigpO1xuXG5cdGxldCBsb2dnZXIgPSBjcmVhdGVMb2dnZXIoe1xuXHRcdGxldmVsOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nID8gJ2luZm8nIDogJ2RlYnVnJyxcblx0XHRmb3JtYXQ6IGNvbWJpbmUoXG5cdFx0XHR0aW1lc3RhbXAoeyBmb3JtYXQ6ICdZWVlZLU1NLUREIEhIOm1tOnNzJyB9KSxcblx0XHRcdGVycm9ycyh7IHN0YWNrOiB0cnVlIH0pLFxuXHRcdFx0anNvbigpXG5cdFx0KSxcblx0XHRkZWZhdWx0TWV0YTogeyBzZXJ2aWNlOiAnZ3Vlc3Rib29rLXNlcnZpY2UnIH0sXG5cdFx0dHJhbnNwb3J0czogW1xuXHRcdFx0bmV3IHRyYW5zcG9ydHMuQ29uc29sZSh7XG5cdFx0XHRcdGZvcm1hdDogY29tYmluZShjb2xvcml6ZSgpLCBsb2dGb3JtYXQpXG5cdFx0XHR9KSxcblx0XHRcdG5ldyBEYWlseVJvdGF0ZUZpbGUoe1xuXHRcdFx0XHRmaWxlbmFtZTogJy4vbG9ncy9zZXJ2ZXIvZXJyb3ItJURBVEUlLmxvZycsXG5cdFx0XHRcdGRpcm5hbWU6ICcuL2xvZ3Mvc2VydmVyJyxcblx0XHRcdFx0ZGF0ZVBhdHRlcm46ICdZWVlZLU1NLUREJyxcblx0XHRcdFx0emlwcGVkQXJjaGl2ZTogdHJ1ZSxcblx0XHRcdFx0bWF4U2l6ZTogJzIwbScsXG5cdFx0XHRcdG1heEZpbGVzOiAnMTRkJyxcblx0XHRcdFx0Zm9ybWF0OiBsb2dGb3JtYXRcblx0XHRcdH0pXG5cdFx0XVxuXHR9KTtcblxuXHRyZXR1cm4gbG9nZ2VyO1xufVxuXG5leHBvcnQgZGVmYXVsdCBzZXR1cExvZ2dlcjtcbiJdfQ==
