import { __awaiter } from 'tslib';
import jwt from 'jsonwebtoken';
import getSecrets from '../../config/secrets.js';
let secrets;
let loadSecrets = () =>
	__awaiter(void 0, void 0, void 0, function* () {
		if (!secrets) {
			secrets = yield getSecrets();
		}
		return secrets;
	});
export let generateToken = (user) =>
	__awaiter(void 0, void 0, void 0, function* () {
		let secrets = yield loadSecrets();
		if (!secrets) {
			throw new Error('Secrets could not be loaded');
		}
		return jwt.sign(
			{ id: user.id, username: user.username },
			secrets.JWT_SECRET,
			{ expiresIn: '1h' }
		);
	});
export let verifyJwToken = (token) =>
	__awaiter(void 0, void 0, void 0, function* () {
		try {
			let secrets = yield loadSecrets();
			if (!secrets) {
				throw new Error('Secrets could not be loaded');
			}
			return jwt.verify(token, secrets.JWT_SECRET);
		} catch (err) {
			console.log(err);
			return null;
		}
	});
export default verifyJwToken;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiand0VXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3RzL3V0aWxzL2F1dGgvand0VXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxHQUFHLE1BQU0sY0FBYyxDQUFDO0FBQy9CLE9BQU8sVUFBVSxNQUFNLHNCQUFzQixDQUFDO0FBVzlDLElBQUksT0FBNEIsQ0FBQztBQUVqQyxJQUFJLFdBQVcsR0FBRyxHQUFTLEVBQUU7SUFDNUIsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2QsT0FBTyxHQUFHLE1BQU0sVUFBVSxFQUFFLENBQUM7SUFDOUIsQ0FBQztJQUNELE9BQU8sT0FBTyxDQUFDO0FBQ2hCLENBQUMsQ0FBQSxDQUFDO0FBRUYsTUFBTSxDQUFDLElBQUksYUFBYSxHQUFHLENBQU8sSUFBVSxFQUFFLEVBQUU7SUFDL0MsSUFBSSxPQUFPLEdBQUcsTUFBTSxXQUFXLEVBQUUsQ0FBQztJQUNsQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDZCxNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUNELE9BQU8sR0FBRyxDQUFDLElBQUksQ0FDZCxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQ3hDLE9BQU8sQ0FBQyxVQUFVLEVBQ2xCLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUNuQixDQUFDO0FBQ0gsQ0FBQyxDQUFBLENBQUM7QUFFRixNQUFNLENBQUMsSUFBSSxhQUFhLEdBQUcsQ0FBTyxLQUFhLEVBQUUsRUFBRTtJQUNsRCxJQUFJLENBQUM7UUFDSixJQUFJLE9BQU8sR0FBRyxNQUFNLFdBQVcsRUFBRSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNkLE1BQU0sSUFBSSxLQUFLLENBQUMsNkJBQTZCLENBQUMsQ0FBQztRQUNoRCxDQUFDO1FBQ0QsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDZCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQztBQUNGLENBQUMsQ0FBQSxDQUFDO0FBRUYsZUFBZSxhQUFhLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XG5pbXBvcnQgZ2V0U2VjcmV0cyBmcm9tICcuLi8uLi9jb25maWcvc2VjcmV0cyc7XG5cbmludGVyZmFjZSBTZWNyZXRzIHtcblx0SldUX1NFQ1JFVDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgVXNlciB7XG5cdGlkOiBzdHJpbmc7XG5cdHVzZXJuYW1lOiBzdHJpbmc7XG59XG5cbmxldCBzZWNyZXRzOiBTZWNyZXRzIHwgdW5kZWZpbmVkO1xuXG5sZXQgbG9hZFNlY3JldHMgPSBhc3luYyAoKSA9PiB7XG5cdGlmICghc2VjcmV0cykge1xuXHRcdHNlY3JldHMgPSBhd2FpdCBnZXRTZWNyZXRzKCk7XG5cdH1cblx0cmV0dXJuIHNlY3JldHM7XG59O1xuXG5leHBvcnQgbGV0IGdlbmVyYXRlVG9rZW4gPSBhc3luYyAodXNlcjogVXNlcikgPT4ge1xuXHRsZXQgc2VjcmV0cyA9IGF3YWl0IGxvYWRTZWNyZXRzKCk7XG5cdGlmICghc2VjcmV0cykge1xuXHRcdHRocm93IG5ldyBFcnJvcignU2VjcmV0cyBjb3VsZCBub3QgYmUgbG9hZGVkJyk7XG5cdH1cblx0cmV0dXJuIGp3dC5zaWduKFxuXHRcdHsgaWQ6IHVzZXIuaWQsIHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lIH0sXG5cdFx0c2VjcmV0cy5KV1RfU0VDUkVULFxuXHRcdHsgZXhwaXJlc0luOiAnMWgnIH1cblx0KTtcbn07XG5cbmV4cG9ydCBsZXQgdmVyaWZ5SndUb2tlbiA9IGFzeW5jICh0b2tlbjogc3RyaW5nKSA9PiB7XG5cdHRyeSB7XG5cdFx0bGV0IHNlY3JldHMgPSBhd2FpdCBsb2FkU2VjcmV0cygpO1xuXHRcdGlmICghc2VjcmV0cykge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdTZWNyZXRzIGNvdWxkIG5vdCBiZSBsb2FkZWQnKTtcblx0XHR9XG5cdFx0cmV0dXJuIGp3dC52ZXJpZnkodG9rZW4sIHNlY3JldHMuSldUX1NFQ1JFVCk7XG5cdH0gY2F0Y2ggKGVycikge1xuXHRcdGNvbnNvbGUubG9nKGVycik7XG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IHZlcmlmeUp3VG9rZW47XG4iXX0=
