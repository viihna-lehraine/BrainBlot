import fs from 'fs';
import os from 'os';
import toobusy from 'toobusy-js';
import { EnvConfigServiceFactory } from '../index/factory/subfactories/EnvConfigServiceFactory.mjs';
import { CacheLayerServiceFactory } from '../index/factory/subfactories/CacheLayerServiceFactory.mjs';
import { DatabaseControllerFactory } from '../index/factory/subfactories/DatabaseControllerFactory.mjs';
import { HTTPSServerFactory } from '../index/factory/subfactories/HTTPSServerFactory.mjs';
import { LoggerServiceFactory } from '../index/factory/subfactories/LoggerServiceFactory.mjs';
import { ErrorHandlerServiceFactory } from '../index/factory/subfactories/ErrorHandlerServiceFactory.mjs';
import { ResourceManagerFactory } from '../index/factory/subfactories/ResourceManagerFactory.mjs';
export class HealthCheckService {
	static instance = null;
	logger;
	errorLogger;
	errorHandler;
	envConfig;
	cacheService;
	resourceManager;
	databaseController;
	httpsServer;
	healthCheckHistory = [];
	thresholdBreaches = [];
	healthCheckInterval = null;
	constructor(
		logger,
		errorLogger,
		errorHandler,
		envConfig,
		cacheService,
		resourceManager,
		databaseController,
		httpsServer
	) {
		this.logger = logger;
		this.errorLogger = errorLogger;
		this.errorHandler = errorHandler;
		this.envConfig = envConfig;
		this.cacheService = cacheService;
		this.resourceManager = resourceManager;
		this.databaseController = databaseController;
		this.httpsServer = httpsServer;
		this.healthCheckInterval = setInterval(() => {
			this.performHealthCheck();
		}, 10000);
	}
	static async getInstance() {
		if (!HealthCheckService.instance) {
			const logger = await LoggerServiceFactory.getLoggerService();
			const errorLogger =
				await LoggerServiceFactory.getErrorLoggerService();
			const errorHandler =
				await ErrorHandlerServiceFactory.getErrorHandlerService();
			const envConfig =
				await EnvConfigServiceFactory.getEnvConfigService();
			const cacheService =
				await CacheLayerServiceFactory.getCacheService();
			const resourceManager =
				await ResourceManagerFactory.getResourceManager();
			const databaseController =
				await DatabaseControllerFactory.getDatabaseController();
			const httpsServer = await HTTPSServerFactory.getHTTPSServer();
			HealthCheckService.instance = new HealthCheckService(
				logger,
				errorLogger,
				errorHandler,
				envConfig,
				cacheService,
				resourceManager,
				databaseController,
				httpsServer
			);
		}
		return HealthCheckService.instance;
	}
	async performHealthCheck() {
		try {
			const databaseInfo =
				await this.databaseController.getDatabaseInfo();
			const httpsServerInfo = await this.httpsServer.getHTTPSServerInfo();
			const databaseHealth = {
				status: databaseInfo ? 'Connected' : 'Not connected',
				uptime: databaseInfo?.uptime_in_seconds ?? 0,
				cpuUsed: databaseInfo?.used_cpu_sys ?? 0,
				memoryUsed: databaseInfo?.used_memory ?? 0,
				cacheSize: databaseInfo?.cacheSize ?? 0,
				connectedClients: databaseInfo?.connected_clients ?? 0
			};
			const httpsServerHealth = {
				status: httpsServerInfo ? 'Running' : 'Stopped',
				uptime: httpsServerInfo?.uptime_in_seconds ?? 0,
				memoryUsed: (httpsServerInfo?.memoryUsage).heapUsed ?? 0,
				heapTotal: (httpsServerInfo?.memoryUsage).heapTotal ?? 0,
				cpuUsage: (httpsServerInfo?.cpuUsage).user ?? 0,
				connections: httpsServerInfo?.connections ?? 0
			};
			const healthSummary = {
				timestamp: new Date().toISOString(),
				databaseStatus: databaseHealth.status,
				httpsServerStatus: httpsServerHealth.status,
				databaseMetrics: databaseHealth,
				httpsServerMetrics: httpsServerHealth,
				cacheServiceMetrics:
					this.cacheService.getCacheMetrics('healthCheckService'),
				eventLoopLag: toobusy.lag(),
				cpuUsage: this.resourceManager.getCpuUsage(),
				memoryUsage: this.resourceManager.getMemoryUsage(),
				diskUsage: await this.resourceManager.getDiskUsage(),
				networkStatus: this.resourceManager.getNetworkUsage(),
				eventLoopLagThreshold: this.envConfig.getEnvVariable(
					'eventLoopLagThreshold'
				),
				cpuThreshold: this.envConfig.getEnvVariable('cpuThreshold'),
				cpuLimit: this.envConfig.getEnvVariable('cpuLimit'),
				memoryThreshold:
					this.envConfig.getEnvVariable('memoryThreshold'),
				memoryLimit: this.envConfig.getEnvVariable('memoryLimit'),
				maxCacheSize: this.envConfig.getEnvVariable('maxCacheSize'),
				maxRedisCacheSize:
					this.envConfig.getEnvVariable('maxRedisCacheSize')
			};
			this.saveHealthCheckToHistory(healthSummary);
			this.logger.debug(`Health Check: ${JSON.stringify(healthSummary)}`);
			return healthSummary;
		} catch (error) {
			this.handleHealthCheckError(
				error,
				'HEALTH_CHECK_ERROR',
				{},
				'Error performing health check'
			);
			return {};
		}
	}
	async getHTTPSServerMetrics(serviceName) {
		try {
			const serverMetrics =
				await this.httpsServer.getHTTPSServerMetrics(serviceName);
			return {
				averageResponseTime: serverMetrics.averageResponseTime,
				requestRate: serverMetrics.requestsPerSecond,
				openConnections: serverMetrics.openConnections
			};
		} catch (error) {
			this.logger.error(
				`Failed to fetch HTTPS server metrics for ${serviceName}`,
				error
			);
			throw error;
		}
	}
	getHealthCheckHistory() {
		return this.healthCheckHistory;
	}
	async getHealthDataForDashboard() {
		return {
			currentHealth: await this.performHealthCheck(),
			history: this.getHealthCheckHistory()
		};
	}
	monitorEventLoopLag() {
		try {
			const lagThreshold =
				this.envConfig.getEnvVariable('eventLoopLagThreshold') || 70;
			setInterval(() => {
				const lag = toobusy.lag();
				if (lag > lagThreshold) {
					this.logger.warn(`High event loop lag detected: ${lag}ms`);
					this.resourceManager.adjustResources();
				}
			}, 10000);
		} catch (error) {
			this.handleHealthCheckError(
				error,
				'EVENT_LOOP_LAG_MONITOR_ERROR',
				{},
				'Error monitoring event loop lag'
			);
		}
	}
	monitorCPU() {
		setInterval(() => {
			const cpuUsage = this.resourceManager.getCpuUsage();
			cpuUsage.forEach(({ core, usage }) => {
				this.logger.info(`CPU ${core}: Usage ${usage}`);
			});
			this.resourceManager.adjustResources();
		}, 5000);
	}
	monitorMemoryUsage() {
		setInterval(() => {
			const memoryUsage = this.resourceManager.getMemoryUsage();
			this.logger.info(`Memory Usage: ${JSON.stringify(memoryUsage)}`);
			const memoryLimit = this.envConfig.getEnvVariable('memoryLimit');
			if (memoryUsage.heapUsed > memoryLimit) {
				this.logger.warn(
					`Memory usage exceeded limit (${memoryLimit} bytes). Adjusting resources...`
				);
				this.resourceManager.adjustResources();
			}
		}, 10000);
	}
	monitorDiskUsage() {
		try {
			const diskPath = this.envConfig.getEnvVariable('diskPath') || '/';
			setInterval(() => {
				fs.stat(diskPath, (err, stats) => {
					if (err) {
						this.logger.error(`Error getting disk usage: ${err}`);
						return;
					}
					this.logger.info(`Disk usage: ${JSON.stringify(stats)}`);
				});
			}, 30000);
		} catch (error) {
			this.handleHealthCheckError(
				error,
				'DISK_MONITOR_ERROR',
				{},
				'Error monitoring disk usage'
			);
		}
	}
	monitorCacheSize() {
		const cacheMetrics =
			this.cacheService.getCacheMetrics('resourceManager');
		const cacheSize = cacheMetrics.cacheSize;
		if (cacheSize) {
			if (cacheSize > this.envConfig.getEnvVariable('maxCacheSize')) {
				this.logger.warn(
					`Cache size exceeded limit. Clearing old entries...`
				);
				this.resourceManager.evictCacheEntries('resourceManager');
			}
		} else {
			this.logger.error('Error getting cache size');
		}
	}
	monitorNetworkUsage() {
		try {
			setInterval(() => {
				const networkInterfaces = os.networkInterfaces();
				Object.keys(networkInterfaces).forEach(interfaceName => {
					const netStats = networkInterfaces[interfaceName];
					if (netStats) {
						netStats.forEach(netStat => {
							this.logger.info(
								`Interface ${interfaceName}: Address ${netStat.address}, Family ${netStat.family}, Internal ${netStat.internal}`
							);
						});
					}
				});
			}, 10000);
		} catch (error) {
			this.handleHealthCheckError(
				error,
				'NETWORK_MONITOR_ERROR',
				{},
				'Error monitoring network usage'
			);
		}
	}
	saveHealthCheckToHistory(healthCheckData) {
		if (this.healthCheckHistory.length >= 100) {
			this.healthCheckHistory.shift();
		}
		this.healthCheckHistory.push(healthCheckData);
	}
	checkThresholds(healthSummary) {
		const eventLoopLag = healthSummary.eventLoopLag;
		const cpuUsage = healthSummary.cpuUsage;
		const memoryUsage = healthSummary.memoryUsage;
		if (
			eventLoopLag >
			this.envConfig.getEnvVariable('eventLoopLagThreshold')
		) {
			this.triggerAlert(
				'Event Loop Lag exceeded threshold',
				eventLoopLag
			);
		}
		if (
			cpuUsage.some(
				cpu =>
					parseFloat(cpu.usage) >
					this.envConfig.getEnvVariable('cpuThreshold')
			)
		) {
			this.triggerAlert('CPU Usage exceeded threshold', cpuUsage);
		}
		if (
			memoryUsage.heapUsed >
			this.envConfig.getEnvVariable('memoryThreshold')
		) {
			this.triggerAlert(
				'Memory Usage exceeded threshold',
				memoryUsage.heapUsed
			);
		}
	}
	triggerAlert(message, value) {
		this.logger.warn(`${message}: ${value}`);
		// *DEV-NOTE* email alert + webhook notification here.
	}
	autoRecover(healthSummary) {
		const memoryUsage = healthSummary.memoryUsage;
		if (
			memoryUsage.heapUsed > this.envConfig.getEnvVariable('memoryLimit')
		) {
			this.logger.warn('Memory usage high, attempting recovery...');
			const serviceName = 'healthCheckService'; // Specify the service name
			this.resourceManager.clearCaches(serviceName).catch(err => {
				this.logger.error(
					`Failed to clear caches for service: ${serviceName}`,
					err
				);
			});
			this.resourceManager.closeIdleConnections().catch(err => {
				this.logger.error('Failed to close idle connections', err);
			});
		}
	}
	logThresholdBreach(metric, value) {
		this.thresholdBreaches.push({
			metric,
			value,
			timestamp: new Date().toISOString()
		});
		if (this.thresholdBreaches.length > 100) {
			this.thresholdBreaches.shift();
		}
	}
	async shutdown() {
		try {
			this.logger.info('Shutting down HealthCheckService...');
			if (this.healthCheckInterval) {
				clearInterval(this.healthCheckInterval);
				this.logger.info('Health check interval cleared.');
			}
			await this.cacheService.clearNamespace('healthCheckService');
			this.logger.info('Health check cache cleared.');
			if (toobusy) {
				toobusy.shutdown();
				this.logger.info('Toobusy.js shutdown complete.');
			}
			this.logger.info('HealthCheckService shutdown completed.');
		} catch (error) {
			this.handleHealthCheckError(
				error,
				'SHUTDOWN_ERROR',
				{},
				'Error during HealthCheckService shutdown'
			);
		}
	}
	handleHealthCheckError(error, errorHeader, errorDetails, customMessage) {
		try {
			const errorMessage = `${customMessage}: ${error}\n${error instanceof Error ? error.stack : ''}`;
			this.errorLogger.logError(errorMessage);
			const healthCheckError =
				new this.errorHandler.ErrorClasses.ResourceManagerError(
					errorHeader,
					{
						details: errorDetails,
						exposeToClient: false
					}
				);
			this.errorHandler.handleError({
				error: healthCheckError
			});
		} catch (error) {
			this.errorLogger.logError(
				`Error handling health check error: ${error}`
			);
			const severity = this.errorHandler.ErrorSeverity.WARNING;
			this.errorHandler.handleError({
				error,
				details: {
					context: 'Health Check Service',
					action: 'Passing error from health check error handler to ErrorHandlerService',
					notes: 'Error occurred while handling Health Check error: ResourceManager.handleResourceManagerError'
				},
				severity
			});
		}
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSGVhbHRoQ2hlY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc2VydmljZXMvSGVhbHRoQ2hlY2sudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ3BCLE9BQU8sRUFBRSxNQUFNLElBQUksQ0FBQztBQUNwQixPQUFPLE9BQU8sTUFBTSxZQUFZLENBQUM7QUFZakMsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sdURBQXVELENBQUM7QUFDaEcsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sd0RBQXdELENBQUM7QUFDbEcsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0seURBQXlELENBQUM7QUFDcEcsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDdEYsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sb0RBQW9ELENBQUM7QUFDMUYsT0FBTyxFQUFFLDBCQUEwQixFQUFFLE1BQU0sMERBQTBELENBQUM7QUFDdEcsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sc0RBQXNELENBQUM7QUFFOUYsTUFBTSxPQUFPLGtCQUFrQjtJQUN0QixNQUFNLENBQUMsUUFBUSxHQUE4QixJQUFJLENBQUM7SUFDbEQsTUFBTSxDQUE0QjtJQUNsQyxXQUFXLENBQThCO0lBQ3pDLFlBQVksQ0FBK0I7SUFDM0MsU0FBUyxDQUE0QjtJQUNyQyxZQUFZLENBQXdCO0lBQ3BDLGVBQWUsQ0FBMkI7SUFDMUMsa0JBQWtCLENBQThCO0lBQ2hELFdBQVcsQ0FBdUI7SUFFbEMsa0JBQWtCLEdBQThCLEVBQUUsQ0FBQztJQUNuRCxpQkFBaUIsR0FBbUMsRUFBRSxDQUFDO0lBQ3ZELG1CQUFtQixHQUEwQixJQUFJLENBQUM7SUFFMUQsWUFDQyxNQUFpQyxFQUNqQyxXQUF3QyxFQUN4QyxZQUEwQyxFQUMxQyxTQUFvQyxFQUNwQyxZQUFtQyxFQUNuQyxlQUF5QyxFQUN6Qyxr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QUFzQjtvQkFDL0IsTUFBTSxFQUFFLHNFQUFzRTtvQkFDOUUsS0FBSyxFQUFFLDhGQUE4RjtpQkFDckc7Z0JBQ0QsUUFBUTthQUNSLENBQUMsQ0FBQztRQUNKLENBQUM7SUFDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBvcyBmcm9tICdvcyc7XG5pbXBvcnQgdG9vYnVzeSBmcm9tICd0b29idXN5LWpzJztcbmltcG9ydCB7XG5cdEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2UsXG5cdENhY2hlU2VydmljZUludGVyZmFjZSxcblx0RGF0YWJhc2VDb250cm9sbGVySW50ZXJmYWNlLFxuXHRFbnZDb25maWdTZXJ2aWNlSW50ZXJmYWNlLFxuXHRFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2UsXG5cdEVycm9ySGFuZGxlclNlcnZpY2VJbnRlcmZhY2UsXG5cdEhlYWx0aENoZWNrU2VydmljZUludGVyZmFjZSxcblx0SFRUUFNTZXJ2ZXJJbnRlcmZhY2UsXG5cdFJlc291cmNlTWFuYWdlckludGVyZmFjZVxufSBmcm9tICcuLi9pbmRleC9pbnRlcmZhY2VzL21haW4nO1xuaW1wb3J0IHsgRW52Q29uZmlnU2VydmljZUZhY3RvcnkgfSBmcm9tICcuLi9pbmRleC9mYWN0b3J5L3N1YmZhY3Rvcmllcy9FbnZDb25maWdTZXJ2aWNlRmFjdG9yeSc7XG5pbXBvcnQgeyBDYWNoZUxheWVyU2VydmljZUZhY3RvcnkgfSBmcm9tICcuLi9pbmRleC9mYWN0b3J5L3N1YmZhY3Rvcmllcy9DYWNoZUxheWVyU2VydmljZUZhY3RvcnknO1xuaW1wb3J0IHsgRGF0YWJhc2VDb250cm9sbGVyRmFjdG9yeSB9IGZyb20gJy4uL2luZGV4L2ZhY3Rvcnkvc3ViZmFjdG9yaWVzL0RhdGFiYXNlQ29udHJvbGxlckZhY3RvcnknO1xuaW1wb3J0IHsgSFRUUFNTZXJ2ZXJGYWN0b3J5IH0gZnJvbSAnLi4vaW5kZXgvZmFjdG9yeS9zdWJmYWN0b3JpZXMvSFRUUFNTZXJ2ZXJGYWN0b3J5JztcbmltcG9ydCB7IExvZ2dlclNlcnZpY2VGYWN0b3J5IH0gZnJvbSAnLi4vaW5kZXgvZmFjdG9yeS9zdWJmYWN0b3JpZXMvTG9nZ2VyU2VydmljZUZhY3RvcnknO1xuaW1wb3J0IHsgRXJyb3JIYW5kbGVyU2VydmljZUZhY3RvcnkgfSBmcm9tICcuLi9pbmRleC9mYWN0b3J5L3N1YmZhY3Rvcmllcy9FcnJvckhhbmRsZXJTZXJ2aWNlRmFjdG9yeSc7XG5pbXBvcnQgeyBSZXNvdXJjZU1hbmFnZXJGYWN0b3J5IH0gZnJvbSAnLi4vaW5kZXgvZmFjdG9yeS9zdWJmYWN0b3JpZXMvUmVzb3VyY2VNYW5hZ2VyRmFjdG9yeSc7XG5cbmV4cG9ydCBjbGFzcyBIZWFsdGhDaGVja1NlcnZpY2UgaW1wbGVtZW50cyBIZWFsdGhDaGVja1NlcnZpY2VJbnRlcmZhY2Uge1xuXHRwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogSGVhbHRoQ2hlY2tTZXJ2aWNlIHwgbnVsbCA9IG51bGw7XG5cdHByaXZhdGUgbG9nZ2VyOiBBcHBMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIGVycm9yTG9nZ2VyOiBFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2U7XG5cdHByaXZhdGUgZXJyb3JIYW5kbGVyOiBFcnJvckhhbmRsZXJTZXJ2aWNlSW50ZXJmYWNlO1xuXHRwcml2YXRlIGVudkNvbmZpZzogRW52Q29uZmlnU2VydmljZUludGVyZmFjZTtcblx0cHJpdmF0ZSBjYWNoZVNlcnZpY2U6IENhY2hlU2VydmljZUludGVyZmFjZTtcblx0cHJpdmF0ZSByZXNvdXJjZU1hbmFnZXI6IFJlc291cmNlTWFuYWdlckludGVyZmFjZTtcblx0cHJpdmF0ZSBkYXRhYmFzZUNvbnRyb2xsZXI6IERhdGFiYXNlQ29udHJvbGxlckludGVyZmFjZTtcblx0cHJpdmF0ZSBodHRwc1NlcnZlcjogSFRUUFNTZXJ2ZXJJbnRlcmZhY2U7XG5cblx0cHJpdmF0ZSBoZWFsdGhDaGVja0hpc3Rvcnk6IFJlY29yZDxzdHJpbmcsIHVua25vd24+W10gPSBbXTtcblx0cHJpdmF0ZSB0aHJlc2hvbGRCcmVhY2hlczogQXJyYXk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+ID0gW107XG5cdHByaXZhdGUgaGVhbHRoQ2hlY2tJbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcblxuXHRwcml2YXRlIGNvbnN0cnVjdG9yKFxuXHRcdGxvZ2dlcjogQXBwTG9nZ2VyU2VydmljZUludGVyZmFjZSxcblx0XHRlcnJvckxvZ2dlcjogRXJyb3JMb2dnZXJTZXJ2aWNlSW50ZXJmYWNlLFxuXHRcdGVycm9ySGFuZGxlcjogRXJyb3JIYW5kbGVyU2VydmljZUludGVyZmFjZSxcblx0XHRlbnZDb25maWc6IEVudkNvbmZpZ1NlcnZpY2VJbnRlcmZhY2UsXG5cdFx0Y2FjaGVTZXJ2aWNlOiBDYWNoZVNlcnZpY2VJbnRlcmZhY2UsXG5cdFx0cmVzb3VyY2VNYW5hZ2VyOiBSZXNvdXJjZU1hbmFnZXJJbnRlcmZhY2UsXG5cdFx0ZGF0YWJhc2VDb250cm9sbGVyOiBEYXRhYmFzZUNvbnRyb2xsZXJJbnRlcmZhY2UsXG5cdFx0aHR0cHNTZXJ2ZXI6IEhUVFBTU2VydmVySW50ZXJmYWNlXG5cdCkge1xuXHRcdHRoaXMubG9nZ2VyID0gbG9nZ2VyO1xuXHRcdHRoaXMuZXJyb3JMb2dnZXIgPSBlcnJvckxvZ2dlcjtcblx0XHR0aGlzLmVycm9ySGFuZGxlciA9IGVycm9ySGFuZGxlcjtcblx0XHR0aGlzLmVudkNvbmZpZyA9IGVudkNvbmZpZztcblx0XHR0aGlzLmNhY2hlU2VydmljZSA9IGNhY2hlU2VydmljZTtcblx0XHR0aGlzLnJlc291cmNlTWFuYWdlciA9IHJlc291cmNlTWFuYWdlcjtcblx0XHR0aGlzLmRhdGFiYXNlQ29udHJvbGxlciA9IGRhdGFiYXNlQ29udHJvbGxlcjtcblx0XHR0aGlzLmh0dHBzU2VydmVyID0gaHR0cHNTZXJ2ZXI7XG5cblx0XHR0aGlzLmhlYWx0aENoZWNrSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG5cdFx0XHR0aGlzLnBlcmZvcm1IZWFsdGhDaGVjaygpO1xuXHRcdH0sIDEwMDAwKTtcblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgYXN5bmMgZ2V0SW5zdGFuY2UoKTogUHJvbWlzZTxIZWFsdGhDaGVja1NlcnZpY2U+IHtcblx0XHRpZiAoIUhlYWx0aENoZWNrU2VydmljZS5pbnN0YW5jZSkge1xuXHRcdFx0Y29uc3QgbG9nZ2VyID0gYXdhaXQgTG9nZ2VyU2VydmljZUZhY3RvcnkuZ2V0TG9nZ2VyU2VydmljZSgpO1xuXHRcdFx0Y29uc3QgZXJyb3JMb2dnZXIgPVxuXHRcdFx0XHRhd2FpdCBMb2dnZXJTZXJ2aWNlRmFjdG9yeS5nZXRFcnJvckxvZ2dlclNlcnZpY2UoKTtcblx0XHRcdGNvbnN0IGVycm9ySGFuZGxlciA9XG5cdFx0XHRcdGF3YWl0IEVycm9ySGFuZGxlclNlcnZpY2VGYWN0b3J5LmdldEVycm9ySGFuZGxlclNlcnZpY2UoKTtcblx0XHRcdGNvbnN0IGVudkNvbmZpZyA9XG5cdFx0XHRcdGF3YWl0IEVudkNvbmZpZ1NlcnZpY2VGYWN0b3J5LmdldEVudkNvbmZpZ1NlcnZpY2UoKTtcblx0XHRcdGNvbnN0IGNhY2hlU2VydmljZSA9XG5cdFx0XHRcdGF3YWl0IENhY2hlTGF5ZXJTZXJ2aWNlRmFjdG9yeS5nZXRDYWNoZVNlcnZpY2UoKTtcblx0XHRcdGNvbnN0IHJlc291cmNlTWFuYWdlciA9XG5cdFx0XHRcdGF3YWl0IFJlc291cmNlTWFuYWdlckZhY3RvcnkuZ2V0UmVzb3VyY2VNYW5hZ2VyKCk7XG5cdFx0XHRjb25zdCBkYXRhYmFzZUNvbnRyb2xsZXIgPVxuXHRcdFx0XHRhd2FpdCBEYXRhYmFzZUNvbnRyb2xsZXJGYWN0b3J5LmdldERhdGFiYXNlQ29udHJvbGxlcigpO1xuXHRcdFx0Y29uc3QgaHR0cHNTZXJ2ZXIgPSBhd2FpdCBIVFRQU1NlcnZlckZhY3RvcnkuZ2V0SFRUUFNTZXJ2ZXIoKTtcblxuXHRcdFx0SGVhbHRoQ2hlY2tTZXJ2aWNlLmluc3RhbmNlID0gbmV3IEhlYWx0aENoZWNrU2VydmljZShcblx0XHRcdFx0bG9nZ2VyLFxuXHRcdFx0XHRlcnJvckxvZ2dlcixcblx0XHRcdFx0ZXJyb3JIYW5kbGVyLFxuXHRcdFx0XHRlbnZDb25maWcsXG5cdFx0XHRcdGNhY2hlU2VydmljZSxcblx0XHRcdFx0cmVzb3VyY2VNYW5hZ2VyLFxuXHRcdFx0XHRkYXRhYmFzZUNvbnRyb2xsZXIsXG5cdFx0XHRcdGh0dHBzU2VydmVyXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdHJldHVybiBIZWFsdGhDaGVja1NlcnZpY2UuaW5zdGFuY2U7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgcGVyZm9ybUhlYWx0aENoZWNrKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgZGF0YWJhc2VJbmZvID1cblx0XHRcdFx0YXdhaXQgdGhpcy5kYXRhYmFzZUNvbnRyb2xsZXIuZ2V0RGF0YWJhc2VJbmZvKCk7XG5cdFx0XHRjb25zdCBodHRwc1NlcnZlckluZm8gPSBhd2FpdCB0aGlzLmh0dHBzU2VydmVyLmdldEhUVFBTU2VydmVySW5mbygpO1xuXG5cdFx0XHRjb25zdCBkYXRhYmFzZUhlYWx0aCA9IHtcblx0XHRcdFx0c3RhdHVzOiBkYXRhYmFzZUluZm8gPyAnQ29ubmVjdGVkJyA6ICdOb3QgY29ubmVjdGVkJyxcblx0XHRcdFx0dXB0aW1lOiBkYXRhYmFzZUluZm8/LnVwdGltZV9pbl9zZWNvbmRzID8/IDAsXG5cdFx0XHRcdGNwdVVzZWQ6IGRhdGFiYXNlSW5mbz8udXNlZF9jcHVfc3lzID8/IDAsXG5cdFx0XHRcdG1lbW9yeVVzZWQ6IGRhdGFiYXNlSW5mbz8udXNlZF9tZW1vcnkgPz8gMCxcblx0XHRcdFx0Y2FjaGVTaXplOiBkYXRhYmFzZUluZm8/LmNhY2hlU2l6ZSA/PyAwLFxuXHRcdFx0XHRjb25uZWN0ZWRDbGllbnRzOiBkYXRhYmFzZUluZm8/LmNvbm5lY3RlZF9jbGllbnRzID8/IDBcblx0XHRcdH07XG5cblx0XHRcdGNvbnN0IGh0dHBzU2VydmVySGVhbHRoID0ge1xuXHRcdFx0XHRzdGF0dXM6IGh0dHBzU2VydmVySW5mbyA/ICdSdW5uaW5nJyA6ICdTdG9wcGVkJyxcblx0XHRcdFx0dXB0aW1lOiBodHRwc1NlcnZlckluZm8/LnVwdGltZV9pbl9zZWNvbmRzID8/IDAsXG5cdFx0XHRcdG1lbW9yeVVzZWQ6XG5cdFx0XHRcdFx0KGh0dHBzU2VydmVySW5mbz8ubWVtb3J5VXNhZ2UgYXMgeyBoZWFwVXNlZDogbnVtYmVyIH0pXG5cdFx0XHRcdFx0XHQuaGVhcFVzZWQgPz8gMCxcblx0XHRcdFx0aGVhcFRvdGFsOlxuXHRcdFx0XHRcdChodHRwc1NlcnZlckluZm8/Lm1lbW9yeVVzYWdlIGFzIHsgaGVhcFRvdGFsOiBudW1iZXIgfSlcblx0XHRcdFx0XHRcdC5oZWFwVG90YWwgPz8gMCxcblx0XHRcdFx0Y3B1VXNhZ2U6XG5cdFx0XHRcdFx0KGh0dHBzU2VydmVySW5mbz8uY3B1VXNhZ2UgYXMgeyB1c2VyOiBudW1iZXIgfSkudXNlciA/PyAwLFxuXHRcdFx0XHRjb25uZWN0aW9uczogaHR0cHNTZXJ2ZXJJbmZvPy5jb25uZWN0aW9ucyA/PyAwXG5cdFx0XHR9O1xuXG5cdFx0XHRjb25zdCBoZWFsdGhTdW1tYXJ5OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHtcblx0XHRcdFx0dGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG5cdFx0XHRcdGRhdGFiYXNlU3RhdHVzOiBkYXRhYmFzZUhlYWx0aC5zdGF0dXMsXG5cdFx0XHRcdGh0dHBzU2VydmVyU3RhdHVzOiBodHRwc1NlcnZlckhlYWx0aC5zdGF0dXMsXG5cdFx0XHRcdGRhdGFiYXNlTWV0cmljczogZGF0YWJhc2VIZWFsdGgsXG5cdFx0XHRcdGh0dHBzU2VydmVyTWV0cmljczogaHR0cHNTZXJ2ZXJIZWFsdGgsXG5cdFx0XHRcdGNhY2hlU2VydmljZU1ldHJpY3M6XG5cdFx0XHRcdFx0dGhpcy5jYWNoZVNlcnZpY2UuZ2V0Q2FjaGVNZXRyaWNzKCdoZWFsdGhDaGVja1NlcnZpY2UnKSxcblx0XHRcdFx0ZXZlbnRMb29wTGFnOiB0b29idXN5LmxhZygpLFxuXHRcdFx0XHRjcHVVc2FnZTogdGhpcy5yZXNvdXJjZU1hbmFnZXIuZ2V0Q3B1VXNhZ2UoKSxcblx0XHRcdFx0bWVtb3J5VXNhZ2U6IHRoaXMucmVzb3VyY2VNYW5hZ2VyLmdldE1lbW9yeVVzYWdlKCksXG5cdFx0XHRcdGRpc2tVc2FnZTogYXdhaXQgdGhpcy5yZXNvdXJjZU1hbmFnZXIuZ2V0RGlza1VzYWdlKCksXG5cdFx0XHRcdG5ldHdvcmtTdGF0dXM6IHRoaXMucmVzb3VyY2VNYW5hZ2VyLmdldE5ldHdvcmtVc2FnZSgpLFxuXHRcdFx0XHRldmVudExvb3BMYWdUaHJlc2hvbGQ6IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKFxuXHRcdFx0XHRcdCdldmVudExvb3BMYWdUaHJlc2hvbGQnXG5cdFx0XHRcdCksXG5cdFx0XHRcdGNwdVRocmVzaG9sZDogdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ2NwdVRocmVzaG9sZCcpLFxuXHRcdFx0XHRjcHVMaW1pdDogdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ2NwdUxpbWl0JyksXG5cdFx0XHRcdG1lbW9yeVRocmVzaG9sZDpcblx0XHRcdFx0XHR0aGlzLmVudkNvbmZpZy5nZXRFbnZWYXJpYWJsZSgnbWVtb3J5VGhyZXNob2xkJyksXG5cdFx0XHRcdG1lbW9yeUxpbWl0OiB0aGlzLmVudkNvbmZpZy5nZXRFbnZWYXJpYWJsZSgnbWVtb3J5TGltaXQnKSxcblx0XHRcdFx0bWF4Q2FjaGVTaXplOiB0aGlzLmVudkNvbmZpZy5nZXRFbnZWYXJpYWJsZSgnbWF4Q2FjaGVTaXplJyksXG5cdFx0XHRcdG1heFJlZGlzQ2FjaGVTaXplOlxuXHRcdFx0XHRcdHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdtYXhSZWRpc0NhY2hlU2l6ZScpXG5cdFx0XHR9O1xuXG5cdFx0XHR0aGlzLnNhdmVIZWFsdGhDaGVja1RvSGlzdG9yeShoZWFsdGhTdW1tYXJ5KTtcblx0XHRcdHRoaXMubG9nZ2VyLmRlYnVnKGBIZWFsdGggQ2hlY2s6ICR7SlNPTi5zdHJpbmdpZnkoaGVhbHRoU3VtbWFyeSl9YCk7XG5cdFx0XHRyZXR1cm4gaGVhbHRoU3VtbWFyeTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVIZWFsdGhDaGVja0Vycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J0hFQUxUSF9DSEVDS19FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgcGVyZm9ybWluZyBoZWFsdGggY2hlY2snXG5cdFx0XHQpO1xuXHRcdFx0cmV0dXJuIHt9O1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhc3luYyBnZXRIVFRQU1NlcnZlck1ldHJpY3MoXG5cdFx0c2VydmljZU5hbWU6IHN0cmluZ1xuXHQpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHNlcnZlck1ldHJpY3MgPVxuXHRcdFx0XHRhd2FpdCB0aGlzLmh0dHBzU2VydmVyLmdldEhUVFBTU2VydmVyTWV0cmljcyhzZXJ2aWNlTmFtZSk7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRhdmVyYWdlUmVzcG9uc2VUaW1lOiBzZXJ2ZXJNZXRyaWNzLmF2ZXJhZ2VSZXNwb25zZVRpbWUsXG5cdFx0XHRcdHJlcXVlc3RSYXRlOiBzZXJ2ZXJNZXRyaWNzLnJlcXVlc3RzUGVyU2Vjb25kLFxuXHRcdFx0XHRvcGVuQ29ubmVjdGlvbnM6IHNlcnZlck1ldHJpY3Mub3BlbkNvbm5lY3Rpb25zXG5cdFx0XHR9O1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEZhaWxlZCB0byBmZXRjaCBIVFRQUyBzZXJ2ZXIgbWV0cmljcyBmb3IgJHtzZXJ2aWNlTmFtZX1gLFxuXHRcdFx0XHRlcnJvclxuXHRcdFx0KTtcblx0XHRcdHRocm93IGVycm9yO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBnZXRIZWFsdGhDaGVja0hpc3RvcnkoKTogQXJyYXk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcblx0XHRyZXR1cm4gdGhpcy5oZWFsdGhDaGVja0hpc3Rvcnk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgZ2V0SGVhbHRoRGF0YUZvckRhc2hib2FyZCgpOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdGN1cnJlbnRIZWFsdGg6IGF3YWl0IHRoaXMucGVyZm9ybUhlYWx0aENoZWNrKCksXG5cdFx0XHRoaXN0b3J5OiB0aGlzLmdldEhlYWx0aENoZWNrSGlzdG9yeSgpXG5cdFx0fTtcblx0fVxuXG5cdHB1YmxpYyBtb25pdG9yRXZlbnRMb29wTGFnKCk6IHZvaWQge1xuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCBsYWdUaHJlc2hvbGQgPVxuXHRcdFx0XHR0aGlzLmVudkNvbmZpZy5nZXRFbnZWYXJpYWJsZSgnZXZlbnRMb29wTGFnVGhyZXNob2xkJykgfHwgNzA7XG5cblx0XHRcdHNldEludGVydmFsKCgpID0+IHtcblx0XHRcdFx0Y29uc3QgbGFnID0gdG9vYnVzeS5sYWcoKTtcblxuXHRcdFx0XHRpZiAobGFnID4gbGFnVGhyZXNob2xkKSB7XG5cdFx0XHRcdFx0dGhpcy5sb2dnZXIud2FybihgSGlnaCBldmVudCBsb29wIGxhZyBkZXRlY3RlZDogJHtsYWd9bXNgKTtcblx0XHRcdFx0XHR0aGlzLnJlc291cmNlTWFuYWdlci5hZGp1c3RSZXNvdXJjZXMoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSwgMTAwMDApO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZUhlYWx0aENoZWNrRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnRVZFTlRfTE9PUF9MQUdfTU9OSVRPUl9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgbW9uaXRvcmluZyBldmVudCBsb29wIGxhZydcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIG1vbml0b3JDUFUoKTogdm9pZCB7XG5cdFx0c2V0SW50ZXJ2YWwoKCkgPT4ge1xuXHRcdFx0Y29uc3QgY3B1VXNhZ2UgPSB0aGlzLnJlc291cmNlTWFuYWdlci5nZXRDcHVVc2FnZSgpO1xuXHRcdFx0Y3B1VXNhZ2UuZm9yRWFjaCgoeyBjb3JlLCB1c2FnZSB9KSA9PiB7XG5cdFx0XHRcdHRoaXMubG9nZ2VyLmluZm8oYENQVSAke2NvcmV9OiBVc2FnZSAke3VzYWdlfWApO1xuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLnJlc291cmNlTWFuYWdlci5hZGp1c3RSZXNvdXJjZXMoKTtcblx0XHR9LCA1MDAwKTtcblx0fVxuXG5cdHB1YmxpYyBtb25pdG9yTWVtb3J5VXNhZ2UoKTogdm9pZCB7XG5cdFx0c2V0SW50ZXJ2YWwoKCkgPT4ge1xuXHRcdFx0Y29uc3QgbWVtb3J5VXNhZ2UgPSB0aGlzLnJlc291cmNlTWFuYWdlci5nZXRNZW1vcnlVc2FnZSgpO1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbyhgTWVtb3J5IFVzYWdlOiAke0pTT04uc3RyaW5naWZ5KG1lbW9yeVVzYWdlKX1gKTtcblx0XHRcdGNvbnN0IG1lbW9yeUxpbWl0ID0gdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21lbW9yeUxpbWl0Jyk7XG5cdFx0XHRpZiAobWVtb3J5VXNhZ2UuaGVhcFVzZWQgPiBtZW1vcnlMaW1pdCkge1xuXHRcdFx0XHR0aGlzLmxvZ2dlci53YXJuKFxuXHRcdFx0XHRcdGBNZW1vcnkgdXNhZ2UgZXhjZWVkZWQgbGltaXQgKCR7bWVtb3J5TGltaXR9IGJ5dGVzKS4gQWRqdXN0aW5nIHJlc291cmNlcy4uLmBcblx0XHRcdFx0KTtcblx0XHRcdFx0dGhpcy5yZXNvdXJjZU1hbmFnZXIuYWRqdXN0UmVzb3VyY2VzKCk7XG5cdFx0XHR9XG5cdFx0fSwgMTAwMDApO1xuXHR9XG5cblx0cHVibGljIG1vbml0b3JEaXNrVXNhZ2UoKTogdm9pZCB7XG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IGRpc2tQYXRoID0gdGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ2Rpc2tQYXRoJykgfHwgJy8nO1xuXHRcdFx0c2V0SW50ZXJ2YWwoKCkgPT4ge1xuXHRcdFx0XHRmcy5zdGF0KGRpc2tQYXRoLCAoZXJyLCBzdGF0cykgPT4ge1xuXHRcdFx0XHRcdGlmIChlcnIpIHtcblx0XHRcdFx0XHRcdHRoaXMubG9nZ2VyLmVycm9yKGBFcnJvciBnZXR0aW5nIGRpc2sgdXNhZ2U6ICR7ZXJyfWApO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHR0aGlzLmxvZ2dlci5pbmZvKGBEaXNrIHVzYWdlOiAke0pTT04uc3RyaW5naWZ5KHN0YXRzKX1gKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9LCAzMDAwMCk7XG5cdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdHRoaXMuaGFuZGxlSGVhbHRoQ2hlY2tFcnJvcihcblx0XHRcdFx0ZXJyb3IsXG5cdFx0XHRcdCdESVNLX01PTklUT1JfRVJST1InLFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0J0Vycm9yIG1vbml0b3JpbmcgZGlzayB1c2FnZSdcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIG1vbml0b3JDYWNoZVNpemUoKTogdm9pZCB7XG5cdFx0Y29uc3QgY2FjaGVNZXRyaWNzID1cblx0XHRcdHRoaXMuY2FjaGVTZXJ2aWNlLmdldENhY2hlTWV0cmljcygncmVzb3VyY2VNYW5hZ2VyJyk7XG5cdFx0Y29uc3QgY2FjaGVTaXplID0gY2FjaGVNZXRyaWNzLmNhY2hlU2l6ZTtcblxuXHRcdGlmIChjYWNoZVNpemUpIHtcblx0XHRcdGlmIChjYWNoZVNpemUgPiB0aGlzLmVudkNvbmZpZy5nZXRFbnZWYXJpYWJsZSgnbWF4Q2FjaGVTaXplJykpIHtcblx0XHRcdFx0dGhpcy5sb2dnZXIud2Fybihcblx0XHRcdFx0XHRgQ2FjaGUgc2l6ZSBleGNlZWRlZCBsaW1pdC4gQ2xlYXJpbmcgb2xkIGVudHJpZXMuLi5gXG5cdFx0XHRcdCk7XG5cdFx0XHRcdHRoaXMucmVzb3VyY2VNYW5hZ2VyLmV2aWN0Q2FjaGVFbnRyaWVzKCdyZXNvdXJjZU1hbmFnZXInKTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5sb2dnZXIuZXJyb3IoJ0Vycm9yIGdldHRpbmcgY2FjaGUgc2l6ZScpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBtb25pdG9yTmV0d29ya1VzYWdlKCk6IHZvaWQge1xuXHRcdHRyeSB7XG5cdFx0XHRzZXRJbnRlcnZhbCgoKSA9PiB7XG5cdFx0XHRcdGNvbnN0IG5ldHdvcmtJbnRlcmZhY2VzID0gb3MubmV0d29ya0ludGVyZmFjZXMoKTtcblx0XHRcdFx0T2JqZWN0LmtleXMobmV0d29ya0ludGVyZmFjZXMpLmZvckVhY2goaW50ZXJmYWNlTmFtZSA9PiB7XG5cdFx0XHRcdFx0Y29uc3QgbmV0U3RhdHMgPSBuZXR3b3JrSW50ZXJmYWNlc1tpbnRlcmZhY2VOYW1lXTtcblx0XHRcdFx0XHRpZiAobmV0U3RhdHMpIHtcblx0XHRcdFx0XHRcdG5ldFN0YXRzLmZvckVhY2gobmV0U3RhdCA9PiB7XG5cdFx0XHRcdFx0XHRcdHRoaXMubG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0XHRcdFx0YEludGVyZmFjZSAke2ludGVyZmFjZU5hbWV9OiBBZGRyZXNzICR7bmV0U3RhdC5hZGRyZXNzfSwgRmFtaWx5ICR7bmV0U3RhdC5mYW1pbHl9LCBJbnRlcm5hbCAke25ldFN0YXQuaW50ZXJuYWx9YFxuXHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH0sIDEwMDAwKTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5oYW5kbGVIZWFsdGhDaGVja0Vycm9yKFxuXHRcdFx0XHRlcnJvcixcblx0XHRcdFx0J05FVFdPUktfTU9OSVRPUl9FUlJPUicsXG5cdFx0XHRcdHt9LFxuXHRcdFx0XHQnRXJyb3IgbW9uaXRvcmluZyBuZXR3b3JrIHVzYWdlJ1xuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIHNhdmVIZWFsdGhDaGVja1RvSGlzdG9yeShcblx0XHRoZWFsdGhDaGVja0RhdGE6IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG5cdCk6IHZvaWQge1xuXHRcdGlmICh0aGlzLmhlYWx0aENoZWNrSGlzdG9yeS5sZW5ndGggPj0gMTAwKSB7XG5cdFx0XHR0aGlzLmhlYWx0aENoZWNrSGlzdG9yeS5zaGlmdCgpO1xuXHRcdH1cblx0XHR0aGlzLmhlYWx0aENoZWNrSGlzdG9yeS5wdXNoKGhlYWx0aENoZWNrRGF0YSk7XG5cdH1cblxuXHRwcml2YXRlIGNoZWNrVGhyZXNob2xkcyhoZWFsdGhTdW1tYXJ5OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IHZvaWQge1xuXHRcdGNvbnN0IGV2ZW50TG9vcExhZyA9IGhlYWx0aFN1bW1hcnkuZXZlbnRMb29wTGFnIGFzIG51bWJlcjtcblx0XHRjb25zdCBjcHVVc2FnZSA9IGhlYWx0aFN1bW1hcnkuY3B1VXNhZ2UgYXMgQXJyYXk8e1xuXHRcdFx0Y29yZTogbnVtYmVyO1xuXHRcdFx0dXNhZ2U6IHN0cmluZztcblx0XHR9Pjtcblx0XHRjb25zdCBtZW1vcnlVc2FnZSA9IGhlYWx0aFN1bW1hcnkubWVtb3J5VXNhZ2UgYXMge1xuXHRcdFx0aGVhcFVzZWQ6IG51bWJlcjtcblx0XHRcdGhlYXBUb3RhbDogbnVtYmVyO1xuXHRcdH07XG5cblx0XHRpZiAoXG5cdFx0XHRldmVudExvb3BMYWcgPlxuXHRcdFx0dGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ2V2ZW50TG9vcExhZ1RocmVzaG9sZCcpXG5cdFx0KSB7XG5cdFx0XHR0aGlzLnRyaWdnZXJBbGVydChcblx0XHRcdFx0J0V2ZW50IExvb3AgTGFnIGV4Y2VlZGVkIHRocmVzaG9sZCcsXG5cdFx0XHRcdGV2ZW50TG9vcExhZ1xuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAoXG5cdFx0XHRjcHVVc2FnZS5zb21lKFxuXHRcdFx0XHRjcHUgPT5cblx0XHRcdFx0XHRwYXJzZUZsb2F0KGNwdS51c2FnZSkgPlxuXHRcdFx0XHRcdHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdjcHVUaHJlc2hvbGQnKVxuXHRcdFx0KVxuXHRcdCkge1xuXHRcdFx0dGhpcy50cmlnZ2VyQWxlcnQoJ0NQVSBVc2FnZSBleGNlZWRlZCB0aHJlc2hvbGQnLCBjcHVVc2FnZSk7XG5cdFx0fVxuXG5cdFx0aWYgKFxuXHRcdFx0bWVtb3J5VXNhZ2UuaGVhcFVzZWQgPlxuXHRcdFx0dGhpcy5lbnZDb25maWcuZ2V0RW52VmFyaWFibGUoJ21lbW9yeVRocmVzaG9sZCcpXG5cdFx0KSB7XG5cdFx0XHR0aGlzLnRyaWdnZXJBbGVydChcblx0XHRcdFx0J01lbW9yeSBVc2FnZSBleGNlZWRlZCB0aHJlc2hvbGQnLFxuXHRcdFx0XHRtZW1vcnlVc2FnZS5oZWFwVXNlZFxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIHRyaWdnZXJBbGVydChtZXNzYWdlOiBzdHJpbmcsIHZhbHVlOiB1bmtub3duKTogdm9pZCB7XG5cdFx0dGhpcy5sb2dnZXIud2FybihgJHttZXNzYWdlfTogJHt2YWx1ZX1gKTtcblx0XHQvLyAqREVWLU5PVEUqIGVtYWlsIGFsZXJ0ICsgd2ViaG9vayBub3RpZmljYXRpb24gaGVyZS5cblx0fVxuXG5cdHByaXZhdGUgYXV0b1JlY292ZXIoaGVhbHRoU3VtbWFyeTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiB2b2lkIHtcblx0XHRjb25zdCBtZW1vcnlVc2FnZSA9IGhlYWx0aFN1bW1hcnkubWVtb3J5VXNhZ2UgYXMge1xuXHRcdFx0aGVhcFVzZWQ6IG51bWJlcjtcblx0XHRcdGhlYXBUb3RhbDogbnVtYmVyO1xuXHRcdH07XG5cblx0XHRpZiAoXG5cdFx0XHRtZW1vcnlVc2FnZS5oZWFwVXNlZCA+IHRoaXMuZW52Q29uZmlnLmdldEVudlZhcmlhYmxlKCdtZW1vcnlMaW1pdCcpXG5cdFx0KSB7XG5cdFx0XHR0aGlzLmxvZ2dlci53YXJuKCdNZW1vcnkgdXNhZ2UgaGlnaCwgYXR0ZW1wdGluZyByZWNvdmVyeS4uLicpO1xuXHRcdFx0Y29uc3Qgc2VydmljZU5hbWUgPSAnaGVhbHRoQ2hlY2tTZXJ2aWNlJzsgLy8gU3BlY2lmeSB0aGUgc2VydmljZSBuYW1lXG5cblx0XHRcdHRoaXMucmVzb3VyY2VNYW5hZ2VyLmNsZWFyQ2FjaGVzKHNlcnZpY2VOYW1lKS5jYXRjaChlcnIgPT4ge1xuXHRcdFx0XHR0aGlzLmxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHRgRmFpbGVkIHRvIGNsZWFyIGNhY2hlcyBmb3Igc2VydmljZTogJHtzZXJ2aWNlTmFtZX1gLFxuXHRcdFx0XHRcdGVyclxuXHRcdFx0XHQpO1xuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLnJlc291cmNlTWFuYWdlci5jbG9zZUlkbGVDb25uZWN0aW9ucygpLmNhdGNoKGVyciA9PiB7XG5cdFx0XHRcdHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gY2xvc2UgaWRsZSBjb25uZWN0aW9ucycsIGVycik7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHRwcml2YXRlIGxvZ1RocmVzaG9sZEJyZWFjaChtZXRyaWM6IHN0cmluZywgdmFsdWU6IHVua25vd24pOiB2b2lkIHtcblx0XHR0aGlzLnRocmVzaG9sZEJyZWFjaGVzLnB1c2goe1xuXHRcdFx0bWV0cmljLFxuXHRcdFx0dmFsdWUsXG5cdFx0XHR0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuXHRcdH0pO1xuXHRcdGlmICh0aGlzLnRocmVzaG9sZEJyZWFjaGVzLmxlbmd0aCA+IDEwMCkge1xuXHRcdFx0dGhpcy50aHJlc2hvbGRCcmVhY2hlcy5zaGlmdCgpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBhc3luYyBzaHV0ZG93bigpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0cnkge1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnU2h1dHRpbmcgZG93biBIZWFsdGhDaGVja1NlcnZpY2UuLi4nKTtcblxuXHRcdFx0aWYgKHRoaXMuaGVhbHRoQ2hlY2tJbnRlcnZhbCkge1xuXHRcdFx0XHRjbGVhckludGVydmFsKHRoaXMuaGVhbHRoQ2hlY2tJbnRlcnZhbCk7XG5cdFx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ0hlYWx0aCBjaGVjayBpbnRlcnZhbCBjbGVhcmVkLicpO1xuXHRcdFx0fVxuXG5cdFx0XHRhd2FpdCB0aGlzLmNhY2hlU2VydmljZS5jbGVhck5hbWVzcGFjZSgnaGVhbHRoQ2hlY2tTZXJ2aWNlJyk7XG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdIZWFsdGggY2hlY2sgY2FjaGUgY2xlYXJlZC4nKTtcblxuXHRcdFx0aWYgKHRvb2J1c3kpIHtcblx0XHRcdFx0dG9vYnVzeS5zaHV0ZG93bigpO1xuXHRcdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdUb29idXN5LmpzIHNodXRkb3duIGNvbXBsZXRlLicpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLmxvZ2dlci5pbmZvKCdIZWFsdGhDaGVja1NlcnZpY2Ugc2h1dGRvd24gY29tcGxldGVkLicpO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aGlzLmhhbmRsZUhlYWx0aENoZWNrRXJyb3IoXG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHQnU0hVVERPV05fRVJST1InLFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0J0Vycm9yIGR1cmluZyBIZWFsdGhDaGVja1NlcnZpY2Ugc2h1dGRvd24nXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgaGFuZGxlSGVhbHRoQ2hlY2tFcnJvcihcblx0XHRlcnJvcjogdW5rbm93bixcblx0XHRlcnJvckhlYWRlcjogc3RyaW5nLFxuXHRcdGVycm9yRGV0YWlsczogb2JqZWN0LFxuXHRcdGN1c3RvbU1lc3NhZ2U6IHN0cmluZ1xuXHQpOiB2b2lkIHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgZXJyb3JNZXNzYWdlID0gYCR7Y3VzdG9tTWVzc2FnZX06ICR7ZXJyb3J9XFxuJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiAnJ31gO1xuXHRcdFx0dGhpcy5lcnJvckxvZ2dlci5sb2dFcnJvcihlcnJvck1lc3NhZ2UpO1xuXHRcdFx0Y29uc3QgaGVhbHRoQ2hlY2tFcnJvciA9XG5cdFx0XHRcdG5ldyB0aGlzLmVycm9ySGFuZGxlci5FcnJvckNsYXNzZXMuUmVzb3VyY2VNYW5hZ2VyRXJyb3IoXG5cdFx0XHRcdFx0ZXJyb3JIZWFkZXIsXG5cdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0ZGV0YWlsczogZXJyb3JEZXRhaWxzLFxuXHRcdFx0XHRcdFx0ZXhwb3NlVG9DbGllbnQ6IGZhbHNlXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHQpO1xuXG5cdFx0XHR0aGlzLmVycm9ySGFuZGxlci5oYW5kbGVFcnJvcih7XG5cdFx0XHRcdGVycm9yOiBoZWFsdGhDaGVja0Vycm9yXG5cdFx0XHR9KTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5lcnJvckxvZ2dlci5sb2dFcnJvcihcblx0XHRcdFx0YEVycm9yIGhhbmRsaW5nIGhlYWx0aCBjaGVjayBlcnJvcjogJHtlcnJvcn1gXG5cdFx0XHQpO1xuXHRcdFx0Y29uc3Qgc2V2ZXJpdHkgPSB0aGlzLmVycm9ySGFuZGxlci5FcnJvclNldmVyaXR5LldBUk5JTkc7XG5cdFx0XHR0aGlzLmVycm9ySGFuZGxlci5oYW5kbGVFcnJvcih7XG5cdFx0XHRcdGVycm9yLFxuXHRcdFx0XHRkZXRhaWxzOiB7XG5cdFx0XHRcdFx0Y29udGV4dDogJ0hlYWx0aCBDaGVjayBTZXJ2aWNlJyxcblx0XHRcdFx0XHRhY3Rpb246ICdQYXNzaW5nIGVycm9yIGZyb20gaGVhbHRoIGNoZWNrIGVycm9yIGhhbmRsZXIgdG8gRXJyb3JIYW5kbGVyU2VydmljZScsXG5cdFx0XHRcdFx0bm90ZXM6ICdFcnJvciBvY2N1cnJlZCB3aGlsZSBoYW5kbGluZyBIZWFsdGggQ2hlY2sgZXJyb3I6IFJlc291cmNlTWFuYWdlci5oYW5kbGVSZXNvdXJjZU1hbmFnZXJFcnJvcidcblx0XHRcdFx0fSxcblx0XHRcdFx0c2V2ZXJpdHlcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxufVxuIl19
