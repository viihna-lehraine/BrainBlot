import Tokens from 'csrf';
import { LoggerServiceFactory } from '../index/factory/subfactories/LoggerServiceFactory.mjs';
import { ErrorHandlerServiceFactory } from '../index/factory/subfactories/ErrorHandlerServiceFactory.mjs';
export class CSRFMiddlewareService {
	static instance = null;
	csrfProtection;
	logger;
	errorLogger;
	errorHandler;
	constructor(options) {
		this.csrfProtection = new Tokens(options);
	}
	static async getInstance(options) {
		if (!CSRFMiddlewareService.instance) {
			const logger = await LoggerServiceFactory.getLoggerService();
			const errorLogger =
				await LoggerServiceFactory.getErrorLoggerService();
			const errorHandler =
				await ErrorHandlerServiceFactory.getErrorHandlerService();
			CSRFMiddlewareService.instance = new CSRFMiddlewareService(options);
			CSRFMiddlewareService.instance.logger = logger;
			CSRFMiddlewareService.instance.errorLogger = errorLogger;
			CSRFMiddlewareService.instance.errorHandler = errorHandler;
		}
		return CSRFMiddlewareService.instance;
	}
	initializeCSRFMiddleware() {
		return async (req, res, next) => {
			try {
				this.logger.info('CSRF middleware enabled');
				const sessionID = req.sessionID || '';
				const csrfToken = this.csrfProtection.create(sessionID);
				res.locals.csrfToken = csrfToken;
				if (this.isWhitelistedRoute(req.path)) {
					this.logger.debug(
						`Route ${req.path} is whitelisted from CSRF`
					);
					return next();
				}
				if (!['GET', 'HEAD', 'OPTIONS'].includes(req.method)) {
					const token =
						req.body.csrfToken || req.headers['x-xsrf-token'];
					if (!token) {
						this.logger.debug('No CSRF token provided');
						res.status(403).json({
							error: 'No CSRF token provided'
						});
						return;
					}
					if (!this.csrfProtection.verify(sessionID, token)) {
						this.logger.debug(
							`Invalid CSRF token for session ID: ${sessionID}`
						);
						res.status(403).json({ error: 'Invalid CSRF token' });
						return;
					}
					this.logger.debug('CSRF token validated successfully');
				}
				next();
			} catch (expressError) {
				const expressMiddlewareError =
					new this.errorHandler.ErrorClasses.ExpressError(
						`Error occurred in CSRF middleware\n${expressError instanceof Error ? expressError.message : String(expressError)}`,
						{ originalError: expressError }
					);
				this.errorLogger.logError(expressMiddlewareError.message);
				this.errorHandler.expressErrorHandler()(
					expressMiddlewareError,
					req,
					res,
					next
				);
			}
		};
	}
	isWhitelistedRoute(path) {
		const whitelistedRoutes = ['/api/webhook', '/api/special'];
		return whitelistedRoutes.includes(path);
	}
	async shutdown() {
		try {
			this.logger.info('Shutting down CSRF Middleware Service...');
			CSRFMiddlewareService.instance = null;
			this.logger.info('CSRF Middleware Service has been shut down.');
		} catch (error) {
			this.errorLogger.logError(
				`Error shutting down CSRF Middleware service: ${error instanceof Error ? error.message : error}`
			);
		}
	}
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ1NSRi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL0NTUkYudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBT0EsT0FBTyxNQUFrQyxNQUFNLE1BQU0sQ0FBQztBQUN0RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUMxRixPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSwwREFBMEQsQ0FBQztBQUV0RyxNQUFNLE9BQU8scUJBQXFCO0lBQ3pCLE1BQU0sQ0FBQyxRQUFRLEdBQWlDLElBQUksQ0FBQztJQUNyRCxjQUFjLENBQVM7SUFDdkIsTUFBTSxDQUE2QjtJQUNuQyxXQUFXLENBQStCO0lBQzFDLFlBQVksQ0FBZ0M7SUFFcEQsWUFBb0IsT0FBcUI7UUFDeEMsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRU0sTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQzlCLE9BQXFCO1FBRXJCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNyQyxNQUFNLE1BQU0sR0FBRyxNQUFNLG9CQUFvQixDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFDN0QsTUFBTSxXQUFXLEdBQ2hCLE1BQU0sb0JBQW9CLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUNwRCxNQUFNLFlBQVksR0FDakIsTUFBTSwwQkFBMEIsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1lBRTNELHFCQUFxQixDQUFDLFFBQVEsR0FBRyxJQUFJLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3BFLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQy9DLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1lBQ3pELHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFD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QUFJLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRU0sS0FBSyxDQUFDLFFBQVE7UUFDcEIsSUFBSSxDQUFDO1lBQ0osSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsMENBQTBDLENBQUMsQ0FBQztZQUM3RCxxQkFBcUIsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1lBQ3RDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLDZDQUE2QyxDQUFDLENBQUM7UUFDakUsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDaEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQ3hCLGdEQUFnRCxLQUFLLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FDaEcsQ0FBQztRQUNILENBQUM7SUFDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcblx0QXBwTG9nZ2VyU2VydmljZUludGVyZmFjZSxcblx0Q1NSRk1pZGRsZXdhcmVTZXJ2aWNlSW50ZXJmYWNlLFxuXHRFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2UsXG5cdEVycm9ySGFuZGxlclNlcnZpY2VJbnRlcmZhY2Vcbn0gZnJvbSAnLi4vaW5kZXgvaW50ZXJmYWNlcy9tYWluJztcbmltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tICdleHByZXNzJztcbmltcG9ydCBUb2tlbnMsIHsgT3B0aW9ucyBhcyBDU1JGT3B0aW9ucyB9IGZyb20gJ2NzcmYnO1xuaW1wb3J0IHsgTG9nZ2VyU2VydmljZUZhY3RvcnkgfSBmcm9tICcuLi9pbmRleC9mYWN0b3J5L3N1YmZhY3Rvcmllcy9Mb2dnZXJTZXJ2aWNlRmFjdG9yeSc7XG5pbXBvcnQgeyBFcnJvckhhbmRsZXJTZXJ2aWNlRmFjdG9yeSB9IGZyb20gJy4uL2luZGV4L2ZhY3Rvcnkvc3ViZmFjdG9yaWVzL0Vycm9ySGFuZGxlclNlcnZpY2VGYWN0b3J5JztcblxuZXhwb3J0IGNsYXNzIENTUkZNaWRkbGV3YXJlU2VydmljZSBpbXBsZW1lbnRzIENTUkZNaWRkbGV3YXJlU2VydmljZUludGVyZmFjZSB7XG5cdHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBDU1JGTWlkZGxld2FyZVNlcnZpY2UgfCBudWxsID0gbnVsbDtcblx0cHJpdmF0ZSBjc3JmUHJvdGVjdGlvbjogVG9rZW5zO1xuXHRwcml2YXRlIGxvZ2dlciE6IEFwcExvZ2dlclNlcnZpY2VJbnRlcmZhY2U7XG5cdHByaXZhdGUgZXJyb3JMb2dnZXIhOiBFcnJvckxvZ2dlclNlcnZpY2VJbnRlcmZhY2U7XG5cdHByaXZhdGUgZXJyb3JIYW5kbGVyITogRXJyb3JIYW5kbGVyU2VydmljZUludGVyZmFjZTtcblxuXHRwcml2YXRlIGNvbnN0cnVjdG9yKG9wdGlvbnM/OiBDU1JGT3B0aW9ucykge1xuXHRcdHRoaXMuY3NyZlByb3RlY3Rpb24gPSBuZXcgVG9rZW5zKG9wdGlvbnMpO1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBhc3luYyBnZXRJbnN0YW5jZShcblx0XHRvcHRpb25zPzogQ1NSRk9wdGlvbnNcblx0KTogUHJvbWlzZTxDU1JGTWlkZGxld2FyZVNlcnZpY2U+IHtcblx0XHRpZiAoIUNTUkZNaWRkbGV3YXJlU2VydmljZS5pbnN0YW5jZSkge1xuXHRcdFx0Y29uc3QgbG9nZ2VyID0gYXdhaXQgTG9nZ2VyU2VydmljZUZhY3RvcnkuZ2V0TG9nZ2VyU2VydmljZSgpO1xuXHRcdFx0Y29uc3QgZXJyb3JMb2dnZXIgPVxuXHRcdFx0XHRhd2FpdCBMb2dnZXJTZXJ2aWNlRmFjdG9yeS5nZXRFcnJvckxvZ2dlclNlcnZpY2UoKTtcblx0XHRcdGNvbnN0IGVycm9ySGFuZGxlciA9XG5cdFx0XHRcdGF3YWl0IEVycm9ySGFuZGxlclNlcnZpY2VGYWN0b3J5LmdldEVycm9ySGFuZGxlclNlcnZpY2UoKTtcblxuXHRcdFx0Q1NSRk1pZGRsZXdhcmVTZXJ2aWNlLmluc3RhbmNlID0gbmV3IENTUkZNaWRkbGV3YXJlU2VydmljZShvcHRpb25zKTtcblx0XHRcdENTUkZNaWRkbGV3YXJlU2VydmljZS5pbnN0YW5jZS5sb2dnZXIgPSBsb2dnZXI7XG5cdFx0XHRDU1JGTWlkZGxld2FyZVNlcnZpY2UuaW5zdGFuY2UuZXJyb3JMb2dnZXIgPSBlcnJvckxvZ2dlcjtcblx0XHRcdENTUkZNaWRkbGV3YXJlU2VydmljZS5pbnN0YW5jZS5lcnJvckhhbmRsZXIgPSBlcnJvckhhbmRsZXI7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIENTUkZNaWRkbGV3YXJlU2VydmljZS5pbnN0YW5jZTtcblx0fVxuXG5cdHB1YmxpYyBpbml0aWFsaXplQ1NSRk1pZGRsZXdhcmUoKSB7XG5cdFx0cmV0dXJuIGFzeW5jIChcblx0XHRcdHJlcTogUmVxdWVzdCxcblx0XHRcdHJlczogUmVzcG9uc2UsXG5cdFx0XHRuZXh0OiBOZXh0RnVuY3Rpb25cblx0XHQpOiBQcm9taXNlPHZvaWQ+ID0+IHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ0NTUkYgbWlkZGxld2FyZSBlbmFibGVkJyk7XG5cdFx0XHRcdGNvbnN0IHNlc3Npb25JRCA9IHJlcS5zZXNzaW9uSUQgfHwgJyc7XG5cdFx0XHRcdGNvbnN0IGNzcmZUb2tlbiA9IHRoaXMuY3NyZlByb3RlY3Rpb24uY3JlYXRlKHNlc3Npb25JRCk7XG5cdFx0XHRcdHJlcy5sb2NhbHMuY3NyZlRva2VuID0gY3NyZlRva2VuO1xuXG5cdFx0XHRcdGlmICh0aGlzLmlzV2hpdGVsaXN0ZWRSb3V0ZShyZXEucGF0aCkpIHtcblx0XHRcdFx0XHR0aGlzLmxvZ2dlci5kZWJ1Zyhcblx0XHRcdFx0XHRcdGBSb3V0ZSAke3JlcS5wYXRofSBpcyB3aGl0ZWxpc3RlZCBmcm9tIENTUkZgXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRyZXR1cm4gbmV4dCgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCFbJ0dFVCcsICdIRUFEJywgJ09QVElPTlMnXS5pbmNsdWRlcyhyZXEubWV0aG9kKSkge1xuXHRcdFx0XHRcdGNvbnN0IHRva2VuID1cblx0XHRcdFx0XHRcdHJlcS5ib2R5LmNzcmZUb2tlbiB8fFxuXHRcdFx0XHRcdFx0KHJlcS5oZWFkZXJzWyd4LXhzcmYtdG9rZW4nXSBhcyBzdHJpbmcpO1xuXHRcdFx0XHRcdGlmICghdG9rZW4pIHtcblx0XHRcdFx0XHRcdHRoaXMubG9nZ2VyLmRlYnVnKCdObyBDU1JGIHRva2VuIHByb3ZpZGVkJyk7XG5cdFx0XHRcdFx0XHRyZXMuc3RhdHVzKDQwMykuanNvbih7XG5cdFx0XHRcdFx0XHRcdGVycm9yOiAnTm8gQ1NSRiB0b2tlbiBwcm92aWRlZCdcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoIXRoaXMuY3NyZlByb3RlY3Rpb24udmVyaWZ5KHNlc3Npb25JRCwgdG9rZW4pKSB7XG5cdFx0XHRcdFx0XHR0aGlzLmxvZ2dlci5kZWJ1Zyhcblx0XHRcdFx0XHRcdFx0YEludmFsaWQgQ1NSRiB0b2tlbiBmb3Igc2Vzc2lvbiBJRDogJHtzZXNzaW9uSUR9YFxuXHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRcdHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgZXJyb3I6ICdJbnZhbGlkIENTUkYgdG9rZW4nIH0pO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHR0aGlzLmxvZ2dlci5kZWJ1ZygnQ1NSRiB0b2tlbiB2YWxpZGF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRuZXh0KCk7XG5cdFx0XHR9IGNhdGNoIChleHByZXNzRXJyb3IpIHtcblx0XHRcdFx0Y29uc3QgZXhwcmVzc01pZGRsZXdhcmVFcnJvciA9XG5cdFx0XHRcdFx0bmV3IHRoaXMuZXJyb3JIYW5kbGVyLkVycm9yQ2xhc3Nlcy5FeHByZXNzRXJyb3IoXG5cdFx0XHRcdFx0XHRgRXJyb3Igb2NjdXJyZWQgaW4gQ1NSRiBtaWRkbGV3YXJlXFxuJHtleHByZXNzRXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGV4cHJlc3NFcnJvci5tZXNzYWdlIDogU3RyaW5nKGV4cHJlc3NFcnJvcil9YCxcblx0XHRcdFx0XHRcdHsgb3JpZ2luYWxFcnJvcjogZXhwcmVzc0Vycm9yIH1cblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR0aGlzLmVycm9yTG9nZ2VyLmxvZ0Vycm9yKGV4cHJlc3NNaWRkbGV3YXJlRXJyb3IubWVzc2FnZSk7XG5cdFx0XHRcdHRoaXMuZXJyb3JIYW5kbGVyLmV4cHJlc3NFcnJvckhhbmRsZXIoKShcblx0XHRcdFx0XHRleHByZXNzTWlkZGxld2FyZUVycm9yLFxuXHRcdFx0XHRcdHJlcSxcblx0XHRcdFx0XHRyZXMsXG5cdFx0XHRcdFx0bmV4dFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH07XG5cdH1cblxuXHRwcml2YXRlIGlzV2hpdGVsaXN0ZWRSb3V0ZShwYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcblx0XHRjb25zdCB3aGl0ZWxpc3RlZFJvdXRlcyA9IFsnL2FwaS93ZWJob29rJywgJy9hcGkvc3BlY2lhbCddO1xuXHRcdHJldHVybiB3aGl0ZWxpc3RlZFJvdXRlcy5pbmNsdWRlcyhwYXRoKTtcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBzaHV0ZG93bigpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0cnkge1xuXHRcdFx0dGhpcy5sb2dnZXIuaW5mbygnU2h1dHRpbmcgZG93biBDU1JGIE1pZGRsZXdhcmUgU2VydmljZS4uLicpO1xuXHRcdFx0Q1NSRk1pZGRsZXdhcmVTZXJ2aWNlLmluc3RhbmNlID0gbnVsbDtcblx0XHRcdHRoaXMubG9nZ2VyLmluZm8oJ0NTUkYgTWlkZGxld2FyZSBTZXJ2aWNlIGhhcyBiZWVuIHNodXQgZG93bi4nKTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhpcy5lcnJvckxvZ2dlci5sb2dFcnJvcihcblx0XHRcdFx0YEVycm9yIHNodXR0aW5nIGRvd24gQ1NSRiBNaWRkbGV3YXJlIHNlcnZpY2U6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBlcnJvcn1gXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxufVxuIl19
